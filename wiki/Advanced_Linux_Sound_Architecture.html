<!--
    title: Advanced_Linux_Sound_TOSitecture
    description: Migration of Advanced_Linux_Sound_TOSitecture from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:58:55.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Advanced Linux Sound TOSitecture</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../wiki/Advanced_Linux_Sound_TOSitecture/Configuration_examples.html" class="mw-redirect" title="ALSA configuration examples">ALSA configuration examples</a></li>
<li><a href="../wiki/Advanced_Linux_Sound_TOSitecture/Troubleshooting.html" class="mw-redirect" title="ALSA troubleshooting">ALSA troubleshooting</a></li>
<li><a href="../wiki/Sound_system.html" title="Sound system">Sound system</a></li>
<li><a href="../wiki/PC_speaker.html" title="PC speaker">PC speaker</a></li>
<li><a href="../wiki/PulseAudio.html" title="PulseAudio">PulseAudio</a></li>
<li><a href="../wiki/Open_Sound_System.html" title="Open Sound System">Open Sound System</a></li>
</ul>
</div>
<p>The <a href="https://en.wikipedia.org/wiki/Advanced_Linux_Sound_TOSitecture"  title="wikipedia:Advanced Linux Sound TOSitecture">Advanced Linux Sound TOSitecture</a> (<b>ALSA</b>) provides kernel driven sound card drivers. It replaces the original Open Sound System (OSS).
</p>
<p>Besides the sound device drivers, ALSA also bundles a user space driven library for application developers. They can then use those ALSA drivers for high level API development. This enables direct (kernel) interaction with sound devices through ALSA libraries.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Installation"><span >1</span> <span >Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#User_privileges"><span >1.1</span> <span >User privileges</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#ALSA_Utilities"><span >1.2</span> <span >ALSA Utilities</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#OSS_compatibility"><span >1.3</span> <span >OSS compatibility</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#PulseAudio_compatibility"><span >1.4</span> <span >PulseAudio compatibility</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#ALSA_and_Systemd"><span >1.5</span> <span >ALSA and Systemd</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#ALSA_Firmware"><span >1.6</span> <span >ALSA Firmware</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#Unmuting_the_channels"><span >2</span> <span >Unmuting the channels</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Unmute_with_amixer"><span >2.1</span> <span >Unmute with amixer</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Unmute_with_alsamixer"><span >2.2</span> <span >Unmute with alsamixer</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Unmute_5.1/7.1_sound"><span >2.3</span> <span >Unmute 5.1/7.1 sound</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Enable_the_microphone"><span >2.4</span> <span >Enable the microphone</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Test_your_changes"><span >2.5</span> <span >Test your changes</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Additional_notes"><span >2.6</span> <span >Additional notes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#Configuration"><span >3</span> <span >Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-16">
<a href="#Basic_syntax"><span >3.1</span> <span >Basic syntax</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#Assignments_and_Separators"><span >3.1.1</span> <span >Assignments and Separators</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#Data_types"><span >3.1.2</span> <span >Data types</span></a></li>
<li class="toclevel-3 tocsection-19">
<a href="#Operation_modes"><span >3.1.3</span> <span >Operation modes</span></a>
<ul>
<li class="toclevel-4 tocsection-20"><a href="#An_example_of_setting_default_device_using_%22defaults%22_node"><span >3.1.3.1</span> <span >An example of setting default device using "defaults" node</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-21"><a href="#Nesting"><span >3.1.4</span> <span >Nesting</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#Including_configuration_files"><span >3.1.5</span> <span >Including configuration files</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-23">
<a href="#Set_the_default_sound_card"><span >3.2</span> <span >Set the default sound card</span></a>
<ul>
<li class="toclevel-3 tocsection-24"><a href="#Select_the_default_PCM_via_environment_variable"><span >3.2.1</span> <span >Select the default PCM via environment variable</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#Alternative_method"><span >3.2.2</span> <span >Alternative method</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-26"><a href="#Verifying_correct_sound_modules_are_loaded"><span >3.3</span> <span >Verifying correct sound modules are loaded</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Getting_S/PDIF_output"><span >3.4</span> <span >Getting S/PDIF output</span></a></li>
<li class="toclevel-2 tocsection-28">
<a href="#System-wide_equalizer"><span >3.5</span> <span >System-wide equalizer</span></a>
<ul>
<li class="toclevel-3 tocsection-29">
<a href="#Using_ALSAEqual_(provides_UI)"><span >3.5.1</span> <span >Using ALSAEqual (provides UI)</span></a>
<ul>
<li class="toclevel-4 tocsection-30"><a href="#Managing_ALSAEqual_states"><span >3.5.1.1</span> <span >Managing ALSAEqual states</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-31"><a href="#Using_mbeq"><span >3.5.2</span> <span >Using mbeq</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-32"><a href="#High_quality_resampling"><span >4</span> <span >High quality resampling</span></a></li>
<li class="toclevel-1 tocsection-33">
<a href="#Upmixing/downmixing"><span >5</span> <span >Upmixing/downmixing</span></a>
<ul>
<li class="toclevel-2 tocsection-34"><a href="#Upmixing"><span >5.1</span> <span >Upmixing</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Downmixing"><span >5.2</span> <span >Downmixing</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-36"><a href="#Dmix"><span >6</span> <span >Dmix</span></a></li>
<li class="toclevel-1 tocsection-37">
<a href="#Tips_and_tricks"><span >7</span> <span >Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-38"><a href="#Disabling_auto_mute_on_startup"><span >7.1</span> <span >Disabling auto mute on startup</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Hot-plugging_a_USB_sound_card"><span >7.2</span> <span >Hot-plugging a USB sound card</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Simultaneous_output"><span >7.3</span> <span >Simultaneous output</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#Keyboard_volume_control"><span >7.4</span> <span >Keyboard volume control</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#Virtual_sound_device_using_snd-aloop"><span >7.5</span> <span >Virtual sound device using snd-aloop</span></a></li>
<li class="toclevel-2 tocsection-43">
<a href="#Debugging_ALSA"><span >7.6</span> <span >Debugging ALSA</span></a>
<ul>
<li class="toclevel-3 tocsection-44"><a href="#Retrieving_the_driver_state"><span >7.6.1</span> <span >Retrieving the driver state</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#Reconfiguring_input/output_ports"><span >7.6.2</span> <span >Reconfiguring input/output ports</span></a></li>
<li class="toclevel-3 tocsection-46"><a href="#Resetting_codecs"><span >7.6.3</span> <span >Resetting codecs</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-47"><a href="#Correctly_detect_microphone_plugged_in_a_4-pin_3.5mm_(TRRS)_jack"><span >7.7</span> <span >Correctly detect microphone plugged in a 4-pin 3.5mm (TRRS) jack</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-48"><a href="#See_also"><span >8</span> <span >See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>ALSA is a set of built-in Linux kernel modules. Therefore, manual installation is not necessary.
</p>
<p><a href="../wiki/Udev.html" title="Udev">udev</a> will automatically detect your hardware and select needed drivers at boot time, therefore, your sound should already be working. However, your sound may be initially muted. If it is, see <a href="#Unmuting_the_channels">Unmuting the channels</a>.
</p>
<h3><span class="mw-headline" id="User_privileges">User privileges</span></h3>
<p>Usually, local users have permission to play audio and change mixer levels.
</p>
<p>To allow remote users to use ALSA, you need to <a href="../wiki/Users_and_groups.html#Group_management" title="Users and groups">add</a> those users to the <code>audio</code> group, however this is not recommended by default (see note below). 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Adding users to the <code>audio</code> group allows direct access to devices. Keep in mind, that this allows applications to exclusively reserve output devices. This may break software mixing or fast-user-switching on multi-seat systems. Therefore, adding a user to the <code>audio</code> group is <b>not</b> recommended by default; unless you specifically need to <a rel="nofollow"  href="https://wiki.ubuntu.com/Audio/TheAudioGroup">[1]</a>.</div>
<h3><span class="mw-headline" id="ALSA_Utilities">ALSA Utilities</span></h3>
<p><a href="../wiki/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-utils">alsa-utils</a></span> package. This contains (among other utilities) the <code>alsamixer</code> and <code>amixer</code> utilities. <i>amixer</i> is a shell command to change audio settings, while <i>alsamixer</i> provides a more intuitive <a href="https://en.wikipedia.org/wiki/Ncurses"  title="wikipedia:Ncurses">ncurses</a> based interface for audio device configuration.
</p>
<p>If you need <a href="#High_quality_resampling">high quality resampling</a> install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-plugins">alsa-plugins</a></span> package to enable <a href="#Upmixing/downmixing">upmixing/downmixing</a> and other advanced features.
</p>
<h3><span class="mw-headline" id="OSS_compatibility">OSS compatibility</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This is important if your application complains about missing <code>/dev/dsp</code> or <code>/dev/snd/seq</code>.</div>
<p>ALSA has some ability to intercept <a href="../wiki/Open_Sound_System.html" class="mw-redirect" title="OSS">OSS</a> calls and re-route them through ALSA instead. This emulation layer is useful e.g. for legacy applications which try to open <code>/dev/dsp</code> and write sound data to them directly. Without OSS or the emulation library, <code>/dev/dsp</code> will be missing, and the application will not produce any sound.
</p>
<p>If you want <a href="../wiki/Open_Sound_System.html" class="mw-redirect" title="OSS">OSS</a> applications to work with <a href="#Dmix">dmix</a>, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-oss">alsa-oss</a></span> package as well. Then load the <code>snd-seq-oss</code>, <code>snd-pcm-oss</code> and <code>snd-mixer-oss</code> <a href="../wiki/Kernel_module.html" class="mw-redirect" title="Kernel modules">kernel modules</a> to enable OSS emulation.
</p>
<h3><span class="mw-headline" id="PulseAudio_compatibility">PulseAudio compatibility</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/apulse/">apulse</a></span><sup><small>AUR</small></sup> lets you use ALSA for applications that support only <a href="../wiki/PulseAudio.html" title="PulseAudio">PulseAudio</a> for sound. Usage is simply <code>$ apulse <i>yourapplication</i></code>.
</p>
<h3><span class="mw-headline" id="ALSA_and_Systemd">ALSA and Systemd</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-utils">alsa-utils</a></span> package comes with <a href="../wiki/Systemd.html" title="Systemd">systemd</a> unit configuration files <code>alsa-restore.service</code> and <code>alsa-state.service</code> by default.
</p>
<p>These are automatically installed and activated during installation (via package provided symlink to <a href="../wiki/Systemd.html#Targets" title="Systemd">sound.target</a>). Neither will run by default, as they rely on some conscious decisions by the user to know which method should be preferred. The options are as follows:
</p>
<ul>
<li>
<code>alsa-restore.service</code> Reads <code>/var/lib/alsa/asound.state</code> on boot and writes updated values on shutdown, granted it is already present by having ran <code>alsactl store</code> at some point</li>
<li>
<code>alsa-state.service</code> (Re-)Starts alsactl in daemon mode to continouously keep track of, and persist, volume changes, again under the condition that the user has consciously started <code>alsactl daemon</code> at least once</li>
</ul>
<p>Both methods are mutually exclusive and you can decide for one of the two approaches depending on your requirements, for further information see <span class="plainlinks archwiki-template-man" title="$ man 1 alsactl"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/alsactl.1">alsactl(1)</a></span>
</p>
<p>You can check their status using <code>systemctl</code>.
</p>
<h3><span class="mw-headline" id="ALSA_Firmware">ALSA Firmware</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-firmware">alsa-firmware</a></span> package contains firmware that may be required for certain sound cards (e.g. Creative SB0400 Audigy2).
</p>
<h2><span class="mw-headline" id="Unmuting_the_channels">Unmuting the channels</span></h2>
<p>By default ALSA has all channels muted. Those have to be unmuted manually. 
</p>
<h3><span class="mw-headline" id="Unmute_with_amixer">Unmute with amixer</span></h3>
<p>Unmuting the sound card's master volume can be done by using <i>amixer</i>:
</p>
<pre>$ amixer sset Master unmute
$ amixer sset Speaker unmute
$ amixer sset Headphone unmute
</pre>
<h3><span class="mw-headline" id="Unmute_with_alsamixer">Unmute with alsamixer</span></h3>
<p>Unmuting the sound card can be done using <i>alsamixer</i>:
</p>
<pre>$ alsamixer
</pre>
<p>The <code>MM</code> label below a channel indicates that the channel is muted, and <code>00</code> indicates that it is open.
</p>
<p>Scroll to the <code>Master</code> and <code>PCM</code> channels with the <code>←</code> and <code>→</code> keys and unmute them by pressing the <code>m</code> key. 
</p>
<p>Use the <code>↑</code> key to increase the volume and obtain a value of <code>0</code> dB gain. The gain can be found in the upper left next to the <code>Item:</code> field.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If gain is set above 0 dB audible distortion can become present.</div>
<h3>
<span id="Unmute_5.1.2F7.1_sound"></span><span class="mw-headline" id="Unmute_5.1/7.1_sound">Unmute 5.1/7.1 sound</span>
</h3>
<p>To get full 5.1 or 7.1 surround sound you will likely need to unmute other channels such as <code>Front</code>, <code>Surround</code>, <code>Center</code>, <code>LFE</code> (subwoofer) and <code>Side</code>. (Those are channel names with Intel HD Audio, they may vary with different hardware)
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Please take note that this will not automatically upmix stereo sources (like most music). In order to accomplish that, see <a href="#Upmixing/downmixing">#Upmixing/downmixing</a>.</div>
<h3><span class="mw-headline" id="Enable_the_microphone">Enable the microphone</span></h3>
<p>To enable your microphone, switch to the Capture tab with <code>F4</code> and enable a channel with <code>Space</code>. See <a href="../wiki/Advanced_Linux_Sound_TOSitecture/Troubleshooting.html#Microphone" title="Advanced Linux Sound TOSitecture/Troubleshooting">/Troubleshooting#Microphone</a> if microphone does not work.
</p>
<h3><span class="mw-headline" id="Test_your_changes">Test your changes</span></h3>
<p>Next, test to see if sound works:
</p>
<pre>$ speaker-test -c 2
</pre>
<p>Change <code>-c</code> to fit your speaker setup. Use <code>-c 8</code> for 7.1, for instance:
</p>
<pre>$ speaker-test -c 8
</pre>
<p>If audio is being outputted to the wrong device, try manually specifying it with the  argument <code>-D</code>. 
</p>
<pre>$ speaker-test -D default:PCH -c 8
</pre>
<p><code>-D</code> accepts PCM channel names as values, which can be retrieved by running the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ aplay -L | grep :CARD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default:CARD=PCH  # 'default:PCH' is the PCM channel name for -D
sysdefault:CARD=PCH
front:CARD=PCH,DEV=0
surround21:CARD=PCH,DEV=0
surround40:CARD=PCH,DEV=0
surround41:CARD=PCH,DEV=0
surround50:CARD=PCH,DEV=0
surround51:CARD=PCH,DEV=0
surround71:CARD=PCH,DEV=0</pre>
<p>If that does not work, consult the <a href="#Configuration">#Configuration</a> section or the <a href="../wiki/Advanced_Linux_Sound_TOSitecture/Troubleshooting.html" title="Advanced Linux Sound TOSitecture/Troubleshooting">/Troubleshooting</a> page.
</p>
<h3><span class="mw-headline" id="Additional_notes">Additional notes</span></h3>
<ul><li>If your system has more than one soundcard, then you can switch between them by pressing <code>F6</code>
</li></ul>
<ul><li>Some cards need to have digital output muted or disabled in order to hear analog sound. For the Soundblaster Audigy LS mute the channel labeled <code>IEC958</code>.</li></ul>
<ul><li>Some machines, (like the Thinkpad T61), have a <code>Speaker</code> channel which must be unmuted and adjusted as well.</li></ul>
<ul><li>Some machines, (like the Dell E6400) may also require the <code>Front</code> and <code>Headphone</code> channels to be unmuted and adjusted.</li></ul>
<ul><li>If your volume adjustments seem to be lost after you reboot, try running <i>alsamixer</i> as root.</li></ul>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The system configuration file is <code>/etc/asound.conf</code>, and the per-user configuration file is <code>~/.asoundrc</code>.
</p>
<h3><span class="mw-headline" id="Basic_syntax">Basic syntax</span></h3>
<p>ALSA configuration files follow a simple syntax consisting of hierarchical value to parameter (key) assignments. Below are (modified) excerpts from asoundrc.txt, which is usually found in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-lib">alsa-lib</a></span> package but can be also reached <a rel="nofollow"  href="http://www.alsa-project.org/alsa-doc/alsa-lib/conf.html">here</a>.
</p>
<h4><span class="mw-headline" id="Assignments_and_Separators">Assignments and Separators</span></h4>
<p>Assignments define a value of a given key. There are different assignment types and styles available.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Simple assignment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># This is a comment. Everything after the '#' symbol to the end of the line will be ignored by ALSA.
key = value # Equal signs are usually left out, since space can also be used as an separator.

key value # Equivalent to the example above.</pre>
<p>Separators are used to indicate the start and end of an assignment, but using commas or whitespace is also possible.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Separators</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># The following three assignments are equivalent.
key value0; key valueN;
key value0, key valueN,
key value0 key valueN

key
value0
	key
valueN</pre>
<p>Compound assignments use braces as separators.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Compound assignment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">key {	subkey0 value0;
	subkeyN valueN;	}

key.subkey0 value0; # Equivalent to the example above.
key.subkeyN valueN;</pre>
<p>For easier reading, it is recommended to use first style for definitions including more than three keys.
</p>
<p>Array definitions use brackets as separators.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Single array</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">key [	"value0";
	"valueN";	]

key.0 "value0"; # Equivalent to the example above
key.N "valueN";</pre>
<p>Everything depends on user preferences when it comes to different styles of configuration, however one should avoid mixing different styles. Further information on basic configuration can be found <a rel="nofollow"  href="http://www.volkerschatz.com/noise/alsa.html#basicconf">here</a>.
</p>
<h4><span class="mw-headline" id="Data_types">Data types</span></h4>
<p>ALSA uses different data types for parameter values, which must be set in the users respective configuration file. Some keys accept multiple data types, while most do not. A list of configuration options and their respective type requirements for PCM plugins can be found <a rel="nofollow"  href="http://www.alsa-project.org/alsa-doc/alsa-lib/pcm_plugins.html">here</a>
</p>
<h4><span class="mw-headline" id="Operation_modes">Operation modes</span></h4>
<p>There are different operation modes for parsing nodes, the default mode is merge and create. If operation mode is either merge/create or merge type checking is done. Only same type assignments can be merged, so strings cannot be merged with integers. Trying to define a simple assignment in default operation mode to a compound (and vice versa) will also not work.
</p>
<p>Prefixes of operation modes:
</p>
<ul>
<li>"+" -- merge and create</li>
<li>"-" -- merge</li>
<li>"?" -- do not override</li>
<li>"!" -- override</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Operation modes</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Merge/create - If a node does not exist, it is created. If it does exist and types match,
# subkeyN is merged into key.
key.subkeyN valueN;

# Merge/create - Equivalent to above
key.+subkeyN valueN;

# Merge - Node key.subkeyN must already exist and must have same data type
key.-subkeyN valueN;

# No override - Ignore new assignment if key.subkeyN node already exists
key.?subkeyN valueN;

# Override - Removes subkeyN and all keys below it, then creates node key.subkeyN
key.!subkeyN valueN;</pre>
<p>Using override operation mode, when done correctly, is usually safe, however one should bear in mind, that there might be other necessary keys in a node for proper functioning.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  Overriding pcm node itself will most definitely make alsa unusable, since every plugin definition will be deleted. Therefore <b>do not use !pcm.key</b> unless you are making a configuration from scratch.</div>
<h5>
<span id="An_example_of_setting_default_device_using_.22defaults.22_node"></span><span class="mw-headline" id='An_example_of_setting_default_device_using_"defaults"_node'>An example of setting default device using "defaults" node</span>
</h5>
<p>Assuming that "defaults" node is set in <code>/usr/share/alsa/alsa.conf</code>, where "defaults.pcm.card" and its "ctl" counterpart have assignment values "0" (type integer), user wants to set default pcm and control device to (third) sound card "2" or "SB" for an Azalia sound card.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Defaults node</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">defaults.ctl.card 2; # Sets default device and control to third card (counting begins with 0).
defaults.pcm.card 2; # This does not change the data type.

defaults.ctl.+card 2; # Equivalent to above.
defaults.pcm.+card 2;

defaults.ctl.-card 2; # Same effect on a default setup, however if defaults node was removed or
defaults.pcm.-card 2; # type has been changed merge operation mode will result in no changes.

defaults.pcm.?card 2; # This does nothing, since this assignment already exists.
defaults.ctl.?card 2;

defaults.pcm.!card "SB"; # The override operation mode is necessary here, because of
defaults.ctl.!card "SB"; # different value types.</pre>
<p>Using double quotes here automatically sets values data type to string, so in the above example setting defaults.pcm.!card "2" would result in retaining last default device, in this case card 0. Using double quotes for strings is not mandatory as long as no special characters are used, which ideally should never be the case. This may be irrelevant in other assignments.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  From a configuration point of view those are not equivalent to setting a compound "default" pcm device, since most users specify addressing type in there also, which actually may be the same, but the assignment itself still differs. Also defaults.pcm.card is referred to multiple times in alsa configuration files, usually as a fallback assignment, where different environment variables take precedence.</div>
<h4><span class="mw-headline" id="Nesting">Nesting</span></h4>
<p>Sometimes it may be useful and even easier to read using nesting in configuration.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Nesting PCM plugins</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pcm.azalia {	type hw; card 0	}
pcm.!default {	type plug; slave.pcm "azalia"	}

# is equivalent to

pcm.!default {	type plug; slave.pcm {	type hw; card 0;	}	}

# which is also equivalent to

pcm.!default.type plug;
pcm.default.slave.pcm.type hw;
pcm.default.slave.pcm.card 0;</pre>
<h4><span class="mw-headline" id="Including_configuration_files">Including configuration files</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Include other configuration files</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;/path/to/configuration-file&gt; # Include a configuration file
&lt;confdir:/path/to/configuration-file&gt; # Reference to a global configuration directory</pre>
<h3><span class="mw-headline" id="Set_the_default_sound_card">Set the default sound card</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Explain the difference between a "card" and a "device." <code>amixer --help</code> suggests the two are not synonymous (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Advanced_Linux_Sound_TOSitecture">Talk:Advanced Linux Sound TOSitecture#</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../wiki/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> There is no previous instruction regarding <code>defaults.pcm.device</code>. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Advanced_Linux_Sound_TOSitecture">Talk:Advanced Linux Sound TOSitecture#</a>)</div>
</div>
<p>In addition to the previous instruction regarding <code>defaults.pcm.card</code> and <code>defaults.pcm.device</code>, if your sound card order changes on boot, you can specify their order in any file ending with <code>.conf</code> in <code>/etc/modprobe.d</code> (<code>/etc/modprobe.d/alsa-base.conf</code> is suggested).
For example, if you want your mia sound card to be #0:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/alsa-base.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options snd_mia index=0
options snd_hda_intel index=1</pre>
<p>Use <code>$ cat /proc/asound/modules</code> to get the loaded sound modules and their order. This list is usually all that is needed for the loading order. Use <code>$ lsmod | grep snd</code> to get a devices &amp; modules list. This configuration assumes you have one mia sound card using <code>snd_mia</code> and one (e.g. onboard) card using <code>snd_hda_intel</code>.
</p>
<p>You can also provide an index of <code>-2</code> to instruct ALSA to never use a card as the primary one. Distributions such as Linux Mint and Ubuntu use the following settings to avoid USB and other "abnormal" drivers from getting index <code>0</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/alsa-base.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options bt87x index=-2
options cx88_alsa index=-2
options saa7134-alsa index=-2
options snd-atiixp-modem index=-2
options snd-intel8x0m index=-2
options snd-via82xx-modem index=-2
options snd-usb-caiaq index=-2
options snd-usb-ua101 index=-2
options snd-usb-us122l index=-2
options snd-usb-usx2y index=-2
options snd-pcsp index=-2
options snd-usb-audio index=-2</pre>
<p>These changes require a system reboot.
</p>
<p>See also <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?pid=1446773#p1446773">[2]</a>
</p>
<h4><span class="mw-headline" id="Select_the_default_PCM_via_environment_variable">Select the default PCM via environment variable</span></h4>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> An explanation of the terminology of a "card", "device", "subdevice" (a "card" is not a "device") and "PCM" can be found on <a href="https://en.wikipedia.org/wiki/Advanced_Linux_Sound_TOSitecture#Concepts"  title="wikipedia:Advanced Linux Sound TOSitecture">wikipedia:Advanced Linux Sound TOSitecture#Concepts</a>.</div>
<p>Probably it is enough to set ALSA_CARD to the name of the device.  First, get the names with <code>aplay -l</code>, then set ALSA_CARD to the name which comes after the colon and before the bracket; e.g. if you have
</p>
<p><code>card 1: HDMI [HDA ATI HDMI], device 3: HDMI 0 [HDMI 0]</code>
</p>
<p>then set ALSA_CARD=HDMI.
</p>
<p>Other variables are also checked in the default global configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/alsa/alsa.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Variable name # Definition
ALSA_CARD # pcm.default pcm.hw pcm.plughw ctl.sysdefault ctl.hw rawmidi.default rawmidi.hw hwdep.hw
ALSA_CTL_CARD # ctl.sysdefault ctl.hw
ALSA_HWDEP_CARD # hwdep.default hwdep.hw
ALSA_HWDEP_DEVICE # hwdep.default hwdep.hw
ALSA_PCM_CARD # pcm.default pcm.hw pcm.plughw
ALSA_PCM_DEVICE # pcm.hw pcm.plughw
ALSA_RAWMIDI_CARD # rawmidi.default rawmidi.hw
ALSA_RAWMIDI_DEVICE # rawmidi.default rawmidi.hw</pre>
<p>Alternatively, you can override the behavior in your own configuration file, preferably the global one (/etc/asound.conf).  Add:
</p>
<pre>pcm.!default {
    type plug
    slave.pcm {
        @func getenv
        vars [ ALSAPCM ]
        default "hw:Audigy2"
    }
}</pre>
<p>In this case as well, replace <code>Audigy2</code> with the name of your device. You can get the names with <code>aplay -l</code> or you can also use PCMs like <b>surround51</b>. But if you need to use the microphone it is a good idea to select full-duplex PCM as default.
</p>
<p>Now you can select the sound card when starting programs by just changing the environment variable <code>ALSAPCM</code>. It works fine for all program that do not allow to select the card, for the others ensure you keep the default card.
For example, assuming you wrote a downmix PCM called <code>mix51to20</code> you can use it with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=mplayer">mplayer</a></span> using the commandline <code>ALSAPCM=mix51to20 mplayer example_6_channel.wav</code>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Pay attention to default addressing type.</div>
<h4><span class="mw-headline" id="Alternative_method">Alternative method</span></h4>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> This process can be partly automated using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=asoundconf">asoundconf</a></span>.</div>
<p>First you will have to find out the card and device id that you want to set as the default:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ aplay -l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">**** List of PLAYBACK Hardware Devices ****
card 0: Intel [HDA Intel], device 0: CONEXANT Analog [CONEXANT Analog]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: Intel [HDA Intel], device 1: Conexant Digital [Conexant Digital]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 1: JamLab [JamLab], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 2: Audio [Altec Lansing XT1 - USB Audio], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Simply setting a <code>type hw</code> as default card is equivalent to addressing hardware directly, which leaves the device unavailable to other applications. This method is only recommended if it is a part of a more sophisticated setup <code>~/.asoundrc</code> or if user deliberately wants to address sound card directly (digital output through <code>eic958</code> or dedicated music server for example).</div>
<p>For example, the last entry in this list has the card ID 2 and the device ID 0. To set this card as the default, you can either use the system-wide file <code>/etc/asound.conf</code> or the user-specific file <code>~/.asoundrc</code>. You may have to create the file if it does not exist. Then insert the following options with the corresponding card.
</p>
<pre>pcm.!default {
    type hw
    card 2
}

ctl.!default {
    type hw
    card 2
}
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For the Asus U32U series it seems that card should be set to 1 for both pcm and ctl.</div>
<p>In most cases it is recommended to use sound card names instead of number references, which also solves boot order problem. Therefore the following would be correct for the above example.
</p>
<pre>pcm.!default {
    type hw
    card Audio
}

ctl.!default {
    type hw
    card Audio
}
</pre>
<p>To get valid ALSA card names, use <i>aplay</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ aplay -l | awk -F \: '/,/{print $2}' | awk '{print $1}' | uniq</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PCH
</pre>
<p>Alternatively use <i>cat</i>, which might return unused devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /proc/asound/card*/id</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PCH
ThinkPadEC
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This method could be problematic if your system has several cards of the same (ALSA)name.</div>
<p>The 'pcm' options affect which card and device will be used for audio playback while the 'ctl' option affects which card is used by control utilities like alsamixer .
</p>
<p>The changes should take effect as soon as you (re-)start an application (MPlayer etc.). You can also test with a command like <i>aplay</i>.
</p>
<pre>$ aplay -D default:PCH <i>your_favourite_sound.wav</i>
</pre>
<p>If you receive an error regarding your asound configuration, check the <a rel="nofollow"  href="http://www.alsa-project.org/main/index.php/Asoundrc#The_default_plugin">upstream documentation</a> for possible changes to the configuration file format.
</p>
<h3><span class="mw-headline" id="Verifying_correct_sound_modules_are_loaded">Verifying correct sound modules are loaded</span></h3>
<p>You can assume that udev will autodetect your sound properly. You can check this with the command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsmod | grep '^snd' | column -t</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">snd_hda_codec_hdmi     22378   4
snd_hda_codec_realtek  294191  1
snd_hda_intel          21738   1
snd_hda_codec          73739   3  snd_hda_codec_hdmi,snd_hda_codec_realtek,snd_hda_intel
snd_hwdep              6134    1  snd_hda_codec
snd_pcm                71032   3  snd_hda_codec_hdmi,snd_hda_intel,snd_hda_codec
snd_timer              18992   1  snd_pcm
snd                    55132   9  snd_hda_codec_hdmi,snd_hda_codec_realtek,snd_hda_intel,snd_hda_codec,snd_hwdep,snd_pcm,snd_timer
snd_page_alloc         7017    2  snd_hda_intel,snd_pcm</pre>
<p>If the output looks similar, your sound drivers have been successfully autodetected.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since <code>udev&gt;=171</code>, the OSS emulation modules (<code>snd_seq_oss, snd_pcm_oss, snd_mixer_oss</code>) are not loaded by default: <a href="../wiki/Kernel_module.html#Manual_module_handling" class="mw-redirect" title="Kernel modules">Load them manually</a>, if they are needed.</div>
<p>You might also want to check the directory <code>/dev/snd/</code> for the right device files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ls -l /dev/snd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">total 0
crw-rw----  1 root audio 116,  0 Apr  8 14:17 controlC0
crw-rw----  1 root audio 116, 32 Apr  8 14:17 controlC1
crw-rw----  1 root audio 116, 24 Apr  8 14:17 pcmC0D0c
crw-rw----  1 root audio 116, 16 Apr  8 14:17 pcmC0D0p
crw-rw----  1 root audio 116, 25 Apr  8 14:17 pcmC0D1c
crw-rw----  1 root audio 116, 56 Apr  8 14:17 pcmC1D0c
crw-rw----  1 root audio 116, 48 Apr  8 14:17 pcmC1D0p
crw-rw----  1 root audio 116,  1 Apr  8 14:17 seq
crw-rw----  1 root audio 116, 33 Apr  8 14:17 timer</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If requesting help on IRC or the forums, please post the output of the above commands, if requested.</div>
<p>If you have at least the devices <b>controlC0</b> and <b>pcmC0D0p</b> or similar, then your sound modules have been detected and loaded properly.
</p>
<p>If this is not the case, your sound modules have not been detected properly. To solve this, you can try loading the modules manually:
</p>
<ul>
<li>Locate the module for your sound card: <a rel="nofollow"  href="http://www.alsa-project.org/main/index.php/Matrix:Main">ALSA Soundcard Matrix</a> The module will be prefixed with 'snd-' (for example: <code>snd-via82xx</code>).</li>
<li>
<a href="../wiki/Kernel_module.html#Manual_module_handling" class="mw-redirect" title="Kernel modules">Load the module</a>.</li>
<li>Check for the device files in <code>/dev/snd</code> (see above) and/or try if <code>alsamixer</code> or <code>amixer</code> have reasonable output.</li>
<li>Configure <code>snd-NAME-OF-MODULE</code> and <code>snd-pcm-oss</code> to <a href="../wiki/Kernel_module.html#Automatic_module_loading_with_systemd" class="mw-redirect" title="Kernel modules">load at boot</a>.</li>
</ul>
<h3>
<span id="Getting_S.2FPDIF_output"></span><span class="mw-headline" id="Getting_S/PDIF_output">Getting S/PDIF output</span>
</h3>
<p><a href="https://en.wikipedia.org/wiki/S/PDIF"  title="wikipedia:S/PDIF">S/PDIF</a> is a digital audio interface often used to connect a computer to a digital amplifier (such as a home theatre with 5.1/7.1 surround sound). 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> With some soundcards this disables analog sound output  (eg. Sound Blaster Audigy 2).</div>
<p>Depending on what <a href="../wiki/Command-line_shell.html" class="mw-redirect" title="Shell">shell</a> you use, add the following line to your shell's configuration file:
</p>
<pre>amixer -c 0 cset name='IEC958 Playback Switch' on
</pre>
<p>You can see the name of your card's digital output with:
</p>
<pre>$ amixer scontrols
</pre>
<h3><span class="mw-headline" id="System-wide_equalizer">System-wide equalizer</span></h3>
<h4>
<span id="Using_ALSAEqual_.28provides_UI.29"></span><span class="mw-headline" id="Using_ALSAEqual_(provides_UI)">Using ALSAEqual (provides UI)</span>
</h4>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/alsaequal/">alsaequal</a></span><sup><small>AUR</small></sup> package. Also install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/lib32-alsaequal/">lib32-alsaequal</a></span><sup><small>AUR</small></sup> for 32-bit application support. 
</p>
<p>After installing the package, add the following to your ALSA configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/asound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ctl.equal {
    type equal;
}

pcm.plugequal {
    type equal;
    # Modify the line below if you do not
    # want to use sound card 0.
    #slave.pcm "plughw:0,0";
    # by default we want to play from more sources at time:
    slave.pcm "plug:dmix";
}

# pcm.equal {
# If you do not want the equalizer to be your
# default soundcard comment the following
# line and uncomment the above line. (You can
# choose it as the output device by addressing
# it with specific apps,eg mpg123 -a equal 06.Back_In_Black.mp3)
pcm.!default {
    type plug;
    slave.pcm plugequal;
}</pre>
<p>And you are ready to change your equalizer using command
</p>
<pre>$ alsamixer -D equal
</pre>
<p>Note that configuration file is different for each user (until not specified else) it is saved in <code>~/.alsaequal.bin</code>.
so if you want to use ALSAEqual with <a href="../wiki/Music_Player_Daemon.html" class="mw-redirect" title="Mpd">mpd</a> or another software running under different user, you can configure it using
</p>
<pre>$ su mpd -c 'alsamixer -D equal'
</pre>
<p>or for example, you can make a symlink to your <code>.alsaequal.bin</code> in his home...
</p>
<h5><span class="mw-headline" id="Managing_ALSAEqual_states">Managing ALSAEqual states</span></h5>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/alsaequal-mgr/">alsaequal-mgr</a></span><sup><small>AUR</small></sup> package.
</p>
<p>Configure the equalizer as usual with
</p>
<pre>$ alsamixer -D equal
</pre>
<p>When you are satisfied with the state, you may give it a name ("foo" in this example) and save it:
</p>
<pre>$ alsaequal-mgr save foo
</pre>
<p>The state "foo" can then be restored at a later time with
</p>
<pre>$ alsaequal-mgr load foo
</pre>
<p>You can thus create different equalizer states for games, movies, music genres, VoIP apps, etc. and reload them as necessary.
</p>
<p>See the <a rel="nofollow"  href="http://xyne.archlinux.ca/projects/alsaequal-mgr/">project page</a> and the help message for more options.
</p>
<h4><span class="mw-headline" id="Using_mbeq">Using mbeq</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This method requires the use of a <a href="https://en.wikipedia.org/wiki/LADSPA"  title="wikipedia:LADSPA">LADSPA</a> plugin which might be CPU intensive during playback. In addition, this was made with stereophonic sound (e.g. headphones) in mind.</div>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-plugins">alsa-plugins</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=ladspa">ladspa</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=swh-plugins">swh-plugins</a></span> packages if you do not already have them.
</p>
<p>If you have not already created either an <code>~/.asoundrc</code> or a <code>/etc/asound.conf</code> file, then create either one and insert the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/asound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pcm.eq {
    type ladspa

    # The output from the EQ can either go direct to a hardware device
    # (if you have a hardware mixer, e.g. SBLive/Audigy) or it can go
    # to the software mixer shown here.
    #slave.pcm "plughw:0,0"
    slave.pcm "plug:dmix"

    # Sometimes you may need to specify the path to the plugins,
    # especially if you have just installed them.  Once you have logged
    # out/restarted this should not be necessary, but if you get errors
    # about being unable to find plugins, try uncommenting this.
    #path "/usr/lib/ladspa"

    plugins [
    {
        label mbeq
        id 1197
        input {
            # The following setting is just an example, edit to your own taste:
            # bands: 50hz, 100hz, 156hz, 220hz, 311hz, 440hz, 622hz, 880hz, 1250hz, 1750hz, 25000hz,
            # 50000hz, 10000hz, 20000hz
            controls [ -5 -5 -5 -5 -5 -10 -20 -15 -10 -10 -10 -10 -10 -3 -2 ]
            }
        }
    ]
}

# Redirect the default device to go via the EQ - you may want to do
# this last, once you are sure everything is working.  Otherwise all
# your audio programs will break/crash if something has gone wrong.
pcm.!default {
    type plug
    slave.pcm "eq"
}

# Redirect the OSS emulation through the EQ too (when programs are running through "aoss")
pcm.dsp0 {
    type plug
    slave.pcm "eq"
}</pre>
<h2><span class="mw-headline" id="High_quality_resampling">High quality resampling</span></h2>
<p>When software mixing is enabled, ALSA is forced to resample everything to the same frequency (48 kHz by default when supported). By default, it will try to use the <i>speexrate</i> converter to do so, and fallback to low-quality linear interpolation if it is not available<a rel="nofollow"  href="http://git.alsa-project.org/?p=alsa-lib.git;a=blob;f=src/pcm/pcm_rate.c;h=2eb4b1b33933dec878d0f25ad118869adac95767;hb=HEAD#l1278">[3]</a>.
Thus, if you are getting poor sound quality due to bad resampling, the problem can be solved by simply installing the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-plugins">alsa-plugins</a></span> package.
</p>
<p>For even higher quality resampling, you can change the default rate converter to <code>speexrate_medium</code> or <code>speexrate_best</code>. Both perform well enough that in practice it does not matter which one you choose, so using the best converter is usually not worth the extra CPU cycles it requires.
</p>
<p>To change the default converter place the following contents in your <code>~/.asoundrc</code> or <code>/etc/asound.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/asound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">defaults.pcm.rate_converter "speexrate_medium"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is also possible to use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=libsamplerate">libsamplerate</a></span> converters, which are only about half as fast as the <i>speexrate</i> converters but do not achieve much higher quality. See <a href="../wiki/Talk:Advanced_Linux_Sound_TOSitecture.html#On_high_quality_resampling" title="Talk:Advanced Linux Sound TOSitecture">discussion</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is also possible to use lavcrate resamplers that use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=ffmpeg">ffmpeg</a></span> With filter sizes of lavcrate_faster:4 lavcrate_fast:8 lavcrate:16 lavcrate_high:32 lavcrate_higher:64 With the last 2 options being equal to Kodi low and medium quality resamplers respectively</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Some applications (like MPlayer and its forks) do their own resampling by default because some ALSA drivers have incorrect delay reporting when resampling is enabled (hence leading to AV desynchronization), so changing this setting will not have any effect unless you configure them to use ALSA resampling.</div>
<h2>
<span id="Upmixing.2Fdownmixing"></span><span class="mw-headline" id="Upmixing/downmixing">Upmixing/downmixing</span>
</h2>
<h3><span class="mw-headline" id="Upmixing">Upmixing</span></h3>
<p>In order for stereo sources like music to be able to saturate a 5.1 or 7.1 sound system, you need to use upmixing. In darker days this used to be tricky and error prone but nowadays plugins exist to easily take care of this task. We will use the <code>upmix</code> plugin, included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-plugins">alsa-plugins</a></span> package.
</p>
<p>Then add the following to your ALSA configuration file of choice (either <code>/etc/asound.conf</code> or <code>~/.asoundrc</code>):
</p>
<pre>pcm.upmix71 {
    type upmix
    slave.pcm "surround71"
    delay 15
    channels 8
}
</pre>
<p>You can easily change this example for 7.1 upmixing to 5.1 or 4.0.
</p>
<p>The following example adds a new PCM channel that you can use for upmixing. If you want all sound sources to go through this channel, add it as a default below the previous definition like so:
</p>
<pre>pcm.!default "plug:upmix71"
</pre>
<p>The plugin automatically allows multiple sources to play through it without problems so setting is as a default is actually a safe choice.
If this is not working, you have to setup your own dmixer for the upmixing PCM like this:
</p>
<pre>pcm.dmix6 {
    type asym
    playback.pcm {
        type dmix
        ipc_key 567829
        slave {
            pcm "hw:0,0"
            channels 6
        }
    }
}</pre>
<p>and use "dmix6" instead of "surround71".
If you experience skipping or distorted sound, consider increasing the buffer_size (to 32768, for example) or use a <a href="#High_quality_resampling">high quality resampler</a>.
</p>
<h3><span class="mw-headline" id="Downmixing">Downmixing</span></h3>
<p>If you want to downmix sources to stereo because you, for instance, want to watch a movie with 5.1 sound on a stereo system, use the <code>vdownmix</code> plugin, included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-plugins">alsa-plugins</a></span> package.
</p>
<p>Again, in your configuration file, add this:
</p>
<pre>pcm.!surround51 {
    type vdownmix
    slave.pcm "default"
}
pcm.!surround40 {
    type vdownmix
    slave.pcm "default"
}</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This might not be enough to make downmixing working, see <a rel="nofollow"  href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=541786">[4]</a>. So, you might also need to add <code>pcm.!default "plug:surround51"</code> or <code>pcm.!default "plug:surround40"</code>. Only one <code>vdownmix</code> plug can be used; if you have 7.1 channels, you will need to use <code>surround71</code> instead the configuration above. A good example, which includes a configuration that makes both <code>vdownmix</code> and <code>dmix</code> working, can be found <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=167275">here</a>.</div>
<h2><span class="mw-headline" id="Dmix">Dmix</span></h2>
<p>Mixing enables multiple applications to output sound at the same time. Most discrete sound cards support hardware mixing, which is enabled by default if available. Integrated motherboard sound cards (such as Intel HD Audio), usually do not support hardware mixing. On such cards, software mixing is done by an ALSA plugin called <code>dmix</code>. This feature is enabled automatically if hardware mixing is unavailable.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Dmix is enabled by default for soundcards which do not support hardware mixing. Dmix is not enabled by default for digital output (S/PDIF) and will require the configuration snippet below.</div>
<p>To manually enable dmix, add the following to your ALSA configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/asound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pcm.dsp {
    type plug
    slave.pcm "dmix"
}</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Disabling_auto_mute_on_startup">Disabling auto mute on startup</span></h3>
<p><i>Auto-Mute Mode</i> can be configured on startup with <code>amixer</code>. For example, to disable it:
</p>
<pre># amixer -c 0 sset "Auto-Mute Mode" Disabled
</pre>
<p>Alternatively, the graphical interface can be utilized through <code>alsamixer</code>. In order to save any modifications, use:
</p>
<pre># alsactl store
</pre>
<h3><span class="mw-headline" id="Hot-plugging_a_USB_sound_card">Hot-plugging a USB sound card</span></h3>
<p>See <a rel="nofollow"  href="http://alsa.opensrc.org/Udev">Writing Udev rules for ALSA</a>.
</p>
<h3><span class="mw-headline" id="Simultaneous_output">Simultaneous output</span></h3>
<p>You might want to play music via external speakers connected via mini jack and internal speakers simultaneously. This can be done by unmuting <b>Auto-Mute</b> item using <code>alsamixer</code> or <code>amixer</code>:
</p>
<pre>$ amixer sset "Auto-Mute" unmute
</pre>
<p>and then unmuting other required items, such as <b>Headphones</b>, <b>Speaker</b>, <b>Bass Speaker</b>...
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have a crackling sound through headphones connector (mini-jack) after, see <a href="../wiki/Advanced_Linux_Sound_TOSitecture/Troubleshooting.html#Crackling_sound_through_mini-jack_.28headphones_connector.29" title="Advanced Linux Sound TOSitecture/Troubleshooting">here</a>.</div>
<h3><span class="mw-headline" id="Keyboard_volume_control">Keyboard volume control</span></h3>
<p>Map the following commands to your volume keys: <code>XF86AudioRaiseVolume</code>, <code>XF86AudioLowerVolume</code>, <code>XF86AudioMute</code>
</p>
<p>To raise the volume:
</p>
<pre>amixer set Master 5%+
</pre>
<p>To lower the volume:
</p>
<pre>amixer set Master 5%-
</pre>
<p>To toggle mute/unmute of the volume:
</p>
<pre>amixer set Master toggle
</pre>
<h3><span class="mw-headline" id="Virtual_sound_device_using_snd-aloop">Virtual sound device using snd-aloop</span></h3>
<p>You might want a jack alternative to create a virtual recording or play device in order to mix different sources, using the snd-aloop module:
</p>
<pre>modprobe snd-aloop
</pre>
<p>List your new virtual devices using:
</p>
<pre>aplay -l
</pre>
<p>now you can for example using ffmpeg:
</p>
<pre>ffmpeg -f alsa -i hw:1,1,0 -f alsa -i hw:1,1,1 -filter_complex amerge output.mp3
</pre>
<p>In the  hw:R,W,N format R is your virtual card device number, W 1 recording devices 0 for writing, N is your sub device you can use all the virtual devices available and play/stop using applications like mplayer:
</p>
<pre>mplayer -ao alsa:device=hw=1,0,0 fileA
mplayer -ao alsa:device=hw=1,0,1 fileB 
</pre>
<p>Another thing you could do with this approach, is using festival to generate a voice into a recording stream using an script like this:
</p>
<pre>#!/bin/bash
echo $1|iconv -f utf-8 -t iso-8859-1| text2wave  &gt; "_tmp_.wav";   
mplayer -ao alsa:device=hw=2,0,0 "_tmp.wav";
rm "_tmp.wav";
</pre>
<h3><span class="mw-headline" id="Debugging_ALSA">Debugging ALSA</span></h3>
<h4><span class="mw-headline" id="Retrieving_the_driver_state">Retrieving the driver state</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-utils">alsa-utils</a></span> package also contains the <code>alsa-info.sh</code> command, which can be used to gather detailed data on the ALSA driver and user-space state.
</p>
<p>See <a rel="nofollow"  href="http://alsa-project.org/main/index.php/Bug_Tracking">ALSA bug tracking</a> for more info.
</p>
<h4>
<span id="Reconfiguring_input.2Foutput_ports"></span><span class="mw-headline" id="Reconfiguring_input/output_ports">Reconfiguring input/output ports</span>
</h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-tools">alsa-tools</a></span> package contains the <code>hdajackretask</code> tool, which can be used (on Intel HDA cards) to reconfigure the sound card input/output ports; for instance, to turn a microphone jack into a headphone jack.
</p>
<h4><span class="mw-headline" id="Resetting_codecs">Resetting codecs</span></h4>
<p>The ALSA driver can fully reconfigure attached codecs (the parts of the sound system that actually process audio streams), by doing:
</p>
<pre># echo 1 &gt; /sys/class/sound/<i>card</i>/reconfig
</pre>
<p>Before doing this, all processes using the ALSA driver (such as <a href="../wiki/PulseAudio.html#Running" title="PulseAudio">Pulseaudio</a> or <a href="../wiki/JACK_Audio_Connection_Kit.html" class="mw-redirect" title="JACK">JACK</a>) must be stopped.
</p>
<h3>
<span id="Correctly_detect_microphone_plugged_in_a_4-pin_3.5mm_.28TRRS.29_jack"></span><span class="mw-headline" id="Correctly_detect_microphone_plugged_in_a_4-pin_3.5mm_(TRRS)_jack">Correctly detect microphone plugged in a 4-pin 3.5mm (TRRS) jack</span>
</h3>
<p>On some modern laptops you may have a combined 3.5mm headset jack, instead of two separated ones, which may not be correctly detected by default.
To make ALSA correctly detect plug-in status on your 3.5mm jack, you could put the following line into your <code>/etc/modprobe.d/alsa-base.conf</code> :
</p>
<pre>options snd_hda_intel index=0 model=[YOUR_MODEL_SETTING]
</pre>
<p>For complete list of options to put in <code>[YOUR_MODEL_SETTING]</code>, see <a rel="nofollow"  href="https://www.kernel.org/doc/html/latest/sound/hd-audio/models.html">HD-Audio Codec-Specific Models</a>.
Tested with Gigabyte Aero15 2017 (P65 Model), with ALC255 and set model to <code>dell-headset-multi</code>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow"  href="http://www.alsa-project.org/">ALSA wiki</a></li>
<li><a rel="nofollow"  href="http://www.alsa-project.org/main/index.php/Asoundrc">Asoundrc</a></li>
<li><a rel="nofollow"  href="http://alsa.opensrc.org/">Unofficial ALSA wiki</a></li>
<li><a rel="nofollow"  href="http://www.mjmwired.net/kernel/Documentation/sound/alsa/ALSA-Configuration.txt">Advanced ALSA module configuration</a></li>
<li><a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=36815">HOWTO: compile driver from svn</a></li>
<li><a rel="nofollow"  href="http://www.volkerschatz.com/noise/alsa.html">A close look at ALSA: ALSA concept introduction</a></li>
<li><a rel="nofollow"  href="http://www.sabi.co.uk/Notes/linuxSoundALSA.html">Linux ALSA sound notes</a></li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../wiki/Category:Sound.html" title="Category:Sound">Sound</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../wiki/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../wiki/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Advanced_Linux_Sound_TOSitecture&amp;oldid=607526">https://wiki.archlinux.org/index.php?title=Advanced_Linux_Sound_TOSitecture&amp;oldid=607526</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 24 April 2020, at 09:48.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../wiki/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../wiki/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../wiki/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



