<!--
    title: Power_management
    description: Migration of Power_management from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Power management</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">Power management/Suspend and hibernate</a></li>
<li><a href="../Display_Power_Management_Signaling.html" title="Display Power Management Signaling">Display Power Management Signaling</a></li>
<li><a href="../CPU_frequency_scaling.html" title="CPU frequency scaling">CPU frequency scaling</a></li>
<li><a href="../Hybrid_graphics.html" title="Hybrid graphics">Hybrid graphics</a></li>
<li><a href="../Kernel_module.html" class="mw-redirect" title="Kernel modules">Kernel modules</a></li>
<li><a href="../Sysctl.html" title="Sysctl">sysctl</a></li>
<li><a href="../Udev.html" title="Udev">udev</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Power_management"  title="wikipedia:Power management">Power management</a> is a feature that turns off the power or switches system's components to a low-power state when inactive.
</p>
<p>In TOS Linux, power management consists of two main parts:
</p>
<ol>
<li>Configuration of the Linux kernel, which interacts with the hardware.
<ul>
<li><a href="../Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a></li>
<li><a href="../Kernel_module.html" class="mw-redirect" title="Kernel modules">Kernel modules</a></li>
<li>
<a href="../Udev.html" title="Udev">udev</a> rules</li>
</ul>
</li>
<li>Configuration of userspace tools, which interact with the kernel and react to its events. Many userspace tools also allow to modify kernel configuration in a "user-friendly" way. See <a href="#Userspace_tools">#Userspace tools</a> for the options.</li>
</ol>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Userspace_tools"><span >1</span> <span >Userspace tools</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Console"><span >1.1</span> <span >Console</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Graphical"><span >1.2</span> <span >Graphical</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#Power_management_with_systemd"><span >2</span> <span >Power management with systemd</span></a>
<ul>
<li class="toclevel-2 tocsection-5">
<a href="#ACPI_events"><span >2.1</span> <span >ACPI events</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Power_managers"><span >2.1.1</span> <span >Power managers</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#xss-lock"><span >2.1.2</span> <span >xss-lock</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8">
<a href="#Suspend_and_hibernate"><span >2.2</span> <span >Suspend and hibernate</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Hybrid-sleep_on_suspend_or_hibernation_request"><span >2.2.1</span> <span >Hybrid-sleep on suspend or hibernation request</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10">
<a href="#Sleep_hooks"><span >2.3</span> <span >Sleep hooks</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#Suspend/resume_service_files"><span >2.3.1</span> <span >Suspend/resume service files</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Combined_Suspend/resume_service_file"><span >2.3.2</span> <span >Combined Suspend/resume service file</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Hooks_in_/usr/lib/systemd/system-sleep"><span >2.3.3</span> <span >Hooks in /usr/lib/systemd/system-sleep</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14">
<a href="#Troubleshooting"><span >2.4</span> <span >Troubleshooting</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="#Delayed_lid_switch_action"><span >2.4.1</span> <span >Delayed lid switch action</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Suspend_from_corresponding_laptop_Fn_key_not_working"><span >2.4.2</span> <span >Suspend from corresponding laptop Fn key not working</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#Power_saving"><span >3</span> <span >Power saving</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Processors_with_HWP_(Hardware_P-state)_support"><span >3.1</span> <span >Processors with HWP (Hardware P-state) support</span></a></li>
<li class="toclevel-2 tocsection-19">
<a href="#Audio"><span >3.2</span> <span >Audio</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#Kernel"><span >3.2.1</span> <span >Kernel</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#PulseAudio"><span >3.2.2</span> <span >PulseAudio</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22"><a href="#Backlight"><span >3.3</span> <span >Backlight</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Bluetooth"><span >3.4</span> <span >Bluetooth</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Web_camera"><span >3.5</span> <span >Web camera</span></a></li>
<li class="toclevel-2 tocsection-25">
<a href="#Kernel_parameters"><span >3.6</span> <span >Kernel parameters</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#Disabling_NMI_watchdog"><span >3.6.1</span> <span >Disabling NMI watchdog</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#Writeback_Time"><span >3.6.2</span> <span >Writeback Time</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Laptop_Mode"><span >3.6.3</span> <span >Laptop Mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-29">
<a href="#Network_interfaces"><span >3.7</span> <span >Network interfaces</span></a>
<ul>
<li class="toclevel-3 tocsection-30"><a href="#Intel_wireless_cards_(iwlwifi)"><span >3.7.1</span> <span >Intel wireless cards (iwlwifi)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-31">
<a href="#Bus_power_management"><span >3.8</span> <span >Bus power management</span></a>
<ul>
<li class="toclevel-3 tocsection-32"><a href="#Active_State_Power_Management"><span >3.8.1</span> <span >Active State Power Management</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="#PCI_Runtime_Power_Management"><span >3.8.2</span> <span >PCI Runtime Power Management</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="#USB_autosuspend"><span >3.8.3</span> <span >USB autosuspend</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="#SATA_Active_Link_Power_Management"><span >3.8.4</span> <span >SATA Active Link Power Management</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-36"><a href="#Hard_disk_drive"><span >3.9</span> <span >Hard disk drive</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#CD-ROM_or_DVD_drive"><span >3.10</span> <span >CD-ROM or DVD drive</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-38">
<a href="#Tools_and_scripts"><span >4</span> <span >Tools and scripts</span></a>
<ul>
<li class="toclevel-2 tocsection-39"><a href="#Using_a_script_and_an_udev_rule"><span >4.1</span> <span >Using a script and an udev rule</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Print_power_settings"><span >4.2</span> <span >Print power settings</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-41"><a href="#See_also"><span >5</span> <span >See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Userspace_tools">Userspace tools</span></h2>
<p>Using these tools can replace setting a lot of settings by hand.  Only run <b>one</b> of these tools to avoid possible conflicts as they all work more or less similarly.  Have a look at the <a href="../Category:Power_management.html" title="Category:Power management">power management category</a> to get an overview on what power management options exist in TOS Linux.
</p>
<p>These are the more popular scripts and tools designed to help power saving:
</p>
<h3><span class="mw-headline" id="Console">Console</span></h3>
<ul><li>
<b><a href="../Acpid.html" title="Acpid">acpid</a></b> —  A daemon for delivering ACPI power management events with netlink support.</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://sourceforge.net/projects/acpid2/">http://sourceforge.net/projects/acpid2/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=acpid">acpid</a></span>
</dd></dl>
<ul><li>
<b><a href="../Laptop_Mode_Tools.html" title="Laptop Mode Tools">Laptop Mode Tools</a></b> — Utility to configure laptop power saving settings, considered by many to be the de facto utility for power saving though may take a bit of configuration.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/rickysarraf/laptop-mode-tools">https://github.com/rickysarraf/laptop-mode-tools</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/laptop-mode-tools/">laptop-mode-tools</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>libsmbios</b> — Library and tools for interacting with Dell SMBIOS tables.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/dell/libsmbios">https://github.com/dell/libsmbios</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=libsmbios">libsmbios</a></span>
</dd></dl>
<ul><li>
<b><a href="../Powertop.html" title="Powertop">powertop</a></b> — A tool to diagnose issues with power consumption and power management to help set power saving settings.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://01.org/powertop/">https://01.org/powertop/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=powertop">powertop</a></span>
</dd></dl>
<ul><li>
<b><a href="../Systemd.html" title="Systemd">systemd</a></b> — A system and service manager.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://freedesktop.org/wiki/Software/systemd/">https://freedesktop.org/wiki/Software/systemd/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=systemd">systemd</a></span>
</dd></dl>
<ul><li>
<b><a href="../TLP.html" title="TLP">TLP</a></b> — Advanced power management for Linux.</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://linrunner.de/tlp">http://linrunner.de/tlp</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=tlp">tlp</a></span>
</dd></dl>
<h3><span class="mw-headline" id="Graphical">Graphical</span></h3>
<ul><li>
<b>batterymon-clone</b> — Simple battery monitor tray icon.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/jareksed/batterymon-clone">https://github.com/jareksed/batterymon-clone</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/batterymon-clone/">batterymon-clone</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>batsignal</b> — Lightweight battery monitor that uses libnotify to warn of low battery levels.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/electrickite/batsignal">https://github.com/electrickite/batsignal</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/batsignal/">batsignal</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>cbatticon</b> — Lightweight and fast battery icon that sits in your system tray.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/valr/cbatticon">https://github.com/valr/cbatticon</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=cbatticon">cbatticon</a></span>
</dd></dl>
<ul><li>
<b>GNOME Power Statistics</b> — System power information and statistics for GNOME.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://gitlab.gnome.org/GNOME/gnome-power-manager">https://gitlab.gnome.org/GNOME/gnome-power-manager</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-power-manager">gnome-power-manager</a></span>
</dd></dl>
<ul><li>
<b>KDE Power Devil</b> — Power management module for Plasma.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://userbase.kde.org/Power_Devil">https://userbase.kde.org/Power_Devil</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=powerdevil">powerdevil</a></span> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/powerdevil-light/">powerdevil-light</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>LXQt Power Management</b> — Power management module for LXQt.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/lxqt/lxqt-powermanagement">https://github.com/lxqt/lxqt-powermanagement</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=lxqt-powermanagement">lxqt-powermanagement</a></span>
</dd></dl>
<ul><li>
<b>MATE Power Management</b> — Power management tool for MATE.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/mate-desktop/mate-power-manager">https://github.com/mate-desktop/mate-power-manager</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=mate-power-manager">mate-power-manager</a></span>
</dd></dl>
<ul><li>
<b>MATE Power Statistics</b> — System power information and statistics for MATE.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/mate-desktop/mate-power-manager">https://github.com/mate-desktop/mate-power-manager</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=mate-power-manager">mate-power-manager</a></span>
</dd></dl>
<ul><li>
<b>powerkit</b> — Desktop independent power manager.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/rodlie/powerkit">https://github.com/rodlie/powerkit</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/powerkit/">powerkit</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>Xfce Power Manager</b> — Power manager for Xfce.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://docs.xfce.org/xfce/xfce4-power-manager/start">https://docs.xfce.org/xfce/xfce4-power-manager/start</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xfce4-power-manager">xfce4-power-manager</a></span>
</dd></dl>
<ul><li>
<b>vattery</b> — Battery monitoring application written in Vala that will display the status of a laptop battery in a system tray.</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://www.jezra.net/projects/vattery">http://www.jezra.net/projects/vattery</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/vattery/">vattery</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h2><span class="mw-headline" id="Power_management_with_systemd">Power management with systemd</span></h2>
<h3><span class="mw-headline" id="ACPI_events">ACPI events</span></h3>
<p><i>systemd</i> handles some power-related <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface"  title="wikipedia:Advanced Configuration and Power Interface">ACPI</a> events, whose actions can be configured in <code>/etc/systemd/logind.conf</code> or <code>/etc/systemd/logind.conf.d/*.conf</code> — see <span class="plainlinks archwiki-template-man" title="$ man 5 logind.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/logind.conf.5">logind.conf(5)</a></span>. On systems with no dedicated power manager, this may replace the <a href="../Acpid.html" title="Acpid">acpid</a> daemon which is usually used to react to these ACPI events.
</p>
<p>The specified action for each event can be one of <code>ignore</code>, <code>poweroff</code>, <code>reboot</code>, <code>halt</code>, <code>suspend</code>, <code>hibernate</code>, <code>hybrid-sleep</code>, <code>suspend-then-hibernate</code>, <code>lock</code> or <code>kexec</code>. In case of hibernation and suspension, they must be properly <a href="../Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">set up</a>. If an event is not configured, <i>systemd</i> will use a default action.
</p>
<table  border="1">
<tbody>
<tr>
<th>Event handler
</th>
<th>Description
</th>
<th>Default action
</th>
</tr>
<tr>
<td>
<code>HandlePowerKey</code>
</td>
<td>Triggered when the power key/button is pressed.
</td>
<td>
<code>poweroff</code>
</td>
</tr>
<tr>
<td>
<code>HandleSuspendKey</code>
</td>
<td>Triggered when the suspend key/button is pressed.
</td>
<td>
<code>suspend</code>
</td>
</tr>
<tr>
<td>
<code>HandleHibernateKey</code>
</td>
<td>Triggered when the hibernate key/button is pressed.
</td>
<td>
<code>hibernate</code>
</td>
</tr>
<tr>
<td>
<code>HandleLidSwitch</code>
</td>
<td>Triggered when the lid is closed, except in the cases below.
</td>
<td>
<code>suspend</code>
</td>
</tr>
<tr>
<td>
<code>HandleLidSwitchDocked</code>
</td>
<td>Triggered when the lid is closed if the system is inserted in a docking station, or more than one display is connected.
</td>
<td>
<code>ignore</code>
</td>
</tr>
<tr>
<td>
<code>HandleLidSwitchExternalPower</code>
</td>
<td>Triggered when the lid is closed if the system is connected to external power.
</td>
<td>action set for <code>HandleLidSwitch</code>
</td>
</tr>
</tbody>
</table>
<p>To apply any changes, signal <code>systemd-logind</code> with <code>HUP</code>:
</p>
<pre># kill -s HUP $(systemctl show --property MainPID systemd-logind | cut -d= -f2)
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>systemd</i> cannot handle AC and Battery ACPI events, so if you use <a href="../Laptop_Mode_Tools.html" title="Laptop Mode Tools">Laptop Mode Tools</a> or other similar tools <a href="../Acpid.html" title="Acpid">acpid</a> is still required.</div>
<h4><span class="mw-headline" id="Power_managers">Power managers</span></h4>
<p>Some <a href="../Desktop_environment.html" title="Desktop environment">desktop environments</a> include power managers which <a rel="nofollow"  href="http://www.freedesktop.org/wiki/Software/systemd/inhibit/">inhibit</a> (temporarily turn off) some or all of the <i>systemd</i> ACPI settings. If such a power manager is running, then the actions for ACPI events can be configured in the power manager alone. Changes to <code>/etc/systemd/logind.conf</code> or <code>/etc/systemd/logind.conf.d/*.conf</code> need be made only if you wish to configure behaviour for a particular event that is not inhibited by the power manager. 
</p>
<p>Note that if the power manager does not inhibit <i>systemd</i> for the appropriate events you can end up with a situation where <i>systemd</i> suspends your system and then when the system is woken up the other power manager suspends it again. As of December 2016, the power managers of <a href="../KDE.html" title="KDE">KDE</a>, <a href="../GNOME.html" title="GNOME">GNOME</a>, <a href="../Xfce.html" title="Xfce">Xfce</a> and <a href="../MATE.html" title="MATE">MATE</a> issue the necessary <i>inhibited</i> commands. If the <i>inhibited</i> commands are not being issued, such as when using <a href="../Acpid.html" title="Acpid">acpid</a> or others to handle ACPI events, set the <code>Handle</code> options to <code>ignore</code>. See also <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-inhibit"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd-inhibit.1">systemd-inhibit(1)</a></span>.
</p>
<h4><span class="mw-headline" id="xss-lock">xss-lock</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xss-lock">xss-lock</a></span> subscribes to the systemd-events <code>suspend</code>, <code>hibernate</code>, <code>lock-session</code>, and <code>unlock-session</code> with appropriate actions (run locker and wait for user to unlock or kill locker). <i>xss-lock</i> also reacts to <a href="../Display_Power_Management_Signaling.html" class="mw-redirect" title="DPMS">DPMS</a> events and runs or kills the locker in response.
</p>
<p>Start xss-lock in your <a href="../Autostarting.html" class="mw-redirect" title="Autostart">autostart</a>, for example
</p>
<pre>xss-lock -- i3lock -n -i <i>background_image.png</i> &amp;
</pre>
<h3><span class="mw-headline" id="Suspend_and_hibernate">Suspend and hibernate</span></h3>
<p><i>systemd</i> provides commands to suspend to RAM or hibernate using the kernel's native suspend/resume functionality. There are also mechanisms to add hooks to customize pre- and post-suspend actions.
</p>
<p><code>systemctl suspend</code> should work out of the box, for <code>systemctl hibernate</code> to work on your system you need to follow the instructions at <a href="../Power_management/Suspend_and_hibernate.html#Hibernation" class="mw-redirect" title="Suspend and hibernate">Suspend and hibernate#Hibernation</a>.
</p>
<p>There are also two modes combining suspend and hibernate:
</p>
<ul>
<li>
<code>systemctl hybrid-sleep</code> suspends the system both to RAM and disk, so a complete power loss does not result in lost data. This mode is also called <a href="../Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">suspend to both</a>.</li>
<li>
<code>systemctl suspend-then-hibernate</code> initially suspends the system to RAM and if it is not interrupted within the delay specified by <code>HibernateDelaySec</code> in <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-sleep.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd-sleep.conf.5">systemd-sleep.conf(5)</a></span>, then the system will be woken using an RTC alarm and hibernated.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>systemd</i> can also use other suspend backends (such as <a href="../Uswsusp.html" title="Uswsusp">Uswsusp</a>), in addition to the default <i>kernel</i> backend, in order to put the computer to sleep or hibernate. See <a href="../Uswsusp.html#With_systemd" title="Uswsusp">Uswsusp#With systemd</a> for an example.</div>
<h4><span class="mw-headline" id="Hybrid-sleep_on_suspend_or_hibernation_request">Hybrid-sleep on suspend or hibernation request</span></h4>
<p>It is possible to configure systemd to always do a <i>hybrid-sleep</i> even on a <i>suspend</i> or <i>hibernation</i> request.
</p>
<p>The default <i>suspend</i> and <i>hibernation</i> action can be configured in the <code>/etc/systemd/sleep.conf</code> file. To set both actions to <i>hybrid-sleep</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/sleep.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Sleep]
# suspend=hybrid-sleep
SuspendMode=suspend
SuspendState=disk
# hibernate=hybrid-sleep
HibernateMode=suspend
HibernateState=disk</pre>
<p>See the <span class="plainlinks archwiki-template-man" title="$ man 5 sleep.conf.d"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/sleep.conf.d.5">sleep.conf.d(5)</a></span> manual page for details and the <a rel="nofollow"  href="https://www.kernel.org/doc/html/latest/admin-guide/pm/sleep-states.html#basic-sysfs-interfaces-for-system-suspend-and-hibernation">linux-toskernel documentation on power states</a>.
</p>
<h3><span class="mw-headline" id="Sleep_hooks">Sleep hooks</span></h3>
<h4>
<span id="Suspend.2Fresume_service_files"></span><span class="mw-headline" id="Suspend/resume_service_files">Suspend/resume service files</span>
</h4>
<p>Service files can be hooked into <i>suspend.target</i>, <i>hibernate.target</i>, <i>sleep.target</i>, <i>hybrid-sleep.target</i> and <i>suspend-then-hibernate.target</i> to execute actions before or after suspend/hibernate. Separate files should be created for user actions and root/system actions. <a href="../Systemd.html#Using_units" class="mw-redirect" title="Enable">Enable</a> the <code>suspend@<i>user</i></code> and <code>resume@<i>user</i></code> services to have them started at boot. Examples:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/suspend@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=User suspend actions
Before=sleep.target

[Service]
User=%I
Type=forking
Environment=DISPLAY=:0
ExecStartPre= -/usr/bin/pkill -u %u unison ; /usr/local/bin/music.sh stop
ExecStart=/usr/bin/sflock
ExecStartPost=/usr/bin/sleep 1

[Install]
WantedBy=sleep.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=User resume actions
After=suspend.target

[Service]
User=%I
Type=simple
ExecStart=/usr/local/bin/ssh-connect.sh

[Install]
WantedBy=suspend.target</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As screen lockers may return before the screen is "locked", the screen may flash on resuming from suspend. Adding a small delay via <code>ExecStartPost=/usr/bin/sleep 1</code> helps prevent this.</div>
<p>For root/system actions (<a href="../Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> the <code>root-resume</code> and <code>root-suspend</code> services to have them started at boot):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/root-suspend.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Local system suspend actions
Before=sleep.target

[Service]
Type=simple
ExecStart=-/usr/bin/pkill sshfs

[Install]
WantedBy=sleep.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/root-resume.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Local system resume actions
After=suspend.target

[Service]
Type=simple
ExecStart=/usr/bin/systemctl restart mnt-media.automount

[Install]
WantedBy=suspend.target</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> A couple of handy hints about these service files (more in <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.service"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd.service.5">systemd.service(5)</a></span>):
<ul>
<li>If <code>Type=oneshot</code> then you can use multiple <code>ExecStart=</code> lines. Otherwise only one <code>ExecStart</code> line is allowed. You can add more commands with either <code>ExecStartPre</code> or by separating commands with a semicolon (see the first example above; note the spaces before and after the semicolon, as they are <i>required</i>).</li>
<li>A command prefixed with <code>-</code> will cause a non-zero exit status to be ignored and treated as a successful command.</li>
<li>The best place to find errors when troubleshooting these service files is of course with <a href="../Systemd/Journal.html" class="mw-redirect" title="Journalctl">journalctl</a>.</li>
</ul>
</div>
<h4>
<span id="Combined_Suspend.2Fresume_service_file"></span><span class="mw-headline" id="Combined_Suspend/resume_service_file">Combined Suspend/resume service file</span>
</h4>
<p>With the combined suspend/resume service file, a single hook does all the work for different phases (sleep/resume) and for different targets (suspend/hibernate/hybrid-sleep).
</p>
<p>Example and explanation:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wicd-sleep.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Wicd sleep hook
Before=sleep.target
StopWhenUnneeded=yes

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=-/usr/share/wicd/daemon/suspend.py
ExecStop=-/usr/share/wicd/daemon/autoconnect.py

[Install]
WantedBy=sleep.target
</pre>
<ul>
<li>
<code>RemainAfterExit=yes</code>: After started, the service is considered active until it is explicitly stopped.</li>
<li>
<code>StopWhenUnneeded=yes</code>: When active, the service will be stopped if no other active service requires it. In this specific example, it will be stopped after <i>sleep.target</i> is stopped.</li>
<li>Because <i>sleep.target</i> is pulled in by <i>suspend.target</i>, <i>hibernate.target</i> and <i>hybrid-sleep.target</i> and because <i>sleep.target</i> itself is a <i>StopWhenUnneeded</i> service, the hook is guaranteed to start/stop properly for different tasks.</li>
</ul>
<h4>
<span id="Hooks_in_.2Fusr.2Flib.2Fsystemd.2Fsystem-sleep"></span><span class="mw-headline" id="Hooks_in_/usr/lib/systemd/system-sleep">Hooks in /usr/lib/systemd/system-sleep</span>
</h4>
<p><i>systemd</i> runs all executables in <code>/usr/lib/systemd/system-sleep/</code>, passing two arguments to each of them:
</p>
<ul>
<li>Argument 1: either <code>pre</code> or <code>post</code>, depending on whether the machine is going to sleep or waking up</li>
<li>Argument 2: <code>suspend</code>, <code>hibernate</code> or <code>hybrid-sleep</code>, depending on which is being invoked</li>
</ul>
<p><i>systemd</i> will run these scripts concurrently and not one after another.
</p>
<p>The output of any custom script will be logged by <i>systemd-suspend.service</i>, <i>systemd-hibernate.service</i> or <i>systemd-hybrid-sleep.service</i>. You can see its output in <i>systemd</i>'s <a href="../Systemd/Journal.html" class="mw-redirect" title="Journalctl">journalctl</a>:
</p>
<pre># journalctl -b -u systemd-suspend.service
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can also use <i>sleep.target</i>, <i>suspend.target</i>, <i>hibernate.target</i> or <i>hybrid-sleep.target</i> to hook units into the sleep state logic instead of using custom scripts.</div>
<p>An example of a custom sleep script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/example.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
case $1/$2 in
  pre/*)
    echo "Going to $2..."
    ;;
  post/*)
    echo "Waking up from $2..."
    ;;
esac
</pre>
<p>Do not forget to make your script executable:
</p>
<pre># chmod a+x /usr/lib/systemd/system-sleep/example.sh
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.special"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd.special.7">systemd.special(7)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-sleep"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd-sleep.8">systemd-sleep(8)</a></span> for more details.
</p>
<h3><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h3>
<h4><span class="mw-headline" id="Delayed_lid_switch_action">Delayed lid switch action</span></h4>
<p>When performing lid switches in short succession, <i>logind</i> will delay the suspend action for up to 90s to detect possible docks. <a rel="nofollow"  href="http://lists.freedesktop.org/archives/systemd-devel/2015-January/027131.html">[1]</a> This delay was made configurable with systemd v220:<a rel="nofollow"  href="https://github.com/systemd/systemd/commit/9d10cbee89ca7f82d29b9cb27bef11e23e3803ba">[2]</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/logind.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
HoldoffTimeoutSec=30s
...</pre>
<h4><span class="mw-headline" id="Suspend_from_corresponding_laptop_Fn_key_not_working">Suspend from corresponding laptop Fn key not working</span></h4>
<p>If, regardless of the setting in logind.conf, the sleep button does not work (pressing it does not even produce a message in syslog), then logind is probably not watching the keyboard device. <a rel="nofollow"  href="http://lists.freedesktop.org/archives/systemd-devel/2015-February/028325.html">[3]</a> Do:
</p>
<pre># journalctl --grep="Watching system buttons"
</pre>
<p>You might see something like this:
</p>
<pre>May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event2 (Power Button)
May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event3 (Sleep Button)
May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event4 (Video Bus)
</pre>
<p>Notice no keyboard device. Now obtain ATTRS{name} for the parent keyboard device <a rel="nofollow"  href="http://systemd-devel.freedesktop.narkive.com/Rbi3rjNN/patch-1-2-logind-add-support-for-tps65217-power-button">[4]</a> :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># udevadm info -a /dev/input/by-path/*-kbd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
KERNEL=="event0"
...
ATTRS{name}=="AT Translated Set 2 keyboard"</pre>
<p>Now write a custom udev rule to add the "power-switch" tag:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/70-power-switch-my.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="remove", GOTO="power_switch_my_end"
SUBSYSTEM=="input", KERNEL=="event*", ATTRS{name}=="AT Translated Set 2 keyboard", TAG+="power-switch"
LABEL="power_switch_my_end"
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Explicit <code>systemctl</code> commands should not be provided. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<p>Restart services and reload rules:
</p>
<pre># systemctl restart systemd-udevd.service
# udevadm trigger
# systemctl restart systemd-logind.service
</pre>
<p>Now you should see <code>Watching system buttons on /dev/input/event0</code> in syslog.
</p>
<h2><span class="mw-headline" id="Power_saving">Power saving</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="../Laptop.html#Power_management" title="Laptop">Laptop#Power management</a> for power management specific to laptops, such as battery monitoring.</div>
<p>This section is a reference for creating custom scripts and power saving settings such as by udev rules. Make sure that the settings are not managed by some <a href="#Userspace_tools">other utility</a> to avoid conflicts.
</p>
<p>Almost all of the features listed here are worth using whether or not the computer is on AC or battery power. Most have negligible performance impact and are just not enabled by default because of commonly broken hardware/drivers. Reducing power usage means reducing heat, which can even lead to higher performance on a modern Intel or AMD CPU, thanks to <a href="https://en.wikipedia.org/wiki/Intel_Turbo_Boost"  title="wikipedia:Intel Turbo Boost">dynamic overclocking</a>.
</p>
<h3>
<span id="Processors_with_HWP_.28Hardware_P-state.29_support"></span><span class="mw-headline" id="Processors_with_HWP_(Hardware_P-state)_support">Processors with HWP (Hardware P-state) support</span>
</h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../CPU_frequency_scaling.html" title="CPU frequency scaling">CPU frequency scaling</a>.</b><a href="../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> More context in the main article. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<p>The available energy preferences of a HWP supported processor are <code>default performance balance_performance balance_power power</code>.
</p>
<p>This can be validated by <code>$ cat /sys/devices/system/cpu/cpufreq/policy?/energy_performance_available_preferences</code>
</p>
<p>To conserve more energy, you can config by creating the following file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tmpfiles.d/energy_performance_preference.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">w /sys/devices/system/cpu/cpufreq/policy?/energy_performance_preference - - - - balance_power
</pre>
<p>See the <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-tmpfiles"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd-tmpfiles.8">systemd-tmpfiles(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 5 tmpfiles.d"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/tmpfiles.d.5">tmpfiles.d(5)</a></span> man pages for details.
</p>
<h3><span class="mw-headline" id="Audio">Audio</span></h3>
<h4><span class="mw-headline" id="Kernel">Kernel</span></h4>
<p>By default, audio power saving is turned off by most drivers. It can be enabled by setting the <code>power_save</code> parameter; a time (in seconds) to go into idle mode. To idle the audio card after one second, create the following file for Intel soundcards.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/audio_powersave.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options snd_hda_intel power_save=1</pre>
<p>Alternatively, use the following for ac97:
</p>
<pre>options snd_ac97_codec power_save=1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>To retrieve the manufacturer and the corresponding kernel driver which is used for your sound card, run <code>lspci -k</code>.</li>
<li>Toggling the audio card's power state can cause a popping sound or noticeable latency on some broken hardware.</li>
</ul>
</div>
<p>It is also possible to further reduce the audio power requirements by disabling the HDMI audio output, which can done by <a href="../Kernel_module.html#Blacklisting" class="mw-redirect" title="Blacklisting">blacklisting</a> the appropriate kernel modules (e.g. <code>snd_hda_codec_hdmi</code> in case of Intel hardware).
</p>
<h4><span class="mw-headline" id="PulseAudio">PulseAudio</span></h4>
<p>By default, PulseAudio suspends any audio sources that have become idle for too long. When using an external USB microphone, recordings may start with a pop sound. As a workaround, comment out the following line in <code>/etc/pulse/default.pa</code>:
</p>
<pre>load-module module-suspend-on-idle
</pre>
<p>Afterwards, restart PulseAudio with <code>systemctl restart --user pulseaudio</code>.
</p>
<h3><span class="mw-headline" id="Backlight">Backlight</span></h3>
<p>See <a href="../Backlight.html" title="Backlight">Backlight</a>.
</p>
<h3><span class="mw-headline" id="Bluetooth">Bluetooth</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The device should likely be disabled with hciconfig first. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<p>To disable bluetooth completely, <a href="../Kernel_module.html#Blacklisting" class="mw-redirect" title="Blacklist">blacklist</a> the <code>btusb</code> and <code>bluetooth</code> modules.
</p>
<p>To turn off bluetooth only temporarily, use <i>rfkill</i>:
</p>
<pre># rfkill block bluetooth
</pre>
<p>Or with udev rule:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-bluetooth.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># disable bluetooth
SUBSYSTEM=="rfkill", ATTR{type}=="bluetooth", ATTR{state}="0"
</pre>
<h3><span class="mw-headline" id="Web_camera">Web camera</span></h3>
<p>If you will not use integrated web camera then <a href="../Kernel_module.html#Blacklisting" class="mw-redirect" title="Blacklist">blacklist</a> the <code>uvcvideo</code> module.
</p>
<h3><span class="mw-headline" id="Kernel_parameters">Kernel parameters</span></h3>
<p>This section uses configs in <code>/etc/sysctl.d/</code>, which is <i>"a drop-in directory for kernel sysctl parameters."</i>  See <a rel="nofollow"  href="http://0pointer.de/blog/projects/the-new-configuration-files">The New Configuration Files</a> and more specifically <span class="plainlinks archwiki-template-man" title="$ man 5 sysctl.d"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/sysctl.d.5">sysctl.d(5)</a></span> for more information.
</p>
<h4><span class="mw-headline" id="Disabling_NMI_watchdog">Disabling NMI watchdog</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This or <code>nowatchdog</code> as can be seen in <a href="../Improving_performance.html#Watchdogs" title="Improving performance">Improving performance#Watchdogs</a> (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<p>The <a href="https://en.wikipedia.org/wiki/Non-maskable_interrupt"  title="wikipedia:Non-maskable interrupt">NMI</a> watchdog is a debugging feature to catch hardware hangs that cause a kernel panic. On some systems it can generate a lot of interrupts, causing a noticeable increase in power usage:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/disable_watchdog.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">kernel.nmi_watchdog = 0</pre>
<p>or add <code>nmi_watchdog=0</code> to the <a href="../Kernel_parameters.html" class="mw-redirect" title="Kernel line">kernel line</a> to disable it completely from early boot.
</p>
<h4><span class="mw-headline" id="Writeback_Time">Writeback Time</span></h4>
<p>Increasing the virtual memory dirty writeback time helps to aggregate disk I/O together, thus reducing spanned disk writes, and increasing power saving. To set the value to 60 seconds (default is 5 seconds):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/dirty.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.dirty_writeback_centisecs = 6000</pre>
<p>To do the same for journal commits on supported filesystems (e.g. ext4, btrfs...), use <code>commit=60</code> as a option in <a href="../Fstab.html" title="Fstab">fstab</a>.
</p>
<p>Note that this value is modified as a side effect of the Laptop Mode setting below.
See also <a href="../Sysctl.html#Virtual_memory" title="Sysctl">sysctl#Virtual memory</a> for other parameters affecting I/O performance and power saving.
</p>
<h4><span class="mw-headline" id="Laptop_Mode">Laptop Mode</span></h4>
<p>See the <a rel="nofollow"  href="https://www.kernel.org/doc/html/latest/admin-guide/laptops/laptop-mode.html">kernel documentation</a> on the laptop mode 'knob.' <i>"A sensible value for the knob is 5 seconds."</i>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/laptop.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.laptop_mode = 5</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This setting is mainly relevant to spinning-disk drives.</div>
<h3><span class="mw-headline" id="Network_interfaces">Network interfaces</span></h3>
<p><a href="../Wake-on-LAN.html" title="Wake-on-LAN">Wake-on-LAN</a> can be a useful feature, but if you are not making use of it then it is simply draining extra power waiting for a magic packet while in suspend. You can adapt the <a href="../Wake-on-LAN.html#udev" title="Wake-on-LAN">Wake-on-LAN#udev</a> rule to disable the feature for all ethernet interfaces.
To enable powersaving with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=iw">iw</a></span> on all wireless interfaces:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/<b>81</b>-wifi-powersave.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="net", KERNEL=="wl*", RUN+="/usr/bin/iw dev $name set power_save on"</pre>
<p>The name of the configuration file is important. With the use of <a href="../Network_configuration.html#Change_interface_name" title="Network configuration">persistent device names</a> in systemd, the above network rule, named lexicographically <b>after</b> <code>80-net-setup-link.rules</code>, is applied after the device is renamed with a persistent name e.g. <code>wlan0</code> renamed <code>wlp3s0</code>.
Be aware that the <code>RUN</code> command is executed after all rules have been processed and must anyway use the persistent name, available in <code>$name</code> for the matched device.
</p>
<h4>
<span id="Intel_wireless_cards_.28iwlwifi.29"></span><span class="mw-headline" id="Intel_wireless_cards_(iwlwifi)">Intel wireless cards (iwlwifi)</span>
</h4>
<p>Additional power saving functions of Intel wireless cards with <code>iwlwifi</code> driver can be enabled by passing the correct parameters to the kernel module. Making them persistent can be achieved by adding the lines below to the <code>/etc/modprobe.d/iwlwifi.conf</code> file:
</p>
<pre>options iwlwifi power_save=1
</pre>
<p>This option will probably increase your median latency:
</p>
<pre>options iwlwifi uapsd_disable=0
</pre>
<p>On kernels &lt; 5.4 you can use this option, but it will probably decrease your maximum throughput:
</p>
<pre>options iwlwifi d0i3_disable=0
</pre>
<p>Depending on your wireless card one of these two options will apply.
</p>
<pre>options iwlmvm power_scheme=3
</pre>
<pre>options iwldvm force_cam=0
</pre>
<p>You can check which one is relevant by checking which of these modules is running using
</p>
<pre># lsmod | grep '^iwl.vm'
</pre>
<p>Keep in mind that these power saving options are experimental and can cause an unstable system.
</p>
<h3><span class="mw-headline" id="Bus_power_management">Bus power management</span></h3>
<h4><span class="mw-headline" id="Active_State_Power_Management">Active State Power Management</span></h4>
<p>If the computer is believed not to support <a href="https://en.wikipedia.org/wiki/Active_State_Power_Management"  title="wikipedia:Active State Power Management">ASPM</a> it will be disabled on boot:
</p>
<pre># lspci -vv | grep 'ASPM.*abled;'
</pre>
<p>ASPM is handled by the BIOS, if ASPM is disabled it will be because <a rel="nofollow"  href="https://wireless.wiki.kernel.org/users/documentation/ASPM">[5]</a>:
</p>
<ol>
<li>The BIOS disabled it for some reason (for conflicts?).</li>
<li>PCIE requires ASPM but L0s are optional (so L0s might be disabled and only L1 enabled).</li>
<li>The BIOS might not have been programmed for it.</li>
<li>The BIOS is buggy.</li>
</ol>
<p>If believing the computer has support for ASPM it can be forced on for the kernel to handle with the <code>pcie_aspm=force</code> <a href="../Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>Forcing on ASPM can cause a freeze/panic, so make sure you have a way to undo the option if it does not work.</li>
<li>On systems that do not support it forcing on ASPM can even increase power consumption.</li>
<li>This forces ASPM in kernel while it can still remain disabled in hardware and not work. To check whether this is the case the <code>dmesg | grep ASPM</code> command can be used and if that is the case, hardware-specific Wiki article should be consulted.</li>
</ul>
</div>
<p>To adjust to <code>powersave</code> do (the following command will not work unless enabled):
</p>
<pre># echo powersave &gt; /sys/module/pcie_aspm/parameters/policy
</pre>
<p>By default it looks like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/module/pcie_aspm/parameters/policy</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[default] performance powersave
</pre>
<h4><span class="mw-headline" id="PCI_Runtime_Power_Management">PCI Runtime Power Management</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/pci_pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SUBSYSTEM=="pci", ATTR{power/control}="auto"</pre>
<p>The rule above powers all unused devices down, but some devices will not wake up again.
To allow runtime power management only for devices that are known to work, use simple matching against vendor and device IDs (use <code>lspci -nn</code> to get these values):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/pci_pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># whitelist for pci autosuspend
SUBSYSTEM=="pci", ATTR{vendor}=="0x1234", ATTR{device}=="0x1234", ATTR{power/control}="auto"
</pre>
<p>Alternatively, to blacklist devices that are not working with PCI runtime power management and enable it for all other devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/pci_pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># blacklist for pci runtime power management
SUBSYSTEM=="pci", ATTR{vendor}=="0x1234", ATTR{device}=="0x1234", ATTR{power/control}="on", GOTO="pci_pm_end"

SUBSYSTEM=="pci", ATTR{power/control}="auto"
LABEL="pci_pm_end"
</pre>
<h4><span class="mw-headline" id="USB_autosuspend">USB autosuspend</span></h4>
<p>The Linux kernel can automatically suspend USB devices when they are not in use. This can sometimes save quite a bit of power, however some USB devices are not compatible with USB power saving and start to misbehave (common for USB mice/keyboards). <a href="../Udev.html" title="Udev">udev</a> rules based on whitelist or blacklist filtering can help to mitigate the problem.
</p>
<p>The most simple and likely useless example is enabling autosuspend for all USB devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-usb_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="usb", TEST=="power/control", ATTR{power/control}="auto"
</pre>
<p>To allow autosuspend only for devices that are known to work, use simple matching against vendor and product IDs (use <i>lsusb</i> to get these values):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-usb_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># whitelist for usb autosuspend
ACTION=="add", SUBSYSTEM=="usb", TEST=="power/control", ATTR{idVendor}=="05c6", ATTR{idProduct}=="9205", ATTR{power/control}="auto"
</pre>
<p>Alternatively, to blacklist devices that are not working with USB autosuspend and enable it for all other devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/50-usb_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># blacklist for usb autosuspend
ACTION=="add", SUBSYSTEM=="usb", ATTR{idVendor}=="05c6", ATTR{idProduct}=="9205", GOTO="power_usb_rules_end"

ACTION=="add", SUBSYSTEM=="usb", TEST=="power/control", ATTR{power/control}="auto"
LABEL="power_usb_rules_end"
</pre>
<p>The default autosuspend idle delay time is controlled by the <code>autosuspend</code> parameter of the <code>usbcore</code> <a href="../Kernel_module.html" title="Kernel module">kernel module</a>. To set the delay to 5 seconds instead of the default 2 seconds:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/usb-autosuspend.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options usbcore autosuspend=5
</pre>
<p>Similarly to <code>power/control</code>, the delay time can be fine-tuned per device by setting the <code>power/autosuspend</code> attribute.
</p>
<p>See the <a rel="nofollow"  href="https://www.kernel.org/doc/html/latest/driver-api/usb/power-management.html">Linux kernel documentation</a> for more information on USB power management.
</p>
<h4><span class="mw-headline" id="SATA_Active_Link_Power_Management">SATA Active Link Power Management</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> SATA Active Link Power Management can lead to data loss on some devices. Do not enable this setting unless you have frequent backups.</div>
<p>Since Linux 4.15 there is a <a rel="nofollow"  href="https://hansdegoede.livejournal.com/18412.html">new setting</a> called <code>med_power_with_dipm</code> that matches the behaviour of Windows IRST driver settings and should not cause data loss with recent SSD/HDD drives. The power saving can be significant, ranging <a rel="nofollow"  href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ebb82e3c79d2a956366d0848304a53648bd6350b">from 1.0 to 1.5 Watts (when idle)</a>. It will become a default setting for Intel based laptops in Linux 4.16 <a rel="nofollow"  href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ebb82e3c79d2a956366d0848304a53648bd6350b">[6]</a>.
</p>
<p>The current setting can be read from <code>/sys/class/scsi_host/host*/link_power_management_policy</code> as follows:
</p>
<pre># cat /sys/class/scsi_host/host*/link_power_management_policy
</pre>
<table >
<caption>Available ALPM settings
</caption>
<tbody>
<tr>
<th>Setting
</th>
<th>Description
</th>
<th>Power saving
</th>
</tr>
<tr>
<td>max_performance
</td>
<td>current default
</td>
<td>None
</td>
</tr>
<tr>
<td>medium_power
</td>
<td>-
</td>
<td>~1.0 Watts
</td>
</tr>
<tr>
<td>med_power_with_dipm
</td>
<td>recommended setting
</td>
<td>~1.5 Watts
</td>
</tr>
<tr>
<td>min_power
</td>
<td>
<b>WARNING: possible data loss</b>
</td>
<td>~1.5 Watts
</td>
</tr>
</tbody>
</table>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/hd_power_save.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="scsi_host", KERNEL=="host*", ATTR{link_power_management_policy}="med_power_with_dipm"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This adds latency when accessing a drive that has been idle, so it is one of the few settings that may be worth toggling based on whether you are on AC power.</div>
<h3><span class="mw-headline" id="Hard_disk_drive">Hard disk drive</span></h3>
<p>See <a href="../Hdparm.html#Power_management_configuration" title="Hdparm">hdparm#Power management configuration</a> for drive parameters that can be set.
</p>
<p>Power saving is not effective when too many programs are frequently writing to the disk. Tracking all programs, and how and when they write to disk is the way to limit disk usage. Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=iotop">iotop</a></span> to see which programs use the disk frequently. See <a href="../Improving_performance.html#Storage_devices" title="Improving performance">Improving performance#Storage devices</a> for other tips.
</p>
<p>Also little things like setting the <a href="../Fstab.html#atime_options" title="Fstab">noatime</a> option can help. If enough RAM is available, consider disabling or limiting <a href="../Swap.html#Swappiness" class="mw-redirect" title="Swappiness">swappiness</a> as it has the possibility to limit a good number of disk writes.
</p>
<h3><span class="mw-headline" id="CD-ROM_or_DVD_drive">CD-ROM or DVD drive</span></h3>
<p>See <a href="../Udisks.html#Devices_do_not_remain_unmounted_(udisks)" title="Udisks">Udisks#Devices do not remain unmounted (udisks)</a>.
</p>
<h2><span class="mw-headline" id="Tools_and_scripts">Tools and scripts</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Merged from <a href="../Power_management.html" class="mw-redirect" title="Power saving">Power saving</a>, needs reorganization to fit into this page. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Power_management">Talk:Power management#</a>)</div>
</div>
<h3><span class="mw-headline" id="Using_a_script_and_an_udev_rule">Using a script and an udev rule</span></h3>
<p>Since systemd users can suspend and hibernate through <code>systemctl suspend</code> or <code>systemctl hibernate</code> and handle acpi events with <code>/etc/systemd/logind.conf</code>, it might be interesting to remove <i>pm-utils</i> and <a href="../Acpid.html" title="Acpid">acpid</a>. There is just one thing systemd cannot do (as of systemd-204): power management depending on whether the system is running on AC or battery. To fill this gap, you can create a single <a href="../Udev.html" title="Udev">udev</a> rule that runs a script when the AC adapter is plugged and unplugged:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/powersave.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SUBSYSTEM=="power_supply", ATTR{online}=="0", RUN+="/path/to/your/script true"
SUBSYSTEM=="power_supply", ATTR{online}=="1", RUN+="/path/to/your/script false"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can use the same script that <i>pm-powersave</i> uses. You just have to make it executable and place it somewhere else (for example <code>/usr/local/bin/</code>).</div>
<p>Examples of powersave scripts:
</p>
<ul>
<li>
<a rel="nofollow"  href="https://github.com/supplantr/ftw">ftw</a>, package: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/ftw-git/">ftw-git</a></span><sup><small>AUR</small></sup>
</li>
<li><a rel="nofollow"  href="https://github.com/Unia/powersave">powersave</a></li>
<li>
<a rel="nofollow"  href="https://github.com/quequotion/pantheon-bzr-qq/blob/master/EXTRAS/indicator-powersave/throttle">throttle</a>, from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/indicator-powersave/">indicator-powersave</a></span><sup><small>AUR</small></sup>
</li>
</ul>
<p>The above udev rule should work as expected, but if your power settings are not updated after a suspend or hibernate cycle, you should add a script in <code>/usr/lib/systemd/system-sleep/</code> with the following contents:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/00powersave</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

case $1 in
    pre) /path/to/your/script false ;;
    post)       
	if cat /sys/class/power_supply/AC0/online | grep 0 &gt; /dev/null 2&gt;&amp;1
	then
    		/path/to/your/script true	
	else
    		/path/to/your/script false
	fi
    ;;
esac
exit 0
</pre>
<p>Do not forget to make it executable!
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Be aware that AC0 may be different for your laptop, change it if that is the case.</div>
<h3><span class="mw-headline" id="Print_power_settings">Print power settings</span></h3>
<p>This script prints power settings and a variety of other properties for USB and PCI devices.  Note that root permissions are needed to see all settings.
</p>
<pre>#!/bin/bash

for i in $(find /sys/devices -name "bMaxPower")
do
	busdir=${i%/*}
	busnum=$(&lt;$busdir/busnum)
	devnum=$(&lt;$busdir/devnum)
	title=$(lsusb -s $busnum:$devnum)

	printf "\n\n+++ %s\n  -%s\n" "$title" "$busdir"

	for ff in $(find $busdir/power -type f ! -empty 2&gt;/dev/null)
	do
		v=$(cat $ff 2&gt;/dev/null|tr -d "\n")
		[[ ${#v} -gt 0 ]] &amp;&amp; echo -e " ${ff##*/}=$v";
		v=;
	done | sort -g;
done;

printf "\n\n\n+++ %s\n" "Kernel Modules"
for mod in $(lspci -k | sed -n '/in use:/s,^.*: ,,p' | sort -u)
do
	echo "+ $mod";
	systool -v -m $mod 2&gt; /dev/null | sed -n "/Parameters:/,/^$/p";
done
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow"  href="http://www.thinkwiki.org/wiki/How_to_reduce_power_consumption">ThinkWiki:How to reduce power consumption</a></li>
<li><a rel="nofollow"  href="http://ivanvojtko.blogspot.sk/2016/04/how-to-get-longer-battery-life-on-linux.html">How to get longer battery life on Linux</a></li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../Category:Power_management.html" title="Category:Power management">Power management</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Power_management&amp;oldid=608997">https://wiki.archlinux.org/index.php?title=Power_management&amp;oldid=608997</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 30 April 2020, at 15:08.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



