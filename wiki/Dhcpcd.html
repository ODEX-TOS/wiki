<!--
    title: Dhcpcd
    description: Migration of Dhcpcd from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">dhcpcd</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../Network_configuration.html" title="Network configuration">Network configuration</a></li>
<li><a href="../Network_configuration/Wireless.html" class="mw-redirect" title="Wireless network configuration">Wireless network configuration</a></li>
<li><a href="../Dhcpd.html" title="Dhcpd">dhcpd</a></li>
</ul>
</div>
<p><i>dhcpcd</i> is a DHCP and DHCPv6 client. It is currently the most feature-rich open source DHCP client, see the <a rel="nofollow"  href="https://roy.marples.name/projects/dhcpcd">home page</a> for the full list of features.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Roy Marples' <i>dhcpcd</i> (DHCP <b>client</b> daemon) is not the same as Internet Systems Consortium's <a href="../Dhcpd.html" title="Dhcpd">dhcpd</a> (DHCP <b>(server)</b> daemon).</div>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span >1</span> <span >Installation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Running"><span >2</span> <span >Running</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Configuration"><span >3</span> <span >Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#DHCP_static_route(s)"><span >3.1</span> <span >DHCP static route(s)</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#DHCP_Client_Identifier"><span >3.2</span> <span >DHCP Client Identifier</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#Static_profile"><span >3.3</span> <span >Static profile</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Fallback_profile"><span >3.3.1</span> <span >Fallback profile</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#Hooks"><span >4</span> <span >Hooks</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#10-wpa_supplicant"><span >4.1</span> <span >10-wpa_supplicant</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#Tips_and_tricks"><span >5</span> <span >Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Speed_up_DHCP_by_disabling_ARP_probing"><span >5.1</span> <span >Speed up DHCP by disabling ARP probing</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Remove_old_DHCP_lease"><span >5.2</span> <span >Remove old DHCP lease</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Different_IPs_when_multi-booting"><span >5.3</span> <span >Different IPs when multi-booting</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#/etc/resolv.conf"><span >5.4</span> <span >/etc/resolv.conf</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#Troubleshooting"><span >6</span> <span >Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Client_ID"><span >6.1</span> <span >Client ID</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Check_DHCP_problem_by_releasing_IP_first"><span >6.2</span> <span >Check DHCP problem by releasing IP first</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Problems_with_noncompliant_routers"><span >6.3</span> <span >Problems with noncompliant routers</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#dhcpcd_and_systemd_network_interfaces"><span >6.4</span> <span >dhcpcd and systemd network interfaces</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Timeout_delay"><span >6.5</span> <span >Timeout delay</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21">
<a href="#Known_issues"><span >7</span> <span >Known issues</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#dhcpcd@.service_causes_slow_startup"><span >7.1</span> <span >dhcpcd@.service causes slow startup</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#See_also"><span >8</span> <span >See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> package.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/dhcpcd-ui/">dhcpcd-ui</a></span><sup><small>AUR</small></sup> is a <a href="../GTK.html" title="GTK">GTK</a> frontend for the <i>dhcpcd</i> daemon, and optionally <a href="../Wpa_supplicant.html" class="mw-redirect" title="WPA supplicant">WPA supplicant</a>. It features a configuration dialogue and the ability to enter a pass phrase for wireless networks.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/dhcpcd-ui-patched/">dhcpcd-ui-patched</a></span><sup><small>AUR</small></sup> is a patched version of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/dhcpcd-ui/">dhcpcd-ui</a></span><sup><small>AUR</small></sup> package. It uses AppIndicator instead of GtkStatusIcon and compiles with gtk3. Has a sharp tray icon when used with <a href="../KDE.html" title="KDE">KDE</a>.
</p>
<h2><span class="mw-headline" id="Running">Running</span></h2>
<p>To start the daemon for <i>all</i> network interfaces, <a href="../Systemd.html#Using_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>dhcpcd.service</code>.
</p>
<p>To start the daemon for a specific interface alone, <a href="../Systemd.html#Using_units" class="mw-redirect" title="Start/enable">start/enable</a> the template unit <code>dhcpcd@<i>interface</i>.service</code>, where <i>interface</i> can be found with <a href="../Network_configuration.html#Listing_network_interfaces" title="Network configuration">Network configuration#Listing network interfaces</a>.
</p>
<p>Using the template unit is recommended; see <a href="#dhcpcd_and_systemd_network_interfaces">#dhcpcd and systemd network interfaces</a> for details.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-cut.png" ><img alt="Tango-edit-cut.png" src="../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a><b>This section is being considered for removal.</b><a href="../File:Tango-edit-cut.png" ><img alt="Tango-edit-cut.png" src="../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> All daemons can be <i>started manually</i>. There should be no reason to avoid the usage of <code>dhcpcd.service</code>/<code>dhcpcd@.service</code>. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Dhcpcd">Talk:Dhcpcd#</a>)</div>
</div>
<p>Alternatively, to start <i>dhcpcd</i> manually, run the following command:
</p>
<pre># dhcpcd <i>interface</i>
</pre>
<p>In all of the above, you will be assigned a dynamic IP address. To assign a static IP address, see <a href="#Static_profile">#Static profile</a>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The main configuration is done in <code>/etc/dhcpcd.conf</code>. See <span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span> for details. Some of the frequently used options are highlighted below.
</p>
<h3>
<span id="DHCP_static_route.28s.29"></span><span class="mw-headline" id="DHCP_static_route(s)">DHCP static route(s)</span>
</h3>
<p>If you need to add a static route client-side, add it to <code>/etc/dhcpcd.exit-hook</code>. The example shows a new hook-script which adds a static route to a VPN subnet on <code>10.11.12.0/24</code> via a gateway machine at <code>192.168.192.5</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.exit-hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ip route add 10.11.12.0/24 via 192.168.192.5
</pre>
<p>You can add multiple routes to this file.
</p>
<h3><span class="mw-headline" id="DHCP_Client_Identifier">DHCP Client Identifier</span></h3>
<p>The DHCP client may be uniquely identified in different ways by the server: 
</p>
<ol>
<li>hostname (or the hostname value sent by the client),</li>
<li>MAC address of the network interface controller through which the connection is being made, linked to this is the third,</li>
<li>Identity Association ID (IAID), which is an abstraction layer to differentiate different use-cases and/or interfaces on a single host,</li>
<li>DHCP Unique Identifier (DUID).</li>
</ol>
<p>For a further description, see <a rel="nofollow"  href="https://tools.ietf.org/html/rfc3315#section-4.2">RFC 3315</a>. 
</p>
<p>It depends on the DHCP-server configuration which options are optional or required to request a DHCP IP lease. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <i>dhcpcd</i> default configuration should be sufficient usually. The listed identifiers are determined automatically and manual configuration changes only be required in case of problems.</div> 
<p>If the <i>dhcpcd</i> default configuration fails to obtain an IP, the following options are available to use in <code>dhcpcd.conf</code>: 
</p>
<ul>
<li>
<code>hostname</code> sends the hostname set in <code>/etc/hostname</code>
</li>
<li>
<code>clientid</code> sends the MAC address as identifier</li>
<li>
<code>iaid &lt;interface&gt;</code> derives the IAID to use for DHCP discovery. It has to be used in an interface block (started by <code>interface &lt;interface&gt;</code>, see <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?pid=1388376#p1388376">[1]</a>), but more frequently the next option is used:</li>
<li>
<code>duid</code> triggers using a combination of DUID and IAID as identifier.</li>
</ul>
<p>The DUID value is set in <code>/var/lib/dhcpcd/duid</code>. For efficient DHCP lease operation it is important that it is unique for the system and applies to all network interfaces alike, while the IAID represents an identifier for each of the systems' interfaces (see <a rel="nofollow"  href="https://tools.ietf.org/html/rfc4361#section-6.1">RFC 4361</a>). 
</p>
<p>Care must be taken on a network running <a href="https://en.wikipedia.org/wiki/Dynamic_DNS"  title="wikipedia:Dynamic DNS">Dynamic DNS</a> to ensure that all three IDs are unique. If duplicate DUID values are presented to the DNS server, e.g. in the case where a virtual machine has been cloned and the hostname and MAC have been made unique but the DUID has not been changed, then the result will be that as each client with the duplicated DUID requests a lease the server will remove the predecessor from the DNS record.
</p>
<h3><span class="mw-headline" id="Static_profile">Static profile</span></h3>
<p>Required settings are explained in <a href="../Network_configuration.html" title="Network configuration">Network configuration</a>. These typically include the <a href="../Network_configuration.html#Network_interfaces" class="mw-redirect" title="Network interface">network interface</a> name, <i>IP address</i>, <i>router address</i>, and <i>name server</i>.
</p>
<p>Configure a static profile for <i>dhcpcd</i> in <code>/etc/dhcpcd.conf</code>, for example: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">interface eth0
static ip_address=192.168.0.10/24	
static routers=192.168.0.1
static domain_name_servers=192.168.0.1 8.8.8.8</pre>
<p>More complicated configurations are possible, for example combining with the <code>arping</code> option. See <span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span> for details.
</p>
<h4><span class="mw-headline" id="Fallback_profile">Fallback profile</span></h4>
<p>It is possible to configure a static profile within <i>dhcpcd</i> and fall back to it when DHCP lease fails. This is useful particularly for <a href="https://en.wikipedia.org/wiki/Headless_computer"  title="wikipedia:Headless computer">headless machines</a>, where the static profile can be used as "recovery" profile to ensure that it is always possible to connect to the machine.
</p>
<p>The following example configures a <code>static_eth0</code> profile with <code>192.168.1.23</code> as IP address, <code>192.168.1.1</code> as gateway and name server, and makes this profile fallback for interface <code>eth0</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># define static profile
profile static_eth0
static ip_address=192.168.1.23/24
static routers=192.168.1.1
static domain_name_servers=192.168.1.1

# fallback to static profile on eth0
interface <i>eth0</i>
fallback static_eth0</pre>
<h2><span class="mw-headline" id="Hooks">Hooks</span></h2>
<p><i>dhcpcd</i> executes all scripts found in <code>/usr/lib/dhcpcd/dhcpcd-hooks/</code> in a lexical order. See <span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 8 dhcpcd-run-hooks"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd-run-hooks.8">dhcpcd-run-hooks(8)</a></span> for details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Each script can be disabled using the <code>nohook</code> option in <code>dhcpcd.conf</code>.</li>
<li>The <code>env</code> option can be used to set an environment variable for <b>all</b> hooks. For example, you can force the hostname hook to always set the hostname with <code>env force_hostname=YES</code>.</li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> describe (at least some) provided hooks. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Dhcpcd">Talk:Dhcpcd#</a>)</div>
</div>
<h3><span class="mw-headline" id="10-wpa_supplicant">10-wpa_supplicant</span></h3>
<p>Enable this hook by creating a symbolic link, which ensures the current version is used, even after package updates:
</p>
<pre># ln -s /usr/share/dhcpcd/hooks/10-wpa_supplicant /usr/lib/dhcpcd/dhcpcd-hooks/
</pre>
<p>The <code>10-wpa_supplicant</code> hook, if enabled, automatically launches <a href="../Wpa_supplicant.html" class="mw-redirect" title="WPA supplicant">WPA supplicant</a> on wireless interfaces. It is started only if:
</p>
<ul>
<li>no <i>wpa_supplicant</i> process is already listening on that interface.</li>
<li>a <i>wpa_supplicant</i> configuration file exists. <i>dhcpcd</i> checks</li>
</ul>
<pre>/etc/wpa_supplicant/wpa_supplicant-<i>interface</i>.conf
/etc/wpa_supplicant/wpa_supplicant.conf
/etc/wpa_supplicant-<i>interface</i>.conf
/etc/wpa_supplicant.conf
</pre>
<p>by default, in that order, but a custom path can be set by adding <code>env wpa_supplicant_conf=<i>configuration_file_path</i></code> into <code>/etc/dhcpcd.conf</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The hook stops at the first configuration file found, thus you should take this into consideration if you have several <i>wpa_supplicant</i> configuration files, otherwise <i>dhcpcd</i> might end up using the wrong file.</div>
<p>If you manage wireless connections with <i>wpa_supplicant</i> itself, the hook may create unwanted connection events. For example, if you stop <i>wpa_supplicant</i> the hook may bring the interface up again. Also, if you use <a href="../Netctl.html#Special_systemd_units" title="Netctl">netctl-auto</a>, <i>wpa_supplicant</i> is started automatically with <code>/run/network/wpa_supplicant_<i>interface</i>.conf</code> for config, so starting it again from the hook is unnecessary and may result in boot-time parse errors of the <code>/etc/wpa_supplicant/wpa_supplicant.conf</code> file, which only contains dummy values in the default packaged version. 
</p>
<p>To disable the hook remove the symbolic link you added, or add <code>nohook wpa_supplicant</code> to <code>dhcpcd.conf</code>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Speed_up_DHCP_by_disabling_ARP_probing">Speed up DHCP by disabling ARP probing</span></h3>
<p><i>dhcpcd</i> contains an implementation of a recommendation of the DHCP standard (<a rel="nofollow"  href="https://www.ietf.org/rfc/rfc2131.txt">RFC2131</a> section 2.2) to check via ARP if the assigned IP address is really not taken. This seems mostly useless in home networks, so you can save about 5 seconds on every connect by adding the following line to <code>/etc/dhcpcd.conf</code>:
</p>
<pre>noarp
</pre>
<p>This is equivalent to passing <code>--noarp</code> to <code>dhcpcd</code>, and disables the described ARP probing, speeding up connections to networks with DHCP.
</p>
<h3><span class="mw-headline" id="Remove_old_DHCP_lease">Remove old DHCP lease</span></h3>
<p>The file <code>/var/lib/dhcpcd/<i>interface</i>.lease</code>, where <code><i>interface</i></code> is the name of the interface on which you have a lease, contains the actual DHCP lease reply sent by the DHCP server. For a wireless interface, the filename is <code>/var/lib/dhcpcd/<i>interface</i>-<i>ssid</i>.lease</code>, where <code><i>ssid</i></code> is the name of the wireless network. It is used to determine the last lease from the server, and its <code>mtime</code> attribute is used to determine when it was issued. This last lease information is then used to request the same IP address previously held on a network, if it is available. If you do not want that, simply delete this file. 
</p>
<p>If the DHCP server still assigns the same IP address, this may happen because it is configured to keep the assignment stable and recognizes the requesting DHCP client id or DUID (see <a href="#DHCP_Client_Identifier">#DHCP Client Identifier</a>). You can test it by stopping <i>dhcpcd</i> and removing or renaming <code>/var/lib/dhcpcd/duid</code>. <i>dhcpcd</i> will generate a new one on next run. 
</p>
<p>Keep in mind that the DUID is intended as persistent machine identifier across reboots and interfaces. If you are transferring the system to new computer, preserving this file should make it appear as old one.
</p>
<h3><span class="mw-headline" id="Different_IPs_when_multi-booting">Different IPs when multi-booting</span></h3>
<p>If you are dualbooting TOS and OS X or Windows and want each to receive different IP addresses, you can exert control about the IPs leased by specifying a different DUID in each operating system installation. 
</p>
<p>In Windows (post XP) the DUID should be stored in the 
</p>
<pre>\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\Dhcpv6DUID 
</pre>
<p>registry key. 
</p>
<p>On OS X it is directly accessible in <code>Network\adapter\dhcp preferences panel</code>.
</p>
<p>If you are using a <a href="../Dnsmasq.html" title="Dnsmasq">dnsmasq</a> DHCP server, the different DUIDs can be used in appropriate <code>dhcp-host=</code> rules in its configuration.
</p>
<h3>
<span id=".2Fetc.2Fresolv.conf"></span><span class="mw-headline" id="/etc/resolv.conf">/etc/resolv.conf</span>
</h3>
<p>If <a href="../Openresolv.html" class="mw-redirect" title="Resolvconf">resolvconf</a> is available DNS information will be sent to it, if not, then <i>dhcpcd</i> itself will write to <code>/etc/resolv.conf</code>.
</p>
<p><code>/etc/resolv.conf</code> overwriting can be stopped by disabling the hook <code>/usr/lib/dhcpcd/dhcpcd-hooks/20-resolv.conf</code>. Do so by adding the following to the last section of <code>/etc/dhcpcd.conf</code>: 
</p>
<pre>nohook resolv.conf
</pre>
<p>Alternatively, you can create a file called <code>/etc/resolv.conf.head</code> containing your DNS servers. <i>dhcpcd</i> will prepend this file to the beginning of <code>/etc/resolv.conf</code>.
</p>
<p>Or you can configure dhcpcd to use the same DNS servers every time. To do this, add the following line at the end of your <code>/etc/dhcpcd.conf</code>, where <code><i>dns-server-ip-addressses</i></code> is a space separated list of DNS IP addresses.
</p>
<pre>static domain_name_servers=<i>dns-server-ip-addresses</i>
</pre>
<p>For example, to set it to Google's DNS servers:
</p>
<pre>static domain_name_servers=8.8.8.8 8.8.4.4
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> When using <a href="../Openresolv.html" title="Openresolv">openresolv</a>, DNS servers can instead be set in <code>/etc/resolvconf.conf</code>. This way they will not get overwritten by any <i>resolvconf</i> supporting software.</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Client_ID">Client ID</span></h3>
<p>If you are on a network with DHCPv4 that filters Client IDs based on MAC addresses, you may need to change the following line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Use the same DUID + IAID as set in DHCPv6 for DHCPv4 Client ID as per RFC4361. 
duid
</pre>
<p>To:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Use the hardware address of the interface for the Client ID (DHCPv4).
clientid
</pre>
<p>Else, you may not obtain a lease since the DHCP server may not read your <a href="https://en.wikipedia.org/wiki/DHCPv6"  title="wikipedia:DHCPv6">DHCPv6-style</a> Client ID correctly. See <a rel="nofollow"  href="https://tools.ietf.org/html/rfc4361">RFC 4361</a> for more information.
</p>
<h3><span class="mw-headline" id="Check_DHCP_problem_by_releasing_IP_first">Check DHCP problem by releasing IP first</span></h3>
<p>A problem may occur when DHCP gets a wrong IP assignment, such as when two routers are tied together through a VPN. The router that is connected through the VPN may be assigning IP address. To fix it, as root, release the IP address:
</p>
<pre># dhcpcd -k
</pre>
<p>Then request a new one:
</p>
<pre># dhcpcd
</pre>
<p>You may have to run those two commands many times.
</p>
<h3><span class="mw-headline" id="Problems_with_noncompliant_routers">Problems with noncompliant routers</span></h3>
<p>For some (noncompliant) routers, you will not be able to connect properly unless you comment the line
</p>
<pre>require dhcp_server_identifier
</pre>
<p>in <code>/etc/dhcpcd.conf</code>. This should not cause issues unless you have multiple DHCP servers on your network (not typical); see <a rel="nofollow"  href="https://technet.microsoft.com/en-us/library/cc977442.aspx">this page</a> for more information.
</p>
<h3><span class="mw-headline" id="dhcpcd_and_systemd_network_interfaces">dhcpcd and systemd network interfaces</span></h3>
<p><code>dhcpcd.service</code> can be <a href="../Systemd.html#Using_units" class="mw-redirect" title="Enabled">enabled</a> without specifying an interface. This may, however, create a race condition at boot with <i>systemd-udevd</i> trying to apply a predictable network interface name: 
</p>
<pre>error changing net interface name wlan0 to wlp4s0: Device or resource busy" 
</pre>
<p>To avoid it, enable <i>dhcpcd</i> per interface it should bind to as described in <a href="#Running">#Running</a>. The downside of the template unit is, however, that it does not support hot-plugging of a wired connection and will fail if the network cable is not connected. To work-around the failure, see <a href="#Timeout_delay">#Timeout delay</a>.
</p>
<p>It is also possible to use <code>denyinterfaces</code> or <code>allowinterfaces</code> in <span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span> to stop dhcpcd from binding to kernel names, for example
</p>
<pre>denyinterfaces wlan* eth*
</pre>
<h3><span class="mw-headline" id="Timeout_delay">Timeout delay</span></h3>
<p>If <i>dhcpcd</i> operates on a single interface and fails to obtain a lease after 30 seconds (for example when the server is not ready or the cable not plugged), it will exit with an error. 
</p>
<p>To have <i>dhcpcd</i> wait indefinitely for one-time, <a href="../Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the unit and set the <code>timeout</code> option to <code>0</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/dhcpcd@.service.d/timeout.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dhcpcd -w -q <b>-t 0</b> %I</pre>
<p>To have it wait indefinitely, let the unit restart after it exited: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/dhcpcd@.service.d/dhcpcdrestart.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Restart=always</pre>
<h2><span class="mw-headline" id="Known_issues">Known issues</span></h2>
<h3>
<span id="dhcpcd.40.service_causes_slow_startup"></span><span class="mw-headline" id="dhcpcd@.service_causes_slow_startup">dhcpcd@.service causes slow startup</span>
</h3>
<p>By default the <code>dhcpcd@.service</code> waits to get an IP address before forking into the background via the <code>-w</code> flag for <i>dhcpcd</i>. If the unit is enabled, this may cause the boot to wait for an IP address before continuing. To fix this, create a <a href="../Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> for the unit with the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/dhcpcd@.service.d/no-wait.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dhcpcd -b -q %I</pre>
<p>See also <a rel="nofollow"  href="https://bugs.archlinux.org/task/49685">FS#49685</a>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 dhcpcd"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd.8">dhcpcd(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span></li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../Category:DHCP.html" title="Category:DHCP">DHCP</a></li>
<li><a href="../Category:Commands.html" title="Category:Commands">Commands</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../Category:Sections_flagged_with_Template:Remove.html" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li>
<li><a href="../Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dhcpcd&amp;oldid=602346">https://wiki.archlinux.org/index.php?title=Dhcpcd&amp;oldid=602346</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 22 March 2020, at 16:00.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



