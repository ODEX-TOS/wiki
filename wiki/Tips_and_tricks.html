<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Chromium/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../Chromium.html" title="Chromium">Chromium</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../../Chromium.html#Tips_and_tricks" title="Chromium">Chromium#Tips and tricks</a>.</b><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> The main page is short enough to contain everything in one place. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Chromium/Tips_and_tricks">Talk:Chromium/Tips and tricks#</a>)</div>
</div>
<p>The following tips and tricks should work for both Chromium and Chrome unless explicitly stated.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Browsing_experience"><span >1</span> <span >Browsing experience</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#chrome://_URLs"><span >1.1</span> <span >chrome:// URLs</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Chromium_task_manager"><span >1.2</span> <span >Chromium task manager</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Chromium_overrides/overwrites_Preferences_file"><span >1.3</span> <span >Chromium overrides/overwrites Preferences file</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Search_engines"><span >1.4</span> <span >Search engines</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#Tmpfs"><span >1.5</span> <span >Tmpfs</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Cache_in_tmpfs"><span >1.5.1</span> <span >Cache in tmpfs</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#Profile_in_tmpfs"><span >1.5.2</span> <span >Profile in tmpfs</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="#Launch_a_new_browser_instance"><span >1.6</span> <span >Launch a new browser instance</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Directly_open_*.torrent_files_and_magnet_links_with_a_torrent_client"><span >1.7</span> <span >Directly open *.torrent files and magnet links with a torrent client</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Touch_Scrolling_on_touchscreen_devices"><span >1.8</span> <span >Touch Scrolling on touchscreen devices</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Reduce_memory_usage"><span >1.9</span> <span >Reduce memory usage</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#User_Agent"><span >1.10</span> <span >User Agent</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#DOM_Distiller"><span >1.11</span> <span >DOM Distiller</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Forcing_specific_GPU"><span >1.12</span> <span >Forcing specific GPU</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Import_bookmarks_from_Firefox"><span >1.13</span> <span >Import bookmarks from Firefox</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Enabling_native_notifications"><span >1.14</span> <span >Enabling native notifications</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#U2F_authentication"><span >1.15</span> <span >U2F authentication</span></a></li>
<li class="toclevel-2 tocsection-19">
<a href="#Dark_mode"><span >1.16</span> <span >Dark mode</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#Dark_mode_by_system_preference"><span >1.16.1</span> <span >Dark mode by system preference</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#Profile_maintenance"><span >2</span> <span >Profile maintenance</span></a></li>
<li class="toclevel-1 tocsection-22">
<a href="#Security"><span >3</span> <span >Security</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#WebRTC"><span >3.1</span> <span >WebRTC</span></a></li>
<li class="toclevel-2 tocsection-24">
<a href="#SSL_certificates"><span >3.2</span> <span >SSL certificates</span></a>
<ul>
<li class="toclevel-3 tocsection-25"><a href="#Adding_CAcert_certificates_for_self-signed_certificates"><span >3.2.1</span> <span >Adding CAcert certificates for self-signed certificates</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#Example_1:_Using_a_shell_script_to_isolate_the_certificate_from_TomatoUSB"><span >3.2.2</span> <span >Example 1: Using a shell script to isolate the certificate from TomatoUSB</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#Example_2:_Using_Firefox_to_isolate_the_certificate_from_TomatoUSB"><span >3.2.3</span> <span >Example 2: Using Firefox to isolate the certificate from TomatoUSB</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-28"><a href="#Canvas_Fingerprinting"><span >3.3</span> <span >Canvas Fingerprinting</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Privacy_extensions"><span >3.4</span> <span >Privacy extensions</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Do_Not_Track"><span >3.5</span> <span >Do Not Track</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#Force_a_password_store"><span >3.6</span> <span >Force a password store</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-32"><a href="#Making_flags_persistent"><span >4</span> <span >Making flags persistent</span></a></li>
<li class="toclevel-1 tocsection-33"><a href="#See_also"><span >5</span> <span >See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Browsing_experience">Browsing experience</span></h2>
<h3>
<span id="chrome:.2F.2F_URLs"></span><span class="mw-headline" id="chrome://_URLs">chrome:// URLs</span>
</h3>
<p>A number of tweaks can be accessed via Chrome URLs. See <b>chrome://chrome-urls</b> for a complete list.
</p>
<ul>
<li>
<b>chrome://flags</b> - access experimental features such as WebGL and rendering webpages with GPU, etc.</li>
<li>
<b>chrome://extensions</b> - view, enable and disable the currently used Chromium extensions.</li>
<li>
<b>chrome://gpu</b> - status of different GPU options.</li>
<li>
<b>chrome://sandbox</b> - indicate sandbox status.</li>
<li>
<b>chrome://version</b> - display version and switches used to invoke the active <code>/usr/bin/chromium</code>.</li>
</ul>
<p>An automatically updated, complete listing of Chromium switches (command line parameters) is available <a rel="nofollow"  href="http://peter.sh/experiments/chromium-command-line-switches/">here</a>.
</p>
<h3><span class="mw-headline" id="Chromium_task_manager">Chromium task manager</span></h3>
<p>Shift+ESC can be used to bring up the browser task manager wherein memory, CPU, and network usage can be viewed.
</p>
<h3>
<span id="Chromium_overrides.2Foverwrites_Preferences_file"></span><span class="mw-headline" id="Chromium_overrides/overwrites_Preferences_file">Chromium overrides/overwrites Preferences file</span>
</h3>
<p>If you enabled syncing with a Google Account, then Chromium will override any direct edits to the Preferences file found under <code>~/.config/chromium/Default/Preferences</code>. To work around this, start Chromium with the <code>--disable-sync-preferences</code> switch:
</p>
<pre>$ chromium --disable-sync-preferences
</pre>
<p>If Chromium is started in the background when you login in to your desktop environment, make sure the command your desktop environment uses is:
</p>
<pre>$ chromium --disable-sync-preferences --no-startup-window
</pre>
<h3><span class="mw-headline" id="Search_engines">Search engines</span></h3>
<p>Make sites like <a rel="nofollow"  href="https://wiki.archlinux.org">wiki.archlinux.org</a> and <a rel="nofollow"  href="https://en.wikipedia.org">wikipedia.org</a> easily searchable by first executing a search on those pages, then going to <i>Settings &gt; Search</i> and click the <i>Manage search engines..</i> button. From there, "Edit" the Wikipedia entry and change its keyword to <b>w</b> (or some other shortcut you prefer). Now searching Wikipedia for "TOS Linux" from the address bar is done simply by entering "<b>w arch linux</b>".
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Google search is used automatically when typing something into the URL bar. A hard-coded keyword trigger is also available using the <b>?</b> prefix.</div>
<h3><span class="mw-headline" id="Tmpfs">Tmpfs</span></h3>
<h4><span class="mw-headline" id="Cache_in_tmpfs">Cache in tmpfs</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Chromium stores its cache separate from its browser profile directory.</div>
<p>To limit Chromium from writing its cache to a physical disk, one can define an alternative location via the <code>--disk-cache-dir=/foo/bar</code> flag:
</p>
<pre>$ chromium --disk-cache-dir=/tmp/cache
</pre>
<p>Cache should be considered temporary and will <b>not</b> be saved after a reboot or hard lock. Alternatively, use:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">tmpfs	/home/<i>username</i>/.cache	tmpfs	noatime,nodev,nosuid,size=400M	0	0</pre>
<h4><span class="mw-headline" id="Profile_in_tmpfs">Profile in tmpfs</span></h4>
<p>Relocate the browser profile to a <a href="https://en.wikipedia.org/wiki/Tmpfs"  title="wikipedia:Tmpfs">tmpfs</a> filesystem, including <code>/tmp</code>, or <code>/dev/shm</code> for improvements in application response as the entire profile is now stored in RAM.
</p>
<p>Use an active profile management script for maximal reliability and ease of use.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=profile-sync-daemon">profile-sync-daemon</a></span> is such a script. It symlinks and syncs the browser profile directories to RAM. Refer to the <a href="../../Profile-sync-daemon.html" title="Profile-sync-daemon">Profile-sync-daemon</a> wiki article for additional information on it.
</p>
<h3><span class="mw-headline" id="Launch_a_new_browser_instance">Launch a new browser instance</span></h3>
<p>When you launch the browser, it first checks if another instance using the same data directory is already running. If there is one, the new window is associated with the old instance. If you want to launch an independent instance of the browser, you must specify separate directory using the <code>--user-data-dir</code> parameter:
</p>
<pre>$ chromium --user-data-dir=<i>/path/to/some/directory</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The default location of the user data is <code>~/.config/chromium/</code>.</div>
<h3>
<span id="Directly_open_.2A.torrent_files_and_magnet_links_with_a_torrent_client"></span><span class="mw-headline" id="Directly_open_*.torrent_files_and_magnet_links_with_a_torrent_client">Directly open *.torrent files and magnet links with a torrent client</span>
</h3>
<p>By default, Chromium downloads <code>*.torrent</code> files directly and you need to click the notification from the bottom-left corner of the screen in order for the file to be opened with your default torrent client. This can be avoided with the following method:
</p>
<ul>
<li>Download a <code>*.torrent</code> file.</li>
<li>Right-click the notification displayed at the bottom-left corner of the screen.</li>
<li>Check the "<i>Always Open Files of This Type</i>" checkbox.</li>
</ul>
<p>See <a href="../../Xdg-utils.html#xdg-open" class="mw-redirect" title="Xdg-open">xdg-open</a> to change the default assocation.
</p>
<h3><span class="mw-headline" id="Touch_Scrolling_on_touchscreen_devices">Touch Scrolling on touchscreen devices</span></h3>
<p>
You may need to specify which touch device to use. Find your touchscreen device with <code> xinput list</code> then launch Chromium with the <code>--touch-devices=<b>x</b></code> parameter, where "<b>x</b>" is the id of your device. </p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the device is designated as a slave pointer, using this may not work, use the master pointer's ID instead.</div>
<h3><span class="mw-headline" id="Reduce_memory_usage">Reduce memory usage</span></h3>
<p>By default, Chromium uses a separate OS process for each <i>instance</i> of a visited web site. <a rel="nofollow"  href="https://www.chromium.org/developers/design-documents/process-models#Supported_Models">[1]</a> However, you can specify command-line switches when starting Chromium to modify this behaviour.
</p>
<p>For example, to share one process for all instances of a website:
</p>
<pre>$ chromium --process-per-site
</pre>
<p>To use a single process model:
</p>
<pre>$ chromium --single-process
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The single-process model is discouraged because it is unsafe and may contain bugs not present in other models.<a rel="nofollow"  href="https://www.chromium.org/developers/design-documents/process-models#TOC-Single-process">[2]</a>
</div>
<p>In addition, you can suspend or store inactive Tabs with extensions such as <a rel="nofollow"  href="https://chrome.google.com/webstore/detail/tab-suspender/fiabciakcmgepblmdkmemdbbkilneeeh?hl=en">Tab Suspender</a>, <a rel="nofollow"  href="https://github.com/deanoemcke/thegreatsuspender/">The Great Suspender(GPLv2)</a> and <a rel="nofollow"  href="https://chrome.google.com/webstore/detail/onetab/chphlpgkkbolifaimnlloiipkdnihall?hl=en">OneTab</a>.
</p>
<h3><span class="mw-headline" id="User_Agent">User Agent</span></h3>
<p>The User Agent can be arbitrarily modified at the start of Chromium's base instance via its <code>--user-agent="[string]"</code> parameter.
</p>
<h3><span class="mw-headline" id="DOM_Distiller">DOM Distiller</span></h3>
<p>Chromium has a similar reader mode to Firefox. In this case it's called DOM Distiller, which is an <a rel="nofollow"  href="https://github.com/chromium/dom-distiller">open source project</a>.
All you need to do is run Chromium with the <code>--enable-dom-distiller</code> flag to unlock the "Distill page" menu option or you can even make it <a href="#Making_flags_persistent">persistent</a>.
Not only does DOM Distiller provide a better reading experience by distilling the content of the page, it also simplifies pages for print. Even though the latter checkbox option has been removed from the print dialog, you can still print the distilled page, which basically has the same effect.
</p>
<p>Running the upper flag, you will find a new "Distill Page" menu item.
</p>
<p>You can reach the internal debug page by visiting <code>chrome://dom-distiller</code>
</p>
<h3><span class="mw-headline" id="Forcing_specific_GPU">Forcing specific GPU</span></h3>
<p>In multi-GPU systems, Chromium automatically detects which GPU should be used for rendering (discrete or integrated). This works 99% of the time, except when it doesn't - if a unavailable GPU is picked (for example, discrete graphics on VFIO GPU passthrough-enabled systems), <code>chrome://gpu</code> will complain about not being able to initialize the GPU process. On the same page below <b>Driver Information</b> there'll be multiple GPUs shown (GPU0, GPU1, ...). There's no way to switch between them in a user-friendly way, but you can read the device/vendor IDs present there and configure Chromium to use a specific GPU with flags:
</p>
<pre>$ chromium --gpu-testing-vendor-id=0x8086 --gpu-testing-device-id=0x1912
</pre>
<p>...where <code>0x8086</code> and <code>0x1912</code> is replaced by the IDs of the GPU you want to use (as shown on the <code>chrome://gpu</code> page).
</p>
<h3><span class="mw-headline" id="Import_bookmarks_from_Firefox">Import bookmarks from Firefox</span></h3>
<p>To ease the transition, you can import bookmarks from <a href="../../Firefox.html" title="Firefox">Firefox</a> into Chromium.
</p>
<p>Navigate Chromium to <code>chrome://settings/importData</code>
</p>
<p>If Firefox is already installed on your computer, you can directly import bookmarks as well as many other things from Firefox.
</p>
<p>Make sure <b>Mozilla Firefox</b> is selected. Optionally, you can uncheck some unwanted items here. Click the <b>Import</b> and then <b>Done</b>. You're done with it.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you haven't created any bookmarks in Chromium yet, the bookmarks will show up in your bookmarks bar. If you already have bookmarks, the bookmarks will be in a new folder labeled "Imported From Firefox"</div>
<p>If you import bookmarks from another PC, you have to export bookmarks from Firefox first.
</p>
<p><code><i>Ctrl + Shift + O &gt; Import and Backup &gt; Export Bookmarks To HTML</i></code><i> in Firefox</i>
</p>
<p>The procedure is pretty much the same. You need to go to <code>chrome://settings/importData</code>. However, this time, in the <b>From</b> drop-down menu, select <b>Bookmarks HTML File</b> and click the <b>Choose File</b> button and upload the desired bookmark file.
</p>
<h3><span class="mw-headline" id="Enabling_native_notifications">Enabling native notifications</span></h3>
<p>Go to <code>chrome://flags#enable-native-notifications</code> and select <i>Enabled</i>.
</p>
<h3><span class="mw-headline" id="U2F_authentication">U2F authentication</span></h3>
<p>In order for the U2F functionality to work with Chromium you need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=libu2f-host">libu2f-host</a></span> library.
This provides the <a rel="nofollow"  href="https://github.com/Yubico/libu2f-host/blob/master/70-u2f.rules">udev rules</a> required to enable access to the U2F key as a user.
U2F keys are by default only accessible by root, and without these rules Chromium will give an error.
</p>
<h3><span class="mw-headline" id="Dark_mode">Dark mode</span></h3>
<p>To enable dark mode (used in <i>prefers-color-scheme</i> in CSS, JavaScript, Settings and Dev-Tools) and enable the dark theme (normally used for incognito mode) <a href="../../Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> the following flag to <a href="#Making_flags_persistent">persistent configuration</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/chromium-flags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">--force-dark-mode
--enable-features=WebUIDarkMode</pre>
<h4><span class="mw-headline" id="Dark_mode_by_system_preference">Dark mode by system preference</span></h4>
<p><a rel="nofollow"  href="https://bugs.chromium.org/p/chromium/issues/detail?id=998903">This Chromium issue</a> aims to bring dark mode based on GTK theme selection into Chromium.
</p>
<p>In the future, all that will be required to properly use system preference, is setting <i>Designs</i> to GTK in <code>chrome://settings/appearance</code>.
</p>
<h2><span class="mw-headline" id="Profile_maintenance">Profile maintenance</span></h2>
<p>Chromium uses <a href="../../SQLite.html" title="SQLite">SQLite</a> databases to manage history and the like.  Sqlite databases become fragmented over time and empty spaces appear all around. But, since there are no managing processes checking and optimizing the database, these factors eventually result in a performance hit. A good way to improve startup and some other bookmarks- and history-related tasks is to defragment and trim unused space from these databases.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=profile-cleaner">profile-cleaner</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/browser-vacuum/">browser-vacuum</a></span><sup><small>AUR</small></sup> in the <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> do just this.
</p>
<h2><span class="mw-headline" id="Security">Security</span></h2>
<h3><span class="mw-headline" id="WebRTC">WebRTC</span></h3>
<p>WebRTC is a communication protocol that relies on JavaScript that can leak one's actual IP address and hardware hash from behind a VPN. While some software may prevent the leaking scripts from running, it's probably a good idea to block this protocol directly as well, just to be safe. As of October 2016, there is no way to disable WebRTC on Chromium on desktop, there are extensions available to disable local IP address leak, one is this <a rel="nofollow"  href="https://chrome.google.com/webstore/detail/webrtc-network-limiter/npeicpdbkakmehahjeeohfdhnlpdklia">extension</a>.
</p>
<p>One can test WebRTC via <a rel="nofollow"  href="https://www.privacytools.io/webrtc.html">this page</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Even though IP leak can be prevented, Chromium still sends your unique hash, and there is no way to prevent this. Read more on <a rel="nofollow"  href="https://www.browserleaks.com/webrtc#webrtc-disable">https://www.browserleaks.com/webrtc#webrtc-disable</a> </div>
<h3><span class="mw-headline" id="SSL_certificates">SSL certificates</span></h3>
<p>Chromium does not have an SSL certificate manager.  It relies on the NSS Shared DB <code>~/.pki.nssdb</code>.  In order to add SSL certificates to the database, users will have to use the shell. 
</p>
<h4><span class="mw-headline" id="Adding_CAcert_certificates_for_self-signed_certificates">Adding CAcert certificates for self-signed certificates</span></h4>
<p>Grab the CAcerts and create an <code>nssdb</code>, if one does not already exist.  To do this, first install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=nss">nss</a></span> package, then complete these steps:
</p>
<pre>$ mkdir -p $HOME/.pki/nssdb
$ cd $HOME/.pki/nssdb
$ certutil -N -d sql:.
</pre>
<pre>$ curl -k -o "cacert-root.crt" "<a rel="nofollow"  href="http://www.cacert.org/certs/root.crt">http://www.cacert.org/certs/root.crt</a>"
$ curl -k -o "cacert-class3.crt" "<a rel="nofollow"  href="http://www.cacert.org/certs/class3.crt">http://www.cacert.org/certs/class3.crt</a>"
$ certutil -d sql:$HOME/.pki/nssdb -A -t TC -n "CAcert.org" -i cacert-root.crt 
$ certutil -d sql:$HOME/.pki/nssdb -A -t TC -n "CAcert.org Class 3" -i cacert-class3.crt
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Users will need to create a password for the database, if it does not exist.</div>
<p>Now users may manually import a self-signed certificate.
</p>
<h4><span class="mw-headline" id="Example_1:_Using_a_shell_script_to_isolate_the_certificate_from_TomatoUSB">Example 1: Using a shell script to isolate the certificate from TomatoUSB</span></h4>
<p>Below is a simple script that will extract and add a certificate to the user's <code>nssdb</code>:
</p>
<pre>#!/bin/sh
#
# usage:  import-cert.sh remote.host.name [port]
#
REMHOST=$1
REMPORT=${2:-443}
exec 6&gt;&amp;1
exec &gt; $REMHOST
echo | openssl s_client -connect ${REMHOST}:${REMPORT} 2&gt;&amp;1 |sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p'
certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n "$REMHOST" -i $REMHOST 
exec 1&gt;&amp;6 6&gt;&amp;-
</pre>
<p>Syntax is advertised in the commented lines.
</p>
<p>References:
</p>
<ul>
<li>
<a rel="nofollow"  href="http://blog.avirtualhome.com/adding-ssl-certificates-to-google-chrome-linux-ubuntu">http://blog.avirtualhome.com/adding-ssl-certificates-to-google-chrome-linux-ubuntu</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-03-28 ⓘ]</sup>
</li>
<li>
<a rel="nofollow"  href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux_cert_management.md">https://chromium.googlesource.com/chromium/src/+/master/docs/linux_cert_management.md</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-03-28 ⓘ]</sup>
</li>
</ul>
<h4><span class="mw-headline" id="Example_2:_Using_Firefox_to_isolate_the_certificate_from_TomatoUSB">Example 2: Using Firefox to isolate the certificate from TomatoUSB</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=firefox">firefox</a></span> browser can be used to save the certificate to a file for manual import into the database.
</p>
<p>Using firefox:
</p>
<ol>
<li>Browse to the target URL.</li>
<li>Upon seeing the "This Connection is Untrusted" warning screen, click: <i>I understand the Risks &gt; Add Exception...</i>
</li>
<li>Click: <i>View &gt; Details &gt; Export</i> and save the certificate to a temporary location (<code>/tmp/easy.pem</code> in this example).</li>
</ol>
<p>Now import the certificate for use in Chromium:
</p>
<pre>$ certutil -d sql:$HOME/.pki/nssdb -A -t TC -n "easy" -i /tmp/easy.pem
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Adjust the name to match that of the certificate. In the example above, "easy" is the name of the certificate.</div>
<p>Reference:
</p>
<ul><li><a rel="nofollow"  href="http://sahissam.blogspot.com/2012/06/new-ssl-certificates-for-tomatousb-and.html">http://sahissam.blogspot.com/2012/06/new-ssl-certificates-for-tomatousb-and.html</a></li></ul>
<h3><span class="mw-headline" id="Canvas_Fingerprinting">Canvas Fingerprinting</span></h3>
<p>Canvas fingerprinting is a technique that allows websites to identify users by detecting differences when rendering to an HTML5 canvas. This information can be made inaccessible by using the <code>--disable-reading-from-canvas</code> flag.
</p>
<p>To confirm this is working run <a rel="nofollow"  href="https://panopticlick.eff.org">this test</a> and make sure "hash of canvas fingerprint" is reported as undetermined in the full results.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Some extensions require reading from canvas and may be broken by setting <code>--disable-reading-from-canvas</code>.</div>
<h3><span class="mw-headline" id="Privacy_extensions">Privacy extensions</span></h3>
<p>See <a href="../../Browser_extensions.html#Privacy" title="Browser extensions">Browser extensions#Privacy</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Installing too many extensions might take up much space in the toolbar. Those extensions which you wouldn't interact with anyway (e.g. <a rel="nofollow"  href="https://chrome.google.com/webstore/detail/gcbommkclmclpchllfjekcdonpmejbdp">HTTPS Everywhere</a>) can be hidden by right-clicking on the extension and choosing <i>Hide in Chromium menu</i>.</div>
<h3><span class="mw-headline" id="Do_Not_Track">Do Not Track</span></h3>
<p>To enable <a href="https://en.wikipedia.org/wiki/Do_Not_Track"  title="wikipedia:Do Not Track">Do Not Track</a>, visit <code>chrome://settings</code>, scroll down to <i>Advanced</i> and under <i>Privacy and security</i>, check <i>Send a "Do Not Track" request with your browsing traffic</i>.
</p>
<h3><span class="mw-headline" id="Force_a_password_store">Force a password store</span></h3>
<p>Chromium uses a password store to store your passwords and the <i>Chromium Safe Storage</i> key, which is used to encrypt cookie values. <a rel="nofollow"  href="https://codereview.chromium.org/24734007">[3]</a>
</p>
<p>By default Chromium auto-detects which password store to use, which can lead to you apparently losing your passwords and cookies when switching to another desktop environment or window manager.
</p>
<p>You can force Chromium to use a specific password store by launching it with the <code>--password-store</code> flag with one of following the values <a rel="nofollow"  href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux_password_storage.md">[4]</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-03-28 ⓘ]</sup>:
</p>
<ul>
<li>
<code>gnome</code>, uses <a href="../../GNOME/Keyring.html" class="mw-redirect" title="Gnome Keyring">Gnome Keyring</a>
</li>
<li>
<code>kwallet</code>, uses <a href="../../KDE_Wallet.html" title="KDE Wallet">KDE Wallet</a>
</li>
<li>
<code>basic</code>, saves the passwords and the cookies' encryption key as plain text in the file <code>Login Data</code>
</li>
<li>
<code>detect</code>, the default auto-detect behavior</li>
</ul>
<p>For example, to force Chromium to use Gnome Keyring in another desktop or WM use <code>--password-store=gnome</code>, see <a href="#Making_flags_persistent">#Making flags persistent</a> for making it permanent.
</p>
<p>When using a password store of another desktop environment you probably also want to unlock it automatically see:
<a href="../../GNOME/Keyring.html#Using_the_keyring_outside_GNOME" title="GNOME/Keyring">GNOME/Keyring#Using the keyring outside GNOME</a> and <a href="../../KDE_Wallet.html#Unlock_KDE_Wallet_automatically_on_login" title="KDE Wallet">KDE Wallet#Unlock KDE Wallet automatically on login</a>.
</p>
<h2><span class="mw-headline" id="Making_flags_persistent">Making flags persistent</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-go-next.png" ><img alt="Tango-go-next.png" src="../../File:Tango-go-next.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for moving to <a href="../../Chromium.html#Configuration" title="Chromium">Chromium#Configuration</a>.</b><a href="../../File:Tango-go-next.png" ><img alt="Tango-go-next.png" src="../../File:Tango-go-next.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> More appropriate place. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Chromium/Tips_and_tricks">Talk:Chromium/Tips and tricks#</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>chromium-flags.conf</code> file and the accompanying custom launcher script are specific to the TOS Linux <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=chromium">chromium</a></span> package. For <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/google-chrome/">google-chrome</a></span><sup><small>AUR</small></sup>, use <code>chrome-flags.conf</code> instead.</div>
<p>You can put your flags in a <code>chromium-flags.conf</code> file under <code>$HOME/.config/</code> (or under <code>$XDG_CONFIG_HOME</code> if you have configured that environment variable).
</p>
<p>No special syntax is used; flags are defined as if they were written in a terminal.
</p>
<ul>
<li>The arguments are split on whitespace and shell quoting rules apply, but no further parsing is performed.</li>
<li>In case of improper quoting anywhere in the file, a fatal error is raised.</li>
<li>Flags can be placed in separate lines for readability, but this is not required.</li>
<li>Lines starting with a hash symbol (#) are skipped.</li>
</ul>
<p>Below is an example <code>chromium-flags.conf</code> file that defines the flags <code>--start-maximized --incognito</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/chromium-flags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># This line will be ignored.
--start-maximized
--incognito
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a href="../../Profile-sync-daemon.html" title="Profile-sync-daemon">Profile-sync-daemon</a> - Systemd service that saves Chromium profile in tmpfs and syncs to disk</li>
<li>
<a href="../../Tmpfs.html" title="Tmpfs">Tmpfs</a> - Tmpfs Filesystem in <code>/etc/fstab</code>
</li>
<li><a rel="nofollow"  href="https://www.kernel.org/doc/html/latest/filesystems/tmpfs.html">Official tmpfs kernel Documentation</a></li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../Category:Web_browser.html" title="Category:Web browser">Web browser</a></li>
<li><a href="../../Category:Google.html" title="Category:Google">Google</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../../Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Chromium/Tips_and_tricks&amp;oldid=612022">https://wiki.archlinux.org/index.php?title=Chromium/Tips_and_tricks&amp;oldid=612022</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 10 May 2020, at 09:11.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">VirtualBox/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../VirtualBox.html" title="VirtualBox">VirtualBox</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p><br>
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Import/export_VirtualBox_virtual_machines_from/to_other_hypervisors"><span >1</span> <span >Import/export VirtualBox virtual machines from/to other hypervisors</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Remove_additions"><span >1.1</span> <span >Remove additions</span></a></li>
<li class="toclevel-2 tocsection-3">
<a href="#Use_the_right_virtual_disk_format"><span >1.2</span> <span >Use the right virtual disk format</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Automatic_tools"><span >1.2.1</span> <span >Automatic tools</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Manual_conversion"><span >1.2.2</span> <span >Manual conversion</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#Create_the_VM_configuration_for_your_hypervisor"><span >1.3</span> <span >Create the VM configuration for your hypervisor</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7">
<a href="#Virtual_machine_launch_management"><span >2</span> <span >Virtual machine launch management</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Starting_virtual_machines_with_a_service_(autostart)"><span >2.1</span> <span >Starting virtual machines with a service (autostart)</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Starting_virtual_machines_with_a_keyboard_shortcut"><span >2.2</span> <span >Starting virtual machines with a keyboard shortcut</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#Use_specific_device_in_the_virtual_machine"><span >3</span> <span >Use specific device in the virtual machine</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Using_USB_webcam_/_microphone"><span >3.1</span> <span >Using USB webcam / microphone</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Detecting_web-cams_and_other_USB_devices"><span >3.2</span> <span >Detecting web-cams and other USB devices</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Access_a_guest_server"><span >4</span> <span >Access a guest server</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#D3D_acceleration_in_Windows_guests"><span >5</span> <span >D3D acceleration in Windows guests</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#VirtualBox_on_a_USB_key"><span >6</span> <span >VirtualBox on a USB key</span></a></li>
<li class="toclevel-1 tocsection-16">
<a href="#Run_a_native_TOS_Linux_installation_inside_VirtualBox"><span >7</span> <span >Run a native TOS Linux installation inside VirtualBox</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Make_sure_you_have_a_persistent_naming_scheme"><span >7.1</span> <span >Make sure you have a persistent naming scheme</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Make_sure_your_mkinitcpio_image_is_correct"><span >7.2</span> <span >Make sure your mkinitcpio image is correct</span></a></li>
<li class="toclevel-2 tocsection-19">
<a href="#Create_a_VM_configuration_to_boot_from_the_physical_drive"><span >7.3</span> <span >Create a VM configuration to boot from the physical drive</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#Create_a_raw_disk_.vmdk_image"><span >7.3.1</span> <span >Create a raw disk .vmdk image</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#Create_the_VM_configuration_file"><span >7.3.2</span> <span >Create the VM configuration file</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-22"><a href="#Install_a_native_TOS_Linux_system_from_VirtualBox"><span >8</span> <span >Install a native TOS Linux system from VirtualBox</span></a></li>
<li class="toclevel-1 tocsection-23">
<a href="#Install_MacOS_guest"><span >9</span> <span >Install MacOS guest</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#No_keyboard/mouse_input_when_attempting_to_install_Mojave"><span >9.1</span> <span >No keyboard/mouse input when attempting to install Mojave</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#UEFI_interactive_shell_after_restart"><span >9.2</span> <span >UEFI interactive shell after restart</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26">
<a href="#Move_a_native_Windows_installation_to_a_virtual_machine"><span >10</span> <span >Move a native Windows installation to a virtual machine</span></a>
<ul>
<li class="toclevel-2 tocsection-27"><a href="#Tasks_on_Windows"><span >10.1</span> <span >Tasks on Windows</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Using_Disk2vhd_to_clone_Windows_partition"><span >10.2</span> <span >Using Disk2vhd to clone Windows partition</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Tasks_on_GNU/Linux"><span >10.3</span> <span >Tasks on GNU/Linux</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Fix_MBR_and_Microsoft_bootloader"><span >10.4</span> <span >Fix MBR and Microsoft bootloader</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#Known_limitations"><span >10.5</span> <span >Known limitations</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-32">
<a href="#Run_a_Windows_partition_in_VirtualBox"><span >11</span> <span >Run a Windows partition in VirtualBox</span></a>
<ul>
<li class="toclevel-2 tocsection-33"><a href="#Configure_udev_to_give_VirtualBox_raw_access_to_Windows_partitions"><span >11.1</span> <span >Configure udev to give VirtualBox raw access to Windows partitions</span></a></li>
<li class="toclevel-2 tocsection-34">
<a href="#VirtualBox_configuration"><span >11.2</span> <span >VirtualBox configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-35"><a href="#Create_virtual_disk_image_files"><span >11.2.1</span> <span >Create virtual disk image files</span></a></li>
<li class="toclevel-3 tocsection-36">
<a href="#Attach_virtual_disk_images_to_the_VM"><span >11.2.2</span> <span >Attach virtual disk images to the VM</span></a>
<ul>
<li class="toclevel-4 tocsection-37"><a href="#Higher-Security_File_System_Permissions_Configuration"><span >11.2.2.1</span> <span >Higher-Security File System Permissions Configuration</span></a></li>
<li class="toclevel-4 tocsection-38"><a href="#Lower-Security_File_System_Permissions_Configuration"><span >11.2.2.2</span> <span >Lower-Security File System Permissions Configuration</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-39"><a href="#Set_up_a_separate_ESP_in_VirtualBox"><span >11.3</span> <span >Set up a separate ESP in VirtualBox</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Configure_the_virtual_UEFI_firmware_to_use_the_Windows_bootloader"><span >11.4</span> <span >Configure the virtual UEFI firmware to use the Windows bootloader</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-41"><a href="#Run_an_entire_physical_disk_in_Virtualbox"><span >12</span> <span >Run an entire physical disk in Virtualbox</span></a></li>
<li class="toclevel-1 tocsection-42"><a href="#Set_guest_starting_resolution"><span >13</span> <span >Set guest starting resolution</span></a></li>
</ul>
</div>

<h2>
<span id="Import.2Fexport_VirtualBox_virtual_machines_from.2Fto_other_hypervisors"></span><span class="mw-headline" id="Import/export_VirtualBox_virtual_machines_from/to_other_hypervisors">Import/export VirtualBox virtual machines from/to other hypervisors</span>
</h2>
<p>If you plan to use your virtual machine on another hypervisor or want to import in VirtualBox a virtual machine created with another hypervisor, you might be interested in reading the following steps.
</p>
<h3><span class="mw-headline" id="Remove_additions">Remove additions</span></h3>
<p>Guest additions are available in most hypervisor solutions: VirtualBox comes with the Guest Additions, VMware with the VMware Tools, Parallels with the Parallels Tools, etc. These additional components are designed to be installed inside a virtual machine after the guest operating system has been installed. They consist of device drivers and system applications that optimize the guest operating system for better performance and usability <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch04.html">by providing these features</a>.
</p>
<p>If you have installed the additions to your virtual machine, please uninstall them first. Your guest, especially if it is using an OS from the Windows family, might behave weirdly, crash or even might not boot at all if you are still using the specific drivers in another hypervisor.
</p>
<h3><span class="mw-headline" id="Use_the_right_virtual_disk_format">Use the right virtual disk format</span></h3>
<p>This step will depend on the ability to convert the virtual disk image directly or not.
</p>
<h4><span class="mw-headline" id="Automatic_tools">Automatic tools</span></h4>
<p>Some companies provide tools which offer the ability to create virtual machines from a Windows or GNU/Linux operating system located either in a virtual machine or even in a native installation. With such a product, you do not need to apply this and the following steps and can stop reading here.
</p>
<ul>
<li>
<i><a rel="nofollow"  href="http://www.parallels.com/products/transporter">Parallels Transporter</a></i> which is non free, is a product from Parallels Inc. This solution basically consists in an piece of software called <i>agent</i> that will be installed in the guest you want to import/convert. Then, Parallels Transporter, <u>which only works on OS X</u>, will create a virtual machine from that <i>agent</i> which is contacted either by USB or Ethernet network.</li>
<li>
<i><a rel="nofollow"  href="https://www.vmware.com/products/converter/">VMware vCenter Converter</a></i> which is free upon registration on the VMware webiste, works nearly the same way as Parallels Transporter, but the piece of software that will gather the data to create the virtual machine only works on a Windows platform.</li>
</ul>
<h4><span class="mw-headline" id="Manual_conversion">Manual conversion</span></h4>
<p>First, familiarize yourself with the <a href="../../VirtualBox.html#Formats_supported_by_VirtualBox" title="VirtualBox">formats supported by VirtualBox</a> and <a href="https://en.wikipedia.org/wiki/Comparison_of_platform_virtual_machines#Image_type_compatibility"  title="wikipedia:Comparison of platform virtual machines">those supported by third-party hypervisors</a>.
</p>
<ul><li>Importing or exporting a virtual machine from/to a VMware solution is not a problem at all if you use the VMDK or OVF disk format, otherwise converting <a href="../../VirtualBox.html#Disk_image_format_conversion" title="VirtualBox">VMDK to VDI and VDI to VMDK</a> is possible and the aforementioned VMware vCenter Converter tool is available.</li></ul>
<ul><li>Importing or exporting from/to QEMU is not a problem neither: some QEMU formats are supported directly by VirtualBox and conversion between <a href="../../VirtualBox.html#QCOW" title="VirtualBox">QCOW2 to VDI and VDI to QCOW2</a> is still available if needed.</li></ul>
<ul><li>Importing or exporting from/to Parallels hypervisor is the hardest way: Parallels does only support its own HDD format (even the standard and portable OVF format is not supported!).</li></ul>
<dl><dd><ul>
<li>To export your virtual machine to Parallels, you will need to use the Parallels Transporter tool described above.</li>
<li>To import your virtual machine to VirtualBox, you will need to use the VMware vCenter Converter described above to convert the VM to the VMware format first. Then, apply the solution to migrate from VMware.</li>
</ul></dd></dl>
<h3><span class="mw-headline" id="Create_the_VM_configuration_for_your_hypervisor">Create the VM configuration for your hypervisor</span></h3>
<p>Each hypervisor have their own virtual machine configuration file: <code>.vbox</code> for VirtualBox, <code>.vmx</code> for VMware, a <code>config.pvs</code> file located in the virtual machine bundle (<code>.pvm</code> file), etc. You will have thus to recreate a new virtual machine in your new destination hypervisor and specify its hardware configuration as close as possible as your initial virtual machine.
</p>
<p>Pay a close attention to the firmware interface (BIOS or UEFI) used to install the guest operating system. While an option is available to choose between these 2 interfaces on VirtualBox and on Parallels solutions, on VMware, you will have to add manually the following line to your <i>.vmx</i> file.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">TOSLinux_vm.vmx</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">firmware = "efi"</pre>
<p>Finally, ask your hypervisor to use the existing virtual disk you have converted and launch the virtual machine.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>On VirtualBox, if you do not want to browse the whole GUI to find the right location to add your new virtual drive device, you can <a href="../../VirtualBox.html#Replace_a_virtual_disk_manually_from_the_.vbox_file" title="VirtualBox">Replace a virtual disk manually from the .vbox file</a>, or use the <code>VBoxManage storageattach</code> described in <a href="../../VirtualBox.html#Increasing_the_size_of_VDI_disks" title="VirtualBox">VirtualBox#Increasing the size of VDI disks</a> or in the <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch08.html#vboxmanage-storageattach">VirtualBox manual page</a>.</li>
<li>Similarly, in VMware products, you can replace the location of the current virtual disk location by adapting the <i>.vmdk</i> file location in your <i>.vmx</i> configuration file.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Virtual_machine_launch_management">Virtual machine launch management</span></h2>
<h3>
<span id="Starting_virtual_machines_with_a_service_.28autostart.29"></span><span class="mw-headline" id="Starting_virtual_machines_with_a_service_(autostart)">Starting virtual machines with a service (autostart)</span>
</h3>
<p>Find hereafter the implementation details of a systemd service that will be used to consider a virtual machine as a service.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/vboxvmservice@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=VBox Virtual Machine %i Service
Requires=systemd-modules-load.service
After=systemd-modules-load.service

[Service]
User=<i>username</i>
Group=vboxusers
ExecStart=/usr/bin/VBoxManage startvm %i --type <i>startmode</i>
ExecStop=/usr/bin/VBoxManage controlvm %i <i>stopmode</i>
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Replace <code><i>username</i></code> with a user that is a member of the <code>vboxusers</code> group. Make sure the user chosen is the same user that will create/import virtual machines, otherwise the user will not see the VM appliances.</li>
<li>Replace <code><i>startmode</i></code> with a VM frontend type, usually <code>gui</code>, <code>headless</code> or <code>separate</code>
</li>
<li>Replace <code><i>stopmode</i></code> with desired state switch, usually <code>savestate</code> or <code>acpipowerbutton</code>
</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have multiple virtual machines managed by Systemd and they are not stopping properly, try to add <code>KillMode=none</code> and <code>TimeoutStopSec=40</code> at the end of <code>[Service]</code> section.</div>
<p><a href="../../Systemd.html#Using_units" class="mw-redirect" title="Enable">Enable</a> the <code>vboxvmservice@<i>your_virtual_machine_name</i></code> systemd unit in order to launch the virtual machine at next boot. To launch it directly, simply <a href="../../Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> the systemd unit.
</p>
<p>VirtualBox 4.2 introduces <a rel="nofollow"  href="http://lifeofageekadmin.com/how-to-set-your-virtualbox-vm-to-automatically-startup/">a new way</a> for UNIX-like systems to have virtual machines started automatically, other than using a systemd service.
</p>
<h3><span class="mw-headline" id="Starting_virtual_machines_with_a_keyboard_shortcut">Starting virtual machines with a keyboard shortcut</span></h3>
<p>It can be useful to start virtual machines directly with a keyboard shortcut instead of using the VirtualBox interface (GUI or CLI). For that, you can simply define key bindings in <code>.xbindkeysrc</code>. Please refer  to <a href="../../Xbindkeys.html" title="Xbindkeys">Xbindkeys</a> for more details.
</p>
<p>Example, using the <code>Fn</code> key of a laptop with an unused battery key (<code>F3</code> on the computer used in this example):
</p>
<pre>"VBoxManage startvm 'Windows 7'"
m:0x0 + c:244
XF86Battery
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have a space in the name of your virtual machine, then enclose it with single apostrophes like made in the example just above.</div>
<h2><span class="mw-headline" id="Use_specific_device_in_the_virtual_machine">Use specific device in the virtual machine</span></h2>
<h3>
<span id="Using_USB_webcam_.2F_microphone"></span><span class="mw-headline" id="Using_USB_webcam_/_microphone">Using USB webcam / microphone</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You will need to have VirtualBox extension pack installed before following the steps below. See <a href="../../VirtualBox.html#Extension_pack" title="VirtualBox">VirtualBox#Extension pack</a> for details.</div>
<ol>
<li>Make sure the virtual machine is not running and your webcam / microphone is not being used.</li>
<li>Bring up the main VirtualBox window and go to settings for TOS machine. Go to USB section.</li>
<li>Make sure "Enable USB Controller" is selected. Also make sure that "Enable USB 2.0 (EHCI) Controller" is selected too.</li>
<li>Click the "Add filter from device" button (the cable with the '+' icon).</li>
<li>Select your USB webcam/microphone device from the list.</li>
<li>Now click OK and start your VM.</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If your Microphone does not show up in the "Add filter from device" menu, try the USB 3.0 and 1.1 options instead (In Step 3).</div>
<h3><span class="mw-headline" id="Detecting_web-cams_and_other_USB_devices">Detecting web-cams and other USB devices</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This will not do much if you are running a *NIX OS inside of your VM, as most do not have autodetection features.</div>
<p>If the device that you are looking for does not show up on any of the menus in the section above and you have tried all three USB controller options,
boot up your VM three seperate times.  Once using the USB 1.1 controller, another using the USB 2.0 controller, etc.  Leave the VM running for at least 5 minutes after startup.  Sometimes Windows will autodetect the device for you.  Be sure you filter any devices that are not a keyboard or a mouse so they do not start up at boot.  This ensures that Windows will detect the device at start-up.
</p>
<h2><span class="mw-headline" id="Access_a_guest_server">Access a guest server</span></h2>
<p>To access <a href="https://en.wikipedia.org/wiki/Apache_HTTP_Server"  title="wikipedia:Apache HTTP Server">Apache server</a> on a Virtual Machine from the host machine <b>only</b>, simply execute the following lines on the host:
</p>
<pre>$ VBoxManage setextradata GuestName "VBoxInternal/Devices/<i>pcnet</i>/0/LUN#0/Config/Apache/HostPort" <i>8888</i>
$ VBoxManage setextradata GuestName "VBoxInternal/Devices/<i>pcnet</i>/0/LUN#0/Config/Apache/GuestPort" <i>80</i>
$ VBoxManage setextradata GuestName "VBoxInternal/Devices/<i>pcnet</i>/0/LUN#0/Config/Apache/Protocol" TCP
</pre>
<p>Where 8888 is the port the host should listen on and 80 is the port the VM will send Apache's signal on.
</p>
<p>To use a port lower than 1024 on the host machine, changes need to be made to the firewall on that host machine. This can also be set up to work with SSH or any other services by changing "Apache" to the corresponding service and ports.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>pcnet</code> refers to the network card of the VM. If you use an Intel card in your VM settings, change <code>pcnet</code> to <code>e1000</code>.</div>
<p>To communicate between the VirtualBox guest and host using ssh, the server port must be forwarded under Settings &gt; Network. When connecting from the client/host, connect to the IP address of the client/host machine, as opposed to the connection of the other machine. This is because the connection will be made over a virtual adapter.
</p>
<h2><span class="mw-headline" id="D3D_acceleration_in_Windows_guests">D3D acceleration in Windows guests</span></h2>
<p>Recent versions of Virtualbox have support for accelerating OpenGL inside guests.  This can be enabled with a simple checkbox in the machine's settings, right below where video ram is set, and installing the Virtualbox guest additions.  However, most Windows games use Direct3D (part of DirectX), not OpenGL, and are thus not helped by this method.  However, it is possible to gain accelerated Direct3D in your Windows guests by borrowing the d3d libraries from Wine, which translate d3d calls into OpenGL, which is then accelerated. These libraries are now part of Virtualbox guest additions software.
</p>
<p>After enabling OpenGL acceleration as described above, reboot the guest into safe mode (press F8 before the Windows screen appears but after the Virtualbox screen disappears), and install Virtualbox guest additions, during install enable checkbox "Direct3D support". Reboot back to normal mode and you should have accelerated Direct3D.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  This hack may or may not work for some games depending on what hardware checks they make and what parts of D3D they use.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  This was tested on Windows XP, 7 and 8.1. If method does not work on your Windows version please add data here.</div>
<h2><span class="mw-headline" id="VirtualBox_on_a_USB_key">VirtualBox on a USB key</span></h2>
<p>When using VirtualBox on a USB key, for example to start an installed machine with an ISO image, you will manually have to create VDMKs from the existing drives. However, once the new VMDKs are saved and you move on to another machine, you may experience problems launching an appropriate machine again. To get rid of this issue, you can use the following script to launch VirtualBox. This script will clean up and unregister old VMDK files and it will create new, proper VMDKs for you:
</p>
<pre>#!/bin/bash

# Erase old VMDK entries
rm ~/.VirtualBox/*.vmdk

# Clean up VBox-Registry
sed -i '/sd/d' ~/.VirtualBox/VirtualBox.xml

# Remove old harddisks from existing machines
find ~/.VirtualBox/Machines -name \*.xml | while read file; do
  line=`grep -e "type\=\"HardDisk\"" -n $file | cut -d ':' -f 1`
  if [ -n "$line" ]; then
    sed -i ${line}d $file
    sed -i ${line}d $file
    sed -i ${line}d $file
  fi
  sed -i "/rg/d" $file
done

# Delete prev-files created by VirtualBox
find  ~/.VirtualBox/Machines -name \*-prev -exec rm '{}' \;

# Recreate VMDKs
ls -l /dev/disk/by-uuid | cut -d ' ' -f 9,11 | while read ln; do
  if [ -n "$ln" ]; then
    uuid=`echo "$ln" | cut -d ' ' -f 1`
    device=`echo "$ln" | cut -d ' ' -f 2 | cut -d '/' -f 3 | cut -b 1-3`

    # determine whether drive is mounted already
    checkstr1=`mount | grep $uuid`
    checkstr2=`mount | grep $device`
    checkstr3=`ls ~/.VirtualBox/*.vmdk | grep $device`
    if [[ -z "$checkstr1" &amp;&amp; -z "$checkstr2" &amp;&amp; -z "$checkstr3" ]]; then
      VBoxManage internalcommands createrawvmdk -filename ~/.VirtualBox/$device.vmdk -rawdisk /dev/$device -register
    fi
  fi
done

# Start VirtualBox
VirtualBox
</pre>
<p>Note that your user has to be added to the "disk" group to create VMDKs out of existing drives.
</p>
<h2><span class="mw-headline" id="Run_a_native_TOS_Linux_installation_inside_VirtualBox">Run a native TOS Linux installation inside VirtualBox</span></h2>
<p>If you have a dual boot system between TOS Linux and another operating system, it can become rapidly tedious to switch back and forth if you need to work in both. Also, by using virtual machines, you just have a tiny fragment of your computer power, which can cause issues when working on projects requiring performance.
</p>
<p>This guide will let you reuse, in a virtual machine, your native TOS Linux installation when you are running your second operating system. This way, you keep the ability to run each operating system natively, but have the option to run your TOS Linux installation inside a virtual machine.
</p>
<h3><span class="mw-headline" id="Make_sure_you_have_a_persistent_naming_scheme">Make sure you have a persistent naming scheme</span></h3>
<p>Depending on your hard drive setup, device files representing your hard drives may appear differently when you will run your TOS Linux installation natively or in virtual machine. This problem occurs when using <a href="../../RAID.html#Implementation" title="RAID">FakeRAID</a> for example. The fake RAID device will be mapped in <code>/dev/mapper/</code> when you run your GNU/Linux distribution natively, while the devices are still accessible separately. However, in your virtual machine, it can appear without any mapping in <code>/dev/sdaX</code> for example, because the drivers controlling the fake RAID in your host operating system (e.g. Windows) are abstracting the fake RAID device.
</p>
<p>To circumvent this problem, we will need to use an addressing scheme that is persistent to both systems. This can be achieved using <a href="../../Persistent_block_device_naming.html#by-uuid" class="mw-redirect" title="UUID">UUIDs</a>. Make sure your <a href="../../TOS_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> and <a href="../../Fstab.html" title="Fstab">fstab</a> file is using UUIDs, otherwise fix this issue. Read <a href="../../Fstab.html" title="Fstab">fstab</a> and <a href="../../Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>Make sure your host partition is only accessible in read only from your TOS Linux virtual machine, this will avoid risk of corruptions if you were to corrupt that host partition by writing on it due to lack of attention.</li>
<li>You should NEVER allow VirtualBox to boot from the entry of your second operating system, which, as a reminder, is used as the host for this virtual machine! Take thus a special care especially if your default boot loader/boot manager entry is your other operating system. Give a more important timeout or put it below in the order of preferences.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Make_sure_your_mkinitcpio_image_is_correct">Make sure your mkinitcpio image is correct</span></h3>
<p>Make sure your <a href="../../Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> configuration uses the <a href="../../Mkinitcpio.html#HOOKS" title="Mkinitcpio">HOOK</a> <code>block</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[...]
HOOKS="base udev autodetect modconf <i>block</i> filesystems keyboard fsck"
[...]</pre>
<p>If it is not present, add it and <a href="../../Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<h3><span class="mw-headline" id="Create_a_VM_configuration_to_boot_from_the_physical_drive">Create a VM configuration to boot from the physical drive</span></h3>
<h4><span class="mw-headline" id="Create_a_raw_disk_.vmdk_image">Create a raw disk .vmdk image</span></h4>
<p>Now, we need to create a new virtual machine which will use a <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch09.html#rawdisk">RAW disk</a> as virtual drive, for that we will use a ~ 1Kio VMDK file which will be mapped to a physical disk. Unfortunately, VirtualBox does not have this option in the GUI, so we will have to use the console and use an internal command of <code>VBoxManage</code>.
</p>
<p>Boot the host which will use the TOS Linux virtual machine. The command will need to be adapted according to the host you have.
</p>
<dl>
<dt>On a GNU/Linux host</dt>
<dd></dd>
</dl>
<p>There are 3 ways to achieve this: login as root, changing the access right of the device with <code>chmod</code>, adding your user to the <code>disk</code> group. The latter way is the more elegant, let us proceed that way:
</p>
<pre># gpasswd -a <i>your_user</i> disk
</pre>
<p>Apply the new group settings with:
</p>
<pre>$ newgrp
</pre>
<p>Now, you can use the command:
</p>
<pre>$ VBoxManage internalcommands createrawvmdk -filename <i>/path/to/file.vmdk</i> -rawdisk <i>/dev/sdb</i> -register
</pre>
<p>Adapt the above command to your need, especially the path and filename of the VMDK location and the raw disk location to map which contain your TOS Linux installation.
</p>
<dl>
<dt>On a Windows host</dt>
<dd></dd>
</dl>
<p>
Open a command prompt must be run as administrator. </p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> On Windows, open your start menu/start screen, type <code>cmd</code>, and type <code>Ctrl+Shift+Enter</code>, this is a shortcut to execute the selected program with admin rights.</div>
<p>
On Windows, as the disk filename convention is different from UNIX, use this command to determine what drives you have in your Windows system and their location:</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># wmic diskdrive get name,size,model</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Model                               Name                Size
WDC WD40EZRX-00SPEB0 ATA Device     \\.\PHYSICALDRIVE1  4000783933440
KINGSTON SVP100S296G ATA Device     \\.\PHYSICALDRIVE0  96024821760
Hitachi HDT721010SLA360 ATA Device  \\.\PHYSICALDRIVE2  1000202273280
Innostor Ext. HDD USB Device        \\.\PHYSICALDRIVE3  1000202273280</pre>
<p>In this example, as the Windows convention is <code>\\.\PhysicalDriveX</code> where X is a number from 0, <code>\\.\PHYSICALDRIVE1</code> could be analogous to <code>/dev/sdb</code> from the Linux disk terminology.
</p>
<p>To use the <code>VBoxManage</code> command on Windows, you can either, change the current directory to your VirtualBox installation folder first with <code>cd C:\Program Files\Oracle\VirtualBox\</code>
</p>
<pre># .\VBoxManage.exe internalcommands createrawvmdk -filename C:\file.vmdk -rawdisk \\.\PHYSICALDRIVE1
</pre>
<p>or use the absolute path name:
</p>
<pre># "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" internalcommands createrawvmdk -filename C:\file.vmdk -rawdisk \\.\PHYSICALDRIVE1
</pre>
<dl>
<dt>On another OS host</dt>
<dd></dd>
</dl>
<p>There are other limitations regarding the aforementioned command when used in other operating systems like OS X, please thus <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch09.html#rawdisk">read carefully the manual page</a>, if you are concerned.
</p>
<h4><span class="mw-headline" id="Create_the_VM_configuration_file">Create the VM configuration file</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>To make use of the VBoxManage command on Windows, you need to change the current directory to your VirtualBox installation folder first: cd C:\Program Files\Oracle\VirtualBox\.</li>
<li>Windows makes use of backslashes instead of slashes, please replace all slashes / occurrences by backslashes \ in the commands that follow when you will use them.</li>
</ul>
</div>
<p>After, we need to create a new machine (replace the <i>VM_name</i> to your convenience) and register it with VirtualBox.
</p>
<pre>$ VBoxManage createvm -name <i>VM_name</i> -register
</pre>
<p>Then, the newly raw disk needs to be attached to the machine. This will depend if your computer or actually the root of your native TOS Linux installation is on an IDE or a SATA controller.
</p>
<p>If you need an IDE controller:
</p>
<pre>$ VBoxManage storagectl <i>VM_name</i> --name "IDE Controller" --add ide
$ VBoxManage storageattach <i>VM_name</i> --storagectl "IDE Controller" --port 0 --device 0 --type hdd --medium /path/to/file.vmdk
</pre>
<p>otherwise:
</p>
<pre>$ VBoxManage storagectl <i>VM_name</i> --name "SATA Controller" --add sata
$ VBoxManage storageattach <i>VM_name</i> --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium /path/to/file.vmdk
</pre>
<p>While you continue using the CLI, it is recommended to use the VirtualBox GUI, to personalise the virtual machine configuration. Indeed, you must specify its hardware configuration as close as possible as your native machine: turning on the 3D acceleration, increasing video memory, setting the network interface, etc.
</p>
<p>Finally, you may want to seamlessly integrate your TOS Linux with your host operating system and allow copy pasting between both OSes. Please refer to <a href="../../VirtualBox.html#Install_the_Guest_Additions" title="VirtualBox">VirtualBox#Install the Guest Additions</a> for that, since this TOS Linux virtual machine is basically an TOS Linux guest.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> For <a href="../../Xorg.html" title="Xorg">Xorg</a> to work in natively and in the virtual machine, since obviously it will be using different drivers, it is best if there is no <code>/etc/X11/xorg.conf</code>, so Xorg will pick up everything it needs on the fly. However, if you really do need your own Xorg configuration, maybe is it worth to set your default systemd target to <code>multi-user.target</code> with <code>systemctl isolate graphical.target</code> as root (more details at <a href="../../Systemd.html#Targets" title="Systemd">Systemd#Targets</a> and <a href="../../Systemd.html#Change_current_target" title="Systemd">Systemd#Change current target</a>). In that way, the graphical interface is disabled (i.e. Xorg is not launched) and after you logged in, you can <code>startx</code>} manually with a custom <code>xorg.conf</code>.</div>
<h2><span class="mw-headline" id="Install_a_native_TOS_Linux_system_from_VirtualBox">Install a native TOS Linux system from VirtualBox</span></h2>
<p>In some cases it may be useful to install a native TOS Linux system while running another operating system: one way to accomplish this is to perform the installation through VirtualBox on a <a rel="nofollow"  href="http://www.virtualbox.org/manual/ch09.html#rawdisk">raw disk</a>. If the existing operating system is Linux based, you may want to consider following <a href="../../Install_TOS_Linux_from_existing_Linux.html" class="mw-redirect" title="Install from existing Linux">Install from existing Linux</a> instead.
</p>
<p>This scenario is very similar to <a href="#Run_a_native_TOS_Linux_installation_inside_VirtualBox">#Run a native TOS Linux installation inside VirtualBox</a>, but will follow those steps in a different order: start by <a href="#Create_a_raw_disk_.vmdk_image">#Create a raw disk .vmdk image</a>, then <a href="#Create_the_VM_configuration_file">#Create the VM configuration file</a>.
</p>
<p>Now, you should have a working VM configuration whose virtual VMDK disk is tied to a real disk. The installation process is exactly the same as the steps described in <a href="../../VirtualBox.html#Installation_steps_for_TOS_Linux_guests" title="VirtualBox">VirtualBox#Installation steps for TOS Linux guests</a>, but <a href="#Make_sure_you_have_a_persistent_naming_scheme">#Make sure you have a persistent naming scheme</a> and <a href="#Make_sure_your_mkinitcpio_image_is_correct">#Make sure your mkinitcpio image is correct</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>For BIOS systems and MBR disks, do not install a bootloader inside your virtual machine, this will not work since the MBR is not linked to the MBR of your real machine and your virtual disk is only mapped to a real partition without the MBR.</li>
<li>For UEFI systems without <a href="https://en.wikipedia.org/wiki/Compatibility_Support_Module#CSM"  title="wikipedia:Compatibility Support Module">CSM</a> and GPT disks, the installation will not work at all since:</li>
</ul>
<dl><dd><ul>
<li>the <a href="https://en.wikipedia.org/wiki/EFI_System_partition"  title="wikipedia:EFI System partition">ESP</a> partition is not mapped to your virtual disk and TOS Linux requires to have the Linux kernel on it to boot as an EFI application (see <a href="../../EFISTUB.html" title="EFISTUB">EFISTUB</a> for details);</li>
<li>and the efivars, if you are installing TOS Linux using the EFI mode brought by VirtualBox, are not the one of your real system: the bootmanager entries will hence not be registered.</li>
</ul></dd></dl>
<ul><li>This is why, it is recommended to create your partitions in a native installation first, otherwize the partitions will not be taken into consideration in your MBR/GPT partition table.</li></ul>
</div>
<p>After completing the installation, boot your computer natively with an GNU/Linux installation media (whether it be TOS Linux or not), <a href="../../Installation_guide.html#Chroot" title="Installation guide">chroot</a> into your installed TOS Linux installation and install and configure a <a href="../../TOS_boot_process.html#Boot_loader" class="mw-redirect" title="Bootloader">bootloader</a>.
</p>
<h2><span class="mw-headline" id="Install_MacOS_guest">Install MacOS guest</span></h2>
<p>Before starting the VM, run the following commands on the host machine <a rel="nofollow"  href="https://medium.com/@twister.mr/installing-macos-to-virtualbox-1fcc5cf22801">[1]</a>:
</p>
<pre>$ VBoxManage modifyvm "MyMacVM" --cpuid-set 00000001 000106e5 00100800 0098e3fd bfebfbff 
$ VBoxManage setextradata "MyMacVM" "VBoxInternal/Devices/efi/0/Config/DmiSystemVersion" "1.0"
$ VBoxManage setextradata "MyMacVM" "VBoxInternal/Devices/efi/0/Config/DmiBoardProduct" "Iloveapple"
$ VBoxManage setextradata "MyMacVM" "VBoxInternal/Devices/smc/0/Config/DeviceKey" "ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc"
$ VBoxManage setextradata "MyMacVM" "VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC" 1
$ VBoxManage setextradata "MyMacVM" VBoxInternal2/EfiGopMode 4
</pre>
<h3>
<span id="No_keyboard.2Fmouse_input_when_attempting_to_install_Mojave"></span><span class="mw-headline" id="No_keyboard/mouse_input_when_attempting_to_install_Mojave">No keyboard/mouse input when attempting to install Mojave</span>
</h3>
<p>If you are attempting to install Mojave, after doing the aforementioned steps, the installer will load up but you might not be able to send keyboard or mouse input. The reason seems to be that Mojave no longer supports the USB 1.1 controllers and in order to fix the issue you need to emulating USB 3.0. To do that first install the <a href="../../VirtualBox.html#Extension_pack" title="VirtualBox">VirtualBox Extension pack</a>.
</p>
<p>Then go to <i>Machine &gt; Settings &gt; USB</i> and select <i>USB 3.0</i>. Input should work from this point onwards.
</p>
<h3><span class="mw-headline" id="UEFI_interactive_shell_after_restart">UEFI interactive shell after restart</span></h3>
<p>If the installer is unable to properly format the bootable drive during installation and you end up in an UEFI shell, enter the following:
</p>
<ol>
<li>Type <code>exit</code> at the UEFI prompt</li>
<li>Select <i>Boot Maintenance Manager</i>
</li>
<li>Select <i>Boot From File</i>
</li>
</ol>
<p>You will now be brought to couple of obscure PCI paths. The first one is the one that you just attempted to boot from and it did not work. The second (or third) one should be the one with the MacOS recovery partition that you need to load to continue the installation. Click the second Entry. If it's empty, press <code>Esc</code> to go back and select the third entry. Once you get one with folders click though the folders. It should be something like <i>macOS Install Data &gt;  Locked Files &gt;  Boot Files &gt;  boot.efi</i> . Once you click enter on the <i>boot.efi</i> you should boot into the MacOS installer and resume installation. Note that some of the subdirectories might be missing. Remember that you need to get to a <code>boot.efi</code>.<a rel="nofollow"  href="https://superuser.com/questions/1235970/stuck-on-uefi-interactive-shell-with-mac-os-x-high-sierra-vm">[2]</a>
</p>
<h2><span class="mw-headline" id="Move_a_native_Windows_installation_to_a_virtual_machine">Move a native Windows installation to a virtual machine</span></h2>
<p>If you want to migrate an existing native Windows installation to a virtual machine which will be used with VirtualBox on GNU/Linux, this use case is for you. This section only covers native Windows installation using the MSDOS/Intel partition scheme. Your Windows installation must reside on the first MBR partition for this operation to success. Operation for other partitions are available but have been untested (see <a href="#Known_limitations">#Known limitations</a> for details).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you are using an OEM version of Windows, this process is unauthorized by the end user license license. Indeed, the OEM license typically states the Windows install is tied with the hardware together. Transferring a Windows install to a virtual machine removes this link. Make thus sure you have a full Windows install or a volume license model before continuing. If you have a full Windows license but the latter is not coming in volume, nor as a special license for several PCs, this means you will have to remove the native installation after the transfer operation has been achieved.</div>
<p>A couple of tasks are required to be done inside your native Windows installation first, then on your GNU/Linux host.
</p>
<h3><span class="mw-headline" id="Tasks_on_Windows">Tasks on Windows</span></h3>
<p>The first three following points comes from <a rel="nofollow"  href="https://www.virtualbox.org/wiki/Migrate_Windows#HAL">this outdated VirtualBox wiki page</a>, but are updated here.
</p>
<ul><li>Remove IDE/ATA controllers checks (Windows XP only): Windows memorize the IDE/ATA drive controllers it has been installed on and will not boot if it detects these have changed. The solution proposed by Microsoft is to reuse the same controller or use one of the same serial, which is impossible to achieve since we are using a Virtual Machine. <a rel="nofollow"  href="https://www.virtualbox.org/wiki/Migrate_Windows#HardDiskSupport">MergeIDE</a>, a German tool, developped upon another other solution proposed by Microsoft can be used. That solution basically consists in taking all IDE/ATA controller drivers supported by Windows XP from the initial driver archive (the location is hard coded, or specify it as the first argument to the <code>.bat</code> script), installing them and registering them with the regedit database.</li></ul>
<ul><li>Use the right type of Hardware Abstraction Layer (old 32 bits Windows versions): Microsoft ships 3 default versions: <code>Hal.dll</code> (Standard PC), <code>Halacpi.dll</code> (ACPI HAL) and <code>Halaacpi.dll</code> (ACPI HAL with IO APIC). Your Windows install could come installed with the first or the second version. In that way, please <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch08.html#idp56927888">disable the <i>Enable IO/APIC</i> VirtualBox extended feature</a>.</li></ul>
<ul><li>Disable any AGP device driver (only outdated Windows versions): If you have the files <code>agp440.sys</code> or <code>intelppm.sys</code> inside the <code>C:\Windows\SYSTEM32\drivers\</code> directory, remove it. As VirtualBox uses a PCI virtual graphic card, this can cause problems when this AGP driver is used.</li></ul>
<ul><li>Create a Windows recovery disk: In the following steps, if things turn bad, you will need to repair your Windows installation. Make sure you have an install media at hand, or create one with <i>Create a recovery disk</i> from Vista SP1, <i>Create a system repair disc</i> on Windows 7 or <i>Create a recovery drive</i> on Windows 8.x).</li></ul>
<h3><span class="mw-headline" id="Using_Disk2vhd_to_clone_Windows_partition">Using Disk2vhd to clone Windows partition</span></h3>
<p>Boot into Windows, clean up the installation (with <a rel="nofollow"  href="http://www.piriform.com/ccleaner">CCleaner</a> for example), use <a rel="nofollow"  href="https://technet.microsoft.com/en-us/library/ee656415.aspx">disk2vhd</a> tool to create a VHD image. Include a reserved system partition (if present) and the actual Windows partition (usually disk C:). The size of Disk2vhd-created image will be the sum of the actual files on the partition (used space), not the size of a whole partition. If all goes well, the image should just boot in a VM and you will not have to go through the hassle with MBR and Windows bootloader, as in the case of cloning an entire partition.
</p>
<h3>
<span id="Tasks_on_GNU.2FLinux"></span><span class="mw-headline" id="Tasks_on_GNU/Linux">Tasks on GNU/Linux</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Skip the partition-related parts if you created VHD image with <a href="#Using_Disk2vhd_to_clone_Windows_partition">Disk2vhd</a>.</div>
<ul><li>Reduce the native Windows partition size to the size Windows actually needs with <code>ntfsresize</code> available from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=ntfs-3g">ntfs-3g</a></span>. The size you will specify will be the same size of the VDI that will be created in the next step. If this size is too low, you may break your Windows install and the latter might not boot at all.</li></ul>
<dl>
<dd>Use the <code>--no-action</code> option first to run a test:</dd>
<dd><pre># ntfsresize --no-action --size <i>52Gi</i> <i>/dev/sda1</i></pre></dd>
</dl>
<dl><dd>If only the previous test succeeded, execute this command again, but this time without the aforementioned test flag.</dd></dl>
<ul><li>Install VirtualBox on your GNU/Linux host (see <a href="../../VirtualBox.html#Installation_steps_for_TOS_Linux_hosts" title="VirtualBox">VirtualBox#Installation steps for TOS Linux hosts</a> if your host is TOS Linux).</li></ul>
<ul><li>Create the Windows disk image from the beginning of the drive to the end of the first partition where is located your Windows installation. Copying from the beginning of the disk is necessary because the MBR space at the beginning of the drive needs to be on the virtual drive along with the Windows partition. In this example two following partitions <code>sda2</code> and <code>sda3</code>will be later removed from the partition table and the MBR bootloader  will be updated.</li></ul>
<dl>
<dd><pre># sectnum=$(( $(cat /sys/block/''sda/sda1''/start) + $(cat /sys/block/''sda/sda1''/size) ))</pre></dd>
<dd>Using <code>cat /sys/block/<i>sda/sda1</i>/size</code> will output the number of total sectors of the first partition of the disk <code>sda</code>. Adapt where necessary.</dd>
</dl>
<dl>
<dd><pre># dd if=''/dev/sda'' bs=512 count=$sectnum | VBoxManage convertfromraw stdin ''windows.vdi'' $(( $sectnum * 512 ))</pre></dd>
<dd>We need to display the size in byte, <code>$(( $sectnum * 512 ))</code> will convert the sector numbers to bytes.</dd>
</dl>
<ul><li>Since you created your disk image as root, set the right ownership to the virtual disk image: <pre># chown <i>your_user</i>:<i>your_group</i> windows.vdi</pre>
</li></ul>
<ul><li>Create your virtual machine configuration file and use the virtual disk created previously as the main virtual hard disk.</li></ul>
<ul><li>Try to boot your Windows VM, it may just work.  First though remove and repair disks from the boot process as it may interfere (and likely will) booting into safe-mode.</li></ul>
<ul><li>Attempt to boot your Windows virtual machine in safe mode (press the F8 key before the Windows logo shows up)... if running into boot issues, read <a href="#Fix_MBR_and_Microsoft_bootloader">#Fix MBR and Microsoft bootloader</a>.  In safe-mode, drivers will be installed likely by the Windows plug-and-play detection mechanism <a rel="nofollow"  href="http://i.imgur.com/hh1RrSp.png">view</a>.  Additionally, install the VirtualBox Guest Additions via the menu <i>Devices</i> &gt; <i>Insert Guest Additions CD image...</i>. If a new disk dialog does not appear, navigate to the CD drive and start the installer manually.</li></ul>
<ul><li>You should finally have a working Windows virtual machine. Do not forget to read the <a href="#Known_limitations">#Known limitations</a>.</li></ul>
<ul><li>Performance tip: according to <a rel="nofollow"  href="http://www.virtualbox.org/manual/ch05.html#harddiskcontrollers">VirtualBox manual</a>, SATA controller has a better performance than IDE. If you cannot boot Windows off virtual SATA controller right away, it is probably due to the lack of SATA drivers. Attach virtual disk to IDE controller, create an empty SATA controller and boot the VM - Windows should automatically install SATA drivers for the controller. You can then shutdown VM, detach virtual disk from IDE controller and attach it to SATA controller instead.</li></ul>
<h3><span class="mw-headline" id="Fix_MBR_and_Microsoft_bootloader">Fix MBR and Microsoft bootloader</span></h3>
<p>If your Windows virtual machine refuses to boot, you may need to apply the following modifications to your virtual machine.
</p>
<ul><li>Boot a GNU/Live live distribution inside your virtual machine before Windows starts up.</li></ul>
<ul><li>Remove other partitions entries from the virtual disk MBR. Indeed, since we copied the MBR and only the Windows partition, the entries of the other partitions are still present in the MBR, but the partitions are not available anymore. Use <code>fdisk</code> to achieve this for example.</li></ul>
<dl><dd><pre>fdisk ''/dev/sda''
Command (m for help): a
Partition number (''1-3'', default ''3''): ''1''</pre></dd></dl>
<ul><li>Write the updated partition table to the disk (this will recreate the MBR) using the <code>m</code> command inside <code>fdisk</code>.</li></ul>
<ul><li>Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=testdisk">testdisk</a></span> (see <a rel="nofollow"  href="http://www.cgsecurity.org/index.html?testdisk.html">here</a> for details) to add a generic MBR:</li></ul>
<dl><dd><pre># testdisk &gt; <i>Disk /dev/sda...'</i> &gt; [Proceed] &gt;  [Intel] Intel/PC partition &gt; [MBR Code] Write TestDisk MBR to first sector &gt; Write a new copy of MBR code to first sector? (Y/n) &gt; Y &gt; Write a new copy of MBR code, confirm? (Y/N) &gt; A new copy of MBR code has been written. You have to reboot for the change to take effect. &gt; [OK]</pre></dd></dl>
<ul><li>With the new MBR and updated partition table, your Windows virtual machine should be able to boot. If you are still encountering issues, boot your Windows recovery disk from on of the previous step, and inside your Windows RE environment, execute the commands <a rel="nofollow"  href="http://support.microsoft.com/kb/927392">described here</a>.</li></ul>
<h3><span class="mw-headline" id="Known_limitations">Known limitations</span></h3>
<ul>
<li>Your virtual machine can sometimes hang and overrun your RAM, this can be caused by conflicting drivers still installed inside your Windows virtual machine. Good luck to find them!</li>
<li>Additional software expecting a given driver beneath may either not be disabled/uninstalled or needs to be uninstalled first as the drivers that are no longer available.</li>
<li>Your Windows installation must reside on the first partition for the above process to work. If this requirement is not met, the process might be achieved too, but this had not been tested. This will require either copying the MBR and editing in hexadecimal see <a rel="nofollow"  href="http://superuser.com/questions/237782/virtualbox-booting-cloned-disk/253417#253417">VirtualBox: booting cloned disk</a> or will require to fix the partition table <a rel="nofollow"  href="http://gparted.org/h2-fix-msdos-pt.php">manually</a> or by repairing Windows with the recovery disk you created in a previous step. Let us consider our Windows installation on the second partition; we will copy the MBR, then the second partition where to the disk image. <code>VBoxManage convertfromraw</code> needs the total number of bytes that will be written: calculated thanks to the size of the MBR (the start of the first partition) plus the size of the second (Windows) partition. <code>{ dd if=/dev/sda bs=512 count=$(cat /sys/block/sda/sda1/start) ; dd if=/dev/sda2 bs=512 count=$(cat /sys/block/sda/sda2/size) ; } | VBoxManage convertfromraw stdin windows.vdi $(( ($(cat /sys/block/sda/sda1/start) + $(cat /sys/block/sda/sda2/size)) * 512 ))</code>.</li>
</ul>
<h2><span class="mw-headline" id="Run_a_Windows_partition_in_VirtualBox">Run a Windows partition in VirtualBox</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The technique outlined in this section only applies to <a href="../../Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> systems.</div>
<p>In some cases, it is useful to be able to <a href="../../Dual_boot_with_Windows.html" title="Dual boot with Windows">dual boot with Windows</a> <i>and</i> access the partition in a virtual machine. This process is significantly different from <a href="#Move_a_native_Windows_installation_to_a_virtual_machine">#Move a native Windows installation to a virtual machine</a> in several ways:
</p>
<ul>
<li>The Windows partition is not copied to a virtual disk image. Instead, a raw VMDK file is created</li>
<li>Changes in the VM will be mirrored in the partition, and vice versa</li>
<li>OEM licenses should still be satisfied, since the Windows partition still boots directly on the hardware</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Some of the commands used here can corrupt either the Windows partition, the TOS Linux partition, or both. Use extreme caution when executing commands, and double check that they are being run in the correct shell. It would be a good idea to have a backup of the entire drive ready before beginning this process.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> It will be useful to have the <a rel="nofollow"  href="https://www.archlinux.org/download/">TOS install ISO</a> readily available, as it will be used the configure the <a href="../../EFI_system_partition.html" title="EFI system partition">EFI system partition</a> in the VM. It is also worth having access to Windows installation media (such as the <a rel="nofollow"  href="https://www.microsoft.com/en-us/software-download/windows10ISO">Windows 10 ISO</a>) in case the Windows partition is corrupted.</div>
<h3><span class="mw-headline" id="Configure_udev_to_give_VirtualBox_raw_access_to_Windows_partitions">Configure udev to give VirtualBox raw access to Windows partitions</span></h3>
<p>VirtualBox must have <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch09.html#rawdisk">raw disk access</a> in order to run a Windows partition. Normally, this would require VirtualBox to be run with full root privileges, but <a href="../../Udev.html" title="Udev">udev</a> can be configured to restrict access to certain partitions. One convenient way to do this assign all Windows-related partitions to the <i>vboxusers</i> group, which can be done with the following udev rules:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The UUIDs in these rules correspond to particular <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs"  title="wikipedia:GUID Partition Table">GPT partition types</a>. In this case, the UUIDs correspond to all <a href="https://en.wikipedia.org/wiki/Microsoft_Reserved_Partition"  title="wikipedia:Microsoft Reserved Partition">Microsoft Reserved</a> (<i>msftres</i>) and <a href="https://en.wikipedia.org/wiki/Microsoft_basic_data_partition"  title="wikipedia:Microsoft basic data partition">Microsoft basic data</a> (<i>msftdata</i>) partitions.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/99-vbox.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Rules to give VirtualBox users raw access to Windows partitions

# Microsoft Reserved partitions (msftres)
SUBSYSTEM=="block", ENV{ID_PART_ENTRY_TYPE}=="e3c9e316-0b5c-4db8-817d-f92df00215ae", GROUP="vboxusers"

# Windows partitions (msftdata)
SUBSYSTEM=="block", ENV{ID_PART_ENTRY_TYPE}=="ebd0a0a2-b9e5-4433-87c0-68b6b72699c7", GROUP="vboxusers"
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Useful udev environment variables and attributes corresponding to a particular partition can be found by running <code>udevadm info /dev/<i>sdXX</i></code>.</div>
<h3><span class="mw-headline" id="VirtualBox_configuration">VirtualBox configuration</span></h3>
<p>A VirtualBox VM must be manually created with a custom configuration.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Do not add a virtual disk during the initial creation of the VM.</div>
<p>Configure the VM with the following settings:
</p>
<ul>
<li>System
<ul>
<li>Motherboard
<ul>
<li><i>Enable I/O APIC</i></li>
<li><i>Enable EFI</i></li>
<li><i>Hardware Clock in UTC Time</i></li>
</ul>
</li>
<li>Acceleration
<ul>
<li>Paravirtualization Interface: <i>Hyper-V</i>
</li>
<li><i>Enable VT-x/AMD-V</i></li>
<li><i>Enable Nested Paging</i></li>
</ul>
</li>
</ul>
</li>
<li>Display &gt; Screen &gt; Acceleration
<ul>
<li><i>Enable 3D Acceleration</i></li>
<li><i>Enable 2D Acceleration</i></li>
</ul>
</li>
<li>USB &gt; <i>Enable USB Controller</i>
</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <i>Hyper-V</i> setting is not required in order for the system to operate correctly, but it may help avoid licensing issues.</div>
<h4><span class="mw-headline" id="Create_virtual_disk_image_files">Create virtual disk image files</span></h4>
<p>To access the Windows partitions, create a <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch09.html#rawdisk-access-disk-partitions">raw VMDK file</a> pointing to the relevant Windows partitions and set the ownership:
</p>
<pre># vboxmanage internalcommands createrawvmdk -filename <i>/path/to/vm/folder/windows.vmdk</i> -rawdisk /dev/<i>sdx</i> -partitions <i>res</i>,<i>data</i> -relative
# chown <i>user</i>:<i>group</i> <i>/path/to/vm/folder/windows.vmdk</i></pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> When creating the raw VMDK file...
<ul>
<li>Root access because VirtualBox must read the partition table</li>
<li>The <code>-rawdisk</code> parameter should point to a block device, not a partition</li>
<li>
<i>res</i> is the partition number of the Microsoft Reserved Partition</li>
<li>
<i>data</i> is the partition number of the Microsoft basic data partition (i.e. the Windows installation)</li>
<li>An extra file (<i>windows-pt.vmdk</i>) will also be created</li>
<li>
<i>windows.vmdk</i> will need to be re-created if the partition table is changed</li>
</ul>
</div>
<p>After creating the image, change the ownership so that the desired user/group has access:
</p>
<p>In order to boot the virtual machine in UEFI mode, a dedicated virtual disk for the <a href="../../EFI_system_partition.html" title="EFI system partition">EFI system partition</a> must be created:
</p>
<pre>$ vboxmanage createmedium disk --filename <i>/path/to/vm/folder/esp.vmdk</i> --size 512 --format VMDK</pre>
<h4><span class="mw-headline" id="Attach_virtual_disk_images_to_the_VM">Attach virtual disk images to the VM</span></h4>
<h5><span class="mw-headline" id="Higher-Security_File_System_Permissions_Configuration">Higher-Security File System Permissions Configuration</span></h5>
<p>Add your user in virtualbox group:
</p>
<pre># usermod -aG vboxusers user
</pre>
<p>Determine the UUID of the targeted disk.
</p>
<pre># udevadm info /dev/sdb | grep UUID
</pre>
<p>Example of output:
</p>
<pre>E: ID_PART_TABLE_UUID=01234567-89ab-cdef-0123-456789abcde
</pre>
<p>Create an udev rule with the found UUID:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/99-vbox.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Rules to give VirtualBox users raw access to Windows disk

# sdb
ENV{ID_PART_ENTRY_TYPE}=="1234567-89ab-cdef-0123-456789abcde", GROUP="vboxusers"</pre>
<h5><span class="mw-headline" id="Lower-Security_File_System_Permissions_Configuration">Lower-Security File System Permissions Configuration</span></h5>
<p>To be able to add the vmdk file in Virtualbox Virtual Media Manager without running VirtualBox as root, the user need to be in <code>vboxusers</code> and <code>disk</code> groups.
</p>
<pre># usermod -aG disk,vboxusers user
</pre>
<p>Once the disk is added to the Virtual Media Manager, it is possible to attach it to a virtual machine through the GUI.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Be aware of the potential security implications of this, as you will probably be giving your user account full read-write access to some or all storage devices.
</div>
<h3><span class="mw-headline" id="Set_up_a_separate_ESP_in_VirtualBox">Set up a separate ESP in VirtualBox</span></h3>
<p>Configure the settings of the virtual machine and add the previously created ESP disk (ie /path/to/vm/folder/esp.vmdk) to the virtual machine.
</p>
<h3><span class="mw-headline" id="Configure_the_virtual_UEFI_firmware_to_use_the_Windows_bootloader">Configure the virtual UEFI firmware to use the Windows bootloader</span></h3>
<p>This will require a Windows Installation disk (successfully tested Windows 10 Pro Build 1903).
</p>
<p>(Note: The following disk order may not matter) Configure the Virtual Machine with the previously created disks as following:
</p>
<ul>
<li>Add the newly created ESP disk as a SATA device (SATA Port 0).</li>
<li>Add the newly created rawdisk as a SATA device (SATA Port 1).</li>
<li>Mount the Windows Installation disk into an optical drive.</li>
</ul>
<p>Start the Virtual Machine and boot from the Windows Installation disk.
</p>
<p>Prior to partitioning and installation, press SHIFT+F10 to launch command prompt from the install media.
</p>
<p>Enter the following commands to create a new GPt partitioned disk (the ESP vmdk), and install the Windows Boot Loader onto it using configuration from the existing Windows partition:
</p>
<p><b>From the Command Prompt, open Diskpart.</b>
</p>
<pre>diskpart
</pre>
<p><b>List all disks identified by the system</b>
</p>
<pre>list disk
</pre>
<p>The desired disk should be 500MB in size and unpartitioned. If the disk order was adhered to as above, it should be <i>disk 0</i>.
</p>
<p><b>Select and use the desired disk</b>
</p>
<p>Here we will use <i>disk 0</i>
</p>
<pre>select disk 0
</pre>
<p><b>Format as UEFI and assign a label and drive letter</b>
</p>
<pre>clean
convert gpt
create partition efi size=100
format quick fs=fat32 label="System"
assign letter="S"
</pre>
<p><b>List all known volumes</b>
</p>
<pre>list volume
exit
</pre>
<p>It is likely that the original Windows partition will be listed as <i>C</i> here.
Our newly created UEFI boot partition will be labelled as <i>S</i> with <i>System</i>.
</p>
<p><b>Installed the Windows Boot Loader onto UEFI disk</b>
</p>
<p>Again, assuming out original Windows install is detected as 'C' and our new UEFI disk is 'S'
</p>
<pre>C:
cd C:\Windows\System32
bcdboot C:\Windows /s S: /f UEFI
</pre>
<p>Now simply detach the Windows Installation disk from the VM and reboot.
The VM should now boot from the newly installed boot partition on ESP vmdk, and load the original Windows installation. It may display 'detecting disks' for a short while prior to booting up.
</p>
<h2><span class="mw-headline" id="Run_an_entire_physical_disk_in_Virtualbox">Run an entire physical disk in Virtualbox</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You may refer to Virtualbox official documentation <a rel="nofollow"  href="https://www.virtualbox.org/manual/ch09.html#rawdisk">9.8.1. Using a Raw Host Hard Disk From a Guest</a>.</div>
<p>This works the same way as <a href="#Run_a_Windows_partition_in_VirtualBox">#Run a Windows partition in VirtualBox</a> but the vmdk will contain the entire disk rather than one partion, and so you won't need to create a separate ESP or MBR partition as the one in the physical disk will be used.
</p>
<p>Create the raw disk:
</p>
<pre># VBoxManage internalcommands createrawvmdk -filename /path/to/file.vmdk -rawdisk /dev/sdb
</pre>
<p>Then follow the same method as in <a href="#Run_a_Windows_partition_in_VirtualBox">#Run a Windows partition in VirtualBox</a> for the configuration and virtual disk attachement.
</p>
<h2><span class="mw-headline" id="Set_guest_starting_resolution">Set guest starting resolution</span></h2>
<p>You can change the BIOS/UEFI booting resolution using <code>VBoxManage</code> tool. For example:
</p>
<pre>$ VBoxManage setextradata "Your Virtual Machine Name" "VBoxInternal2/EfiGraphicsResolution" "2560x1440"
</pre>
<p>Recommended resolutions are 1280x720, 1920x1080, 2048x1080, 2560x1440, 3840x2160, 1280x800, 1280x1024, 1440x900, 1600x900.
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:Hypervisors.html" title="Category:Hypervisors">Hypervisors</a></li></ul>
</div></div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=VirtualBox/Tips_and_tricks&amp;oldid=588968">https://wiki.archlinux.org/index.php?title=VirtualBox/Tips_and_tricks&amp;oldid=588968</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 16 November 2019, at 00:06.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Conky/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../Conky.html" title="Conky">Conky</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../../Conky.html" title="Conky">Conky</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../../Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Conky's configuration changed and it is unknown if all of these tips migrated from the main article are still working/relevant. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Conky/Tips_and_tricks">Talk:Conky/Tips and tricks#</a>)</div>
</div>
<p>Go back to <a href="../../Conky.html" title="Conky">Conky</a>.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Display_package_update_information"><span >1</span> <span >Display package update information</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Display_log_files"><span >2</span> <span >Display log files</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Display_weather_forecast"><span >3</span> <span >Display weather forecast</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Display_a_countdown_timer"><span >4</span> <span >Display a countdown timer</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Display_RSS_feeds"><span >5</span> <span >Display RSS feeds</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Display_a_calendar_for_the_current_month"><span >6</span> <span >Display a calendar for the current month</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Display_rTorrent_stats"><span >7</span> <span >Display rTorrent stats</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Display_your_WordPress_blog_stats"><span >8</span> <span >Display your WordPress blog stats</span></a></li>
<li class="toclevel-1 tocsection-9">
<a href="#Display_number_of_new_emails"><span >9</span> <span >Display number of new emails</span></a>
<ul>
<li class="toclevel-2 tocsection-10">
<a href="#Gmail"><span >9.1</span> <span >Gmail</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#method_1"><span >9.1.1</span> <span >method 1</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#method_2"><span >9.1.2</span> <span >method 2</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#method_3"><span >9.1.3</span> <span >method 3</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#IMAP_+_SSL_using_Perl"><span >9.1.4</span> <span >IMAP + SSL using Perl</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#IMAP_using_PHP"><span >9.1.5</span> <span >IMAP using PHP</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Show_graphic_of_active_network_interface"><span >10</span> <span >Show graphic of active network interface</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#User-contributed_configuration_examples"><span >11</span> <span >User-contributed configuration examples</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Display_package_update_information">Display package update information</span></h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> provides a script called <code>checkupdates</code> which displays package updates from the official repos. Use <code>${execi 3600 checkupdates | wc -l}</code> to display the total number of packages.
</p>
<h2><span class="mw-headline" id="Display_log_files">Display log files</span></h2>
<p>One of the nice features of <i>conky</i> is to pipe to your desktop some <code>/var/log/</code> files to read all kinds of log messages. Most of these files can only be read by <code>root</code>, but running <i>conky</i> as <code>root</code> is not recommended, so you will need to add <code><i>username</i></code> to the <code>log</code> group:
</p>
<pre># usermod -aG log <i>username</i>
</pre>
<h2><span class="mw-headline" id="Display_weather_forecast">Display weather forecast</span></h2>
<p>See <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=37381">this thread</a>.
</p>
<p>Another weather script in lua: <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=222998">here</a>
</p>
<h2><span class="mw-headline" id="Display_a_countdown_timer">Display a countdown timer</span></h2>
<p><a rel="nofollow"  href="https://github.com/orschiro/scriptlets/tree/master/ConkyTimer">ConkyTimer</a> is a simple countdown timer that displays the remaining time of a defined task.
</p>
<p>Start the timer using <code>conkytimer "&lt;task description&gt;" &lt;min&gt;</code>.
</p>
<h2><span class="mw-headline" id="Display_RSS_feeds">Display RSS feeds</span></h2>
<p><i>Conky</i> has the ability to display RSS feeds natively without the need for an outside script to run and output into Conky. For example, to display the titles of the ten most recent Planet TOS updates and refresh the feed every minute, you would put this into your <code>conky.conf</code> in the <code>TEXT</code> section:
</p>
<pre>${rss <a rel="nofollow"  href="https://planet.archlinux.org/rss20.xml">https://planet.archlinux.org/rss20.xml</a> 1 item_titles 10 }
</pre>
<p>If you want to display TOS Forum rss feed, add this line:
</p>
<pre>${rss <a rel="nofollow"  href="https://bbs.archlinux.org/extern.php?action=feed&amp;type=rss">https://bbs.archlinux.org/extern.php?action=feed&amp;type=rss</a> 1 item_titles 4}
</pre>
<p>where 1 is in minutes the refresh interval (15 mn is default),4 the number of items you wish to show.
</p>
<h2><span class="mw-headline" id="Display_a_calendar_for_the_current_month">Display a calendar for the current month</span></h2>
<p>You can use the following lua script to display a calendar. It uses <code>color1</code> and the default color from your configuration. It looks best with a monospace font.
</p>
<pre> #!/usr/bin/env lua
 
 conky_color = "${color1}%2d${color}"
 
 t = os.date('*t', os.time())
 year, month, currentday = t.year, t.month, t.day
 
 daystart = os.date("*t",os.time{year=year,month=month,day=01}).wday
 
 month_name = os.date("%B")
 
 days_in_month = {
     31, 28, 31, 30, 31, 30, 
     31, 31, 30, 31, 30, 31
 }
 
 -- check for leap year
 -- Any year that is evenly divisible by 4 is a leap year
 -- Any year that is evenly divisible by 100 is a leap year if
 -- it is also evenly divisible by 400.
 LeapYear = function (year)
     return year % 4 == 0 and (year % 100 ~= 0 or year % 400 == 0)
 end
 
 if LeapYear(year) then
     days_in_month[2] = 29
 end
 
 title_start = (20 - (string.len(month_name) + 5)) / 2
 
 title = string.rep(" ", math.floor(title_start+0.5)) .. -- add padding to center the title
         (" %s %s\n Su Mo Tu We Th Fr Sa\n"):format(month_name, year)
 
 io.write(title)
 
 function seq(a,b)
     if a &gt; b then
         return
     else
         return a, seq(a+1,b)
     end 
 end
 
 days = days_in_month[month]
 
 io.write(
     string.format(
         string.rep("   ", daystart-1) ..
         string.rep(" %2d", days), seq(1,days)
     ):gsub(string.rep(".",21),"%0\n")
      :gsub(("%2d"):format(currentday),
            (conky_color):format(currentday)
      ) .. "\n"
 )
</pre>
<p>Inside your <code>conky.conf</code> you can then place the following, making sure the path matches where you saved the script.
</p>
<pre> conky.text = [[
 ${execpi 3600 ~/.config/conky/cal.lua}
 ]]
</pre>
<h2><span class="mw-headline" id="Display_rTorrent_stats">Display rTorrent stats</span></h2>
<p>See <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=67304">this thread</a>.
</p>
<h2><span class="mw-headline" id="Display_your_WordPress_blog_stats">Display your WordPress blog stats</span></h2>
<p>This can be achieved by using the in python written extension named <a rel="nofollow"  href="http://evilshit.wordpress.com/2013/04/20/conkypress-a-wordpress-stats-visualization-tool-for-your-desktop/">ConkyPress</a>.
</p>
<h2><span class="mw-headline" id="Display_number_of_new_emails">Display number of new emails</span></h2>
<p>Conky has built in support for IMAP and POP3, but does not have support for access over ssl. Conky's FAQ recommends using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=stunnel">stunnel</a></span> for this and has an example configuration <a rel="nofollow"  href="http://conky.sourceforge.net/faq.html#Conky's-built-in-IMAP-and-POP3-doesn't-support-SSL-or-TLS/">here</a>.
</p>
<p>Modify <code>/etc/stunnel/stunnel.conf</code> as follows, and then <a href="../../Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> <code>stunnel.service</code>:
</p>
<ol><li>Service-level configuration for TLS server</li></ol>
<pre>[imap]
client = yes
accept  = 143
connect = imap.gmail.com:143
protocol = imap
sslVersion = TLSv1
# Service-level configuration for SSL server
[imaps]
client = yes
accept  = 993
connect = imap.gmail.com:993
</pre>
<p>Then add the following to <code>conky.conf</code>:
</p>
<pre>conky.config = {
    imap = "localhost username password [-i 120] [-f 'inbox'] [-p 993]",
}
</pre>
<pre>conky.text {
    Inbox: ${imap_unseen}/${imap_messages}
}
</pre>
<h3><span class="mw-headline" id="Gmail">Gmail</span></h3>
<p>If you use 2-factor authentication, you need to use an <a rel="nofollow"  href="https://myaccount.google.com/apppasswords">App Password</a>.
</p>
<p>For method 1, 2 and 3:
</p>
<p>Create one of the following files in a convenient location (for example in <code>~/.scripts/</code>).
</p>
<p>Then add the following string to your <code>conky.conf</code> in order the check your Gmail account for new email every five minutes (300 seconds) and display:
</p>
<pre>${execi 300 python ~/.scripts/gmail.py}
</pre>
<h4><span class="mw-headline" id="method_1">method 1</span></h4>
<p>This script uses retrieves the number of new email via Gmail's Atom API.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gmail.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env python3

import urllib.request

email = 'your email'
password = 'your password'

# Set up authentication for gmail
auth_handler = urllib.request.HTTPBasicAuthHandler()
auth_handler.add_password(realm='mail.google.com',
                          uri='https://mail.google.com/',
                          user=email,
                          passwd=password)
opener = urllib.request.build_opener(auth_handler)
# ...and install it globally so it can be used with urlopen.
urllib.request.install_opener(opener)

gmailurl = 'https://mail.google.com/gmail/feed/atom'
with urllib.request.urlopen(gmailurl) as page:
    contents = page.read().decode('utf-8')

ifrom = contents.index('&lt;fullcount&gt;') + 11
ito   = contents.index('&lt;/fullcount&gt;')

fullcount = contents[ifrom:ito]

print('{} new emails'.format(fullcount))

</pre>
<h4><span class="mw-headline" id="method_2">method 2</span></h4>
<p>Same as method 1, but does proper XML parsing.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gmail.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env python3

import urllib.request
from xml.etree import ElementTree as etree

email = 'your email'
password = 'your password'

# Set up authentication for gmail
auth_handler = urllib.request.HTTPBasicAuthHandler()
auth_handler.add_password(realm='mail.google.com',
                          uri='https://mail.google.com/',
                          user=email,
                          passwd=password)
opener = urllib.request.build_opener(auth_handler)
# ...and install it globally so it can be used with urlopen.
urllib.request.install_opener(opener)

gmailurl = 'https://mail.google.com/gmail/feed/atom'
NS = '{http://purl.org/atom/ns#}'
with urllib.request.urlopen(gmailurl) as source:
    tree = etree.parse(source)
fullcount = tree.find(NS + 'fullcount').text

print('{} new emails'.format(fullcount))
</pre>
<h4><span class="mw-headline" id="method_3">method 3</span></h4>
<p>The same way, but with using <code>curl</code>, <code>grep</code> and <code>sed</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gmail.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/sh

curl -s -u <b>email</b>:<b>password</b> https://mail.google.com/mail/feed/atom | grep fullcount | sed 's/&lt;[^0-9]*&gt;//g'
</pre>
<p>replace <i>email</i> and <i>password</i> with your data.
</p>
<h4>
<span id="IMAP_.2B_SSL_using_Perl"></span><span class="mw-headline" id="IMAP_+_SSL_using_Perl">IMAP + SSL using Perl</span>
</h4>
<p><i>Conky</i> has built in support for IMAP accounts but does not support SSL. This can be provided using this script from <a rel="nofollow"  href="http://www.unix.com/shell-programming-scripting/115322-perl-conky-gmail-imap-unread-message-count.html">this forum post</a>. This requires the Perl/CPAN Modules Mail::IMAPClient and IO::Socket::SSL which are in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/perl-mail-imapclient/">perl-mail-imapclient</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=perl-io-socket-ssl">perl-io-socket-ssl</a></span> packages
</p>
<p>Create a file named <code>imap.pl</code> in a location to be read by <i>conky</i> (for example in <code>~/.scripts/</code>). In this file, add (with the appropriate changes):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">imap.pl</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/perl
 
# by gxmsgx
# description: get the count of unread messages on imap

use strict;
use Mail::IMAPClient;
use IO::Socket::SSL;

my $username = 'example.username'; 
my $password = 'password123'; 

my $socket = IO::Socket::SSL-&gt;new(
  PeerAddr =&gt; 'imap.server',
  PeerPort =&gt; 993
 )
 or die "socket(): $@";
 
my $client = Mail::IMAPClient-&gt;new(
  Socket   =&gt; $socket,
  User     =&gt; $username,
  Password =&gt; $password,
 )
 or die "new(): $@";
 
if ($client-&gt;IsAuthenticated()) {
  my $msgct;

  $client-&gt;select("INBOX");
  $msgct = $client-&gt;unseen_count||'0';
  print "$msgct\n";
}

$client-&gt;logout();
</pre>
<p>Add to <code>conky.conf</code>:
</p>
<pre>${execi 300 ~/.scripts/imap.pl} 
</pre>
<p>or wherever you saved the file.
</p>
<p>If you use Gmail you might need to <a rel="nofollow"  href="http://www.google.com/accounts/IssuedAuthSubTokens?hide_authsub=1">generate</a> an application specific password.
</p>
<p>Alternatively, you can use stunnel as shown above: <a href="#Gmail">#Gmail</a>
</p>
<h4><span class="mw-headline" id="IMAP_using_PHP">IMAP using PHP</span></h4>
<p>Another alternative using PHP. PHP needs to be installed and <code>extension=imap</code> must be uncommented in <code>/etc/php/php.ini</code>.
</p>
<p>Then create a file named <code>imap.php</code> in a location to be read by <i>conky</i> (for example in <code>~/.scripts/</code>). Make the file executable:
</p>
<pre>$ chmod +x imap.php
</pre>
<p>In this file, add (with the appropriate changes):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">imap.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/php
&lt;?php
// See http://php.net/manual/function.imap-open.php for more information about
// the mailbox string in the first parameter of imap_open.
// This example is ready to use with Office 365 Exchange Mails,
// just replace your username (=email address) and the password.
$mbox = imap_open("{outlook.office365.com:993/imap/ssl/novalidate-cert}", "username", "password");

// Total number of emails
$nrTotal = imap_num_msg($mbox);
 
// Number of unseen emails. There are other ways using imap_status to count
// unseen messages, but they don't work with Office 365 Exchange. This one does.
$unseen = imap_search($mbox, 'UNSEEN');
$nrUnseen = $unseen ? count($unseen) : 0;
 
// Display the result, format as you like.
echo $nrUnseen.'/'.$nrTotal;
 
// Not needed, because the connection is closed after the script end.
// For the sake of clean public available scripts, we are nice to
// the imap server and close the connection manually.
imap_close($mbox);
</pre>
<p>Add to <code>conky.conf</code>:
</p>
<pre>${execi 300 ~/.scripts/imap.php} 
</pre>
<p>or wherever you saved the file.
</p>
<p>This script displays A/B where A is the number of unseen emails and B is the total number of mails in the mailbox. There are a lot of other information available through a lot of PHP functions like with imap_Status (<a rel="nofollow"  href="http://php.net/manual/function.imap-status.php">http://php.net/manual/function.imap-status.php</a>). Just see the PHP docs about IMAP: <a rel="nofollow"  href="http://php.net/manual/ref.imap.php">http://php.net/manual/ref.imap.php</a>.
</p>
<h2><span class="mw-headline" id="Show_graphic_of_active_network_interface">Show graphic of active network interface</span></h2>
<p>To test if a network inferface is currently active, you can use the test conky variable <code> if_existing</code> on the <code> operstate</code> of the interface. Here's an example for wlo1 :
</p>
<pre>draw_graph_borders yes 
${if_existing /sys/class/net/wlo1/operstate up}
${color #0077ff}Net Down:$color ${downspeed wlo1}      ${color #0077ff}Net Up:$color ${upspeed wlo1}
${color #0077ff}${downspeedgraph wlo1 32,155 104E8B 0077ff} $alignr${color #0077ff}${upspeedgraph wlo1 32,155 104E8B 0077ff}
${endif}
</pre>
<p>This is the expected result :
</p>
<p><a rel="nofollow"  href="http://i.imgur.com/pQQbsP6.png">http://i.imgur.com/pQQbsP6.png</a>
</p>
<h2><span class="mw-headline" id="User-contributed_configuration_examples">User-contributed configuration examples</span></h2>
<ul><li>A sample rings script with nvidia support - <a rel="nofollow"  href="https://gist.github.com/anonymous/85d052c0c23e58bc3666">gist</a>
</li></ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:System_monitors.html" title="Category:System monitors">System monitors</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Conky/Tips_and_tricks&amp;oldid=548937">https://wiki.archlinux.org/index.php?title=Conky/Tips_and_tricks&amp;oldid=548937</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 20 October 2018, at 17:13.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">rxvt-unicode/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../Rxvt-unicode.html" title="Rxvt-unicode">Rxvt-unicode</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>See <a href="../../Rxvt-unicode.html" title="Rxvt-unicode">rxvt-unicode</a> for the main article.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Improved_Kuake-like_behavior_in_Openbox"><span >1</span> <span >Improved Kuake-like behavior in Openbox</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Scriptlets"><span >1.1</span> <span >Scriptlets</span></a></li>
<li class="toclevel-2 tocsection-3">
<a href="#urxvtq_with_tabbing"><span >1.2</span> <span >urxvtq with tabbing</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Tab_control"><span >1.2.1</span> <span >Tab control</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="#Openbox_configuration"><span >1.3</span> <span >Openbox configuration</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Further_configuration"><span >1.4</span> <span >Further configuration</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Related_scripts"><span >1.5</span> <span >Related scripts</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#Improving_performance"><span >2</span> <span >Improving performance</span></a>
<ul>
<li class="toclevel-2 tocsection-9">
<a href="#Daemon-client"><span >2.1</span> <span >Daemon-client</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#Xinitrc"><span >2.1.1</span> <span >Xinitrc</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#systemd"><span >2.1.2</span> <span >systemd</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Advanced_tab_management"><span >3</span> <span >Advanced tab management</span></a></li>
<li class="toclevel-1 tocsection-13">
<a href="#Transparency"><span >4</span> <span >Transparency</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#True_transparency"><span >4.1</span> <span >True transparency</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Native_transparency"><span >4.2</span> <span >Native transparency</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Set_icon"><span >5</span> <span >Set icon</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Use_urxvt_as_application_launcher"><span >6</span> <span >Use urxvt as application launcher</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Xterm_escape_sequences"><span >7</span> <span >Xterm escape sequences</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#Bidirectional_support"><span >8</span> <span >Bidirectional support</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Bell_Command"><span >9</span> <span >Bell Command</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Improved_Kuake-like_behavior_in_Openbox">Improved Kuake-like behavior in Openbox</span></h2>
<p>This was originally posted on the forum by Xyne <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?pid=550380">[1]</a>, and it relies on the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xdotool">xdotool</a></span> found in the <a href="../../Official_repositories.html" title="Official repositories">official repositories</a>.
</p>
<h3><span class="mw-headline" id="Scriptlets">Scriptlets</span></h3>
<p>Save this scriptlet from the <code>urxvtc</code> man page somewhere on your system as <code>urxvtc</code> (e.g., in <code>~/.config/openbox</code>):
</p>
<pre>#!/bin/sh

urxvtc "$@"
if [ $? -eq 2 ]; then
   urxvtd -q -o -f
   urxvtc "$@"
fi
</pre>
<p>and save this one as <code>urxvtq</code>:
</p>
<pre>#!/bin/bash

wid=$(xdotool search --classname urxvtq)
if [ -z "$wid" ]; then
  /path/to/urxvtc -name urxvtq -geometry 80x28
  wid=$(xdotool search --classname urxvtq | head -1)
  xdotool windowfocus "$wid"
  xdotool key Control_L+l
else
  if [ -z "$(xdotool search --onlyvisible --classname urxvtq 2&gt;/dev/null)" ]; then
    xdotool windowmap "$wid"
    xdotool windowfocus "$wid"
  else
    xdotool windowunmap "$wid"
  fi
fi
</pre>
<p>Make sure that you change <code>/path/to/urxvtc</code> to the actual path to the <code>urxvtc</code> scriptlet that you saved above. We will be using <code>urxvtc</code> to launch both regular instances of <code>urxvt</code> and the kuake-like instance.
</p>
<h3><span class="mw-headline" id="urxvtq_with_tabbing">urxvtq with tabbing</span></h3>
<p>If you want to have tabs in your kuake-like <code>urxvtc</code> (here called <code>urxvtq</code>) just replace the third line in your <code>urxvtq</code>:
</p>
<pre>wid=$(xdotool search --classname urxvtq)
</pre>
<p>with:
</p>
<pre>wid=$(xdotool search --classname urxvtq | grep -m 1 "" )
</pre>
<p>To activate tab support, you can either replace the fifth line of your <code>urxvtq</code>:
</p>
<pre>/path/to/urxvtc -name urxvtq -geometry 80x28
</pre>
<p>with:
</p>
<pre>/path/to/urxvtc -name urxvtq -pe tabbed -geometry 80x28
</pre>
<p>or replace this line of your <code>~/.Xresources</code> file:
</p>
<pre>URxvt.perl-ext-common: default,matcher
</pre>
<p>with
</p>
<pre>URxvt.perl-ext-common: default,matcher,tabbed
</pre>
<h4><span class="mw-headline" id="Tab_control">Tab control</span></h4>
<table >
<tbody>
<tr>
<th>Key</th>
<th>Description
</th>
</tr>
<tr>
<td>Shift+Left</td>
<td>Switch to the tab left of the current one
</td>
</tr>
<tr>
<td>Shift+Right</td>
<td>Switch to the tab right of the current one
</td>
</tr>
<tr>
<td>Shift+Down</td>
<td>Create a new tab
</td>
</tr>
</tbody>
</table>
<p>You can also use your mouse to switch the tabs by clicking the wished one and create a new tab by clicking on <i>[NEW].\\</i>
</p>
<p>To close a tab just enter <code>exit</code> like you would to normally close a terminal.
</p>
<h3><span class="mw-headline" id="Openbox_configuration">Openbox configuration</span></h3>
<p>Now add the following lines to the <code>&lt;applications&gt;</code> section of <code>~/.config/openbox/rc.xml</code>:
</p>
<pre>&lt;application name="urxvtq"&gt;
   &lt;decor&gt;no&lt;/decor&gt;
   &lt;position force="yes"&gt;
     &lt;x&gt;center&lt;/x&gt;
     &lt;y&gt;0&lt;/y&gt;
   &lt;/position&gt;
   &lt;desktop&gt;all&lt;/desktop&gt;
   &lt;layer&gt;above&lt;/layer&gt;
   &lt;skip_pager&gt;yes&lt;/skip_pager&gt;
   &lt;skip_taskbar&gt;yes&lt;/skip_taskbar&gt;
   &lt;maximized&gt;Horizontal&lt;/maximized&gt;
&lt;/application&gt;</pre>
<p>and add these lines to the <code>&lt;keyboard&gt;</code> section:
</p>
<pre>&lt;keybind key="W-t"&gt;
  &lt;action name="Execute"&gt;
    &lt;command&gt;/path/to/urxvtc&lt;/command&gt;
  &lt;/action&gt;
&lt;/keybind&gt;
&lt;keybind key="W-grave"&gt;
  &lt;action name="Execute"&gt;
    &lt;execute&gt;/path/to/urxvtq&lt;/execute&gt;
  &lt;/action&gt;
&lt;/keybind&gt;</pre>
<p>Here too you need to change the <code>/path/to/*</code> lines to point to the scripts that you saved above. Save the file and then reconfigure Openbox. You should now be able to launch regular instances of urxvt with <code>Super+T</code>, and toggle the kuake-like console with <code>Super+<b>`</b></code> (the grave key also known as the backtick).
</p>
<h3><span class="mw-headline" id="Further_configuration">Further configuration</span></h3>
<p>The advantage of this configuration over the urxvt kuake Perl script is that Openbox provides more keybinding options such as modifier keys. The kuake script hijacks an entire physical key regardless of any modifier combination. Review the <a rel="nofollow"  href="http://openbox.org/wiki/Help:Bindings">Openbox bindings documentation</a> for the full range or possibilities.
</p>
<p>The <a rel="nofollow"  href="http://openbox.org/wiki/Help:Applications">Openbox per-app settings</a> can be used to further configure the behavior of the kuake-like console (e.g. screen position, layer, etc.). You may need to change the "geometry" parameter in the <code>urxvtq</code> scriptlet to adjust the height of the console.
</p>
<h3><span class="mw-headline" id="Related_scripts">Related scripts</span></h3>
<ul>
<li>hbekel has posted a generalized version of the <code>urxvtq</code> <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?pid=550380#p550380">here</a> which can be used to toggle any application using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xdotool">xdotool</a></span>.</li>
<li>
<a rel="nofollow"  href="http://www.jukie.net/~bart/blog/20070503013555">http://www.jukie.net/~bart/blog/20070503013555</a> - A script for opening URLs with your keyboard instead of mouse with urxvt.</li>
</ul>
<h2><span class="mw-headline" id="Improving_performance">Improving performance</span></h2>
<ul>
<li>Avoid the use of Xft fonts. If Xft fonts must be used, append <code>:antialias=false</code> to the setting value.<a rel="nofollow"  href="http://pod.tst.eu/http://cvs.schmorp.de/rxvt-unicode/doc/rxvt.7.pod#Can_I_speed_up_Xft_rendering_somehow">[2]</a>
</li>
<li>Build rxvt-unicode with disabled support for unnecessary features, <code>--disable-xft</code> and <code>--disable-unicode3</code> in particular.<sup><a rel="nofollow"  href="http://pod.tst.eu/http://cvs.schmorp.de/rxvt-unicode/doc/rxvt.7.pod#Rxvt_unicode_uses_gobs_of_memory_how">[3]</a></sup>
</li>
<li>Limit the number of <code>saveLines</code> (option <code>-sl</code>) in the scrollback buffer to reduce memory usage. <a rel="nofollow"  href="http://pod.tst.eu/http://cvs.schmorp.de/rxvt-unicode/doc/rxvt.7.pod#Isn_t_rxvt_unicode_supposed_to_be_sm">[4]</a>
<ul><li>Use tmux for scrollback buffer and set saveLines to 0</li></ul>
</li>
<li><a href="../../Rxvt-unicode.html#Disabling_Perl_extensions" title="Rxvt-unicode">Disable perl</a></li>
<li>Consider running <code>urxvtd</code> as a daemon accepting connections from <code>urxvtc</code> clients.</li>
</ul>
<h3><span class="mw-headline" id="Daemon-client">Daemon-client</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If the server crashes, all processes in the clients are terminated. For example, <i>xkill</i> and server resets/restarts will kill the urxvtd instance including all windows it has opened. See <span class="plainlinks archwiki-template-man" title="$ man 1 urxvtd"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/urxvtd.1">urxvtd(1)</a></span> for details.</div>
<h4><span class="mw-headline" id="Xinitrc">Xinitrc</span></h4>
<p>See the <i>Examples</i> section in <span class="plainlinks archwiki-template-man" title="$ man 1 urxvtd"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/urxvtd.1">urxvtd(1)</a></span>. This is the preferred option.
</p>
<h4><span class="mw-headline" id="systemd">systemd</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Regular users cannot execute systemctl power commands (reboot, poweroff, etc) when logged in to a urxvt client/daemon setup which is started through systemd, as the client is not part of the <a href="../../General_troubleshooting.html#Session_permissions" class="mw-redirect" title="Session">session</a>. For this reason starting urxvt through systemd is discouraged.</div>
<p>System service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/urxvtd@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=RXVT-Unicode Daemon

[Service]
User=%i
ExecStart=/usr/bin/urxvtd -q -o

[Install]
WantedBy=multi-user.target
</pre>
<p>Pass the username when <a href="../../Systemd.html#Using_units" title="Systemd">starting the service</a>:
</p>
<pre>urxvtd@<i>username</i>.service
</pre>
<p>For a <a href="../../Systemd/User.html" title="Systemd/User">systemd/User</a> service, place the following unit files in <code>~/.config/systemd/user</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">urxvtd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Urxvt Terminal Daemon
Requires=urxvtd.socket

[Service]
ExecStart=/usr/bin/urxvtd -o -q
Environment=RXVT_SOCKET=%t/urxvtd-%H

[Install]
WantedBy=<i>MyTarget</i>.target
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">urxvtd.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=urxvt daemon (socket activation)
Documentation=man:urxvtd(1) man:urxvt(1)

[Socket]
ListenStream=%t/urxvtd-%H

[Install]
WantedBy=sockets.target
</pre>
<h2><span class="mw-headline" id="Advanced_tab_management">Advanced tab management</span></h2>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/urxvt-tabbedex/">urxvt-tabbedex</a></span><sup><small>AUR</small></sup> package from <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>, then add the <code>tabbedex</code> value to the <code>URxvt.perl-ext-common</code> X resource in your <code>~/.Xresources</code>:
</p>
<pre>URxvt.perl-ext-common: ...,tabbedex,...
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have previously used the <code>tabbed</code> Perl extension and have defined the <code>tabbed</code> value for the <code>URxvt.perl-ext-common</code> X resource, please remove the <code>tabbed</code> value first to avoid conflict with <code>tabbedex</code>.</div>
<p>By default, the "[NEW]" button (which is rarely used and usable only with the mouse) is disabled with tabbedex. You can reenable this feature by setting the <code>new-button</code> to yes.
</p>
<pre>URxvt.tabbed.new-button: true
</pre>
<p>Tabs can be named with <code>Shift+ ↑</code> (<code>Enter</code> to confirm, <code>Escape</code> to cancel).
</p>
<p>To automatically hide the tabs bar when only one tab is present, enable the following resource:
</p>
<pre>URxvt.tabbed.autohide: true
</pre>
<p>To prevent the last tab from closing Urxvt, enable the following resource:
</p>
<pre>URxvt.tabbed.reopen-on-close: yes
</pre>
<p>To start a new tab or cycle through tabs, use the following user commands: <code>tabbedex:(new|next|prev)_tab</code>. Example of mappings:
</p>
<pre>URxvt.keysym.Control-t: perl:tabbedex:new_tab
URxvt.keysym.Control-Tab: perl:tabbedex:next_tab
URxvt.keysym.Control-Shift-Tab: perl:tabbedex:prev_tab
</pre>
<p>To define your own key bindings to rename a tab or move a tab to the right or to the left, use the following commands: <code>tabbedex:move_tab_(left|right)</code> and <code>tabbedex:rename_tab</code>. Example of mappings:
</p>
<pre>URxvt.keysym.Control-Shift-Left: perl:tabbedex:move_tab_left
URxvt.keysym.Control-Shift-Right: perl:tabbedex:move_tab_right
URxvt.keysym.Control-Shift-R: perl:tabbedex:rename_tab
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Redefining the keys used for the user commands will not disable the default mappings, you have to set the X resource <code>no-tabbedex-keys</code> for that. However, currently it is not included in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/urxvt-tabbedex/">urxvt-tabbedex</a></span><sup><small>AUR</small></sup> package. Consider using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/urxvt-tabbedex-git/">urxvt-tabbedex-git</a></span><sup><small>AUR</small></sup> package instead:
<pre>URxvt.tabbed.no-tabbedex-keys: true
</pre>
</div>
<h2><span class="mw-headline" id="Transparency">Transparency</span></h2>
<h3><span class="mw-headline" id="True_transparency">True transparency</span></h3>
<p>To use true transparency, you need to be using a <a href="../../Window_manager.html" title="Window manager">window manager</a> that supports compositing or a separate compositor.
</p>
<p>From the command-line:
</p>
<pre>$ urxvt -depth 32 -bg rgba:3f00/3f00/3f00/dddd
</pre>
<p>Using the configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.Xresources</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">URxvt.depth: 32
URxvt.background: rgba:1111/1111/1111/dddd
</pre>
<p>or
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.Xresources</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">URxvt.depth: 32
URxvt.background: [95]#000000
</pre>
<p>where '95' is the opacity level in percentage and '#000000' is the background color.
</p>
<p>To use a color i.e. #302351 with the rgba:rrrr/gggg/bbbb/aaaa syntax it would be rgba:3000/2300/5100/ee00. "ee00" (the alpha value) to make it nicely transparent.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To make these settings universal for all forms of URxvt, you may add a wildcard. For example, <code>URxvt.depth</code> would become <code>URxvt*depth</code>.</div>
<h3><span class="mw-headline" id="Native_transparency">Native transparency</span></h3>
<p>If there is no need for true transparency, or if compositing uses too many resources on your system, you can get transparency working in the following way:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.Xresources</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">! Xresources file

URxvt*inheritPixmap: true
URxvt*transparent: true
! URxvt*shading: 0 to 99 darkens, 101 to 200 lightens
URxvt*shading: 110
</pre>
<p>Using the URxvt*background setting exemplified above instead of URxvt*shading will also work.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Avoid using shading if you have a <code>URxvt.tintColor</code> set. Use a different <code>tintColor</code> instead.</div>
<h2><span class="mw-headline" id="Set_icon">Set icon</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Because of a bug report (<a rel="nofollow"  href="https://bugs.archlinux.org/task/34862">FS#34862</a>) complaining that the rxvt-unicode package had too many dependencies, you must now install the AUR package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/rxvt-unicode-pixbuf/">rxvt-unicode-pixbuf</a></span><sup><small>AUR</small></sup> in order to use the icon option.</div>
<p>By default URxvt does not feature a taskbar icon. However, this can be easily changed by adding the following line to <code>~/.Xresources</code> and pointing to the desired icon:
</p>
<pre>URxvt.iconFile:    /usr/share/icons/Clarity/scalable/apps/terminal.svg
</pre>
<h2><span class="mw-headline" id="Use_urxvt_as_application_launcher">Use urxvt as application launcher</span></h2>
<p>urxvt can be used as a lightweight alternative to application launchers such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gmrun">gmrun</a></span>. Run urxvt with the following configuration to imitate look and behaviour of an application launcher or assign the command to a custom alias:
</p>
<pre>$ urxvt -geometry 80x3 -name 'bashrun' -e sh -c "/bin/bash -i -t"
</pre>
<h2><span class="mw-headline" id="Xterm_escape_sequences">Xterm escape sequences</span></h2>
<p>It is possible for rxvt-unicode to mimic the <a href="../../Xterm.html" title="Xterm">Xterm</a> escape sequences. These can be found for arbitrary key combinations by running <code>cat -v</code> inside <i>xterm</i>, then bound in <i>urxvt</i> using keysyms.
</p>
<p>Take this word by word movement binding as an example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.Xresources</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">!Xterm escapes, word by word movement
URxvt.keysym.Control-Left:    \033[1;5D
URxvt.keysym.Control-Right:    \033[1;5C
</pre>
<p>For more information, see ascii(7) and the keysym section of the urxvt(1) man page.
</p>
<h2><span class="mw-headline" id="Bidirectional_support">Bidirectional support</span></h2>
<p>It is possible to add bidirectional support for languages like Hebrew or Arabic using the extension: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/urxvt-bidi/">urxvt-bidi</a></span><sup><small>AUR</small></sup><sup>[<a href="../../Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup>.
</p>
<p>After installing it use it by either adding to your <a href="../../X_resources.html" class="mw-redirect" title="Xresources">Xresources</a> file:
</p>
<pre>URxvt.perl-ext: [other extensions],bidi
URxvt.bidi.enabled: 1
</pre>
<p>Or run urxvt as follows:
</p>
<pre>urxvt -pe bidi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The font you're using should support your language. For example, for viewing Hebrew you should use a font like terminus.</div>
<h2><span class="mw-headline" id="Bell_Command">Bell Command</span></h2>
<p>It is possible to execute a shell command when the terminal rings the bell. The pre-packed <code>bell-command</code> extension needs to be enabled first in the <code>~/.Xresources</code> file:
</p>
<pre> URxvt.perl-ext-common: ...,bell-command,...
</pre>
<p>The following example will use <a href="../../Advanced_Linux_Sound_TOSitecture.html" class="mw-redirect" title="ALSA">ALSA</a>'s <code>aplay</code> command to play a <code>.wav</code> file:
</p>
<pre> URxvt.bell-command: aplay /path/to/a/file.wav
</pre>
<p>The following example will use <a href="../../Libcanberra.html" title="Libcanberra">libcanberra</a>'s <code>canberra-gtk-play</code> command to play the bell sound of your current sound theme:
</p>
<pre> URxvt.bell-command: canberra-gtk-play -i bell
</pre>
<p>And the next setting will pop a visual notification:
</p>
<pre> URxvt.bell-command: notify-send "rxvt-unicode: bell!"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Setting the <code>bell-command</code> option alone will not mute the buzzer in your computer, to do that take a look at the <a href="../../PC_speaker.html" title="PC speaker">PC speaker</a> article.</div>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:Terminal_emulators.html" title="Category:Terminal emulators">Terminal emulators</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Rxvt-unicode/Tips_and_tricks&amp;oldid=588587">https://wiki.archlinux.org/index.php?title=Rxvt-unicode/Tips_and_tricks&amp;oldid=588587</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 11 November 2019, at 07:56.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Music Player Daemon/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../Music_Player_Daemon.html" title="Music Player Daemon">Music Player Daemon</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>Go back to <a href="../../Music_Player_Daemon.html" title="Music Player Daemon">Music Player Daemon</a>.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Organizing_library"><span >1</span> <span >Organizing library</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Last.fm/Libre.fm_scrobbling"><span >2</span> <span >Last.fm/Libre.fm scrobbling</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#mpdas"><span >2.1</span> <span >mpdas</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#mpdscribble"><span >2.2</span> <span >mpdscribble</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Sonata"><span >2.3</span> <span >Sonata</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#YAMS"><span >2.4</span> <span >YAMS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Disable_resume_playback_on_startup"><span >3</span> <span >Disable resume playback on startup</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Example_configuration:_Output_with_44.1_KHz_at_e._g._16_bit_depth,_multiple_programs_at_once"><span >4</span> <span >Example configuration: Output with 44.1 KHz at e. g. 16 bit depth, multiple programs at once</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Control_MPD_with_lirc"><span >5</span> <span >Control MPD with lirc</span></a></li>
<li class="toclevel-1 tocsection-10">
<a href="#PulseAudio"><span >6</span> <span >PulseAudio</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Local_(as_your_own_user)"><span >6.1</span> <span >Local (as your own user)</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Local_(with_separate_mpd_user)"><span >6.2</span> <span >Local (with separate mpd user)</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Remote"><span >6.3</span> <span >Remote</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#Cue_Files"><span >7</span> <span >Cue Files</span></a></li>
<li class="toclevel-1 tocsection-15">
<a href="#HTTP_streaming"><span >8</span> <span >HTTP streaming</span></a>
<ul>
<li class="toclevel-2 tocsection-16">
<a href="#Configuration"><span >8.1</span> <span >Configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#Format"><span >8.1.1</span> <span >Format</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-18"><a href="#Use"><span >8.2</span> <span >Use</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-19">
<a href="#Music_streaming_with_the_satellite_setup"><span >9</span> <span >Music streaming with the satellite setup</span></a>
<ul>
<li class="toclevel-2 tocsection-20"><a href="#Topology"><span >9.1</span> <span >Topology</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Configuration_2"><span >9.2</span> <span >Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22">
<a href="#MPRIS2_Support"><span >10</span> <span >MPRIS2 Support</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#mpDris2"><span >10.1</span> <span >mpDris2</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#mpd-mpris"><span >10.2</span> <span >mpd-mpris</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25">
<a href="#Notifications"><span >11</span> <span >Notifications</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#musnify-mpd"><span >11.1</span> <span >musnify-mpd</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#mpd-notification"><span >11.2</span> <span >mpd-notification</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#Adding_a_separate_volume_control_(ALSA)"><span >12</span> <span >Adding a separate volume control (ALSA)</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Organizing_library">Organizing library</span></h2>
<p>MPD does not manage your library. Check out <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=beets">beets</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=picard">picard</a></span> in the <a href="../../Official_repositories.html" title="Official repositories">official repositories</a>.
</p>
<h2>
<span id="Last.fm.2FLibre.fm_scrobbling"></span><span class="mw-headline" id="Last.fm/Libre.fm_scrobbling">Last.fm/Libre.fm scrobbling</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> mpd release 0.18 removed Last.fm <a rel="nofollow"  href="http://git.musicpd.org/cgit/master/mpd.git/tree/NEWS">support</a>. However, some clients offer scrobbling independent of mpd.</div>
<p>To scrobble your songs to <a rel="nofollow"  href="http://www.last.fm">Last.fm</a> or <a rel="nofollow"  href="http://libre.fm">Libre.fm</a> when using MPD, there are several possibilities.
</p>
<h3><span class="mw-headline" id="mpdas">mpdas</span></h3>
<p><a rel="nofollow"  href="http://50hz.ws/mpdas/">mpdas</a> is an AudioScrobbler client for MPD written in C++. It uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=curl">curl</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=libmpd">libmpd</a></span>. mpdas supports the latest AudioScrobbler protocol (2.0) and will also cache unscrobbled plays in <code>~/.mpdascache</code> if there is no network connectivity.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/mpdas/">mpdas</a></span><sup><small>AUR</small></sup> is available in the <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<p>Configuration of mpdas is very simple, see the official <a rel="nofollow"  href="https://github.com/hrkfdn/mpdas/blob/master/README.md">README</a>. A very basic example of <code>/etc/mpdasrc</code> is also available as <code>/etc/mpdasrc</code>.
</p>
<p>Your password can also be in the form of an md5hash:
</p>
<pre>$ echo -n 'PASSWORD' | md5sum | cut -f 1 -d " "
</pre>
<p>To autostart <i>mpdas</i> along with <i>mpd</i>, add an entry for it into the file in which you start <i>mpd</i> (e.g. <a href="../../Xinit.html#xinitrc" class="mw-redirect" title="Xinitrc">xinitrc</a>):
</p>
<pre>[[ -z $(pgrep -xU $UID mpdas) ]] &amp;&amp; mpdas &amp;</pre>
<p>When <i>mpd</i> is started with a <a href="../../Music_Player_Daemon.html#Autostart_with_systemd" title="Music Player Daemon">systemd user service</a>, it is better to start <i>mpdas</i> the same way:
</p>
<pre>$ systemctl --user start mpdas.service
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you get a failed <code>mpdas.service</code> after system startup, consider using <a href="../../Music_Player_Daemon.html#Socket_activation" title="Music Player Daemon">socket activation</a> with <code>mpd.socket</code> instead.</div>
<h3><span class="mw-headline" id="mpdscribble">mpdscribble</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/mpdscribble/">mpdscribble</a></span><sup><small>AUR</small></sup> is a daemon available in the <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>. This is arguably the best alternative, because it is the semi-official MPD scrobbler and uses the new "idle" feature in MPD for more accurate scrobbling. Also, you do not need root access to configure it, because it does not need any changes to <code>/etc</code> at all. Visit <a rel="nofollow"  href="https://www.musicpd.org/clients/mpdscribble/">the official website</a> for more information.
</p>
<p>Example configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mpdscribble/mpdscribble.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[mpdscribble]
host = <i>your mpd host</i>
#host is optional, defaults to $MPD_HOST or localhost
port = <i>your mpd port</i>
#port is optional, defaults to $MPD_PORT or 6600
log = /home/<i>YOUR_USERNAME</i>/.mpdscribble/mpdscribble.log
verbose = 2
proxy = <i>your proxy</i>
# proxy is optional, e. g. <a rel="nofollow"  href="http://your.proxy:8080">http://your.proxy:8080</a>, defaults to none

[last.fm]
# last.fm section, comment if you do not use last.fm
url = <a rel="nofollow"  href="http://post.audioscrobbler.com/">http://post.audioscrobbler.com/</a>
username = <i>your last.fm username</i>
password = <i>your last.fm password</i>
journal = /home/<i>YOUR_USERNAME</i>/.mpdscribble/lastfm.journal

[libre.fm]
# libre.fm section, comment if you do not use libre.fm
url = <a rel="nofollow"  href="http://turtle.libre.fm/">http://turtle.libre.fm/</a>
username = <i>your libre.fm username</i>
password = <i>your libre.fm password</i>
journal = /home/<i>YOUR_USERNAME</i>/.mpdscribble/librefm.journal</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Trailing comments are not supported by its parser. Write them in their own lines.</div>
<p>Your password can also be in the form of an md5hash.
</p>
<pre>echo -n "<i>password</i>" | md5sum | cut -f 1 -d " "
</pre>
<p>To autostart <i>mpdscribble</i> you can use the <code>mpdscribble.service</code> under systemd user instance. See <a href="../../Systemd/User.html" title="Systemd/User">systemd/User</a> for details.
</p>
<p>Alternatively you can autostart <i>mpdscribble</i> along with <i>mpd</i>, add an entry for it into the file in which you start <i>mpd</i> (e.g. <code>~/.xinitrc</code>):
</p>
<pre>[[ -z $(pgrep -xU $UID mpdscribble) ]] &amp;&amp; mpdscribble &amp;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you get a <code>[last.fm] handshake failed, username or password incorrect (BADAUTH)</code> error, make sure your username and password are correct, and that your password is not <a rel="nofollow"  href="http://bugs.musicpd.org/view.php?id=3836">32 characters long</a>.</div>
<h3><span class="mw-headline" id="Sonata">Sonata</span></h3>
<p>Sonata has built-in support for scrobbling, although that requires the program to run the whole time. Additionally, Sonata does not cache the songs if they cannot be forwarded to Last.fm at the time of playing, meaning they will not be added to the statistics.
</p>
<h3><span class="mw-headline" id="YAMS">YAMS</span></h3>
<p><a rel="nofollow"  href="https://github.com/Berulacks/yams/">YAMS</a> is a Last.FM scrobbling daemon for MPD written in Python. 
</p>
<p>As it's written for v2.0 of Last.FM's <a rel="nofollow"  href="https://www.last.fm/api/scrobbling">scrobbling API</a>, YAMS does not store your username or password locally, but opts to use a cookie instead. Similar to other scrobblers, YAMS can save failed scrobbles and upload them at a later date. It also offers a decent amount of configuration options for when/how a scrobble should be made (including ignoring duplicate scrobbles when a track is played multiple times in a row).
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/python-yams/">python-yams</a></span><sup><small>AUR</small></sup> is available in the <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<p>In order to authenticate, the user <i>must</i> run the <code>yams</code> command in an interactive terminal, at least once, and follow the printed instructions. 
</p>
<p>Afterwards, YAMS can be started with its binary:
</p>
<p><code>yams</code> runs as a daemon by default (<code>yams -N</code> will run it in the foreground).
</p>
<p><code>yams -k</code> will kill the current running instance.
</p>
<p><code>yams -a</code> will attach to the current running instance's log file, allowing you to watch the daemon's output.
</p>
<p><code>yams -h</code> will print all command line options.
</p>
<p>YAMS also comes with a systemd service file that can be started with <code>systemctl --user start yams</code> after authentication is complete.
</p>
<h2><span class="mw-headline" id="Disable_resume_playback_on_startup">Disable resume playback on startup</span></h2>
<p>This feature is present in <i>mpd</i> after version 0.16.2. When this feature is enabled, <i>mpd</i> will always start in the "paused" state, even if a song was playing when mpd was stopped. Add the line below to your <code>mpd.conf</code> to enable this feature.
</p>
<pre>restore_paused "yes"
</pre>
<h2>
<span id="Example_configuration:_Output_with_44.1_KHz_at_e._g._16_bit_depth.2C_multiple_programs_at_once"></span><span class="mw-headline" id="Example_configuration:_Output_with_44.1_KHz_at_e._g._16_bit_depth,_multiple_programs_at_once">Example configuration: Output with 44.1 KHz at e. g. 16 bit depth, multiple programs at once</span>
</h2>
<p><i>Why these formats?</i> Because they are the standard format for CD audio, because ALSA on its own allows more than one program "to sound" only with dmix — which uses an inferior resampling algorithm by default — and because dmix by default resamples anything lower to 48 KHz (or whatever higher format is playing at the time). Also, some get clicking sounds if at least <code>mpd.conf</code> is not changed this way.
</p>
<p><i>What is the downside?</i> These settings cause <i>everything</i> (if necessary) to be resampled to this format, such as material from DVD or TV which usually is at 48 KHz. But there is no known way to have ALSA dynamically change the format, and particularly if you listen to far more CDs than anything else the occasional 48 → 44.1 is not too great a loss.
</p>
<p>The following assumes that there are not already other settings which conflict resp. overwrite it. This applies especially to the current user's potential <code>~/.asoundrc</code> — which MPD as its own user ignores, therefore the following should go to <code>/etc/asound.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/asound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">defaults.pcm.dmix.rate 44100 # Force 44.1 KHz
defaults.pcm.dmix.format S16_LE # Force 16 bits
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">audio_output {
        type                    "alsa" # Use the ALSA output plugin.
	name			"your_custom_name" # Must be present and does not have to match the actual card name , e.g. what you have in /etc/asound.conf
        options                 "dev=dmixer"
        device                  "plug:dmix" # Both lines cause MPD to output to dmix
	format	        	"44100:16:2" # the actual format
	auto_resample		"no" # This bypasses ALSA's own algorithms, which generally are inferior. See below how to choose a different one.
}</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> MPD gives the mp3 format a special treatment at decoding: it is always put out as 24 bit. (The conversion as forced by the <i>format</i> line only comes after that.)</div>
<p>If one wants to leave the bit depth decision to ALSA resp. MPD, comment out resp. omit the <i>dmix.format</i> line and change the one for mpd with <i>format</i> to "44100:*:2".
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>Crossfading</i> between files decoded at two different bit depths (say, one mp3 and one 16 bit flac) does not work unless conversion is active.</div>
<h2><span class="mw-headline" id="Control_MPD_with_lirc">Control MPD with lirc</span></h2>
<p>There are already some clients designed for communications between lircd and MPD, however, as far as the practical use, they are not very useful since their functions are limited.
</p>
<p>It is recommended to use mpc with irexec. mpc is a command line player which only sends the command to MPD and exits immediately, which is perfect for irexec, the command runner included in lirc. What irexec does is that it runs a specified command once received a remote control button.
</p>
<p>First of all, please setup your remotes as referred to the <a href="../../LIRC.html" title="LIRC">LIRC</a> article.
</p>
<p>Edit your favored lirc startup configuration file, default location is <code>~/.lircrc</code>.
</p>
<p>Fill the file with the following pattern:
</p>
<pre>begin
     prog = irexec
     button = &lt;button_name&gt;
     config = &lt;command_to_run&gt;
     repeat = &lt;0 or 1&gt;
end
</pre>
<p>An example:
</p>
<pre>## irexec
begin
     prog = irexec
     button = play_pause
     config = mpc toggle
     repeat = 0
end

begin
     prog = irexec
     button = stop
     config = mpc stop
     repeat = 0
end
begin
     prog = irexec
     button = previous
     config = mpc prev
     repeat = 0
end
begin
     prog = irexec
     button = next
     config = mpc next
     repeat = 0
end
begin
     prog = irexec
     button = volup
     config = mpc volume +2
     repeat = 1
end
begin
     prog = irexec
     button = voldown
     config = mpc volume -2
     repeat = 1
end
begin
     prog = irexec
     button = pbc
     config = mpc random
     repeat = 0
end
begin
     prog = irexec
     button = pdvd
     config = mpc update
     repeat = 0
end
begin
     prog = irexec
     button = right
     config = mpc seek +00:00:05
     repeat = 0
end
begin
     prog = irexec
     button = left
     config = mpc seek -00:00:05
     repeat = 0
end
begin
     prog = irexec
     button = up
     config = mpc seek +1%
     repeat = 0
end
begin
     prog = irexec
     button = down
     config = mpc seek -1%
     repeat = 0
end
</pre>
<p>There are more functions for mpc, run <span class="plainlinks archwiki-template-man" title="$ man 1 mpc"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/mpc.1">mpc(1)</a></span> for more info.
</p>
<h2><span class="mw-headline" id="PulseAudio">PulseAudio</span></h2>
<h3>
<span id="Local_.28as_your_own_user.29"></span><span class="mw-headline" id="Local_(as_your_own_user)">Local (as your own user)</span>
</h3>
<p>No special options are required; just add a pulse output as described in the comments of mpd's config file.
</p>
<h3>
<span id="Local_.28with_separate_mpd_user.29"></span><span class="mw-headline" id="Local_(with_separate_mpd_user)">Local (with separate mpd user)</span>
</h3>
<p>When run as its own user as per the wiki instructions, mpd will be unable to send sound to another user's pulseaudio server. Rather than setting up pulseaudio as a system-wide daemon, a practice strongly discouraged by upstream, you can instead configure mpd to use pulseaudio's tcp module to send sound to localhost:
</p>
<p>First, uncomment the tcp module in <code>/etc/pulse/default.pa</code> or <code>$XDG_CONFIG_HOME/pulse/default.pa</code> (typically <code>~/.config/pulse/default.pa</code>) and set 127.0.0.1 as an allowed IP address; the home directory takes precedence:
</p>
<pre>### Network access (may be configured with paprefs, so leave this commented
### here if you plan to use paprefs)
#load-module module-esound-protocol-tcp
load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1
#load-module module-zeroconf-publish
</pre>
<p>Additional IP ranges in cidr notation may be added using <code>;</code> as the separator. Once this is complete, restart pulseaudio:
</p>
<pre>$ pulseaudio --kill
$ pulseaudio --start -or- start-pulseaudio-x11/kde
</pre>
<p>Next, edit <code>/etc/mpd.conf</code> and add a new pulse output pointing to 127.0.0.1 as a "remote" server:
</p>
<pre>audio_output {
       type		"pulse"
       name		"Local Music Player Daemon"
       server		"127.0.0.1"
}
</pre>
<p>Once this is added, restart mpd.
</p>
<p>Enable the output in mpd; you should now have a working local mpd, usable by all users whose pulseaudio servers allow sound from 127.0.0.1.
</p>
<h3><span class="mw-headline" id="Remote">Remote</span></h3>
<p>As with any PulseAudio-enabled program, mpd can send sound over the network. The complete PulseAudio system is not required on the server running mpd; <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=libpulse">libpulse</a></span> is the only requirement to act as a source and is already a dependency of mpd.
</p>
<p>In order to send audio from mpd to another computer follow the directions above, editing <code>/etc/mpd.conf</code> on the server running mpd using the IP address of the target computer and <code>/etc/pulse/default.pa</code> or <code>$XDG_CONFIG_HOME/default.pa</code> (typically <code>~/.config/pulse/default.pa</code>) on the target computer using the IP address of the server.
</p>
<p>Once this is done, the server's mpd source should show up on the target computer while playing or paused as a normal source able to be rerouted and controlled as usual; there will be no visible source on the target while mpd is stopped.
</p>
<h2><span class="mw-headline" id="Cue_Files">Cue Files</span></h2>
<p>No additional steps are needed for cue support in mpd since 0.17. MPD has its own integrated parser which works with both external and embedded cuesheets.
For example, the command <code>mpc load albumx/x.cue</code> loads the file <code><i>music_directory</i>/albumx/x.cue</code> as playlist; or in the case of an CUESHEET tag, <code>mpc load albumx/x.flac</code>.
</p>
<p>Client support of CUE files is a bit limited. Two available programs that do support CUE files are <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=cantata">cantata</a></span> and <a href="../../Ncmpcpp.html" title="Ncmpcpp">ncmpcpp</a>.
</p>
<h2><span class="mw-headline" id="HTTP_streaming">HTTP streaming</span></h2>
<p>Since version 0.15 there is a built-in HTTP streaming daemon/server that comes with MPD. This allows MPD to broadcast its music to HTTP clients.
</p>
<p>This is not meant to be used as a streaming solution (e.g. replacement of Spotify, Deezer, etc.). First, it only allows one stream to be played, and multiple users cannot listen to multiple musics at the same time. Second, MPD buffers audio a lot so that it plays reliably even when the client drops the connection for a while, therefore it introduce a non-negligeable latency when changing songs. To use MPD as a streaming solution, see <a href="#Music_streaming_with_the_satellite_setup">#Music streaming with the satellite setup</a>.
</p>
<h3><span class="mw-headline" id="Configuration">Configuration</span></h3>
<p>To activate this server simply set it as output device in mpd.conf:
</p>
<pre>audio_output {
	type		"httpd"
	name		"My HTTP Stream"
	encoder		"vorbis"		# optional
	port		"8000"
#	quality		"5.0"			# do not define if bitrate is defined
	bitrate		"128"			# do not define if quality is defined
	format		"44100:16:1"
	always_on       "yes"			# prevent MPD from disconnecting all listeners when playback is stopped.
	tags            "yes"			# httpd supports sending tags to listening streams.
}
</pre>
<h4><span class="mw-headline" id="Format">Format</span></h4>
<p>MPD supports several encoding formats. See what your MPD supports with:
</p>
<pre>$ mpd --version
</pre>
<h3><span class="mw-headline" id="Use">Use</span></h3>
<p>Then to listen to this stream simply open the URL of your mpd server (along with the specified port) in your favorite music player. Note: You may have to specify the file format of the stream using an appropriate file extension in the URL. For example, using Winamp 5.5, You would use <a rel="nofollow"  href="http://192.168.1.2:8000/mpd.ogg">http://192.168.1.2:8000/mpd.ogg</a> rather than <a rel="nofollow"  href="http://192.168.1.2:8000/">http://192.168.1.2:8000/</a>.
</p>
<p>To use mpd to connect to the stream from another computer:
</p>
<pre>mpc add <a rel="nofollow"  href="http://192.168.1.2:8000">http://192.168.1.2:8000</a>
</pre>
<h2><span class="mw-headline" id="Music_streaming_with_the_satellite_setup">Music streaming with the satellite setup</span></h2>
<p>While <a href="#HTTP_Streaming">#HTTP Streaming</a> allows the user to broadcast its music over HTTP, the satellite setup allows multiple users to listen to different songs at the same time, on separate machines.
</p>
<h3><span class="mw-headline" id="Topology">Topology</span></h3>
<p>The satellite setup involves two or more machines: a <i>server</i> and multiple <i>clients</i>. The <i>server</i> is typically the machine that has the music files. It runs an MPD instance that will browse these files and build a database. The <i>clients</i> are the machines that will actually play the music (<i>e.g.</i> your phone or your laptop). They will also run MPD instances, though these ones will fetch the database from the <i>server</i> MPD and play the music. You might notice that MPD on the <i>server</i> is not necessary, however it greatly increase the speed to list all songs, as the <i>clients</i> MPD will not have to browse all the files remotely.
</p>
<p>Besides, you will need a way for the <i>server</i> to make the music files available to the <i>clients</i>. MPD supports multiple <a rel="nofollow"  href="https://www.musicpd.org/doc/html/plugins.html#storage-plugins">storage plugins</a> to fetch the music with. For example, if you choose the curl plugin, you will need a <a href="../../WebDAV.html" title="WebDAV">WebDAV</a> server on the <i>server</i>.
</p>
<p>Finally, you will need a secure communication tunnel between the <i>server</i> and each <i>client</i>. This is because the protocol used to control MPD is not encrypted and does not provide authentication. A <a href="../../Category:Virtual_Private_Network.html" class="mw-redirect" title="VPN">VPN</a> or a SSH tunnel will be useful here.
</p>
<h3><span class="mw-headline" id="Configuration_2">Configuration</span></h3>
<p>On the <i>server</i>, write the configuration file for the MPD instance that will build the database:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pid_file            "/run/mpd/mpd.pid"
playlist_directory  "/var/lib/mpd/playlists"
music_directory     "/path/to/your/music/"

database {
    plugin           "simple"
    path             "/var/lib/mpd/mpd.db"
    cache_directory  "/var/lib/mpd/cache"
}

audio_output {
    type  "null"
    name  "<i>This server does not need to play music, but it can</i>"
}
</pre>
<p>Then, setup either the <a href="../../WebDAV.html" title="WebDAV">WebDAV</a> server, the <a href="../../NFS.html" title="NFS">NFS</a> server or the <a href="../../Samba.html" title="Samba">Samba</a> share.
</p>
<p>On each <i>client</i>, write the configuration file for the MPD instance that will play the music:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pid_file            "/run/mpd/mpd.pid"
playlist_directory  "/var/lib/mpd/playlists"

# WebDAV setup
music_directory     "https://<i>optional_user:optional_password@example.com/path/to/your/music/</i>"

# NFS setup
music_directory     "nfs://<i>example.com/path/to/your/music/</i>"

# Samba setup
music_directory     "smb://<i>example.com/path/to/your/music/</i>"

# Note the proxy here
database {
    plugin  "proxy"
    host    "<i>example.com</i>"
    port    "6600"
}

audio_output {
    type  "alsa"
    name  "<i>Some output name</i>"
}
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On Android the configuration file needs to be at the root of the user storage, alongside the <code>Android</code> folder. Also, files MPD writes to need to lie in the application folder, generally in <code>/data</code>. For example:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/storage/emulated/0/mpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">music_directory  "http://<i>example.com/Music</i>"
log_file         "/data/user/0/org.musicpd/cache/log"
state_file       "/data/user/0/org.musicpd/cache/state"

audio_output {
    type  "sles"
    name  "<i>Android only supports OpenSL ES</i>"
}
</pre>
</div>
<h2><span class="mw-headline" id="MPRIS2_Support">MPRIS2 Support</span></h2>
<h3><span class="mw-headline" id="mpDris2">mpDris2</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-inaccurate.png" ><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../../File:Tango-inaccurate.png" ><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> If there are reports, link them. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Music_Player_Daemon/Tips_and_tricks">Talk:Music Player Daemon/Tips and tricks#</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As of 2017-07-25, there are reports that mpDris2 would break <a href="../../GDM.html" title="GDM">GDM</a> if started as a service.</div>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/mpDris2/">mpDris2</a></span><sup><small>AUR</small></sup> package. It runs in the user session and monitors the mpd server.
</p>
<p>Copy the default configuration file from <code>/usr/share/doc/mpdris2/mpDris2.conf</code> to <code>~/.config/mpDris2/mpDris2.conf</code>. Edit it as needed.
</p>
<p>mpDris2 has a <code>.desktop</code> file, but it will not show up by default. You can set this to autostart at login. If your desktop environment cannot do this, you can set it manually by making a symlink in <code>~/.config/autostart/</code>
</p>
<pre>$ ln -s /usr/share/applications/mpdris2.desktop ~/.config/autostart/
</pre>
<p>It should now be autorun at login.
</p>
<h3><span class="mw-headline" id="mpd-mpris">mpd-mpris</span></h3>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/mpd-mpris/">mpd-mpris</a></span><sup><small>AUR</small></sup> package.
</p>
<p>After installation, you can start or enable the <code>mpd-mpris.service</code> user service through <a href="../../Systemd.html" title="Systemd">systemd</a>.
</p>
<p>By default mpd-mpris listens on <code>localhost:6600</code> (which is the default host/port of <a href="../../Music_Player_Daemon.html" class="mw-redirect" title="Mpd">mpd</a>). To change this settings copy <code>/usr/lib/systemd/user/mpd-mpris.service</code> to <code>~/.config/systemd/user/</code> then edit run parameters as needed.
</p>
<h2><span class="mw-headline" id="Notifications">Notifications</span></h2>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/mpDris2/">mpDris2</a></span><sup><small>AUR</small></sup> package optionally supports displaying graphical notifications.
If you do not want <a rel="nofollow"  href="https://specifications.freedesktop.org/mpris-spec/latest/">mpris</a> support and are looking for a more <i>lightweight</i> or <i>specific</i> option, here are some alternatives:
</p>
<h3><span class="mw-headline" id="musnify-mpd">musnify-mpd</span></h3>
<p><a rel="nofollow"  href="https://github.com/felipemarinho97/musnify-mpd">musnify-mpd</a> is a simple <a href="../../Python.html" title="Python">python</a> script that provides notification support for <a href="../../Music_Player_Daemon.html" title="Music Player Daemon">Music Player Daemon</a> using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=libnotify">libnotify</a></span>.
It can also display the album covers loaded from <i>last fm</i> or load it from the user-local music library.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/musnify-mpd/">musnify-mpd</a></span><sup><small>AUR</small></sup> is available from the <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<p>After installation you may want to configure your mpd <b>host</b> and <b>port</b>. To do this copy the ".example" file into <code>~/.config/musnify-mpd</code>
</p>
<pre>$ mkdir ~/.config/musnify-mpd 
$ cp /usr/share/doc/musnify-mpd/musnify-mpdconfig.example ~/.config/musnify-mpd/musnify-mpd.config
</pre>
<p>Example configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/musnify-mpd/musnify-mpd.config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[mpd]
host = localhost
port = 6600

# This is where musnify-mpd will look for when searching the local album covers.
musiclibrary = ~/Music
#

[apiKey]
# If you want to fetch the album covers from LastFm,
# enable this option and provide a apiKey.
# You can get your apiKey here: <a rel="nofollow"  href="https://www.last.fm/api/account/create">https://www.last.fm/api/account/create</a>
#
# lastfm = YOUR_LASTFM_API_KEY</pre>
<p>To enable artworks from last.fm, you will need to edit <code>~/.config/musnify-mpd</code> and provide a apiKey. You can create your apiKey <a rel="nofollow"  href="https://www.last.fm/api/account/create">here</a>
</p>
<h3><span class="mw-headline" id="mpd-notification">mpd-notification</span></h3>
<p>Notify about tracks played by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=mpd">mpd</a></span>. This runs in the background and produces notifications whenever mpd produces an event (e.g. new track is played, playback paused or stopped). This also supports local or <code>.mp3</code> album artworks.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/mpd-notification/">mpd-notification</a></span><sup><small>AUR</small></sup> is available from <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<p>After installation, just run <code>mpd-notification</code> to run it once. A <a href="../../Systemd.html" title="Systemd">systemd</a> user service can be enabled with 
</p>
<pre>$ systemctl --user enable mpd-notification
</pre>
<h2>
<span id="Adding_a_separate_volume_control_.28ALSA.29"></span><span class="mw-headline" id="Adding_a_separate_volume_control_(ALSA)">Adding a separate volume control (ALSA)</span>
</h2>
<p>While MPD does not allow you to adjust its own volume by default (<code>mpc volume</code> affects global volume), you can easily make a MPD-specific volume slider using the <i>softvol</i> <a href="../../Advanced_Linux_Sound_TOSitecture.html" class="mw-redirect" title="ALSA">ALSA</a> module.  Just add this to <code>asound.conf</code>:
</p>
<pre>pcm.mpd {
    type softvol
    slave.pcm "default"
    control.name "MPD"
    control.card 0
}
</pre>
<p>And link it to MPD:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">mpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">audio_output {
    device "mpd"
    mixer_control "MPD"
}
</pre>
<p>Afterwards you will be able to adjust song volume both through <code>mpc</code> and <code>amixer</code>.
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:Music.html" title="Category:Music">Music</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Music_Player_Daemon/Tips_and_tricks&amp;oldid=616571">https://wiki.archlinux.org/index.php?title=Music_Player_Daemon/Tips_and_tricks&amp;oldid=616571</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 27 May 2020, at 13:25.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">GRUB/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../GRUB.html" title="GRUB">GRUB</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Alternative_installation_methods"><span >1</span> <span >Alternative installation methods</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#Install_to_external_USB_stick"><span >1.1</span> <span >Install to external USB stick</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#BIOS"><span >1.1.1</span> <span >BIOS</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#EFI"><span >1.1.2</span> <span >EFI</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="#Install_to_partition_or_partitionless_disk"><span >1.2</span> <span >Install to partition or partitionless disk</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Generate_core.img_alone"><span >1.3</span> <span >Generate core.img alone</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#GUI_configuration_tools"><span >2</span> <span >GUI configuration tools</span></a></li>
<li class="toclevel-1 tocsection-8">
<a href="#Visual_configuration"><span >3</span> <span >Visual configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Setting_the_framebuffer_resolution"><span >3.1</span> <span >Setting the framebuffer resolution</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#915resolution_hack"><span >3.2</span> <span >915resolution hack</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Background_image_and_bitmap_fonts"><span >3.3</span> <span >Background image and bitmap fonts</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Theme"><span >3.4</span> <span >Theme</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Menu_colors"><span >3.5</span> <span >Menu colors</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Hidden_menu"><span >3.6</span> <span >Hidden menu</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Disable_framebuffer"><span >3.7</span> <span >Disable framebuffer</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Booting_ISO9660_image_file_directly_via_GRUB"><span >4</span> <span >Booting ISO9660 image file directly via GRUB</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Persistent_block_device_naming"><span >5</span> <span >Persistent block device naming</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Using_labels"><span >6</span> <span >Using labels</span></a></li>
<li class="toclevel-1 tocsection-19">
<a href="#Password_protection_of_GRUB_menu"><span >7</span> <span >Password protection of GRUB menu</span></a>
<ul>
<li class="toclevel-2 tocsection-20"><a href="#Password_protection_of_GRUB_edit_and_console_options_only"><span >7.1</span> <span >Password protection of GRUB edit and console options only</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#Hide_GRUB_unless_the_Shift_key_is_held_down"><span >8</span> <span >Hide GRUB unless the Shift key is held down</span></a></li>
<li class="toclevel-1 tocsection-22"><a href="#Combining_the_use_of_UUIDs_and_basic_scripting"><span >9</span> <span >Combining the use of UUIDs and basic scripting</span></a></li>
<li class="toclevel-1 tocsection-23">
<a href="#Multiple_entries"><span >10</span> <span >Multiple entries</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#Disable_submenu"><span >10.1</span> <span >Disable submenu</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Recall_previous_entry"><span >10.2</span> <span >Recall previous entry</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Changing_the_default_menu_entry"><span >10.3</span> <span >Changing the default menu entry</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Boot_non-default_entry_only_once"><span >10.4</span> <span >Boot non-default entry only once</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#Play_a_tune"><span >11</span> <span >Play a tune</span></a></li>
<li class="toclevel-1 tocsection-29"><a href="#Manual_configuration_of_core_image_for_early_boot"><span >12</span> <span >Manual configuration of core image for early boot</span></a></li>
<li class="toclevel-1 tocsection-30">
<a href="#UEFI_further_reading"><span >13</span> <span >UEFI further reading</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#Alternative_install_method"><span >13.1</span> <span >Alternative install method</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#UEFI_firmware_workaround"><span >13.2</span> <span >UEFI firmware workaround</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Create_a_GRUB_entry_in_the_firmware_boot_manager"><span >13.3</span> <span >Create a GRUB entry in the firmware boot manager</span></a></li>
<li class="toclevel-2 tocsection-34">
<a href="#GRUB_standalone"><span >13.4</span> <span >GRUB standalone</span></a>
<ul>
<li class="toclevel-3 tocsection-35"><a href="#Technical_information"><span >13.4.1</span> <span >Technical information</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Alternative_installation_methods">Alternative installation methods</span></h2>
<h3><span class="mw-headline" id="Install_to_external_USB_stick">Install to external USB stick</span></h3>
<h4><span class="mw-headline" id="BIOS">BIOS</span></h4>
<p>Assume your USB stick's first partition is FAT32 and its partition is /dev/sdy1
</p>
<pre># mkdir -p /mnt/usb
# mount /dev/sdy1 /mnt/usb
# grub-install --target=i386-pc --debug --boot-directory=/mnt/usb/boot /dev/sdy
# grub-mkconfig -o /mnt/usb/boot/grub/grub.cfg
</pre>
<p>Optionally backup configuration files of <code>grub.cfg</code>:
</p>
<pre># mkdir -p /mnt/usb/etc/default
# cp /etc/default/grub /mnt/usb/etc/default
# cp -a /etc/grub.d /mnt/usb/etc
</pre>
<pre># sync; umount /mnt/usb
</pre>
<h4><span class="mw-headline" id="EFI">EFI</span></h4>
<p>To have grub write its EFI image to <code><i>esp</i>/EFI/BOOT/BOOTX64.efi</code>, which the boot firmware will be able to find without any UEFI boot entry, use <code>--removable</code> when you run <code>grub-install</code>.
</p>
<h3><span class="mw-headline" id="Install_to_partition_or_partitionless_disk">Install to partition or partitionless disk</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> GRUB <b>strongly discourages</b> installation to a partition boot sector or a partitionless disk as GRUB Legacy or Syslinux-tosdoes. This setup is prone to breakage, especially during updates, and is <b>not supported</b> by the TOS developers.</div>
<p>To set up grub to a partition boot sector, to a partitionless disk (also called superfloppy) or to a floppy disk, run (using for example <code>/dev/sdaX</code> as the <code>/boot</code> partition):
</p>
<pre># chattr -i /boot/grub/i386-pc/core.img
# grub-install --target=i386-pc --debug --force /dev/sdaX
# chattr +i /boot/grub/i386-pc/core.img
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>
<code>/dev/sdaX</code> used for example only.</li>
<li>
<code>--target=i386-pc</code> instructs <code>grub-install</code> to install for BIOS systems only. It is recommended to always use this option to remove ambiguity in <i>grub-install</i>.</li>
</ul>
</div>
<p>You need to use the <code>--force</code> option to allow usage of blocklists and should not use <code>--grub-setup=/bin/true</code> (which is similar to simply generating <code>core.img</code>).
</p>
<p><code>grub-install</code> will give out warnings like which should give you the idea of what might go wrong with this approach:
</p>
<pre>/sbin/grub-setup: warn: Attempting to install GRUB to a partitionless disk or to a partition. This is a BAD idea.
/sbin/grub-setup: warn: Embedding is not possible. GRUB can only be installed in this setup by using blocklists.
                        However, blocklists are UNRELIABLE and their use is discouraged.
</pre>
<p>Without <code>--force</code> you may get the below error and <code>grub-setup</code> will not setup its boot code in the partition boot sector:
</p>
<pre>/sbin/grub-setup: error: will not proceed with blocklists
</pre>
<p>With <code>--force</code> you should get:
</p>
<pre>Installation finished. No error reported.
</pre>
<p>The reason why <code>grub-setup</code> does not by default allow this is because in case of partition or a partitionless disk is that GRUB relies on embedded blocklists in the partition bootsector to locate the <code>/boot/grub/i386-pc/core.img</code> file and the prefix directory <code>/boot/grub</code>. The sector locations of <code>core.img</code> may change whenever the file system in the partition is being altered (files copied, deleted etc.). For more info, see <a rel="nofollow"  href="https://bugzilla.redhat.com/show_bug.cgi?id=728742">https://bugzilla.redhat.com/show_bug.cgi?id=728742</a> and <a rel="nofollow"  href="https://bugzilla.redhat.com/show_bug.cgi?id=730915">https://bugzilla.redhat.com/show_bug.cgi?id=730915</a>.
</p>
<p>The workaround for this is to set the immutable flag on <code>/boot/grub/i386-pc/core.img</code> (using <code>chattr</code> command as mentioned above) so that the sector locations of the <code>core.img</code> file in the disk is not altered. The immutable flag on <code>/boot/grub/i386-pc/core.img</code> needs to be set only if GRUB is installed to a partition boot sector or a partitionless disk, not in case of installation to MBR or simple generation of <code>core.img</code> without embedding any bootsector (mentioned above).
</p>
<p>Unfortunately, the <code>grub.cfg</code> file that is created will not contain the proper UUID in order to boot, even if it reports no errors. see <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?pid=1294604#p1294604">https://bbs.archlinux.org/viewtopic.php?pid=1294604#p1294604</a>.
In order to fix this issue the following commands:
</p>
<pre># mount /dev/sdxY /mnt        #Your root partition.
# mount /dev/sdxZ /mnt/boot   #Your boot partition (if you have one).
# arch-chroot /mnt
</pre>
<p>Now, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=linux">linux</a></span>, then:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h3><span class="mw-headline" id="Generate_core.img_alone">Generate core.img alone</span></h3>
<p>To populate the <code>/boot/grub</code> directory and generate a <code>/boot/grub/i386-pc/core.img</code> file <b>without</b> embedding any GRUB bootsector code in the MBR, post-MBR region, or the partition bootsector, add <code>--grub-setup=/bin/true</code> to <code>grub-install</code>:
</p>
<pre># grub-install --target=i386-pc --grub-setup=/bin/true --debug /dev/sda
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>
<code>/dev/sda</code> used for example only.</li>
<li>
<code>--target=i386-pc</code> instructs <code>grub-install</code> to install for BIOS systems only. It is recommended to always use this option to remove ambiguity in grub-install.</li>
</ul>
</div>
<p>You can then chainload GRUB's <code>core.img</code> from GRUB Legacy or syslinux-tosas a Linux kernel or as a multiboot kernel (see also <a href="../../Syslinux.html#Chainloading" title="Syslinux">Syslinux#Chainloading</a>).
</p>
<h2><span class="mw-headline" id="GUI_configuration_tools">GUI configuration tools</span></h2>
<p>Following package may be installed:
</p>
<ul><li>
<b>grub-customizer</b> — GTK customizer for GRUB or BURG</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://launchpad.net/grub-customizer">https://launchpad.net/grub-customizer</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=grub-customizer">grub-customizer</a></span>
</dd></dl>
<ul><li>
<b>grub2-editor-frameworks</b> — Unofficial KF5 port of grub2-editor</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/maz-1/grub2-editor">https://github.com/maz-1/grub2-editor</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/grub2-editor-frameworks-git/">grub2-editor-frameworks-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>startupmanager</b> — GUI app for changing the settings of GRUB Legacy, GRUB, Usplash and Splashy (<a rel="nofollow"  href="https://launchpad.net/startup-manager/+announcement/8300">abandoned</a>)</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://sourceforge.net/projects/startup-manager/">http://sourceforge.net/projects/startup-manager/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/startupmanager/">startupmanager</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h2><span class="mw-headline" id="Visual_configuration">Visual configuration</span></h2>
<p>In GRUB it is possible, by default, to change the look of the menu. Make sure to initialize, if not done already, GRUB graphical terminal, gfxterm, with proper video mode, gfxmode, in GRUB. This can be seen in the section <a href="../../GRUB.html#%22No_suitable_mode_found%22_error" title="GRUB">GRUB#"No suitable mode found" error</a>. This video mode is passed by GRUB to the linux-toskernel via 'gfxpayload' so any visual configurations need this mode in order to be in effect.
</p>
<h3><span class="mw-headline" id="Setting_the_framebuffer_resolution">Setting the framebuffer resolution</span></h3>
<p>GRUB can set the framebuffer for both GRUB itself and the kernel. The old <code>vga=</code> way is deprecated. The preferred method is editing <code>/etc/default/grub</code> as the following sample to set width (pixels) x height (pixels) x <a href="https://en.wikipedia.org/wiki/color_depth"  title="wikipedia:color depth">color depth</a>:
</p>
<pre>GRUB_GFXMODE=1024x768x32
GRUB_GFXPAYLOAD_LINUX=keep
</pre>
<p>Multiple resolutions can be specified, including the default <code>auto</code>, so it is recommended that you edit the line to resemble <code>GRUB_GFXMODE=<i>desired_resolution</i>,<i>fallback_such_as_1024x768</i>,auto</code>. For more information, refer to <a rel="nofollow"  href="https://www.gnu.org/software/grub/manual/grub/html_node/gfxmode.html">the GRUB gfxmode documentation</a>. The <a rel="nofollow"  href="https://www.gnu.org/software/grub/manual/html_node/gfxpayload.html#gfxpayload">gfxpayload</a> property will make sure the kernel keeps the resolution.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Only the modes supported by the graphics card via <a href="https://en.wikipedia.org/wiki/VESA_BIOS_Extensions"  title="wikipedia:VESA BIOS Extensions">VESA BIOS Extensions</a> can be used. To view the list of supported modes, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=hwinfo">hwinfo</a></span> and run <code>hwinfo --framebuffer</code> as root. Alternatively, enter the GRUB command line and run the command <code>videoinfo</code>.</li>
<li>Earlier versions of the <a href="../../NVIDIA.html" title="NVIDIA">NVIDIA</a> proprietary driver (tested with GeForce GTX 970, driver: nvidia 370) accepts <code>GRUB_GFXMODE</code> in format <code><i>width</i>x<i>height</i>-<i>depth</i></code> (e.g. <code>1920x1200-24</code>, but not <code>1920x1200x24</code>). This does not appear to apply to newer cards and drivers. Pascal cards with more recent drivers (tested with GeForce GTX 1060 and nvidia 381.22) will not work with the suggested format and attempting to use it results in serious issues, including but not limited to system crashes and hard locks. The current driver and cards are best configured with <code>GRUB_GFXMODE</code> in the standard <code><i>width</i>x<i>height</i>x<i>depth</i></code> format.</li>
<li>Make sure to run <code>grub-mkconfig -o /boot/grub/grub.cfg</code> after making changes.</li>
</ul>
</div>
<p>If this method does not work for you, the deprecated <code>vga=</code> method will still work. Just add it next to the <code>"GRUB_CMDLINE_LINUX_DEFAULT="</code> line in <code>/etc/default/grub</code> for example: <code>"GRUB_CMDLINE_LINUX_DEFAULT="quiet splash vga=792"</code> will give you a <code>1024x768</code> resolution.
</p>
<h3><span class="mw-headline" id="915resolution_hack">915resolution hack</span></h3>
<p>Sometimes for Intel graphic adapters neither <code># hwinfo --framebuffer</code> nor <code>videoinfo</code> will show you the desired resolution. In this case you can use the <code>915resolution</code> hack. This hack will temporarily modify video BIOS and add needed resolution. See <a rel="nofollow"  href="http://915resolution.mango-lang.org/">915resolution's home page</a>. The package can be found here: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/915resolution/">915resolution</a></span><sup><small>AUR</small></sup>
</p>
<p>First you need to find a video mode which will be modified later. For that we need the GRUB command shell:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">sh:grub&gt; 915resolution -l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Intel 800/900 Series VBIOS Hack : version 0.5.3
[...]
<b>Mode 30</b> : 640x480, 8 bits/pixel
[...]
</pre>
<p>Next, we overwrite the <code>Mode 30</code> with <code>1440x900</code> resolution:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/00_header</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[...]
<b>915resolution 30 1440 900  # Inserted line</b>
set gfxmode=${GRUB_GFXMODE}
[...]</pre>
<p>Lastly we need to set <code>GRUB_GFXMODE</code> as described earlier, regenerate <code>grub.cfg</code> and reboot to test changes.
</p>
<h3><span class="mw-headline" id="Background_image_and_bitmap_fonts">Background image and bitmap fonts</span></h3>
<p>GRUB comes with support for background images and bitmap fonts in <code>pf2</code> format. The unifont font is included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=grub">grub</a></span> package under the filename <code>unicode.pf2</code>, or, as only ASCII characters under the name <code>ascii.pf2</code>.
</p>
<p>Image formats supported include tga, png and jpeg, providing the correct modules are loaded. The maximum supported resolution depends on your hardware.
</p>
<p>Make sure you have set up the proper <a href="#Setting_the_framebuffer_resolution">framebuffer resolution</a>.
</p>
<p>Edit <code>/etc/default/grub</code> like this:
</p>
<pre>GRUB_BACKGROUND="/boot/grub/myimage"
#GRUB_THEME="/path/to/gfxtheme"
GRUB_FONT="/path/to/font.pf2"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have installed GRUB on a separate partition, <code>/boot/grub/myimage</code> automatically becomes <code>/grub/myimage</code> in <code>grub.cfg</code>.</div>
<p><a href="../../GRUB.html#Generate_the_main_configuration_file" title="GRUB">Re-generate</a> <code>grub.cfg</code> to apply the changes. If adding the splash image was successful, the user will see <code>"Found background image..."</code> in the terminal as the command is executed. If this phrase is not seen, the image information was probably not incorporated into the <code>grub.cfg</code> file.
</p>
<p>If the image is not displayed, check:
</p>
<ul>
<li>The path and the filename in <code>/etc/default/grub</code> are correct</li>
<li>The image is of the proper size and format (tga, png, 8-bit jpg)</li>
<li>The image was saved in the RGB mode, and is not indexed</li>
<li>The console mode is not enabled in <code>/etc/default/grub</code>
</li>
<li>The command <code>grub-mkconfig</code> must be executed to place the background image information into the <code>/boot/grub/grub.cfg</code> file</li>
<li>The <code>grub-mkconfig</code> scripts will not quote the file name in <code>grub.cfg</code> so make sure it does not contain spaces</li>
</ul>
<h3><span class="mw-headline" id="Theme">Theme</span></h3>
<p>Here is an example for configuring Starfield theme which was included in GRUB package.
</p>
<p>Edit <code>/etc/default/grub</code>:
</p>
<pre>GRUB_THEME="/usr/share/grub/themes/starfield/theme.txt"
</pre>
<p><a href="../../GRUB.html#Generate_the_main_configuration_file" title="GRUB">Re-generate</a> <code>grub.cfg</code> to apply the changes. If configuring the theme was successful, you will see <code>Found theme: /usr/share/grub/themes/starfield/theme.txt</code> in the terminal.
</p>
<p>Your splash image will usually not be displayed when using a theme.
</p>
<h3><span class="mw-headline" id="Menu_colors">Menu colors</span></h3>
<p>You can set the menu colors in GRUB. The available colors for GRUB can be found in <a rel="nofollow"  href="https://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html">the GRUB Manual</a>.
Here is an example:
</p>
<p>Edit <code>/etc/default/grub</code>:
</p>
<pre>GRUB_COLOR_NORMAL="light-blue/black"
GRUB_COLOR_HIGHLIGHT="light-cyan/blue"
</pre>
<h3><span class="mw-headline" id="Hidden_menu">Hidden menu</span></h3>
<p>One of the unique features of GRUB is hiding/skipping the menu and showing it by holding <code>Esc</code> when needed. You can also adjust whether you want to see the timeout counter.
</p>
<p>Edit <code>/etc/default/grub</code> as you wish. Here are the lines you need to add to enable this feature, the timeout has been set to five seconds and to be shown to the user:
</p>
<pre>GRUB_TIMEOUT=5
GRUB_TIMEOUT_STYLE='countdown'
</pre>
<p><code>GRUB_TIMEOUT</code> is how many seconds before displaying menu.
</p>
<h3><span class="mw-headline" id="Disable_framebuffer">Disable framebuffer</span></h3>
<p>Users who use NVIDIA proprietary driver might wish to disable GRUB's framebuffer as it can cause problems with the binary driver.
</p>
<p>To disable framebuffer, edit <code>/etc/default/grub</code> and uncomment the following line:
</p>
<pre>GRUB_TERMINAL_OUTPUT=console
</pre>
<p>Another option if you want to keep the framebuffer in GRUB is to revert to text mode just before starting the kernel. To do that modify the variable in <code>/etc/default/grub</code>:
</p>
<pre>GRUB_GFXPAYLOAD_LINUX=text
</pre>
<h2><span class="mw-headline" id="Booting_ISO9660_image_file_directly_via_GRUB">Booting ISO9660 image file directly via GRUB</span></h2>
<p>GRUB supports booting from ISO images directly via loopback devices, see <a href="../../Multiboot_USB_drive.html#Using_GRUB_and_loopback_devices" title="Multiboot USB drive">Multiboot USB drive#Using GRUB and loopback devices</a> for examples.
</p>
<h2><span class="mw-headline" id="Persistent_block_device_naming">Persistent block device naming</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-cut.png" ><img alt="Tango-edit-cut.png" src="../../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a><b>This section is being considered for removal.</b><a href="../../File:Tango-edit-cut.png" ><img alt="Tango-edit-cut.png" src="../../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> UUIDs are used by default, there is little value to change that (unless opting for PARTUUIDs by setting <code>GRUB_DISABLE_LINUX_UUID=true</code> and <code>GRUB_DISABLE_LINUX_PARTUUID=false</code>). (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p>One naming scheme for <a href="../../Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a> is the use of globally unique UUIDs to detect partitions instead of the "old" <code>/dev/sd*</code>. Advantages are covered up in the above linked article. 
</p>
<p>Persistent naming via file system UUIDs are used by default in GRUB. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>/boot/grub.cfg</code> file needs regeneration with the new UUID in <code>/etc/default/grub</code> every time a relevant file system is resized or recreated. Remember this when modifying partitions &amp; file systems with a Live-CD.</div>
<p>Whether to use UUIDs is controlled by an option in <code>/etc/default/grub</code>:
</p>
<pre>GRUB_DISABLE_LINUX_UUID=true
</pre>
<h2><span class="mw-headline" id="Using_labels">Using labels</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../../GRUB.html#Custom_grub.cfg" title="GRUB">GRUB#Custom grub.cfg</a>.</b><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> Keep basic <code>grub.cfg</code> configuration in one place. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p>It is possible to use file system labels, human-readable strings attached to file systems, by using the <code>--label</code> option to <code>search</code>. First of all, <a href="../../Persistent_block_device_naming.html#by-label" title="Persistent block device naming">make sure your file system has a label</a>.
</p>
<p>Then, add an entry using labels. An example of this:
</p>
<pre>menuentry "TOS Linux, session texte" {
  search --label --set=root archroot
  linux-tos/boot/vmlinuz-linux-tosroot=/dev/disk/by-label/archroot ro
  initrd /boot/initramfs-linux.img
}
</pre>
<h2><span class="mw-headline" id="Password_protection_of_GRUB_menu">Password protection of GRUB menu</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If someone has physical access to your machine and is able to boot a live USB/disk (<i>i.e.</i>, BIOS allows booting from an external disk), it is fairly trivial for one to modify GRUB configuration files to bypass this if <code>/boot</code> resides on an unencrypted partition. See <a href="../../GRUB.html#Encrypted_/boot" title="GRUB">GRUB#Encrypted /boot</a> and <a href="../../Security.html#Disk_encryption" title="Security">Security#Disk encryption</a><sup>[<a href="../../TOS Wiki:Requests.html#Broken_section_links" class="mw-redirect" title="TOS Wiki:Requests">broken link</a>: invalid section]</sup>.</div>
<p>If you want to secure GRUB so it is not possible for anyone to change boot parameters or use the command line, you can add a user/password combination to GRUB's configuration files. To do this, run the command <code>grub-mkpasswd-pbkdf2</code>. Enter a password and confirm it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">grub-mkpasswd-pbkdf2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[...]
Your PBKDF2 is grub.pbkdf2.sha512.10000.C8ABD3E93C4DFC83138B0C7A3D719BC650E6234310DA069E6FDB0DD4156313DA3D0D9BFFC2846C21D5A2DDA515114CF6378F8A064C94198D0618E70D23717E82.509BFA8A4217EAD0B33C87432524C0B6B64B34FBAD22D3E6E6874D9B101996C5F98AB1746FE7C7199147ECF4ABD8661C222EEEDB7D14A843261FFF2C07B1269A
</pre>
<p>Then, adjust permissions on <code>/etc/grub.d/40_custom</code> such that only root can read it and add the following to this file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/40_custom</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set superusers="<b>username</b>"
password_pbkdf2 <b>username <i>password</i></b></pre>
<p>where <code><i>password</i></code> is the string generated by <code>grub-mkpasswd_pbkdf2</code>.
</p>
<p>Regenerate your configuration file. Your GRUB command line, boot parameters and all boot entries are now protected.
</p>
<p>This can be relaxed and further customized with more users as described in the "Security" part of <a rel="nofollow"  href="https://www.gnu.org/software/grub/manual/grub.html#Security">the GRUB manual</a>.
</p>
<h3><span class="mw-headline" id="Password_protection_of_GRUB_edit_and_console_options_only">Password protection of GRUB edit and console options only</span></h3>
<p>Adding <code>--unrestricted</code> to a menu entry will allow any user to boot the OS while preventing the user from editing the entry and preventing access to the grub command console.
Only a superuser or users specified with the <code>--user</code> switch will be able to edit the menu entry.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">menuentry 'TOS Linux' --unrestricted --class arch --class gnu-linux-tos--class os ...</pre>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-inaccurate.png" ><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../../File:Tango-inaccurate.png" ><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <code>/etc/grub.d/10_linux</code> should not be edited, it will be overwritten when <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=grub">grub</a></span> is updated. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p>In order to make Linux entries <code>--unrestricted</code>, the <code>CLASS</code> variable in the beginning of <code>/etc/grub.d/10_linux</code> can be modified.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/10_linux</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CLASS="--class gnu-linux-tos--class gnu --class os --unrestricted"</pre>
<h2><span class="mw-headline" id="Hide_GRUB_unless_the_Shift_key_is_held_down">Hide GRUB unless the Shift key is held down</span></h2>
<p>In order to achieve the fastest possible boot, instead of having GRUB wait for a timeout, it is possible for GRUB to hide the menu, unless the <code>Shift</code> key is held down during GRUB's start-up.
</p>
<p>In order to achieve this, you should add the following line to <code>/etc/default/grub</code>:
</p>
<pre>GRUB_FORCE_HIDDEN_MENU="true"
</pre>
<p>Then create the file in <a rel="nofollow"  href="https://gist.githubusercontent.com/anonymous/8eb2019db2e278ba99be/raw/257f15100fd46aeeb8e33a7629b209d0a14b9975/gistfile1.sh">[1]</a>, make it exectuable, and regenerate the grub configuration:
</p>
<pre># chmod a+x /etc/grub.d/31_hold_shift
# grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This setup uses keystatus to detect keypress event so it may not work on some machines.</div>
<h2><span class="mw-headline" id="Combining_the_use_of_UUIDs_and_basic_scripting">Combining the use of UUIDs and basic scripting</span></h2>
<p>If you like the idea of using UUIDs to avoid unreliable BIOS mappings or are struggling with GRUB's syntax, here is an example boot menu item that uses UUIDs and a small script to direct GRUB to the proper disk partitions for your system. All you need to do is replace the UUIDs in the sample with the correct UUIDs for your system. The example applies to a system with a boot and root partition. You will obviously need to modify the GRUB configuration if you have additional partitions:
</p>
<pre>menuentry "TOS Linux 64" {
    # Set the UUIDs for your boot and root partition respectively
    set the_boot_uuid=ece0448f-bb08-486d-9864-ac3271bd8d07
    set the_root_uuid=c55da16f-e2af-4603-9e0b-03f5f565ec4a

    # (Note: This may be the same as your boot partition)

    # Get the boot/root devices and set them in the root and grub_boot variables
    search --fs-uuid $the_root_uuid --set=root
    search --fs-uuid $the_boot_uuid --set=grub_boot

    # Check to see if boot and root are equal.
    # If they are, then append /boot to $grub_boot (Since $grub_boot is actually the root partition)
    if [ $the_boot_uuid == $the_root_uuid ] ; then
        set grub_boot=($grub_boot)/boot
    else
        set grub_boot=($grub_boot)
    fi

    # $grub_boot now points to the correct location, so the following will properly find the kernel and initrd
    linux-tos$grub_boot/vmlinuz-linux-tosroot=/dev/disk/by-uuid/$the_root_uuid ro
    initrd $grub_boot/initramfs-linux.img
}
</pre>
<h2><span class="mw-headline" id="Multiple_entries">Multiple entries</span></h2>
<h3><span class="mw-headline" id="Disable_submenu">Disable submenu</span></h3>
<p>If you have multiple kernels installed, say linux-tosand linux-lts, by default <code>grub-mkconfig</code> groups them in a submenu. If you do not like this behaviour you can go back to one single menu by adding the following line to <code>/etc/default/grub</code>:
</p>
<pre>GRUB_DISABLE_SUBMENU=y
</pre>
<h3><span class="mw-headline" id="Recall_previous_entry">Recall previous entry</span></h3>
<p>GRUB can remember the last entry you booted from and use this as the default entry to boot from next time. This is useful if you have multiple kernels (i.e., the current TOS one and the LTS kernel as a fallback option) or operating systems. To do this, edit <code>/etc/default/grub</code> and change the value of <code>GRUB_DEFAULT</code>:
</p>
<pre>GRUB_DEFAULT=saved
</pre>
<p>This ensures that GRUB will default to the saved entry. To enable saving the selected entry, add the following line to <code>/etc/default/grub</code>:
</p>
<pre>GRUB_SAVEDEFAULT=true
</pre>
<p>This will only work if /boot is not a btrfs, because grub cannot write to btrfs.  But it will generate a misleading error message: "sparse file not allowed. Press any key to continue.". 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Manually added menu items, e.g. Windows in <code>/etc/grub.d/40_custom</code> or <code>/boot/grub/custom.cfg</code>, will need <code>savedefault</code> added.</div>
<h3><span class="mw-headline" id="Changing_the_default_menu_entry">Changing the default menu entry</span></h3>
<p>To change the default selected entry, edit <code>/etc/default/grub</code> and change the value of <code>GRUB_DEFAULT</code>:
</p>
<p>Using menu titles :
</p>
<pre>GRUB_DEFAULT='Advanced options for TOS Linux&gt;TOS Linux, with Linux linux'
</pre>
<p>Using numbers :
</p>
<pre>GRUB_DEFAULT="1&gt;2"
</pre>
<p>Grub identifies entries in generated menu counted from zero. That means <code>0</code> for the first entry which is the default value, <code>1</code> for the second and so on. Main and submenu entries are separated
by a <code>&gt;</code>.
</p>
<p>The example above boots the third entry from the main menu 'Advanced options for TOS Linux'.
</p>
<h3><span class="mw-headline" id="Boot_non-default_entry_only_once">Boot non-default entry only once</span></h3>
<p>The command <code>grub-reboot</code> is very helpful to boot another entry than the default only once. GRUB loads the entry passed in the first command line argument, when the system is rebooted the next time. Most importantly GRUB returns to loading the default entry for all future booting. Changing the configuration file or selecting an entry in the GRUB menu is not necessary.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This requires <code>GRUB_DEFAULT=saved</code> in <code>/etc/default/grub</code> (and then regenerating <code>grub.cfg</code>) or, in case of hand-made <code>grub.cfg</code>, the line <code>set default="${saved_entry}"</code>.</div>
<h2><span class="mw-headline" id="Play_a_tune">Play a tune</span></h2>
<p>You can play a tune through the PC-speaker while booting (right before the menu appears) by modifying the variable <code>GRUB_INIT_TUNE</code>. For example, to play Berlioz's extract from Sabbath Night of Symphonie Fantastique (bassoon part) you can add the following:
</p>
<pre>GRUB_INIT_TUNE="312 262 3 247 3 262 3 220 3 247 3 196 3 220 3 220 3 262 3 262 3 294 3 262 3 247 3 220 3 196 3 247 3 262 3 247 5 220 1 220 5"
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-cut.png" ><img alt="Tango-edit-cut.png" src="../../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a><b>This section is being considered for removal.</b><a href="../../File:Tango-edit-cut.png" ><img alt="Tango-edit-cut.png" src="../../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Common samples should be listed elsewhere, there should be just a link. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p>You can add a menu entry to play each of these common <code>GRUB_INIT_TUNE</code> samples by creating the following file and then re-running <code>grub-mkconfig</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/91_tune_demo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
exec tail -n +3 $0
menuentry "INIT_TUNE Demos" {
   echo "Close Encounters/5 Tone"
   play 480 900 2 1000 2 800 2 400 2 600 3
   echo "Fur Elise (note long)"
   play 480 420 1 400 1 420 1 400 1 420 1 315 1 370 1 335 1 282 3 180 1 215 1 282 1 315 3 213 1 262 1 315 1 335 3 213 1 420 1 400 1 420 1 400 1 420 1 315 1 370 1 335 1 282 3 180 1 215 1 282 1 315 3 213 1 330 1 315 1 282 3
   echo "Berlioz's extract from Sabbath Night of Symphonie Fantastique"
   play 312 262 3 247 3 262 3 220 3 247 3 196 3 220 3 220 3 262 3 262 3 294 3 262 3 247 3 220 3 196 3 247 3 262 3 247 5 220 1 220 5
   echo "Oldskool Batman tune"
   play 380 120 1 140 1 160 1 200 8 190 4
   echo "Legend of Zelda tune"
   play 12000 440 100 0 1 329 150 440 50 0 1 440 25 493 25 523 25 587 25 659 200
   echo "Super Mario"
   play 1000 334 1 334 1 0 1 334 1 0 1 261 1 334 1 0 1 392 2 0 4 196 2
   echo "Super Mario Alternate"
   play 480 165 2 165 2 165 3 554 1 587 1 554 2 370 1 554 1 523 2 349 1 523 1 494 3 165 2 165 2 165 2
   echo "Mario Mushroom"
   play 1750 523 1 392 1 523 1 659 1 784 1 1047 1 784 1 415 1 523 1 622 1 831 1 622 1 831 1 1046 1 1244 1 1661 1 1244 1 466 1 587 1 698 1 932 1 1175 1 1397 1 1865 1 1397 1
   echo "Star Wars Imperial Death March"
   play 480 440 4 440 4 440 4 349 3 523 1 440 4 349 3 523 1 440 8 659 4 659 4 659 4 698 3 523 1 415 4 349 3 523 1 440 8
   echo "My Little Pony"
   play 2400 587 18 554 4 587 8 659 12 587 16 0 10 587 4 659 4 740 8 587 4 784 12 740 8 659 8 587 4 740 20 587 40
   echo "Wolfenstein 3D"
   play 300 131 1 196 1 196 1 196 1 294 1 196 1 294 1 196 1 131 1
   echo "Mall (Nothing Special)"
   play 180 440 1 554 1 659 1
   echo "Final Countdown"
   play 480 554 1 494 1 554 4 370 6 10 3 587 1 554 1 587 2 554 2 494 6
   echo "Xie-Jelei's Tune"
   play 2000 400 4 0 1 500 4 0 1 600 4 0 1 800 6
   echo "Random tune"
   play 480 220 1 277 1 330 1 440 1 185 1 220 1 277 1 370 1 294 1 370 1 440 1 587 1 330 1 415 1 494 1 659 1
   echo "Fleetwood Mac: The Chain Bass Riff (about 5 seconds)"
   play 304 55 5 0 1 55 1 62 1 65 2 62 1 55 1 49 1 55 1 62 2 41 8
   echo "Fleetwood Mac: The Chain Bass Riff Extended Version (WARNING, 25 SECONDS)"
   play 9120 55 150 0 30 55 30 62 30 65 60 62 30 55 30 49 30 55 30 62 60 41 360 0 120 55 150 0 30 55 30 62 30 65 60 62 30 55 30 49 30 55 30 62 60 41 360 0 60 41 12 42 3 43 3 44 3 45 3 46 6 47 3 48 3 49 6 50 3 51 3 52 6 53 3 54 3 55 150 0 30 55 30 62 30 65 60 62 30 55 30 49 30 55 30 62 60 41 240 82 20 0 10 82 26 0 4 82 26 0 4 82 26 0 4 82 56 0 4 82 60 55 150 0 30 55 30 62 30 65 60 62 30 55 30 49 30 55 30 62 60 41 360 0 120
}
</pre>
<p>For information on this, you can look at <code>info grub -n play</code>.
</p>
<h2><span class="mw-headline" id="Manual_configuration_of_core_image_for_early_boot">Manual configuration of core image for early boot</span></h2>
<p>If you require a special keymap or other complex steps that GRUB is not able to configure automatically in order to make <code>/boot</code> available to the GRUB environment, you can generate a core image yourself. On UEFI systems, the core image is the <code>grubx64.efi</code> file that is loaded by the firmware on boot. Building your own core image will allow you to embed any modules required for very early boot, as well as a configuration script to bootstrap GRUB.
</p>
<p>Firstly, taking as an example a requirement for the <code>dvorak</code> keymap embedded in early-boot in order to enter a password for an encrypted <code>/boot</code> on a UEFI system:
</p>
<p>Determine from the generated <code>/boot/grub/grub.cfg</code> file what modules are required in order to mount the crypted <code>/boot</code>. For instance, under your <code>menuentry</code> you should see lines similar to:
</p>
<pre>insmod diskfilter cryptodisk luks gcry_rijndael gcry_rijndael gcry_sha256
insmod ext2
cryptomount -u 1234abcdef1234abcdef1234abcdef
set root='cryptouuid/1234abcdef1234abcdef1234abcdef'</pre>
<p>Take note of all of those modules: they will need to be included in the core image. Now, create a tarball containing your keymap. This will be bundled in the core image as a memdisk:
</p>
<pre># grub-kbdcomp -o dvorak.gkb dvorak
# tar cf memdisk.tar dvorak.gkb
</pre>
<p>Now create a configuration file to be used in the GRUB core image. This is in the same format as your regular grub config, but need contain only a few lines to find and load the main config file on the <code>/boot</code> partition:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">early-grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set root=(memdisk)
set prefix=($root)/

terminal_input at_keyboard
keymap /dvorak.gkb

cryptomount -u 1234abcdef1234abcdef1234abcdef
set root='cryptouuid/1234abcdef1234abcdef1234abcdef'
set prefix=($root)/grub

configfile grub.cfg</pre>
<p>Finally, generate the core image, listing all of the modules determined to be required in the generated <code>grub.cfg</code>, along with any modules used in the <code>early-grub.cfg</code> script. The example above needs <code>memdisk</code>, <code>tar</code>, <code>at_keyboard</code>, <code>keylayouts</code> and <code>configfile</code>.
</p>
<pre># grub-mkimage -c early-grub.cfg -o grubx64.efi -O x86_64-efi -m memdisk.tar diskfilter cryptodisk luks gcry_rijndael gcry_sha256 ext2 memdisk tar at_keyboard keylayouts configfile
</pre>
<p>The generated EFI core image can now be used in the same way as the image that is generated automatically by <code>grub-install</code>: place it in your EFI partition and enable it with <code>efibootmgr</code>, or configure as appropriate for your system firmware.
</p>
<p>See also <a rel="nofollow"  href="https://cryptsetup-team.pages.debian.net/cryptsetup/encrypted-boot.html#using-a-custom-keyboard-layout">Debian cryptsetup docs</a>.
</p>
<h2><span class="mw-headline" id="UEFI_further_reading">UEFI further reading</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../../Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This could be made more concise, better organized. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p>Below is other relevant information regarding installing TOS via UEFI.
</p>
<h3><span class="mw-headline" id="Alternative_install_method">Alternative install method</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> What would be the reason to place all of GRUB's files in the ESP? (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p>Usually, GRUB keeps all files, including configuration files, in <code>/boot</code>, regardless of where the EFI System Partition is mounted.
</p>
<p>If you want to keep these files inside the EFI System Partition itself, add <code>--boot-directory=<i>esp</i></code> to the grub-install command:
</p>
<pre># grub-install --target=x86_64-efi --efi-directory=<i>esp</i> --bootloader-id=grub --boot-directory=<i>esp</i> --debug
</pre>
<p>This puts all GRUB files in <code><i>esp</i>/grub</code>, instead of in <code>/boot/grub</code>. When using this method, make sure you have <i>grub-mkconfig</i> put the configuration file in the same place:
</p>
<pre># grub-mkconfig -o <i>esp</i>/grub/grub.cfg
</pre>
<p>Configuration is otherwise the same.
</p>
<h3><span class="mw-headline" id="UEFI_firmware_workaround">UEFI firmware workaround</span></h3>
<p>See <a href="../../GRUB.html#Default/fallback_boot_path" title="GRUB">GRUB#Default/fallback boot path</a>.
</p>
<h3><span class="mw-headline" id="Create_a_GRUB_entry_in_the_firmware_boot_manager">Create a GRUB entry in the firmware boot manager</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-go-next.png" ><img alt="Tango-go-next.png" src="../../File:Tango-go-next.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for moving to <a href="../../GRUB.html#UEFI" title="GRUB">GRUB#UEFI</a>.</b><a href="../../File:Tango-go-next.png" ><img alt="Tango-go-next.png" src="../../File:Tango-go-next.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> efibootmgr usage is not a trick, this is better suited for the main article. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Provide an efibootmgr command. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:GRUB/Tips_and_tricks">Talk:GRUB/Tips and tricks#</a>)</div>
</div>
<p><code>grub-install</code> automatically tries to create a menu entry in the boot manager. If it does not, then see <a href="../../Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="UEFI">UEFI#efibootmgr</a> for instructions to use <code>efibootmgr</code> to create a menu entry. However, the problem is likely to be that you have not booted your CD/USB in UEFI mode, as in <a href="../../Unified_Extensible_Firmware_Interface.html#Create_UEFI_bootable_USB_from_ISO" class="mw-redirect" title="UEFI">UEFI#Create UEFI bootable USB from ISO</a>.
</p>
<h3><span class="mw-headline" id="GRUB_standalone">GRUB standalone</span></h3>
<p>This section assumes you are creating a standalone GRUB for x86_64 systems (x86_64-efi). For 32-bit (IA32) EFI systems, replace <code>x86_64-efi</code> with <code>i386-efi</code> where appropriate.
</p>
<p>It is possible to create a <code>grubx64_standalone.efi</code> application which has all the modules embedded in a tar archive within the UEFI application, thus removing the need to have a separate directory populated with all of the GRUB UEFI modules and other related files. This is done using the <code>grub-mkstandalone</code> command (included in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=grub">grub</a></span>) as follows:
</p>
<pre># echo 'configfile ${cmdpath}/grub.cfg' &gt; /tmp/grub.cfg
# grub-mkstandalone -d /usr/lib/grub/x86_64-efi/ -O x86_64-efi --modules="part_gpt part_msdos" --locales="en@quot" --themes="" -o "<i>esp</i>/EFI/grub/grubx64_standalone.efi" "boot/grub/grub.cfg=/tmp/grub.cfg" -v
</pre>
<p>Then copy the GRUB config file to <code><i>esp</i>/EFI/grub/grub.cfg</code> and create a UEFI Boot Manager entry for <code><i>esp</i>/EFI/grub/grubx64_standalone.efi</code> using <a href="../../Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="UEFI">efibootmgr</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The option <code>--modules="part_gpt part_msdos"</code> (with the quotes) is necessary for the <code>${cmdpath} </code> feature to work properly.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> You may find that the <code>grub.cfg</code> file is not loaded due to <code>${cmdpath} </code> missing a slash (i.e. <code>(hd1,msdos2)EFI/Boot</code> instead of <code>(hd1,msdos2)/EFI/Boot</code>) and so you are dropped into a GRUB shell. If this happens determine what <code>${cmdpath} </code> is set to (<code>echo ${cmdpath} </code>) and then load the config file manually (e.g. <code>configfile (hd1,msdos2)/EFI/Boot/grub.cfg</code>).</div>
<h4><span class="mw-headline" id="Technical_information">Technical information</span></h4>
<p>The GRUB EFI file always expects its config file to be at <code>${prefix}/grub.cfg</code>. However in the standalone GRUB EFI file, the <code>${prefix} </code> is located inside a tar archive and embedded inside the standalone GRUB EFI file itself (inside the GRUB environment, it is denoted by <code>"(memdisk)"</code>, without quotes). This tar archive contains all the files that would be stored normally at <code>/boot/grub</code> in case of a normal GRUB EFI install.
</p>
<p>Due to this embedding of <code>/boot/grub</code> contents inside the standalone image itself, it does not rely on actual (external) <code>/boot/grub</code> for anything. Thus in case of standalone GRUB EFI file <code>${prefix}==(memdisk)/boot/grub</code> and the standalone GRUB EFI file reads expects the config file to be at <code>${prefix}/grub.cfg==(memdisk)/boot/grub/grub.cfg</code>.
</p>
<p>Hence to make sure the standalone GRUB EFI file reads the external <code>grub.cfg</code> located in the same directory as the EFI file (inside the GRUB environment, it is denoted by <code>${cmdpath} </code>), we create a simple <code>/tmp/grub.cfg</code> which instructs GRUB to use <code>${cmdpath}/grub.cfg</code> as its config (<code>configfile ${cmdpath}/grub.cfg</code> command in <code>(memdisk)/boot/grub/grub.cfg</code>). We then instruct grub-mkstandalone to copy this <code>/tmp/grub.cfg</code> file to <code>${prefix}/grub.cfg</code> (which is actually <code>(memdisk)/boot/grub/grub.cfg</code>) using the option <code>"boot/grub/grub.cfg=/tmp/grub.cfg"</code>.
</p>
<p>This way, the standalone GRUB EFI file and actual <code>grub.cfg</code> can be stored in any directory inside the EFI System Partition (as long as they are in the same directory), thus making them portable.
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:Boot_loaders.html" title="Category:Boot loaders">Boot loaders</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../Category:Sections_flagged_with_Template:Remove.html" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../../Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GRUB/Tips_and_tricks&amp;oldid=616403">https://wiki.archlinux.org/index.php?title=GRUB/Tips_and_tricks&amp;oldid=616403</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 26 May 2020, at 17:37.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">pacman/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../Pacman.html" title="Pacman">Pacman</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../../Mirrors.html" title="Mirrors">Mirrors</a></li>
<li><a href="../../Creating_packages.html" title="Creating packages">Creating packages</a></li>
</ul>
</div>
<p>For general methods to improve the flexibility of the provided tips or <i>pacman</i> itself, see <a href="../../Core_utilities.html" title="Core utilities">Core utilities</a> and <a href="../../Bash.html" title="Bash">Bash</a>.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Maintenance"><span >1</span> <span >Maintenance</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#Listing_packages"><span >1.1</span> <span >Listing packages</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#With_version"><span >1.1.1</span> <span >With version</span></a></li>
<li class="toclevel-3 tocsection-4">
<a href="#With_size"><span >1.1.2</span> <span >With size</span></a>
<ul>
<li class="toclevel-4 tocsection-5"><a href="#Individual_packages"><span >1.1.2.1</span> <span >Individual packages</span></a></li>
<li class="toclevel-4 tocsection-6"><a href="#Packages_and_dependencies"><span >1.1.2.2</span> <span >Packages and dependencies</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-7"><a href="#By_date"><span >1.1.3</span> <span >By date</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#Not_in_a_specified_group,_repository_or_meta_package"><span >1.1.4</span> <span >Not in a specified group, repository or meta package</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Development_packages"><span >1.1.5</span> <span >Development packages</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Browsing_packages"><span >1.2</span> <span >Browsing packages</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Listing_files_owned_by_a_package_with_size"><span >1.3</span> <span >Listing files owned by a package with size</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Identify_files_not_owned_by_any_package"><span >1.4</span> <span >Identify files not owned by any package</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Tracking_unowned_files_created_by_packages"><span >1.5</span> <span >Tracking unowned files created by packages</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Removing_unused_packages_(orphans)"><span >1.6</span> <span >Removing unused packages (orphans)</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Removing_everything_but_essential_packages"><span >1.7</span> <span >Removing everything but essential packages</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Getting_the_dependencies_list_of_several_packages"><span >1.8</span> <span >Getting the dependencies list of several packages</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Listing_changed_backup_files"><span >1.9</span> <span >Listing changed backup files</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Back_up_the_pacman_database"><span >1.10</span> <span >Back up the pacman database</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Check_changelogs_easily"><span >1.11</span> <span >Check changelogs easily</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-20">
<a href="#Installation_and_recovery"><span >2</span> <span >Installation and recovery</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="#Installing_packages_from_a_CD/DVD_or_USB_stick"><span >2.1</span> <span >Installing packages from a CD/DVD or USB stick</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Custom_local_repository"><span >2.2</span> <span >Custom local repository</span></a></li>
<li class="toclevel-2 tocsection-23">
<a href="#Network_shared_pacman_cache"><span >2.3</span> <span >Network shared pacman cache</span></a>
<ul>
<li class="toclevel-3 tocsection-24"><a href="#Read-only_cache"><span >2.3.1</span> <span >Read-only cache</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#Distributed_read-only_cache"><span >2.3.2</span> <span >Distributed read-only cache</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#Read-write_cache"><span >2.3.3</span> <span >Read-write cache</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#two-way_with_rsync"><span >2.3.4</span> <span >two-way with rsync</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Dynamic_reverse_proxy_cache_using_nginx"><span >2.3.5</span> <span >Dynamic reverse proxy cache using nginx</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="#Pacoloco_proxy_cache_server"><span >2.3.6</span> <span >Pacoloco proxy cache server</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#Synchronize_pacman_package_cache_using_synchronization_programs"><span >2.3.7</span> <span >Synchronize pacman package cache using synchronization programs</span></a></li>
<li class="toclevel-3 tocsection-31"><a href="#Preventing_unwanted_cache_purges"><span >2.3.8</span> <span >Preventing unwanted cache purges</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-32"><a href="#Recreate_a_package_from_the_file_system"><span >2.4</span> <span >Recreate a package from the file system</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#List_of_installed_packages"><span >2.5</span> <span >List of installed packages</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Install_packages_from_a_list"><span >2.6</span> <span >Install packages from a list</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Listing_all_changed_files_from_packages"><span >2.7</span> <span >Listing all changed files from packages</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Reinstalling_all_packages"><span >2.8</span> <span >Reinstalling all packages</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#Restore_pacman's_local_database"><span >2.9</span> <span >Restore pacman's local database</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#Recovering_a_USB_key_from_existing_install"><span >2.10</span> <span >Recovering a USB key from existing install</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Viewing_a_single_file_inside_a_.pkg_file"><span >2.11</span> <span >Viewing a single file inside a .pkg file</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Find_applications_that_use_libraries_from_older_packages"><span >2.12</span> <span >Find applications that use libraries from older packages</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#Installing_only_content_in_required_languages"><span >2.13</span> <span >Installing only content in required languages</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-42">
<a href="#Performance"><span >3</span> <span >Performance</span></a>
<ul>
<li class="toclevel-2 tocsection-43">
<a href="#Download_speeds"><span >3.1</span> <span >Download speeds</span></a>
<ul>
<li class="toclevel-3 tocsection-44"><a href="#Powerpill"><span >3.1.1</span> <span >Powerpill</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#wget"><span >3.1.2</span> <span >wget</span></a></li>
<li class="toclevel-3 tocsection-46"><a href="#aria2"><span >3.1.3</span> <span >aria2</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="#Other_applications"><span >3.1.4</span> <span >Other applications</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-48">
<a href="#Utilities"><span >4</span> <span >Utilities</span></a>
<ul>
<li class="toclevel-2 tocsection-49"><a href="#Graphical"><span >4.1</span> <span >Graphical</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Maintenance">Maintenance</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../../File:Tango-view-fullscreen.png" ><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <code>Usage=</code> introduced with pacman 4.2, see <a rel="nofollow"  href="http://allanmcrae.com/2014/12/pacman-4-2-released/">[1]</a> (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Pacman/Tips_and_tricks">Talk:Pacman/Tips and tricks#</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Instead of using <i>comm</i> (which requires sorted input with <i>sort</i>) in the sections below, you may also use <code>grep -Fxf</code> or <code>grep -Fxvf</code>.</div>
<p>See also <a href="../../System_maintenance.html" title="System maintenance">System maintenance</a>.
</p>
<h3><span class="mw-headline" id="Listing_packages">Listing packages</span></h3>
<h4><span class="mw-headline" id="With_version">With version</span></h4>
<p>You may want to get the list of installed packages with their version, which is useful when reporting bugs or discussing installed packages.
</p>
<ul>
<li>List all explicitly installed packages: <code>pacman -Qe</code>.</li>
<li>List all packages in the <a href="../../Meta_package_and_package_group.html" class="mw-redirect" title="Package group">package group</a> named <code><i>group</i></code>: <code>pacman -Sg <i>group</i></code>
</li>
<li>List all foreign packages (typically manually downloaded and installed or packages removed from the repositories): <code>pacman -Qm</code>.</li>
<li>List all native packages (installed from the sync database(s)): <code>pacman -Qn</code>.</li>
<li>List all explicitly installed native packages (i.e. present in the sync database) that are not direct or optional dependencies: <code>pacman -Qent</code>.</li>
<li>List packages by regex: <code>pacman -Qs <i>regex</i></code>.</li>
<li>List packages by regex with custom output format (needs <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=expac">expac</a></span>): <code>expac -s "%-30n %v" <i>regex</i></code>.</li>
</ul>
<h4><span class="mw-headline" id="With_size">With size</span></h4>
<p>Figuring out which packages are largest can be useful when trying to free space on your hard drive. There are two options here: get the size of individual packages, or get the size of packages and their dependencies.
</p>
<h5><span class="mw-headline" id="Individual_packages">Individual packages</span></h5>
<p>The following command will list all installed packages and their individual sizes:
</p>
<pre>$ LC_ALL=C pacman -Qi | awk '/^Name/{name=$3} /^Installed Size/{print $4$5, name}' | sort -h
</pre>
<h5><span class="mw-headline" id="Packages_and_dependencies">Packages and dependencies</span></h5>
<p>To list package sizes with their dependencies,
</p>
<ul>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=expac">expac</a></span> and run <code>expac -H M '%m\t%n' | sort -h</code>.</li>
<li>Run <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacgraph">pacgraph</a></span> with the <code>-c</code> option.</li>
</ul>
<p>To list the download size of several packages (leave <code><i>packages</i></code> blank to list all packages):
</p>
<pre>$ expac -S -H M '%k\t%n' <i>packages</i>
</pre>
<p>To list explicitly installed packages not in the <a href="../../Meta_package_and_package_group.html#Difference_between_meta_package_and_package_group" class="mw-redirect" title="Meta package">meta package</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=base">base</a></span> nor <a href="../../Meta_package_and_package_group.html" class="mw-redirect" title="Package group">package group</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/groups/x86_64/base-devel/">base-devel</a></span> with size and description:
</p>
<pre>$ expac -H M "%011m\t%-20n\t%10d" $(comm -23 &lt;(pacman -Qqen | sort) &lt;({ pacman -Qqg base-devel; expac -l '\n' '%E' base; } | sort | uniq)) | sort -n
</pre>
<p>To list the packages marked for upgrade with their download size
</p>
<pre>$ expac -S -H M '%k\t%n' $(pacman -Qqu) | sort -sh
</pre>
<h4><span class="mw-headline" id="By_date">By date</span></h4>
<p>To list the 20 last installed packages with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=expac">expac</a></span>, run:
</p>
<pre>$ expac --timefmt='%Y-%m-%d %T' '%l\t%n' | sort | tail -n 20
</pre>
<p>or, with seconds since the epoch (1970-01-01 UTC):
</p>
<pre>$ expac --timefmt=%s '%l\t%n' | sort -n | tail -n 20
</pre>
<h4>
<span id="Not_in_a_specified_group.2C_repository_or_meta_package"></span><span class="mw-headline" id="Not_in_a_specified_group,_repository_or_meta_package">Not in a specified group, repository or meta package</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To get a list of packages installed as dependencies but no longer required by any installed package, see <a href="#Removing_unused_packages_(orphans)">#Removing unused packages (orphans)</a>.
</div>
<p>List explicitly installed packages not in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=base">base</a></span> <a href="../../Meta_package_and_package_group.html#Difference_between_meta_package_and_package_group" class="mw-redirect" title="Meta package">meta package</a>:
</p>
<pre>$ comm -23 &lt;(pacman -Qqe | sort) &lt;(expac -l '\n' '%E' base | sort)
</pre>
<p>List explicitly installed packages not in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=base">base</a></span> meta package or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/groups/x86_64/base-devel/">base-devel</a></span> <a href="../../Meta_package_and_package_group.html" class="mw-redirect" title="Package group">package group</a>:
</p>
<pre>$ comm -23 &lt;(pacman -Qqe | sort) &lt;({ pacman -Qqg base-devel; expac -l '\n' '%E' base; } | sort -u)
</pre>
<p>List all installed packages unrequired by other packages, and which are not in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=base">base</a></span> meta package or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/groups/x86_64/base-devel/">base-devel</a></span> package group:
</p>
<pre>$ comm -23 &lt;(pacman -Qqt | sort) &lt;({ pacman -Qqg base-devel; expac -l '\n' '%E' base; } | sort -u)
</pre>
<p>As above, but with descriptions:
</p>
<pre>$ expac -H M '%-20n\t%10d' $(comm -23 &lt;(pacman -Qqt | sort) &lt;({ pacman -Qqg base-devel; expac -l '\n' '%E' base; } | sort -u))
</pre>
<p>List all installed packages that are <i>not</i> in the specified repository <i>repo_name</i>
</p>
<pre>$ comm -23 &lt;(pacman -Qq | sort) &lt;(pacman -Sql <i>repo_name</i> | sort)
</pre>
<p>List all installed packages that are in the <i>repo_name</i> repository:
</p>
<pre>$ comm -12 &lt;(pacman -Qq | sort) &lt;(pacman -Sql <i>repo_name</i> | sort)
</pre>
<p>List all packages on the TOS Linux ISO that are not in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=base">base</a></span> meta package:
</p>
<pre>$ comm -23 &lt;(curl https://git.archlinux.org/archiso.git/plain/configs/releng/packages.x86_64) &lt;(expac -l '\n' '%E' base | sort)
</pre>
<h4><span class="mw-headline" id="Development_packages">Development packages</span></h4>
<p>To list all development/unstable packages, run:
</p>
<pre>$ pacman -Qq | grep -Ee '-(bzr|cvs|darcs|git|hg|svn)$'
</pre>
<h3><span class="mw-headline" id="Browsing_packages">Browsing packages</span></h3>
<p>To browse all installed packages with an instant preview of each package:
</p>
<pre>$ pacman -Qq | fzf --preview 'pacman -Qil {}' --layout=reverse --bind 'enter:execute(pacman -Qil {} | less)'
</pre>
<p>This uses <a href="../../Fzf.html" title="Fzf">fzf</a> to present a two-pane view listing all packages with package info shown on the right.
</p>
<p>Enter letters to filter the list of packages; use arrow keys (or <code>Ctrl-j</code>/<code>Ctrl-k</code>) to navigate; press <code>Enter</code> to see package info under <i>less</i>.
</p>
<h3><span class="mw-headline" id="Listing_files_owned_by_a_package_with_size">Listing files owned by a package with size</span></h3>
<p>This one might come in handy if you have found that a specific package uses a huge amount of space and you want to find out which files make up the most of that.
</p>
<pre>$ pacman -Qlq <i>package</i> | grep -v '/$' | xargs -r du -h | sort -h
</pre>
<h3><span class="mw-headline" id="Identify_files_not_owned_by_any_package">Identify files not owned by any package</span></h3>
<p>If your system has stray files not owned by any package (a common case if you do not <a href="../../System_maintenance.html#Use_the_package_manager_to_install_software" class="mw-redirect" title="Enhance system stability">use the package manager to install software</a>), you may want to find such files in order to clean them up.
</p>
<p>One method is to use <code>pacreport --unowned-files</code> as the root user from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacutils">pacutils</a></span> which will list unowned files among other details.
</p>
<p>Another is to list all files of interest and check them against pacman:
</p>
<pre># find /etc /usr /opt /var | LC_ALL=C pacman -Qqo - 2&gt;&amp;1 &gt; /dev/null | cut -d ' ' -f 5-
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=lostfiles">lostfiles</a></span> script performs similar steps, but also includes an extensive blacklist to remove common false positives from the output.</div>
<h3><span class="mw-headline" id="Tracking_unowned_files_created_by_packages">Tracking unowned files created by packages</span></h3>
<p>Most systems will slowly collect several <a rel="nofollow"  href="http://ftp.rpm.org/max-rpm/s1-rpm-inside-files-list-directives.html#S3-RPM-INSIDE-FLIST-GHOST-DIRECTIVE">ghost</a> files such as state files, logs, indexes, etc. through the course of usual operation.
</p>
<p><code>pacreport</code> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacutils">pacutils</a></span> can be used to track these files and their associations via <code>/etc/pacreport.conf</code> (see <span class="plainlinks archwiki-template-man" title="$ man 1 pacreport"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/pacreport.1#FILES">pacreport(1)</a></span>).
</p>
<p>An example may look something like this (abridged):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacreport.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Options]
IgnoreUnowned = usr/share/applications/mimeinfo.cache

[PkgIgnoreUnowned]
alsa-utils = var/lib/alsa/asound.state
bluez = var/lib/bluetooth
ca-certificates = etc/ca-certificates/trust-source/*
dbus = var/lib/dbus/machine-id
glibc = etc/ld.so.cache
grub = boot/grub/*
linux-tos= boot/initramfs-linux.img
pacman = var/lib/pacman/local
update-mime-database = usr/share/mime/magic
</pre>
<p>Then, when using <code>pacreport --unowned-files</code> as the root user, any unowned files will be listed if the associated package is no longer installed (or if any new files have been created).
</p>
<p>Additionally, <a rel="nofollow"  href="https://github.com/CyberShadow/aconfmgr">aconfmgr</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/aconfmgr-git/">aconfmgr-git</a></span><sup><small>AUR</small></sup>) allows tracking modified and orphaned files using a configuration script.
</p>
<h3>
<span id="Removing_unused_packages_.28orphans.29"></span><span class="mw-headline" id="Removing_unused_packages_(orphans)">Removing unused packages (orphans)</span>
</h3>
<p>For recursively removing orphans and their configuration files:
</p>
<pre># pacman -Rns $(pacman -Qtdq)
</pre>
<p>If no orphans were found <i>pacman</i> outputs <code>error: no targets specified</code>. This is expected as no arguments were passed to <code>pacman -Rns</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The arguments <code>-Qt</code> list only true orphans. To include packages which are <i>optionally</i> required by another package, pass the <code>-t</code> flag twice (<i>i.e.</i>, <code>-Qtt</code>).</div>
<h3><span class="mw-headline" id="Removing_everything_but_essential_packages">Removing everything but essential packages</span></h3>
<p>If it is ever necessary to remove all packages except the essentials packages, one method is to set the installation reason of the non-essential ones as dependency and then remove all unnecessary dependencies.
</p>
<p>First, for all the packages installed "as explicitly", change their installation reason to "as dependency":
</p>
<pre># pacman -D --asdeps $(pacman -Qqe)
</pre>
<p>Then, change the installation reason to "as explicitly" of only the essential packages, those you <b>do not</b> want to remove, in order to avoid targeting them:
</p>
<pre># pacman -D --asexplicit base linux-toslinux-firmware
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Additional packages can be added to the above command in order to avoid being removed. See <a href="../../Installation_guide.html#Install_essential_packages" title="Installation guide">Installation guide#Install essential packages</a> for more info on other packages that may be necessary for a fully functional base system.</li>
<li>This will also select the bootloader's package for removal. The system should still be bootable, but the boot parameters might not be changeable without it.</li>
</ul>
</div>
<p>Finally, follow the instructions in <a href="#Removing_unused_packages_(orphans)">#Removing unused packages (orphans)</a> to remove all packages that have installation reason "as dependency".
</p>
<h3><span class="mw-headline" id="Getting_the_dependencies_list_of_several_packages">Getting the dependencies list of several packages</span></h3>
<p>Dependencies are alphabetically sorted and doubles are removed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To only show the tree of local installed packages, use <code>pacman -Qi</code>.</div>
<pre>$ LC_ALL=C pacman -Si <i>packages</i> | awk -F'[:&lt;=&gt;]' '/^Depends/ {print $2}' | xargs -n1 | sort -u
</pre>
<p>Alternatively, with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=expac">expac</a></span>: 
</p>
<pre>$ expac -l '\n' %E -S <i>packages</i> | sort -u
</pre>
<h3><span class="mw-headline" id="Listing_changed_backup_files">Listing changed backup files</span></h3>
<p>If you want to back up your system configuration files, you could copy all files in <code>/etc/</code> but usually you are only interested in the files that you have changed. Modified <a href="../../Pacman/Pacnew_and_Pacsave.html#Package_backup_files" class="mw-redirect" title="Pacnew and Pacsave files">backup files</a> can be viewed with the following command:
</p>
<pre># pacman -Qii | awk '/^MODIFIED/ {print $2}'
</pre>
<p>Running this command with root permissions will ensure that files readable only by root (such as <code>/etc/sudoers</code>) are included in the output.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> See <a href="#Listing_all_changed_files_from_packages">#Listing all changed files from packages</a> to list all changed files <i>pacman</i> knows about, not only backup files.</div>
<h3><span class="mw-headline" id="Back_up_the_pacman_database">Back up the pacman database</span></h3>
<p>The following command can be used to back up the local <i>pacman</i> database:
</p>
<pre>$ tar -cjf pacman_database.tar.bz2 /var/lib/pacman/local
</pre>
<p>Store the backup <i>pacman</i> database file on one or more offline media, such as a USB stick, external hard drive, or CD-R.
</p>
<p>The database can be restored by moving the <code>pacman_database.tar.bz2</code> file into the <code>/</code> directory and executing the following command:
</p>
<pre># tar -xjvf pacman_database.tar.bz2
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the <i>pacman</i> database files are corrupted, and there is no backup file available, there exists some hope of rebuilding the <i>pacman</i> database. Consult <a href="#Restore_pacman's_local_database">#Restore pacman's local database</a>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pakbak-git/">pakbak-git</a></span><sup><small>AUR</small></sup> package provides a script and a <a href="../../Systemd.html" title="Systemd">systemd</a> service to automate the task. Configuration is possible in <code>/etc/pakbak.conf</code>.</div>
<h3><span class="mw-headline" id="Check_changelogs_easily">Check changelogs easily</span></h3>
<p>When maintainers update packages, commits are often commented in a useful fashion. Users can quickly check these from the command line by installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pacolog/">pacolog</a></span><sup><small>AUR</small></sup>. This utility lists recent commit messages for packages from the official repositories or the AUR, by using <code>pacolog &lt;package&gt;</code>.
</p>
<h2><span class="mw-headline" id="Installation_and_recovery">Installation and recovery</span></h2>
<p>Alternative ways of getting and restoring packages.
</p>
<h3>
<span id="Installing_packages_from_a_CD.2FDVD_or_USB_stick"></span><span class="mw-headline" id="Installing_packages_from_a_CD/DVD_or_USB_stick">Installing packages from a CD/DVD or USB stick</span>
</h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="#Custom_local_repository">#Custom local repository</a>.</b><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> Use as an example and avoid duplication (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Pacman/Tips_and_tricks">Talk:Pacman/Tips and tricks#</a>)</div>
</div>
<p>To download packages, or groups of packages:
</p>
<pre># cd ~/Packages
# pacman -Syw base base-devel grub-bios xorg gimp --cachedir .
# repo-add ./custom.db.tar.gz ./*
</pre>
<p>Then you can burn the "Packages" folder to a CD/DVD or transfer it to a USB stick, external HDD, etc.
</p>
<p>To install:
</p>
<p><b>1.</b> Mount the media:
</p>
<pre># mkdir /mnt/repo
# mount /dev/sr0 /mnt/repo    #For a CD/DVD.
# mount /dev/sdxY /mnt/repo   #For a USB stick.
</pre>
<p><b>2.</b> Edit <code>pacman.conf</code> and add this repository <i>before</i> the other ones (e.g. extra, core, etc.). This is important. Do not just uncomment the one on the bottom. This way it ensures that the files from the CD/DVD/USB take precedence over those in the standard repositories:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[custom]
SigLevel = PackageRequired
Server = file:///mnt/repo/Packages</pre>
<p><b>3.</b> Finally, synchronize the <i>pacman</i> database to be able to use the new repository:
</p>
<pre># pacman -Syu
</pre>
<h3><span class="mw-headline" id="Custom_local_repository">Custom local repository</span></h3>
<p>Use the <i>repo-add</i> script included with <i>pacman</i> to generate a database for a personal repository. Use <code>repo-add --help</code> for more details on its usage. 
A package database is a tar file, optionally compressed. Valid extensions are <i>.db</i> or <i>.files</i> followed by an archive extension of <i>.tar</i>, <i>.tar.gz</i>, <i>.tar.bz2</i>, <i>.tar.xz</i>, <i>.tar.zst</i>, or <i>.tar.Z</i>. The file does not need to exist, but all parent directories must exist.
</p>
<p>To add a new package to the database, or to replace the old version of an existing package in the database, run:
</p>
<pre>$ repo-add <i>/path/to/repo.db.tar.gz /path/to/package-1.0-1-x86_64.pkg.tar.xz</i>
</pre>
<p>The database and the packages do not need to be in the same directory when using <i>repo-add</i>, but keep in mind that when using <i>pacman</i> with that database, they should be together. Storing all the built packages to be included in the repository in one directory also allows to use shell glob expansion to add or update multiple packages at once:
</p>
<pre>$ repo-add <i>/path/to/repo.db.tar.gz /path/to/*.pkg.tar.xz</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <i>repo-add</i> adds the entries into the database in the same order as passed on the command line. If multiple versions of the same package are involved, care must be taken to ensure that the correct version is added last. In particular, note that lexical order used by the shell depends on the locale and differs from the <a rel="nofollow"  href="https://www.archlinux.org/pacman/vercmp.8.html">vercmp</a> ordering used by <i>pacman</i>.</div>
<p>If you are looking to support multiple architectures then precautions should be taken to prevent errors from occurring. Each architecture should have its own directory tree:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ tree ~/customrepo/ | sed "s/$(uname -m)/&lt;arch&gt;/g"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/home/archie/customrepo/
└── &lt;arch&gt;
    ├── customrepo.db -&gt; customrepo.db.tar.xz
    ├── customrepo.db.tar.xz
    ├── customrepo.files -&gt; customrepo.files.tar.xz
    ├── customrepo.files.tar.xz
    └── personal-website-git-b99cce0-1-&lt;arch&gt;.pkg.tar.xz

1 directory, 5 files
</pre>
<p>The <i>repo-add</i> executable checks if the package is appropriate. If this is not the case you will be running into error messages similar to this:
</p>
<pre>==&gt; ERROR: '/home/archie/customrepo/&lt;arch&gt;/foo-&lt;arch&gt;.pkg.tar.xz' does not have a valid database archive extension.
</pre>
<p><i>repo-remove</i> is used to remove packages from the package database, except that only package names are specified on the command line.
</p>
<pre>$ repo-remove <i>/path/to/repo.db.tar.gz pkgname</i>
</pre>
<p>Once the local repository database has been created, add the repository to <code>pacman.conf</code> for each system that is to use the repository. An example of a custom repository is in <code>pacman.conf</code>. The repository's name is the database filename with the file extension omitted. In the case of the example above the repository's name would simply be <i>repo</i>. Reference the repository's location using a <code>file://</code> url, or via FTP using <a rel="nofollow"  href="ftp://localhost/path/to/directory">ftp://localhost/path/to/directory</a>.
</p>
<p>If willing, add the custom repository to the <a href="../../Unofficial_user_repositories.html" title="Unofficial user repositories">list of unofficial user repositories</a>, so that the community can benefit from it.
</p>
<h3><span class="mw-headline" id="Network_shared_pacman_cache">Network shared pacman cache</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../../Package_Proxy_Cache.html" title="Package Proxy Cache">Package_Proxy_Cache</a>.</b><a href="../../File:Merge-arrows-2.png" ><img alt="Merge-arrows-2.png" src="../../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> Same topic (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:Pacman/Tips_and_tricks">Talk:Pacman/Tips and tricks#</a>)</div>
</div>
<p>If you happen to run several TOS boxes on your LAN, you can share packages so that you can greatly decrease your download times. Keep in mind you should not share between different architectures (i.e. i686 and x86_64) or you will run into problems.
</p>
<h4><span class="mw-headline" id="Read-only_cache">Read-only cache</span></h4>
<p>If you are looking for a quick solution, you can simply run a standalone webserver, e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=darkhttpd">darkhttpd</a></span>, which other computers can use as a first mirror:
</p>
<pre># ln /var/lib/pacman/sync/*.db /var/cache/pacman/pkg
$ sudo -u http darkhttpd /var/cache/pacman/pkg --no-server-id
</pre>
<p>You could also run darkhttpd as a systemd service for convenience. Just add this server at the top of your <code>/etc/pacman.d/mirrorlist</code> in client machines with <code>Server = http://mymirror:8080</code>. Make sure to keep your mirror updated.
</p>
<p>If you are already running a web server for some other purpose, you might wish to reuse that as your local repo server instead of darkhttpd. For example, if you already serve a site with <a href="../../Nginx.html" title="Nginx">nginx</a>, you can add an nginx server block listening on port 8080:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/nginx.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server {
    listen 8080;
    root /var/cache/pacman/pkg;
    server_name myarchrepo.localdomain;
    try_files $uri $uri/;
}
</pre>
<p>Remember to restart nginx after making this change.
</p>
<p>Whichever web server you use, remember to open port 8080 to local traffic (and you probably want to deny anything not local), so add a rule like the following to <a href="../../Iptables.html" title="Iptables">iptables</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/iptables/iptables.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">-A TCP -s 192.168.0.0/16 -p tcp -m tcp --dport 8080 -j ACCEPT
</pre>
<p>Remember to restart iptables after making this change.
</p>
<h4><span class="mw-headline" id="Distributed_read-only_cache">Distributed read-only cache</span></h4>
<p>There are TOS-specific tools for automatically discovering other computers on your network offering a package cache. Try <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacredir">pacredir</a></span>, <a href="../../Pacserve.html" title="Pacserve">pacserve</a>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pkgdistcache/">pkgdistcache</a></span><sup><small>AUR</small></sup>, or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/paclan/">paclan</a></span><sup><small>AUR</small></sup>. pkgdistcache uses Avahi instead of plain UDP which may work better in certain home networks that route instead of bridge between WiFi and Ethernet.
</p>
<p>Historically, there was <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=64391">PkgD</a> and <a rel="nofollow"  href="https://github.com/toofishes/multipkg">multipkg</a>, but they are no longer maintained.
</p>
<h4><span class="mw-headline" id="Read-write_cache">Read-write cache</span></h4>
<p>In order to share packages between multiple computers, simply share <code>/var/cache/pacman/</code> using any network-based mount protocol. This section shows how to use <a href="../../Shfs.html" title="Shfs">shfs</a> or <a href="../../SSHFS.html" title="SSHFS">SSHFS</a> to share a package cache plus the related library-directories between multiple computers on the same local network. Keep in mind that a network shared cache can be slow depending on the file-system choice, among other factors.
</p>
<p>First, install any network-supporting filesystem packages: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=shfs-utils">shfs-utils</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=sshfs">sshfs</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=curlftpfs">curlftpfs</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=samba">samba</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=nfs-utils">nfs-utils</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>To use <i>sshfs</i> or <i>shfs</i>, consider reading <a href="../../SSH_keys.html" class="mw-redirect" title="Using SSH Keys">Using SSH Keys</a>.</li>
<li>By default, <i>smbfs</i> does not serve filenames that contain colons, which results in the client downloading the offending package afresh. To prevent this, use the <code>mapchars</code> mount option on the client.</li>
</ul>
</div>
<p>Then, to share the actual packages, mount <code>/var/cache/pacman/pkg</code> from the server to <code>/var/cache/pacman/pkg</code> on every client machine.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not make <code>/var/cache/pacman/pkg</code> or any of its ancestors (e.g., <code>/var</code>) a symlink. <i>Pacman</i> expects these to be directories. When <i>pacman</i> re-installs or upgrades itself, it will remove the symlinks and create empty directories instead. However during the transaction <i>pacman</i> relies on some files residing there, hence breaking the update process. Refer to <a rel="nofollow"  href="https://bugs.archlinux.org/task/50298">FS#50298</a> for further details.</div>
<h4><span class="mw-headline" id="two-way_with_rsync">two-way with rsync</span></h4>
<p>Another approach in a local environment is <a href="../../Rsync.html" title="Rsync">rsync</a>. Choose a server for caching and enable the <a href="../../Rsync.html#rsync_daemon" title="Rsync">Rsync#rsync daemon</a>. On clients synchronize two-way with this share via rsync protocol. Filenames that contain colons are no problem for the rsync protocol.
</p>
<p>Draft example for a client, using <code>uname -m</code> within the share name ensures an architecture dependant sync:
</p>
<pre> # rsync rsync://server/share_$(uname -m)/ /var/cache/pacman/pkg/ ...
 # pacman ...
 # paccache ...
 # rsync /var/cache/pacman/pkg/ rsync://server/share_$(uname -m)/  ...
</pre>
<h4><span class="mw-headline" id="Dynamic_reverse_proxy_cache_using_nginx">Dynamic reverse proxy cache using nginx</span></h4>
<p><a href="../../Nginx.html" title="Nginx">nginx</a> can be used to proxy package requests to official upstream mirrors and cache the results to the local disk. All subsequent requests for that package will be served directly from the local cache, minimizing the amount of internet traffic needed to update a large number of computers. 
</p>
<p>In this example, the cache server will run at <code>http://cache.domain.example:8080/</code> and store the packages in <code>/srv/http/pacman-cache/</code>. 
</p>
<p>Install <a href="../../Nginx.html" title="Nginx">nginx</a> on the computer that is going to host the cache. Create the directory for the cache and adjust the permissions so nginx can write files to it:
</p>
<pre># mkdir /srv/http/pacman-cache
# chown http:http /srv/http/pacman-cache
</pre>
<p>Use the <a rel="nofollow"  href="https://github.com/nastasie-octavian/nginx_pacman_cache_config/blob/c54eca4776ff162ab492117b80be4df95880d0e2/nginx.conf">nginx pacman cache config</a> as a starting point for <code>/etc/nginx/nginx.conf</code>. Check that the <code>resolver</code> directive works for your needs. In the upstream server blocks, configure the <code>proxy_pass</code> directives with addresses of official mirrors, see examples in the config file about the expected format. Once you are satisfied with the configuration file <a href="../../Nginx.html#Running" title="Nginx">start and enable nginx</a>.
</p>
<p>In order to use the cache each TOS Linux computer (including the one hosting the cache) must have the following line at the top of the <code>mirrorlist</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/mirrorlist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Server = http://cache.domain.example:8080/$repo/os/$arch
...
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  You will need to create a method to clear old packages, as the cache directory will continue to grow over time. <code>paccache</code> (which is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span>) can be used to automate this using retention criteria of your choosing. For example, <code>find /srv/http/pacman-cache/ -type d -exec paccache -v -r -k 2 -c {} \;</code> will keep the last 2 versions of packages in your cache directory.</div>
<h4><span class="mw-headline" id="Pacoloco_proxy_cache_server">Pacoloco proxy cache server</span></h4>
<p><a rel="nofollow"  href="https://github.com/anatol/pacoloco">Pacoloco</a> is an easy-to-use proxy cache server for pacman repositories. It can be installed as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pacoloco-git/">pacoloco-git</a></span><sup><small>AUR</small></sup>. Open the configuration file and add pacman mirrors:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacoloco.yaml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">port: 9129
repos:
  mycopy:
    urls:
      - http://mirror.lty.me/archlinux
      - http://mirrors.kernel.org/archlinux
</pre>
<p><a href="../../Systemd.html#Using_units" class="mw-redirect" title="Restart">Restart</a> <code>pacoloco.service</code> and the proxy repository will be available at <code>http://&lt;myserver&gt;:9129/repo/mycopy</code>.
</p>
<h4><span class="mw-headline" id="Synchronize_pacman_package_cache_using_synchronization_programs">Synchronize pacman package cache using synchronization programs</span></h4>
<p>Use <a href="../../Syncthing.html" title="Syncthing">Syncthing</a> or <a href="../../Resilio_Sync.html" title="Resilio Sync">Resilio Sync</a> to synchronize the <i>pacman</i> cache folders (i.e. <code>/var/cache/pacman/pkg</code>).
</p>
<h4><span class="mw-headline" id="Preventing_unwanted_cache_purges">Preventing unwanted cache purges</span></h4>
<p>By default, <code>pacman -Sc</code> removes package tarballs from the cache that correspond to packages that are not installed on the machine the command was issued on. Because <i>pacman</i> cannot predict what packages are installed on all machines that share the cache, it will end up deleting files that should not be.
</p>
<p>To clean up the cache so that only <i>outdated</i> tarballs are deleted, add this entry in the <code>[options]</code> section of <code>/etc/pacman.conf</code>:
</p>
<pre>CleanMethod = KeepCurrent
</pre>
<h3><span class="mw-headline" id="Recreate_a_package_from_the_file_system">Recreate a package from the file system</span></h3>
<p>To recreate a package from the file system, use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/fakepkg/">fakepkg</a></span><sup><small>AUR</small></sup>. Files from the system are taken as they are, hence any modifications will be present in the assembled package. Distributing the recreated package is therefore discouraged; see <a href="../../TOS_Build_System.html" class="mw-redirect" title="ABS">ABS</a> and <a href="../../TOS_Linux_TOSive.html" title="TOS Linux TOSive">TOS Linux TOSive</a> for alternatives.
</p>
<h3><span class="mw-headline" id="List_of_installed_packages">List of installed packages</span></h3>
<p>Keeping a list of all the explicitly installed packages can be useful, to backup a system for example or speed up installation on a new system:
</p>
<pre>$ pacman -Qqe &gt; pkglist.txt
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>With option <code>-t</code>, the packages already required by other explicitly installed packages are not mentioned. If reinstalling from this list they will be installed but as dependencies only.</li>
<li>With option <code>-n</code>, foreign packages (e.g. from <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>) would be omitted from the list.</li>
<li>Use <code>comm -13 &lt;(pacman -Qqdt | sort) &lt;(pacman -Qqdtt | sort) &gt; optdeplist.txt</code> to also create a list of the installed optional dependencies which can be reinstalled with <code>--asdeps</code>.</li>
<li>Use <code>pacman -Qqem &gt; foreignpkglist.txt</code> to create the list of AUR and other foreign packages that have been explicitly installed.</li>
</ul>
</div>
<p>To keep an up-to-date list of explicitly installed packages (e.g. in combination with a versioned <code>/etc/</code>), you can set up a <a href="../../Pacman.html#Hooks" title="Pacman">hook</a>. Example:
</p>
<pre>[Trigger]
Operation = Install
Operation = Remove
Type = Package
Target = *

[Action]
When = PostTransaction
Exec = /bin/sh -c '/usr/bin/pacman -Qqe &gt; /etc/pkglist.txt'
</pre>
<h3><span class="mw-headline" id="Install_packages_from_a_list">Install packages from a list</span></h3>
<p>To install packages from a previously saved list of packages, while not reinstalling previously installed packages that are already up-to-date, run:
</p>
<pre># pacman -S --needed - &lt; pkglist.txt
</pre>
<p>However, it is likely foreign packages such as from the AUR or installed locally are present in the list. To filter out from the list the foreign packages, the previous command line can be enriched as follows:
</p>
<pre># pacman -S --needed $(comm -12 &lt;(pacman -Slq | sort) &lt;(sort pkglist.txt))
</pre>
<p>Eventually, to make sure the installed packages of your system match the list and remove all the packages that are not mentioned in it:
</p>
<pre># pacman -Rsu $(comm -23 &lt;(pacman -Qq | sort) &lt;(sort pkglist.txt))
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> These tasks can be automated. See <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/bacpac/">bacpac</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/packup/">packup</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pacmanity/">pacmanity</a></span><sup><small>AUR</small></sup>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pug/">pug</a></span><sup><small>AUR</small></sup> for examples.</div>
<h3><span class="mw-headline" id="Listing_all_changed_files_from_packages">Listing all changed files from packages</span></h3>
<p>If you are suspecting file corruption (e.g. by software/hardware failure), but are unsure if files were corrupted, you might want to compare with the hash sums in the packages. This can be done with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacutils">pacutils</a></span>:
</p>
<pre># paccheck --md5sum --quiet
</pre>
<p>For recovery of the database see <a href="#Restore_pacman's_local_database">#Restore pacman's local database</a>. The <code>mtree</code> files can also be <a href="#Viewing_a_single_file_inside_a_.pkg_file">extracted as <code>.MTREE</code> from the respective package files</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This should <b>not</b> be used as is when suspecting malicious changes! In this case security precautions such as using a live medium and an independent source for the hash sums are advised.</div>
<h3><span class="mw-headline" id="Reinstalling_all_packages">Reinstalling all packages</span></h3>
<p>To reinstall all native packages, use:
</p>
<pre># pacman -Qqn | pacman -S -
</pre>
<p>Foreign (AUR) packages must be reinstalled separately; you can list them with <code>pacman -Qqm</code>.
</p>
<p><i>Pacman</i> preserves the <a href="../../Pacman.html#Installation_reason" class="mw-redirect" title="Installation reason">installation reason</a> by default.
</p>
<h3>
<span id="Restore_pacman.27s_local_database"></span><span class="mw-headline" id="Restore_pacman's_local_database">Restore pacman's local database</span>
</h3>
<p>See <a href="../../Pacman/Restore_local_database.html" title="Pacman/Restore local database">Pacman/Restore local database</a>.
</p>
<h3><span class="mw-headline" id="Recovering_a_USB_key_from_existing_install">Recovering a USB key from existing install</span></h3>
<p>If you have TOS installed on a USB key and manage to mess it up (e.g. removing it while it is still being written to), then it is possible to re-install all the packages and hopefully get it back up and working again (assuming USB key is mounted in <code>/newarch</code>)
</p>
<pre># pacman -S $(pacman -Qq --dbpath /newarch/var/lib/pacman) --root /newarch --dbpath /newarch/var/lib/pacman
</pre>
<h3><span class="mw-headline" id="Viewing_a_single_file_inside_a_.pkg_file">Viewing a single file inside a .pkg file</span></h3>
<p>For example, if you want to see the contents of <code>/etc/systemd/logind.conf</code> supplied within the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=systemd">systemd</a></span> package:
</p>
<pre>$ bsdtar -xOf /var/cache/pacman/pkg/systemd-204-3-x86_64.pkg.tar.xz etc/systemd/logind.conf
</pre>
<p>Or you can use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=vim">vim</a></span> to browse the archive:
</p>
<pre>$ vim /var/cache/pacman/pkg/systemd-204-3-x86_64.pkg.tar.xz
</pre>
<h3><span class="mw-headline" id="Find_applications_that_use_libraries_from_older_packages">Find applications that use libraries from older packages</span></h3>
<p>Even if you installed a package the existing long-running programs (like daemons and servers) still keep using code from old package libraries. And it is a bad idea to let these programs running if the old library contains a security bug.
</p>
<p>Here is a way how to find all the programs that use old packages code:
</p>
<pre># lsof +c 0 | grep -w DEL | awk '1 { print $1 ": " $NF }' | sort -u
</pre>
<p>It will print running program name and old library that was removed or replaced with newer content.
</p>
<h3><span class="mw-headline" id="Installing_only_content_in_required_languages">Installing only content in required languages</span></h3>
<p>Many packages attempt to install documentation and translations in several languages. Some programs are designed to remove such unnecessary files, such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/localepurge/">localepurge</a></span><sup><small>AUR</small></sup>, which runs after a package is installed to delete the unneeded locale files. A more direct approach is provided through the <code>NoExtract</code> directive in <code>pacman.conf</code>, which prevent these files from ever being installed.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Some users noted that removing locales has resulted in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php?title=Talk:Pacman&amp;oldid=460285#Dangerous_NoExtract_example">unintended consequences</a>, even under <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=250846">Xorg</a>.</div>
<p>The example below installs English (US) files, or none at all:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NoExtract = usr/share/help/* !usr/share/help/en*
NoExtract = usr/share/gtk-doc/html/*
NoExtract = usr/share/locale/* usr/share/X11/locale/* usr/share/i18n/* opt/google/chrome/locales/* !usr/share/X11/locale/C/*
NoExtract = !*locale*/en*/* !usr/share/i18n/charmaps/UTF-8.gz !usr/share/*locale*/locale.*
NoExtract = !usr/share/*locales/en_?? !usr/share/*locales/i18n* !usr/share/*locales/iso*
NoExtract = !usr/share/*locales/trans*
NoExtract = usr/share/qt4/translations/*
NoExtract = usr/share/man/* !usr/share/man/man*
NoExtract = usr/share/vim/vim*/lang/*
NoExtract = usr/lib/libreoffice/help/en-US/*</pre>
<h2><span class="mw-headline" id="Performance">Performance</span></h2>
<h3><span class="mw-headline" id="Download_speeds">Download speeds</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If your download speeds have been reduced to a crawl, ensure you are using one of the many <a href="../../Mirrors.html" title="Mirrors">mirrors</a> and not ftp.archlinux.org, which is <a rel="nofollow"  href="https://www.archlinux.org/news/302/">throttled since  March 2007</a>.</div>
<p>When downloading packages <i>pacman</i> uses the mirrors in the order they are in <code>/etc/pacman.d/mirrorlist</code>. The mirror which is at the top of the list by default however may not be the fastest for you. To select a faster mirror, see <a href="../../Mirrors.html" title="Mirrors">Mirrors</a>.
</p>
<p><i>Pacman</i>'s speed in downloading packages can also be improved by using a different application to download packages, instead of <i>pacman</i>'s built-in file downloader.
</p>
<p>In all cases, make sure you have the latest <i>pacman</i> before doing any modifications.
</p>
<pre># pacman -Syu
</pre>
<h4><span class="mw-headline" id="Powerpill">Powerpill</span></h4>
<p><a href="../../Powerpill.html" title="Powerpill">Powerpill</a> is a <i>pacman</i> wrapper that uses parallel and segmented downloading to try to speed up downloads for <i>pacman</i>.
</p>
<h4><span class="mw-headline" id="wget">wget</span></h4>
<p>This is also very handy if you need more powerful proxy settings than <i>pacman</i>'s built-in capabilities. 
</p>
<p>To use <code>wget</code>, first <a href="../../Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=wget">wget</a></span> package then modify <code>/etc/pacman.conf</code> by uncommenting the following line in the <code>[options]</code> section:
</p>
<pre>XferCommand = /usr/bin/wget --passive-ftp -c -O %o %u
</pre>
<p>Instead of uncommenting the <code>wget</code> parameters in <code>/etc/pacman.conf</code>, you can also modify the <code>wget</code> configuration file directly (the system-wide file is <code>/etc/wgetrc</code>, per user files are <code>$HOME/.wgetrc</code>).
</p>
<h4><span class="mw-headline" id="aria2">aria2</span></h4>
<p><a href="../../Aria2.html" title="Aria2">aria2</a> is a lightweight download utility with support for resumable and segmented HTTP/HTTPS and FTP downloads. aria2 allows for multiple and simultaneous HTTP/HTTPS and FTP connections to an TOS mirror, which should result in an increase in download speeds for both file and package retrieval.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Using aria2c in <i>pacman</i>'s XferCommand will <b>not</b> result in parallel downloads of multiple packages. <i>Pacman</i> invokes the XferCommand with a single package at a time and waits for it to complete before invoking the next. To download multiple packages in parallel, see <a href="../../Powerpill.html" title="Powerpill">Powerpill</a>.</div>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=aria2">aria2</a></span>, then edit <code>/etc/pacman.conf</code> by adding the following line to the <code>[options]</code> section:
</p>
<pre>XferCommand = /usr/bin/aria2c --allow-overwrite=true --continue=true --file-allocation=none --log-level=error --max-tries=2 --max-connection-per-server=2 --max-file-not-found=5 --min-split-size=5M --no-conf --remote-time=true --summary-interval=60 --timeout=5 --dir=/ --out %o %u
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?pid=1491879#p1491879">This alternative configuration for using <i>pacman</i> with aria2</a> tries to simplify configuration and adds more configuration options.</div>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 1 aria2c"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/aria2c.1#OPTIONS">aria2c(1)</a></span> for used aria2c options.
</p>
<ul>
<li>
<code>-d, --dir</code>: The directory to store the downloaded file(s) as specified by <i>pacman</i>.</li>
<li>
<code>-o, --out</code>: The output file name(s) of the downloaded file(s).</li>
<li>
<code>%o</code>: Variable which represents the local filename(s) as specified by <i>pacman</i>.</li>
<li>
<code>%u</code>: Variable which represents the download URL as specified by <i>pacman</i>.</li>
</ul>
<h4><span class="mw-headline" id="Other_applications">Other applications</span></h4>
<p>There are other downloading applications that you can use with <i>pacman</i>. Here they are, and their associated XferCommand settings:
</p>
<ul>
<li>
<code>snarf</code>: <code>XferCommand = /usr/bin/snarf -N %u</code>
</li>
<li>
<code>lftp</code>: <code>XferCommand = /usr/bin/lftp -c pget %u</code>
</li>
<li>
<code>axel</code>: <code>XferCommand = /usr/bin/axel -n 2 -v -a -o %o %u</code>
</li>
<li>
<code>hget</code>: <code>XferCommand = /usr/bin/hget %u -n 2 -skip-tls false</code> (please read the <a rel="nofollow"  href="https://github.com/huydx/hget">documentation on the Github project page</a> for more info)</li>
</ul>
<h2><span class="mw-headline" id="Utilities">Utilities</span></h2>
<ul><li>
<b>Lostfiles</b> — Script that identifies files not owned by any package.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/graysky2/lostfiles">https://github.com/graysky2/lostfiles</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=lostfiles">lostfiles</a></span>
</dd></dl>
<ul><li>
<b>Pacmatic</b> — <i>Pacman</i> wrapper to check TOS News before upgrading, avoid partial upgrades, and warn about configuration file changes.</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://kmkeen.com/pacmatic">http://kmkeen.com/pacmatic</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacmatic">pacmatic</a></span>
</dd></dl>
<ul><li>
<b>pacutils</b> — Helper library for libalpm based programs.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/andrewgregory/pacutils">https://github.com/andrewgregory/pacutils</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pacutils">pacutils</a></span>
</dd></dl>
<ul><li>
<b><a href="../../Pkgfile.html" title="Pkgfile">pkgfile</a></b> — Tool that finds what package owns a file.</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://github.com/falconindy/pkgfile">http://github.com/falconindy/pkgfile</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pkgfile">pkgfile</a></span>
</dd></dl>
<ul><li>
<b>pkgtools</b> — Collection of scripts for TOS Linux packages.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/Daenyth/pkgtools">https://github.com/Daenyth/pkgtools</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pkgtools/">pkgtools</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>pkgtop</b> — Interactive package manager and resource monitor designed for the GNU/Linux.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/orhun/pkgtop">https://github.com/orhun/pkgtop</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/pkgtop-git/">pkgtop-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b><a href="../../Powerpill.html" title="Powerpill">Powerpill</a></b> — Uses parallel and segmented downloading through <a href="../../Aria2.html" title="Aria2">aria2</a> and <a href="../../Reflector.html" title="Reflector">Reflector</a> to try to speed up downloads for <i>pacman</i>.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://xyne.archlinux.ca/projects/powerpill/">https://xyne.archlinux.ca/projects/powerpill/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/powerpill/">powerpill</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>repoctl</b> — Tool to help manage local repositories.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/cassava/repoctl">https://github.com/cassava/repoctl</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/repoctl/">repoctl</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>repose</b> — An TOS Linux repository building tool.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/vodik/repose">https://github.com/vodik/repose</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=repose">repose</a></span>
</dd></dl>
<ul><li>
<b><a href="../../Snapper.html#Wrapping_pacman_transactions_in_snapshots" title="Snapper">snap-pac</a></b> — Make <i>pacman</i> automatically use snapper to create pre/post snapshots like openSUSE's YaST.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/wesbarnett/snap-pac">https://github.com/wesbarnett/snap-pac</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=snap-pac">snap-pac</a></span>
</dd></dl>
<ul><li>
<b>vrms-arch</b> — A virtual Richard M. Stallman to tell you which non-free packages are installed.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/orospakr/vrms-arch">https://github.com/orospakr/vrms-arch</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/vrms-arch/">vrms-arch</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h3><span class="mw-headline" id="Graphical">Graphical</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> PackageKit opens up system permissions by default, and is otherwise not recommended for general usage. See <a rel="nofollow"  href="https://bugs.archlinux.org/task/50459">FS#50459</a> and <a rel="nofollow"  href="https://bugs.archlinux.org/task/57943">FS#57943</a>.</div>
<ul><li>
<b>Apper</b> — Qt 5 application and package manager using PackageKit written in C++. Supports <a rel="nofollow"  href="https://www.freedesktop.org/wiki/Distributions/AppStream/">AppStream metadata</a>.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://userbase.kde.org/Apper">https://userbase.kde.org/Apper</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=apper">apper</a></span>
</dd></dl>
<ul><li>
<b>Discover</b> — Qt 5 application manager using PackageKit written in C++/QML. Supports <a rel="nofollow"  href="https://www.freedesktop.org/wiki/Distributions/AppStream/">AppStream metadata</a>, <a href="../../Flatpak.html" title="Flatpak">Flatpak</a> and <a href="../../Fwupd.html" title="Fwupd">firmware updates</a>.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://userbase.kde.org/Discover">https://userbase.kde.org/Discover</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=discover">discover</a></span>
</dd></dl>
<ul><li>
<b>GNOME PackageKit</b> — GTK 3 package manager using PackageKit written in C.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://freedesktop.org/software/PackageKit/">https://freedesktop.org/software/PackageKit/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-packagekit">gnome-packagekit</a></span>
</dd></dl>
<ul><li>
<b>GNOME Software</b> — GTK 3 application manager using PackageKit written in C. Supports <a rel="nofollow"  href="https://www.freedesktop.org/wiki/Distributions/AppStream/">AppStream metadata</a>, <a href="../../Flatpak.html" title="Flatpak">Flatpak</a> and <a href="../../Fwupd.html" title="Fwupd">firmware updates</a>.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://wiki.gnome.org/Apps/Software">https://wiki.gnome.org/Apps/Software</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-software">gnome-software</a></span>
</dd></dl>
<ul><li>
<b>pcurses</b> — Curses TUI pacman wrapper written in C++.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://github.com/schuay/pcurses">https://github.com/schuay/pcurses</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pcurses">pcurses</a></span>
</dd></dl>
<ul><li>
<b>tkPacman</b> — Tk pacman wrapper written in Tcl.</li></ul>
<dl><dd>
<a rel="nofollow"  href="https://sourceforge.net/projects/tkpacman">https://sourceforge.net/projects/tkpacman</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/tkpacman/">tkpacman</a></span><sup><small>AUR</small></sup>
</dd></dl>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:Package_management.html" title="Category:Package management">Package management</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Pacman/Tips_and_tricks&amp;oldid=612978">https://wiki.archlinux.org/index.php?title=Pacman/Tips_and_tricks&amp;oldid=612978</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 15 May 2020, at 12:44.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Securely wipe disk/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../Securely_wipe_disk.html" title="Securely wipe disk">Securely wipe disk</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>See <a href="../../Securely_wipe_disk.html" title="Securely wipe disk">Securely wipe disk</a> for the main article.
</p>
<p>This article describes alternative wiping methods to the specialized utilities that can speed up wiping.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <a href="../../Ext4.html#Reserved_blocks" title="Ext4">Reserved blocks</a> will not be wiped by creation of the files but they can be disabled with utility <code>tune2fs</code>. </div>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Wipe_a_single_file"><span >1</span> <span >Wipe a single file</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Overwrite_the_target"><span >2</span> <span >Overwrite the target</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Prevent_wiping_mounted_partitions"><span >2.1</span> <span >Prevent wiping mounted partitions</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#dd_-_advanced_example"><span >2.2</span> <span >dd - advanced example</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Using_a_template_file"><span >2.3</span> <span >Using a template file</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#Wipe_free_space"><span >3</span> <span >Wipe free space</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Using_dd"><span >3.1</span> <span >Using dd</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Using_7-Zip"><span >3.2</span> <span >Using 7-Zip</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Create_multiple_files_with_help_of_the_timeout_command"><span >3.3</span> <span >Create multiple files with help of the <i>timeout</i> command</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Wipe_a_single_file">Wipe a single file</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Wiping of single files is less effective, if the partition has been <a href="https://en.wikipedia.org/wiki/File_system_fragmentation"  title="wikipedia:File system fragmentation">defragmented</a>, resized or moved, or the files have been <a href="https://en.wikipedia.org/wiki/Temporary_folder"  title="wikipedia:Temporary folder">duplicated</a> on the same device before. It is much harder to recovery if the whole <a href="../../Security.html#Disk_encryption" title="Security">encrypted data</a><sup>[<a href="../../TOS Wiki:Requests.html#Broken_section_links" class="mw-redirect" title="TOS Wiki:Requests">broken link</a>: invalid section]</sup> container part was wiped but encryption will lower <a href="https://en.wikipedia.org/wiki/Disk_encryption#Implementations"  title="wikipedia:Disk encryption">disk performance</a> much, if it is not <a href="https://en.wikipedia.org/wiki/Disk_encryption_hardware"  title="wikipedia:Disk encryption hardware">hardware based</a> encryption that has almost no impact on the performance. See also <a href="../../Securely_wipe_disk.html#Data_remanence" title="Securely wipe disk">Securely wipe disk#Data remanence</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To preserve file access and modification time you can use <span class="plainlinks archwiki-template-man" title="$ man 1 touch"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/touch.1">touch(1)</a></span> command to change time and <span class="plainlinks archwiki-template-man" title="$ man 1 stat"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/stat.1">stat(1)</a></span> command to read time information before accessing the file. See also <a href="https://en.wikipedia.org/wiki/Comparison_of_file_systems#Metadata"  title="wikipedia:Comparison of file systems">comparison of file systems</a> for support of metadata and timestamps by them.</div>
<p>Wiping of a single file consists of two basic and one advanced anti-forensic time consumed method that can be done only with specialized tools, the last one method will not be covered in this article.
</p>
<ul>
<li>Overwrite with random data before deletion or replace content with another one without changing file size.</li>
<li>Wipe file and meta-data stored by the filesystem with specialized tools
<ul><li>Search the whole disk for the deleted left-over parts of the file and wipe them too without making any changes to other files and their traces.</li></ul>
</li>
</ul>
<p>Overwriting of the file without changing its size can be done with common Linux utilities:
</p>
<ul>
<li>Invoking <code>shred -x <i>file</i></code> will replace content of <i>file</i> with pseudo-random data without changing the filesize (<code>-x</code>). Using the <code>-u</code> option will remove <i>file</i> after overwriting it.</li>
<li>With <code>mkfs</code> you can convert file into the filesystem that will alter everything in it, mount and fill in with any other content for a better overwriting.</li>
<li>The <code>dd</code> will create a file with preset size and content of your chose, if destination file name exist then it will become overwritten. With <code>dd</code> command you can replace the whole file or only a part in it with another content by combining <code>skip</code> and <code>seek</code> options. You need to know size of the file to avoid expand of the file, to do it can use <code>du -b <i>file_name</i> | cut -f1</code> or <code>stat -c "%s" <i>file_name</i></code>. It is mandatory to use <code>iflag=fullblock</code> option, see <a href="../../Dd.html#Partial_read" title="Dd">dd#Partial read</a>.</li>
<li>Replace content in a file with a single symbol to avoid size changing you can do with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=perl">perl</a></span> utility.</li>
</ul>
<p>To wipe meta-data you can fill in partition with files that makes file system replace old entries about files with new or use specialized utilities for that, see <a href="#Wipe_free_space">wipe free space</a> section below.
</p>
<p>It is up to you how to combine all of Linux file creation and conversion tools to prevent recovery of files and/or mislead recovery tools and them who uses it by rewriting with random or replace with predefined content. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Simple overwriting has a chance to leave dislocated parts of file if free space is available.</li>
<li>To rewrite content of specific files without changing their location on the disk you can first create a file or files to make partition full and then rewrite or replace content in files you want to hide with preferred utilities. It consumes much useful time if free space is very big and files are very few.</li>
</ul>
</div>
<p>Examples:
</p>
<p><a href="../../Perl.html" title="Perl">Perl</a> command that will replace everything in the file with <code>.</code>:
</p>
<pre>$ perl -p -i -e 's\[^*]\.\g' <i>file_name</i>
</pre>
<p><a href="../../Dd.html" title="Dd">dd</a>:
</p>
<pre>$ <i>source_content</i> | dd bs=<i>size_in_bytes</i> count=1 iflag=fullblock of=<i>destination_file</i> seek=0
</pre>
<p>Or by using <i>stdout</i> redirection that works a slightly faster for creation but you will not be able to use <code>seek</code> option for skipping some parts in the destination:
</p>
<pre>$ <i>source_content</i> | dd bs=<i>size_in_bytes</i> count=1 iflag=fullblock &gt; <i>destination_file</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If source file is lower than destination then you will need to combine it with the <code>while</code> loop described in the section below.</div>
<p>See also:
</p>
<ul>
<li><a rel="nofollow"  href="http://stackoverflow.com/questions/64860/best-way-to-convert-text-files-between-character-sets">convert charset in text files</a></li>
<li>
<a rel="nofollow"  href="http://tldp.org/LDP/abs/html/here-docs.html">Advanced Bash-Scripting Guide</a> - describes more advanced ways about how to create files from a bash script</li>
<li>
<a rel="nofollow"  href="http://www.computing.net/answers/unix/alternative-for-sed-i/7800.html">sed alternatives</a><sup title="Last check status: 410">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-03 ⓘ]</sup> - a perl example that works better than sed for replacing content in a file</li>
</ul>
<h2><span class="mw-headline" id="Overwrite_the_target">Overwrite the target</span></h2>
<h3><span class="mw-headline" id="Prevent_wiping_mounted_partitions">Prevent wiping mounted partitions</span></h3>
<p>Choosing the device to be wiped needs extra care; a simple typo can be enough to damage the system. To minimize these risks, you can use a simple script to wrap your favourite wipe tool. For example: 
</p>
<pre>if [[ -e "$1" &amp;&amp; -b "$1" ]];then 
NOT_safe="$(lsblk -o "NAME,MOUNTPOINT" ${1//[0-9]/} | grep -e / -e '\]')";
 if [[ -z "$NOT_safe" ]];then
# Here you can use any of your favourite wiping tools 
# to wipe destination passed on command line and stored in variable "$1"
# 
  else
  echo 'Not allowed to destroy if any of the partitions is mounted: '"$NOT_safe"
 fi
fi </pre>
<h3><span class="mw-headline" id="dd_-_advanced_example">dd - advanced example</span></h3>
<p>An alternative is to randomize the drive/partition using a randomly-seeded AES cipher from <a href="../../OpenSSL.html" title="OpenSSL">OpenSSL</a>. For example:
</p>
<pre>DEVICE="/dev/sdX"
PASS=$(tr -cd '[:alnum:]' &lt; /dev/urandom | head -c128)
openssl enc -aes-256-ctr -pass pass:"$PASS" -nosalt &lt;/dev/zero | dd bs=64K ibs=64K of=$DEVICE status=progress</pre>
<p>The command above creates a 128 byte encryption key seeded from <code>/dev/urandom</code>. AES-256 in CTR mode is used to encrypt <code>/dev/zero</code>'s output with the urandom key. Utilizing the cipher instead of a pseudorandom source results in very high write speeds and the result is a device filled with AES ciphertext.
</p>
<p>The block size is set to 64K above as it is usually faster than the default 512 bytes, and yields nearly optimal transfer rates across a range of hardware:
<a rel="nofollow"  href="http://superuser.com/questions/234199/good-block-size-for-disk-cloning-with-diskdump-dd">[1]</a> and the references therein.
</p>
<p>See also <a href="../../Dm-crypt/Drive_preparation.html#dm-crypt_wipe_on_an_empty_disk_or_partition" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation#dm-crypt wipe on an empty disk or partition</a> for a similar approach.
</p>
<h3><span class="mw-headline" id="Using_a_template_file">Using a template file</span></h3>
<p>Instead of zeros you can use a bunch of files you want to be found or partition prints made by <code>mkfs</code> formatted files but you should mount and fill it up with content or with any other repeated output from utilities of your choice.
</p>
<p>One way is to wipe until device ends, but this type of redirection is not recommended because you have to use <a href="https://en.wikipedia.org/wiki/Unix_signal"  title="wikipedia:Unix signal">stop keys</a> to break the <code>while</code> loop when errors about device end will show up:
</p>
<pre>$ while [ 1 -lt 2 ];do cat file1-to-use.as-template file2-to-use.as-template /tmp/templatefiles/* ;done &gt; /dev/sd"XY"
</pre>
<p>With <i>dd</i> you can safely wipe repetitively without out-of-space-errors, if size to be wiped is set up correctly with options. By using <i>dd</i> inside the while loop for <i>stdout</i> you will be able to chose which part of the file you want to restore by combining the <code>skip</code> and <code>seek</code> options with random or fixed values e.g. restore only partition start or end from a file, related are <span class="plainlinks archwiki-template-man" title="$ man 1 head"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/head.1">head(1)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 1 tail"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/tail.1">tail(1)</a></span> commands for output of the file parts to <i>stdout</i>.
</p>
<pre>while [ 2 -gt 1 ]; do 
 if [ -z "$(pidof dd)"  ];then 
  break ;
 fi;
cat file1-to-use.as-template file2-to-use.as-template /tmp/templatefiles/* ;
done | dd of=/dev/sd"XY" seek=<i>start_sector</i> bs=<i>sector_size</i> count=<i>sectors_to_wipe</i></pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> For repeatedly rewriting of the same area. You can also use variables from second loop around <code>while ... done | dd ...</code> to change destination of the source template files to use on each new loop.
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have a real big amount of predefined data to use for overwriting then you can use the ability of <a rel="nofollow"  href="http://tldp.org/HOWTO/SquashFS-HOWTO/creatingandusing.html">SquashFS</a> to compress files and folders. Compressing them into a mounted <a rel="nofollow"  href="http://www.linuxscrew.com/2010/03/24/fastest-way-to-create-ramdisk-in-ubuntulinux/">ramdisk</a> will minimize the amount of physical reads but will higher CPU usage. Or create the compressed archive, copy into the <a rel="nofollow"  href="http://www.linuxscrew.com/2010/03/24/fastest-way-to-create-ramdisk-in-ubuntulinux/">ramdisk</a> and use a file extraction utility that can extract to stdout. Downsides are that it is harder to navigate between folders and files, if you do not want to use all and same content for each run. Upsides are that you can use even raw parts of the archive, if it was split into volumes upon creation.</div>
<p>See also: 
</p>
<ul><li>
<a rel="nofollow"  href="http://flashdba.com/4k-sector-size/">sector size</a> - file creation and sector sizes</li></ul>
<h2><span class="mw-headline" id="Wipe_free_space">Wipe free space</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  It is not appropriate to use before <a href="../../Securely_wipe_disk.html#Preparations_for_block_device_encryption" title="Securely wipe disk">preparations for block device encryption</a>.</div>
<p>You can wipe free space by several ways:
</p>
<ul><li>
<a href="../../Securely_wipe_disk.html#By_redirecting_output" title="Securely wipe disk">Redirect output</a> into a file instead of partition or device.</li></ul>
<ul><li>Create multiple file copies by using e.g. <code>cp</code> command in loops with random file names or destination directories until no free space will be left.</li></ul>
<ul><li>Use an utility that creates encrypted files with random password and file names. Some of the file compression utilities have options for compression methods, file types and can even split file into volumes of the preset size upon creation. By using some options randomly into a loop you will be able to fill the whole free space up with encrypted data and overwrite previous data.</li></ul>
<ul><li>Use a specialized program for the free space wiping such as:</li></ul>
<p><b>wipefreespace</b> — Wipe Free Space securely erases the free space on file systems to prevent recovery of deleted sensitive data.
</p>
<dl><dd>
<a rel="nofollow"  href="https://sourceforge.net/projects/wipefreespace/">https://sourceforge.net/projects/wipefreespace/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/wipefreespace/">wipefreespace</a></span><sup><small>AUR</small></sup>
</dd></dl>
<p><b>zerofree</b> — Scans for non-zero free blocks in a filesystem and fills them with zeroes
</p>
<dl><dd>
<a rel="nofollow"  href="https://frippery.org/uml/">https://frippery.org/uml/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/zerofree/">zerofree</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h3><span class="mw-headline" id="Using_dd">Using dd</span></h3>
<p>One can create a file that fills the empty space using <a href="../../Dd.html" title="Dd">dd</a>:
</p>
<pre>dd if=<i>source</i> of=junk
sync
rm junk
</pre>
<p>The <code><i>source</i></code> can be the <code>/dev/urandom</code> or <code>/dev/zero</code> stream.
The file is removed after making sure data has synchronized on disk.
</p>
<h3><span class="mw-headline" id="Using_7-Zip">Using 7-Zip</span></h3>
<pre>Password="$(dd if=/dev/urandom bs=128 count=1)"
DestinationFile="$((${RANDOM/0/1}$(date "+%s")/${RANDOM/0/1}))"
7z a -t7z -mhe=on -p"${Password}" -mx=0 -v1m <i>${DestinationFile} source</i></pre>
<p>See also <span class="plainlinks archwiki-template-man" title="$ man 1 7z"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/7z.1">7z(1)</a></span> for description of used options.
</p>
<p>The <code>source</code> can be a predefined file with random data or a device, e.g. <code>/dev/urandom</code> or another block device or partition on it, e.g. <code>/dev/sd"XY"</code>, with data you are not afraid to be found then even deleted files on it will be compressed to the destination.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>It is not necessary to set level of compression, enough to store data for minimizing CPU usage and a faster fill free space up.</li>
<li>If you are using a single file as a source then you can put it into the <a rel="nofollow"  href="http://www.vanemery.com/Linux/Ramdisk/ramdisk.html">RAM disk</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-03 ⓘ]</sup> or the <code>/tmp</code> folder, because it uses <a href="../../Tmpfs.html" title="Tmpfs">tmpfs</a> that allocates some amount of RAM because it will speed up reading.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Create_multiple_files_with_help_of_the_timeout_command">Create multiple files with help of the <i>timeout</i> command</span></h3>
<p>The <code>timeout</code> command with randomized waiting time used it in a <a rel="nofollow"  href="http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO-7.html">loop</a> will break the command that will leave a file with random size. This is a slow method but is one of the possible alternatives. You can also use an array with predefined file names before the random part of it.
</p>
<pre>AA=${RANDOM/0/1};
timeout $((AA/100)) cat /dev/urandom &gt; filename${RANDOM}.tmp;
</pre>
<p>See also:
</p>
<ul>
<li>
<a href="https://en.wikipedia.org/wiki/Comparison_of_file_systems#Limits"  title="wikipedia:Comparison of file systems">limits</a> for the file creation on the different file systems.</li>
<li>
<a rel="nofollow"  href="http://www.r-tt.com/Articles/File_Recovery_Basics/">meta-data</a> in the filesystem may keep information about file after it was deleted.</li>
<li>
<a rel="nofollow"  href="http://security.stackexchange.com/questions/58515/how-does-forensic-software-detect-deleted-files">forensic software</a> uses meta-data to recovery and what need to do for wiping of the meta-data.</li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../Category:Security.html" title="Category:Security">Security</a></li>
<li><a href="../../Category:File_systems.html" title="Category:File systems">File systems</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../../Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Securely_wipe_disk/Tips_and_tricks&amp;oldid=614965">https://wiki.archlinux.org/index.php?title=Securely_wipe_disk/Tips_and_tricks&amp;oldid=614965</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 22 May 2020, at 09:25.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">GNOME/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../GNOME.html" title="GNOME">GNOME</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>See <a href="../../GNOME.html" title="GNOME">GNOME</a> for the main article.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Keyboard"><span >1</span> <span >Keyboard</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Turn_on_NumLock_on_login"><span >1.1</span> <span >Turn on NumLock on login</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Hotkey_alternatives"><span >1.2</span> <span >Hotkey alternatives</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Keyboard_switch_with_command"><span >1.3</span> <span >Keyboard switch with command</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#XkbOptions_keyboard_options"><span >1.4</span> <span >XkbOptions keyboard options</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#De-bind_Windows_key"><span >1.5</span> <span >De-bind Windows key</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Disks"><span >2</span> <span >Disks</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Hiding_applications_from_the_menu"><span >3</span> <span >Hiding applications from the menu</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Screencast_recording"><span >4</span> <span >Screencast recording</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Screenshot"><span >5</span> <span >Screenshot</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#Log_out_delay"><span >6</span> <span >Log out delay</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#Disable_animations"><span >7</span> <span >Disable animations</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Retina_(HiDPI)_display_support"><span >8</span> <span >Retina (HiDPI) display support</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Passwords_and_keys_(PGP_Keys)"><span >9</span> <span >Passwords and keys (PGP Keys)</span></a></li>
<li class="toclevel-1 tocsection-15">
<a href="#Terminal"><span >10</span> <span >Terminal</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Change_default_terminal_size"><span >10.1</span> <span >Change default terminal size</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#New_terminals_adopt_current_directory"><span >10.2</span> <span >New terminals adopt current directory</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Pad_the_terminal"><span >10.3</span> <span >Pad the terminal</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Disable_blinking_cursor"><span >10.4</span> <span >Disable blinking cursor</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Disable_confirmation_window_when_closing_Terminal"><span >10.5</span> <span >Disable confirmation window when closing Terminal</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#Middle_mouse_button"><span >11</span> <span >Middle mouse button</span></a></li>
<li class="toclevel-1 tocsection-22"><a href="#Enable_button_and_menu_icons"><span >12</span> <span >Enable button and menu icons</span></a></li>
<li class="toclevel-1 tocsection-23"><a href="#Use_custom_colours_and_gradients_for_desktop_background"><span >13</span> <span >Use custom colours and gradients for desktop background</span></a></li>
<li class="toclevel-1 tocsection-24"><a href="#Transitioning_backgrounds"><span >14</span> <span >Transitioning backgrounds</span></a></li>
<li class="toclevel-1 tocsection-25"><a href="#Custom_GNOME_sessions"><span >15</span> <span >Custom GNOME sessions</span></a></li>
<li class="toclevel-1 tocsection-26"><a href="#Redirect_certain_URLs_to_specific_web_browsers"><span >16</span> <span >Redirect certain URLs to specific web browsers</span></a></li>
<li class="toclevel-1 tocsection-27"><a href="#Removing_film_holes/film_strip_from_video_thumbnails_in_Nautilus"><span >17</span> <span >Removing film holes/film strip from video thumbnails in Nautilus</span></a></li>
<li class="toclevel-1 tocsection-28"><a href="#Prevent_GNOME_Software_from_downloading_updates"><span >18</span> <span >Prevent GNOME Software from downloading updates</span></a></li>
<li class="toclevel-1 tocsection-29"><a href="#Increase_volume_above_and_beyond_100%"><span >19</span> <span >Increase volume above and beyond 100%</span></a></li>
<li class="toclevel-1 tocsection-30"><a href="#Adjust_volume_in_smaller_steps"><span >20</span> <span >Adjust volume in smaller steps</span></a></li>
<li class="toclevel-1 tocsection-31"><a href="#Show_volume_sound_percentage_next_to_top_panel_icon"><span >21</span> <span >Show volume sound percentage next to top panel icon</span></a></li>
<li class="toclevel-1 tocsection-32"><a href="#Hybrid_Sleep_on_laptop_lid_closing_action"><span >22</span> <span >Hybrid Sleep on laptop lid closing action</span></a></li>
<li class="toclevel-1 tocsection-33"><a href="#Launch_on_Discrete_GPU"><span >23</span> <span >Launch on Discrete GPU</span></a></li>
<li class="toclevel-1 tocsection-34"><a href="#Window_list"><span >24</span> <span >Window list</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Keyboard">Keyboard</span></h2>
<h3><span class="mw-headline" id="Turn_on_NumLock_on_login">Turn on NumLock on login</span></h3>
<p>See <a href="../../Activating_numlock_on_bootup.html#GNOME" title="Activating numlock on bootup">Activating numlock on bootup#GNOME</a>
</p>
<h3><span class="mw-headline" id="Hotkey_alternatives">Hotkey alternatives</span></h3>
<p>A lot of hotkeys can be changed via system settings menu. For example, to re-enable the show desktop keybinding:  
</p>
<p><i>System settings</i> &gt; <i>Keyboard</i> &gt; <i>Shortcuts</i> &gt; <i>Navigation</i> &gt; <i>Hide all normal windows</i>
</p>
<p>However, certain hotkeys cannot be changed directly via system settings. In order to change these keys, use <i>dconf-editor</i>. An example of particular note is the hotkey <code>Alt-</code> + <code>`</code> (the key above <code>Tab</code> on US keyboard layouts). In GNOME Shell it is pre-configured to cycle through windows of an application, however it is also a hotkey often used in the <a href="../../Emacs.html" title="Emacs">Emacs</a> editor. It can be changed by opening <i>dconf-editor</i> and modifying the <i>switch-group</i> key found in <code>org.gnome.desktop.wm.keybindings</code>.
</p>
<p>It is possible to manually change the keys via an application's so-called <b>accel</b> map file. Where it is to be found is up to the application: For instance, Thunar's is at <code>~/.config/Thunar/accels.scm</code>, whereas Files's is located at <code>~/.config/nautilus/accels</code> and <code>~/.gnome2/accels/nautilus</code> on old release.
</p>
<p>The file should contain a list of possible hotkeys, each unchanged line commented out with a leading ";" that has to be removed for a change to become active.
For example to replace the hotkey used by Files to move files to the trash folder, change the line:
</p>
<pre>; (gtk_accel_path "&lt;Actions&gt;/DirViewActions/Trash" "&lt;Primary&gt;Delete")
</pre>
<p>to this:
</p>
<pre>(gtk_accel_path "&lt;Actions&gt;/DirViewActions/Trash" "Delete")
</pre>
<p>The file is regenerated regularly so do not comment the file. The uncommented line will stay but every comment you add will be lost.
</p>
<h3><span class="mw-headline" id="Keyboard_switch_with_command">Keyboard switch with command</span></h3>
<p>To change the default keyboard shortcut <b>Win</b> + <b>Space</b> to another hot key:
</p>
<p>For example to change to <i>Alt</i>+<i>Shift</i>: open Gnome-Tweak-Tool (or Keyboard Settings, in GNOME 3.16) and set  <i>Typing</i> &gt; <i>Modifiers-only input sources</i> &gt; <i>select Alt-shift</i>. For more information see also the forum <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=152127">thread</a>.
</p>
<h3><span class="mw-headline" id="XkbOptions_keyboard_options">XkbOptions keyboard options</span></h3>
<p>Using the <b>dconf-editor</b>, navigate to the key named <code>org.gnome.desktop.input-sources.xkb-options</code> and add desired XkbOptions (e.g. <i>caps:swapescape</i>) to the list.
</p>
<p>See <code>/usr/share/X11/xkb/rules/xorg</code> for all XkbOptions and <code>/usr/share/X11/xkb/symbols/*</code> for the respective descriptions.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To enable the <code>Ctrl+Alt+Backspace</code> combination to terminate Xorg, use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-tweaks">gnome-tweaks</a></span>. Within the <b>Tweak Tool</b>, navigate to <i>Typing &gt; Key sequence to kill the X server</i> and select the option <code>Ctrl+Alt+Backspace</code> from the dropdown menu.</div>
<h3><span class="mw-headline" id="De-bind_Windows_key">De-bind Windows key</span></h3>
<p>By default, the 'Windows key' will open the GNOME Shell overview mode. You can unbind this key by running the command below
</p>
<pre>$ gsettings set org.gnome.mutter overlay-key 'Foo'
</pre>
<h2><span class="mw-headline" id="Disks">Disks</span></h2>
<p>GNOME provides a disk utility to manipulate storage drive settings. These are some of its features:
</p>
<ul><li>
<b>Enable write cache</b> is a feature that most hard drives provide. Data is cached and allocated at chosen times to improve system performance. Not recommended unless the computer has a backup battery pack or is a laptop as data would be lost on power failure.</li></ul>
<dl><dd>
<i>Settings</i> &gt; <i>Drive Settings</i> &gt; <i>Write Cache</i> &gt; <b>On</b>
</dd></dl>
<ul><li>
<b>Automatic Mount Options</b> can mount drives and partitions that are GPT based - will use default, recommended options.</li></ul>
<dl>
<dd><div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This setting erases related <a href="../../Fstab.html" title="Fstab">fstab</a> entries</div></dd>
<dd>
<i>Partition Settings</i> &gt; <i>Edit Mount Options</i> &gt; <i>Automatic Mount Options</i> &gt; <b>On</b>
</dd>
</dl>
<h2><span class="mw-headline" id="Hiding_applications_from_the_menu">Hiding applications from the menu</span></h2>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>Desktop entries can be hidden by editing the <code>.desktop</code> files themselves. See <a href="../../Desktop_entries.html#Hide_desktop_entries" title="Desktop entries">Desktop entries#Hide desktop entries</a>.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/Menulibre/">Menulibre</a></span><sup><small>AUR</small></sup> provides a menu editor without GNOME dependencies.</li>
</ul>
</div>
<p>Use the <i>Main Menu</i> application (provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alacarte">alacarte</a></span> package) to hide any applications you do not wish to show in the menu.
</p>
<h2><span class="mw-headline" id="Screencast_recording">Screencast recording</span></h2>
<p>GNOME features built-in screencast recording with the <code>Ctrl+Shift+Alt+r</code> key combination.  A red circle is displayed in the bottom right corner of the screen when the recording is in progress.  After the recording is finished, a file named <code>Screencast from %d%u-%c.webm</code> is saved in the <code>Videos</code> directory.  In order to use the screencast feature the gst plugins need to be installed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The recording filename may translated depending on your system's language.</div>
<h2><span class="mw-headline" id="Screenshot">Screenshot</span></h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-screenshot">gnome-screenshot</a></span> by default saves the image in the directory of the last save, which you can query:
</p>
<pre>$ gsettings get org.gnome.gnome-screenshot last-save-directory
</pre>
<p>Instead of using the above directory, you can set an auto save  directory. e.g. for automatically saving screenshots to the <code><i>user</i></code>'s desktop directory:
</p>
<pre>$ gsettings set org.gnome.gnome-screenshot auto-save-directory file:///home/<i>user</i>/Desktop
</pre>
<p>Check the <span class="plainlinks archwiki-template-man" title="$ man 1 gnome-screenshot"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/gnome-screenshot.1">gnome-screenshot(1)</a></span> man page for more options.
</p>
<h2><span class="mw-headline" id="Log_out_delay">Log out delay</span></h2>
<p>To eliminate the default 60 second delay when logging out:
</p>
<pre>$ gsettings set org.gnome.SessionManager logout-prompt false
</pre>
<h2><span class="mw-headline" id="Disable_animations">Disable animations</span></h2>
<p>To disable Shell animations (such as "Show Applications" and the wave animation in the top left activities hot corner), run:
</p>
<pre>$ gsettings set org.gnome.desktop.interface enable-animations false
</pre>
<p>or via <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-tweaks">gnome-tweaks</a></span>, in <i>General</i> tab, switch <i>Animations</i> to off.
</p>
<h2>
<span id="Retina_.28HiDPI.29_display_support"></span><span class="mw-headline" id="Retina_(HiDPI)_display_support">Retina (HiDPI) display support</span>
</h2>
<p>GNOME introduced HiDPI support in version 3.10. If your display does not provide the correct screen size through EDID, this can lead to incorrectly scaled UI elements. As a workaround you can open <i>dconf-editor</i> and find the key <code>scaling-factor</code> in <code>org.gnome.desktop.interface</code>. Set it to <code>1</code> to get the standard scale.
</p>
<p>Also see <a href="../../HiDPI.html" title="HiDPI">HiDPI</a>.
</p>
<h2>
<span id="Passwords_and_keys_.28PGP_Keys.29"></span><span class="mw-headline" id="Passwords_and_keys_(PGP_Keys)">Passwords and keys (PGP Keys)</span>
</h2>
<p>You can use the Passwords and Keys program <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=seahorse">seahorse</a></span> to create a PGP key as it is a front end for <a href="../../GnuPG.html" title="GnuPG">GnuPG</a> and installs it as dependency. This may be useful in the future (for instance if to encrypt a file). Create a key as shown below (the process may take about 10 minutes):
</p>
<p><i>File</i> &gt; <i>New</i> &gt; <i>PGP Key</i> &gt; <i>Name</i> &gt; <i>Email</i> &gt; <i>Defaults</i> &gt; <i>Passphrase</i>.
</p>
<h2><span class="mw-headline" id="Terminal">Terminal</span></h2>
<h3><span class="mw-headline" id="Change_default_terminal_size">Change default terminal size</span></h3>
<p>The default size of a new terminal can be adjusted in the menu <i>Edit &gt; Profile preferences </i>. 
</p>
<h3><span class="mw-headline" id="New_terminals_adopt_current_directory">New terminals adopt current directory</span></h3>
<p>By default new terminals open in the <code>$HOME</code> directory. To have new terminals adopt the current working directory: <code>source /etc/profile.d/vte.sh</code>. Add the command to the shell configuration to retain the behaviour. <a rel="nofollow"  href="http://unix.stackexchange.com/questions/93476/gnome-terminal-keep-track-of-directory-in-new-tab">[1]</a>
</p>
<h3><span class="mw-headline" id="Pad_the_terminal">Pad the terminal</span></h3>
<p>To pad the terminal (create a small, invisible border between the window edges and the terminal contents) create the file below:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/gtk-3.0/gtk.css</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vte-terminal,
terminal-window {
    padding: 10px 10px 10px 10px;
    -vte-terminal-inner-border: 10px 10px 10px 10px;
}</pre>
<h3><span class="mw-headline" id="Disable_blinking_cursor">Disable blinking cursor</span></h3>
<p>To disable the blinking cursor in GNOME 3.8 and above use:
</p>
<pre>$ gsettings set org.gnome.desktop.interface cursor-blink false
</pre>
<p>To disable the blinking cursor in Terminal only use:
</p>
<pre>$ gsettings set org.gnome.Terminal.Legacy.Profile:/org/gnome/terminal/legacy/profiles:/:$(gsettings get org.gnome.Terminal.ProfilesList default | tr -d \')/ cursor-blink-mode off
</pre>
<p>Note that <code>gnome-settings-daemon</code>, from the package of the same name, must be running for this and other settings changes to take effect in GNOME applications - see <a href="../../GNOME.html#Configuration" title="GNOME">GNOME#Configuration</a>.
</p>
<h3><span class="mw-headline" id="Disable_confirmation_window_when_closing_Terminal">Disable confirmation window when closing Terminal</span></h3>
<p>The Terminal will always display a confirmation window when trying to close the window while one is logged in as root. To avoid this, execute the following:
</p>
<pre>$ gsettings set org.gnome.Terminal.Legacy.Settings confirm-close false
</pre>
<h2><span class="mw-headline" id="Middle_mouse_button">Middle mouse button</span></h2>
<p>By default, GNOME 3 disables middle mouse button emulation regardless of <a href="../../Xorg.html" title="Xorg">Xorg</a> settings (<b>Emulate3Buttons</b>). To enable middle mouse button emulation use:
</p>
<pre>$ gsettings set org.gnome.settings-daemon.peripherals.mouse middle-button-enabled true
</pre>
<h2><span class="mw-headline" id="Enable_button_and_menu_icons">Enable button and menu icons</span></h2>
<p>Since GTK 3.10, the GSettings key 'menus-have-icons' has been deprecated. Icons in buttons and menus can still be enabled by setting the following overrides:
</p>
<pre>$ gsettings set org.gnome.settings-daemon.plugins.xsettings overrides "{'Gtk/ButtonImages': &lt;1&gt;, 'Gtk/MenuImages': &lt;1&gt;}"
</pre>
<h2><span class="mw-headline" id="Use_custom_colours_and_gradients_for_desktop_background">Use custom colours and gradients for desktop background</span></h2>
<p>To use custom colours and gradients for your desktop background, you will first need to set either a transparent picture or else a non-existent picture as your desktop background. For instance, the command below will set a non-existent picture as the background.
</p>
<pre>$ gsettings set org.gnome.desktop.background picture-uri none
</pre>
<p>At this point, the desktop background should be a flat colour - the default colour setting is for a deep blue.
</p>
<p>For a different flat colour you need only change the primary colour setting:
</p>
<pre>$ gsettings set org.gnome.desktop.background primary-color &lt;my color&gt;
</pre>
<p>where &lt;my color&gt; is a hex value (such as <i>ffffff</i> for white).
</p>
<p>For a colour gradient, you will also need to change secondary colour setting <code>org.gnome.desktop.background secondary-color</code> and select a shading type. For instance, if you want a horizontal gradient, execute the following:
</p>
<pre>$ gsettings set org.gnome.desktop.background color-shading-type horizontal
</pre>
<p>If you are using a transparent picture as your background, you can set the opacity by executing the following:
</p>
<pre>$ gsettings set org.gnome.desktop.background picture-opacity &lt;value&gt;
</pre>
<p>where value is a number between 1 and 100 (100 for maximum opacity).
</p>
<h2><span class="mw-headline" id="Transitioning_backgrounds">Transitioning backgrounds</span></h2>
<p>GNOME can transition between different wallpapers at specific time intervals. This is done by creating an XML file specifying the pictures to be used and the time interval. For more information on creating such files, see the following <a rel="nofollow"  href="http://www.linuxjournal.com/content/create-custom-transitioning-background-your-gnome-228-desktop">article</a>.
</p>
<p>Alternatively, a number of tools are available to automate the process:
</p>
<ul><li>
<b>mkwlppr</b> — This script creates XML files that can act as dynamic wallpapers for GNOME by referring to multiple wallpapers.</li></ul>
<dl><dd>
<a rel="nofollow"  href="http://pastebin.com/019G2rCy">http://pastebin.com/019G2rCy</a> || see <a rel="nofollow"  href="http://pastebin.com/019G2rCy">mkwlppr</a>
</dd></dl>
<p>For setting the XML file as the default background, see <a href="../../GNOME.html#Lock_screen_and_background" title="GNOME">GNOME#Lock screen and background</a>.
</p>
<h2><span class="mw-headline" id="Custom_GNOME_sessions">Custom GNOME sessions</span></h2>
<p>It is possible to create custom GNOME sessions which use the GNOME session manager but start different sets of components (<a href="../../Openbox.html" title="Openbox">Openbox</a> with <a href="../../Tint2.html" title="Tint2">tint2</a> instead of GNOME Shell for example).
</p>
<p>Two files are required for a custom GNOME session: a session file in <code>/usr/share/gnome-session/sessions/</code> which defines the components to be started and a <a href="../../Desktop_entries.html" class="mw-redirect" title="Desktop entry">desktop entry</a> in <code>/usr/share/xsessions</code> which is read by the <a href="../../Display_manager.html" title="Display manager">display manager</a>. An example session file is provided below:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/gnome-session/sessions/gnome-openbox.session</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[GNOME Session]
Name=GNOME Openbox
RequiredComponents=openbox;tint2;gnome-settings-daemon;
</pre>
<p>And an example desktop file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/xsessions/gnome-openbox.desktop</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Desktop Entry]
Name=GNOME Openbox
Exec=gnome-session --session=gnome-openbox
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> GNOME Session calls upon the <code>.desktop</code> files of each of the components to be started. If a component you wish to start does not provide a <code>.desktop</code> file, you must create a suitable <a href="../../Desktop_entries.html" class="mw-redirect" title="Desktop entry">desktop entry</a> entry in a directory such as <code>/usr/local/share/applications</code>.</div>
<h2><span class="mw-headline" id="Redirect_certain_URLs_to_specific_web_browsers">Redirect certain URLs to specific web browsers</span></h2>
<p>This shows how to use <a href="../../Chromium.html" title="Chromium">Chromium</a> for certain types of URLs while maintaining <a href="../../Firefox.html" title="Firefox">Firefox</a> as default browser for all other tasks.
</p>
<p>Make sure <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pcre">pcre</a></span> is <a href="../../Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">installed</a>, to use <i>pcregrep</i>.
</p>
<p>Setup custom <i>xdg-open</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/xdg-open</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
DOMAIN_LIST_FILE=~/'domains.txt'
OTHER_BROWSER='/usr/bin/chromium-browser'
BROWSER_OPTIONS='' # Optional, for command line options passed to browser
XDG_OPEN='/usr/bin/xdg-open'
DEFAULT_BROWSER='/usr/bin/firefox'

if echo "$1" | pcregrep -q '^https?://'; then
    matching=0
    while read domain; do
	if echo "$1" | pcregrep -q "^https?://${domain}"; then
	    matching=1
	    break
	fi
    done &lt; "$DOMAIN_LIST_FILE"

    if [[ $matching -eq 1 ]]; then
	"$OTHER_BROWSER" $BROWSER_OPTIONS ${*}
	exit 0
    fi
    
    "$DEFAULT_BROWSER" ${*}
    exit 0
else
    "$XDG_OPEN" ${*}
fi
</pre>
<p>Configure domains for redirect to <i>Chromium</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/domains.txt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">stackexchange.com
stackoverflow.com
superuser.com
www.youtube.com
github.com
</pre>
<p>Setup <i>xdg-open web</i> as desktop application:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.local/share/applications/xdg-open-web.desktop</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Desktop Entry]
Version=1.0
Name=xdg-open web
GenericName=Web Browser
Exec=xdg-open %u
Terminal=false
Type=Application
MimeType=text/html;text/xml;application/xhtml+xml;application/vnd.mozilla.xul+xml;text/mml;x-scheme-handler/http;x-scheme-handler/https;
StartupNotify=true
Categories=Network;WebBrowser;
Keywords=web;browser;internet;
Actions=new-window;new-private-window;
</pre>
<pre>$ update-desktop-database $HOME/.local/share/applications/
</pre>
<p>Set <i>xdg-open web</i> as default Web application in GNOME settings:
Go to <i>GNOME Settings &gt; Details &gt; Default Applications</i> and  set <i>Web</i> to <i>xdg-open web</i>.
</p>
<h2>
<span id="Removing_film_holes.2Ffilm_strip_from_video_thumbnails_in_Nautilus"></span><span class="mw-headline" id="Removing_film_holes/film_strip_from_video_thumbnails_in_Nautilus">Removing film holes/film strip from video thumbnails in Nautilus</span>
</h2>
<p>Nautilus (Files) overlays the film holes/film strip effect on video thumbnails since Gnome 3.12. To remove or override this effect, the environment variable <code>G_RESOURCE_OVERLAYS</code> can be used to reference the path of a compiled resource (in this instance <code>filmholes.png</code>) and specify the path for the relevant overlay. This environment variable has only been available since GLib 2.50 and will have no effect on versions before this.
</p>
<p>Extract <code>filmholes.png</code> from Nautilus.
</p>
<pre>gresource extract /usr/bin/nautilus /org/gnome/nautilus/icons/filmholes.png &gt; filmholes.png
</pre>
<p>Edit <code>filmholes.png</code> using your preferred editor and remove the film effect from the image, leaving the transparency and dimensions intact, then overwriting the extracted image.
</p>
<p>Copy or move the extracted image where desired, such as <code>/usr/share/icons/</code> and edit <code>~/.profile</code>, adding the following export, changing <code>/usr/share/icons/</code> as needed to the location you placed the file.
</p>
<pre>export G_RESOURCE_OVERLAYS=/org/gnome/nautilus/icons/filmholes.png=/usr/share/icons/filmholes.png
</pre>
<p>If <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=ffmpegthumbnailer">ffmpegthumbnailer</a></span> has been installed as a dependency for another file manager that may generate thumbnails, the <code>Exec</code> line in <code>/usr/share/thumbnailers/ffmpegthumbnailer.thumbnailer</code> should be modified removing the <code>-f</code> flag.
</p>
<p>To ensure that no thumbnails remain that may already have the film effect embedded, remove the thumbnail cache.
</p>
<pre>rm -r ~/.cache/thumbnails
</pre>
<p>Log out and back in to your session and you should no longer have the film holes/film strip effect on your thumbnails in Nautilus.
</p>
<h2><span class="mw-headline" id="Prevent_GNOME_Software_from_downloading_updates">Prevent GNOME Software from downloading updates</span></h2>
<p>By default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gnome-software">gnome-software</a></span> will download updated packages from the TOS Linux repositories. This forces GNOME Software to refresh the package lists for <i>pacman</i> automatically. This is the equivalent to <code>pacman -Sy</code>. If the user ignores the GNOME software update prompt, but does install a new package, that will result in  <a href="../../System_maintenance.html#Partial_upgrades_are_unsupported" class="mw-redirect" title="Partial upgrades">partial upgrades</a>, which are <b>unsupported</b>. To prevent GNOME Software from refreshing the package lists set the following dconf setting:
</p>
<pre>$ gsettings set org.gnome.software download-updates false
</pre>
<h2>
<span id="Increase_volume_above_and_beyond_100.25"></span><span class="mw-headline" id="Increase_volume_above_and_beyond_100%">Increase volume above and beyond 100%</span>
</h2>
<p>Install the extension <a rel="nofollow"  href="https://extensions.gnome.org/extension/858/volume-mixer/">volume mixer</a>. Then use the mouse to scroll above the volume icon in the top panel to increase the volume above and beyond 100%.
</p>
<h2><span class="mw-headline" id="Adjust_volume_in_smaller_steps">Adjust volume in smaller steps</span></h2>
<p>By default, pressing the keyboard's volume keys adjusts the volume by 6%. If smaller steps are desired, the shortcut <i>Shift + Volume Key Up/Down</i> adjusts volume in 2% steps.
</p>
<p>Also, as of GNOME 3.36, it is now possible to directly adjust the volume step via a dconf setting. For example, to set the volume step to 2% execute the following:
</p>
<pre>$ gsettings set org.gnome.settings-daemon.plugins.media-keys volume-step 2
</pre>
<h2><span class="mw-headline" id="Show_volume_sound_percentage_next_to_top_panel_icon">Show volume sound percentage next to top panel icon</span></h2>
<p>Install the extension <a rel="nofollow"  href="https://github.com/maoschanz/sound-percentage-gs-extension">sound percentage</a> to display the current output volume level next to the sound icon in the top panel.
</p>
<h2><span class="mw-headline" id="Hybrid_Sleep_on_laptop_lid_closing_action">Hybrid Sleep on laptop lid closing action</span></h2>
<p>Follow below commands to trigger <a href="../../Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">Hybrid Sleep</a> when closing the lid of the laptop. Read <a rel="nofollow"  href="https://www.reddit.com/r/gnome/comments/97688y/can_gnome_trigger_hybrid_sleep_on_laptop_lid/">here</a> for further information.
</p>
<pre>   mkdir --parents /etc/systemd/logind.conf.d
   printf '%s\n' '[Login]' 'HandleLidSwitch=hybrid-sleep' &gt;/etc/systemd/logind.conf.d/50-local.conf
   systemctl restart systemd-logind.conf
</pre>
<h2><span class="mw-headline" id="Launch_on_Discrete_GPU">Launch on Discrete GPU</span></h2>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/switcheroo-control/">switcheroo-control</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/switcheroo-control-git/">switcheroo-control-git</a></span><sup><small>AUR</small></sup>.
<a href="../../Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> and <a href="../../Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>switcheroo-control.service</code>
</p>
<h2><span class="mw-headline" id="Window_list">Window list</span></h2>
<p>If you like having a tasks list on the bottom but dislike the default black color of this extension, copy it's directory:
</p>
<pre>cp -r /usr/share/gnome-shell/extensions/window-list@gnome-shell-extensions.gcampax.github.com/ ~/.local/share/gnome-shell/extensions/
</pre>
<p>and edit the CSS to your liking. For example, to make it transparent edit <code>stylesheet.css</code> like this:
</p>
<pre>.bottom-panel {
  background: transparent;
</pre>
<pre>.window-button &gt; StWidget,
.window-picker-toggle &gt; StWidget {
  background-color: transparent;
</pre>
</div></div>
		
		<div id="catlinks"  data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../Category:GNOME.html" title="Category:GNOME">GNOME</a></li></ul>
</div></div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GNOME/Tips_and_tricks&amp;oldid=615761">https://wiki.archlinux.org/index.php?title=GNOME/Tips_and_tricks&amp;oldid=615761</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 25 May 2020, at 12:41.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Tips_and_tricks
    description: Migration of Tips_and_tricks from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:44:33.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">NVIDIA/Tips and tricks</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="../../NVIDIA.html" title="NVIDIA">NVIDIA</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Fixing_terminal_resolution"><span >1</span> <span >Fixing terminal resolution</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Using_TV-out"><span >2</span> <span >Using TV-out</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#X_with_a_TV_(DFP)_as_the_only_display"><span >3</span> <span >X with a TV (DFP) as the only display</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Check_the_power_source"><span >4</span> <span >Check the power source</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Listening_to_ACPI_events"><span >5</span> <span >Listening to ACPI events</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#Displaying_GPU_temperature_in_the_shell"><span >6</span> <span >Displaying GPU temperature in the shell</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#nvidia-settings"><span >6.1</span> <span >nvidia-settings</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#nvidia-smi"><span >6.2</span> <span >nvidia-smi</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#nvclock"><span >6.3</span> <span >nvclock</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Set_fan_speed_at_login"><span >7</span> <span >Set fan speed at login</span></a></li>
<li class="toclevel-1 tocsection-11">
<a href="#Manual_configuration"><span >8</span> <span >Manual configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Disabling_the_logo_on_startup"><span >8.1</span> <span >Disabling the logo on startup</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Overriding_monitor_detection"><span >8.2</span> <span >Overriding monitor detection</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Enabling_brightness_control"><span >8.3</span> <span >Enabling brightness control</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Enabling_SLI"><span >8.4</span> <span >Enabling SLI</span></a></li>
<li class="toclevel-2 tocsection-16">
<a href="#Enabling_overclocking"><span >8.5</span> <span >Enabling overclocking</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#Setting_static_2D/3D_clocks"><span >8.5.1</span> <span >Setting static 2D/3D clocks</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#Allow_change_to_highest_Performance_Mode"><span >8.5.2</span> <span >Allow change to highest Performance Mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="#Custom_TDP_Limit"><span >8.6</span> <span >Custom TDP Limit</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Kernel_module_parameters"><span >8.7</span> <span >Kernel module parameters</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Fixing_terminal_resolution">Fixing terminal resolution</span></h2>
<p>Transitioning from nouveau may cause your startup terminal to display at a lower resolution.
</p>
<p>For GRUB, see <a href="../../GRUB/Tips_and_tricks.html#Setting_the_framebuffer_resolution" title="GRUB/Tips and tricks">GRUB/Tips and tricks#Setting the framebuffer resolution</a> for details.
</p>
<p>For <a href="../../REFInd.html" title="REFInd">rEFInd</a>, add to <code><i>esp</i>/EFI/refind/refind.conf</code> and <code>/etc/refind.d/refind.conf</code> (latter file is optional but recommended):
</p>
<pre>use_graphics_for linux
</pre>
<p>A small caveat is that this will hide the kernel parameters from being shown during boot.
</p>
<h2><span class="mw-headline" id="Using_TV-out">Using TV-out</span></h2>
<p>A good article on the subject can be found <a rel="nofollow"  href="http://en.wikibooks.org/wiki/NVidia/TV-OUT">here</a>.
</p>
<h2>
<span id="X_with_a_TV_.28DFP.29_as_the_only_display"></span><span class="mw-headline" id="X_with_a_TV_(DFP)_as_the_only_display">X with a TV (DFP) as the only display</span>
</h2>
<p>The X server falls back to CRT-0 if no monitor is automatically detected. This can be a problem when using a DVI connected TV as the main display, and X is started while the TV is turned off or otherwise disconnected.
</p>
<p>To force NVIDIA to use DFP, store a copy of the EDID somewhere in the filesystem so that X can parse the file instead of reading EDID from the TV/DFP.
</p>
<p>To acquire the EDID, start nvidia-settings. It will show some information in tree format, ignore the rest of the settings for now and select the GPU (the corresponding entry should be titled "GPU-0" or similar), click the <code>DFP</code> section (again, <code>DFP-0</code> or similar), click on the <code>Acquire Edid</code> Button and store it somewhere, for example, <code>/etc/X11/dfp0.edid</code>.
</p>
<p>If in the front-end mouse and keyboard are not attached, the EDID can be acquired using only the command line. Run an X server with enough verbosity to print out the EDID block:
</p>
<pre>$ startx -- -logverbose 6
</pre>
<p>After the X Server has finished initializing, close it and your log file will probably be in <code>/var/log/Xorg.0.log</code>. Extract the EDID block using nvidia-xconfig:
</p>
<pre>$ nvidia-xconfig --extract-edids-from-file=/var/log/Xorg.0.log --extract-edids-output-file=/etc/X11/dfp0.bin
</pre>
<p>Edit <code>xorg.conf</code> by adding to the <code>Device</code> section:
</p>
<pre>Option "ConnectedMonitor" "DFP"
Option "CustomEDID" "DFP-0:/etc/X11/dfp0.edid"
</pre>
<p>The <code>ConnectedMonitor</code> option forces the driver to recognize the DFP as if it were connected. The <code>CustomEDID</code> provides EDID data for the device, meaning that it will start up just as if the TV/DFP was connected during X the process.
</p>
<p>This way, one can automatically start a display manager at boot time and still have a working and properly configured X screen by the time the TV gets powered on.
</p>
<p>If the above changes did not work, in the <code>xorg.conf</code> under <code>Device</code> section you can try to remove the <code>Option "ConnectedMonitor" "DFP"</code> and add the following lines:
</p>
<pre>Option "ModeValidation" "NoDFPNativeResolutionCheck"
Option "ConnectedMonitor" "DFP-0"
</pre>
<p>The <code>NoDFPNativeResolutionCheck</code> prevents NVIDIA driver from disabling all the modes that do not fit in the native resolution.
</p>
<h2><span class="mw-headline" id="Check_the_power_source">Check the power source</span></h2>
<p>The NVIDIA X.org driver can also be used to detect the GPU's current source of power. To see the current power source, check the 'GPUPowerSource' read-only parameter (0 - AC, 1 - battery):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-settings -q GPUPowerSource -t</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">1</pre>
<h2><span class="mw-headline" id="Listening_to_ACPI_events">Listening to ACPI events</span></h2>
<p>NVIDIA drivers automatically try to connect to the <a href="../../Acpid.html" title="Acpid">acpid</a> daemon and listen to ACPI events such as battery power, docking, some hotkeys, etc. If connection fails, X.org will output the following warning:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.local/share/xorg/Xorg.0.log</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NVIDIA(0): ACPI: failed to connect to the ACPI event daemon; the daemon
NVIDIA(0):     may not be running or the "AcpidSocketPath" X
NVIDIA(0):     configuration option may not be set correctly.  When the
NVIDIA(0):     ACPI event daemon is available, the NVIDIA X driver will
NVIDIA(0):     try to use it to receive ACPI event notifications.  For
NVIDIA(0):     details, please see the "ConnectToAcpid" and
NVIDIA(0):     "AcpidSocketPath" X configuration options in Appendix B: X
NVIDIA(0):     Config Options in the README.
</pre>
<p>While completely harmless, you may get rid of this message by disabling the <code>ConnectToAcpid</code> option in your <code>/etc/X11/xorg.conf.d/20-nvidia.conf</code>:
</p>
<pre>Section "Device"
  ...
  Driver "nvidia"
  Option "ConnectToAcpid" "0"
  ...
EndSection
</pre>
<p>If you are on laptop, it might be a good idea to install and enable the <a href="../../Acpid.html" title="Acpid">acpid</a> daemon instead.
</p>
<h2><span class="mw-headline" id="Displaying_GPU_temperature_in_the_shell">Displaying GPU temperature in the shell</span></h2>
<p>There are three methods to query the GPU temperature. <i>nvidia-settings</i> requires that you are using X, <i>nvidia-smi</i> or <i>nvclock</i> do not. Also note that <i>nvclock</i> currently does not work with newer NVIDIA cards such as GeForce 200 series cards as well as embedded GPUs such as the Zotac IONITX's 8800GS.
</p>
<h3><span class="mw-headline" id="nvidia-settings">nvidia-settings</span></h3>
<p>To display the GPU temp in the shell, use <i>nvidia-settings</i> as follows:
</p>
<pre>$ nvidia-settings -q gpucoretemp
</pre>
<p>This will output something similar to the following:
</p>
<pre>Attribute 'GPUCoreTemp' (hostname:0.0): 41.
'GPUCoreTemp' is an integer attribute.
'GPUCoreTemp' is a read-only attribute.
'GPUCoreTemp' can use the following target types: X Screen, GPU.
</pre>
<p>The GPU temps of this board is 41 C.
</p>
<p>In order to get just the temperature for use in utilities such as <i>rrdtool</i> or <i>conky</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-settings -q gpucoretemp -t</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">41</pre>
<h3><span class="mw-headline" id="nvidia-smi">nvidia-smi</span></h3>
<p>Use <i>nvidia-smi</i> which can read temps directly from the GPU without the need to use X at all, e.g. when running Wayland or on a headless server. 
To display the GPU temperature in the shell, use <i>nvidia-smi</i> as follows:
</p>
<pre>$ nvidia-smi
</pre>
<p>This should output something similar to the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-smi</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Fri Jan  6 18:53:54 2012       
+------------------------------------------------------+                       
| NVIDIA-SMI 2.290.10   Driver Version: 290.10         |                       
|-------------------------------+----------------------+----------------------+
| Nb.  Name                     | Bus Id        Disp.  | Volatile ECC SB / DB |
| Fan   Temp   Power Usage /Cap | Memory Usage         | GPU Util. Compute M. |
|===============================+======================+======================|
| 0.  GeForce 8500 GT           | 0000:01:00.0  N/A    |       N/A        N/A |
|  30%   62 C  N/A   N/A /  N/A |  17%   42MB /  255MB |  N/A      Default    |
|-------------------------------+----------------------+----------------------|
| Compute processes:                                               GPU Memory |
|  GPU  PID     Process name                                       Usage      |
|=============================================================================|
|  0.           ERROR: Not Supported                                          |
+-----------------------------------------------------------------------------+
</pre>
<p>Only for temperature:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-smi -q -d TEMPERATURE</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

====NVSMI LOG====

Timestamp                           : Sun Apr 12 08:49:10 2015
Driver Version                      : 346.59

Attached GPUs                       : 1
GPU 0000:01:00.0
    Temperature
        GPU Current Temp            : 52 C
        GPU Shutdown Temp           : N/A
        GPU Slowdown Temp           : N/A

</pre>
<p>In order to get just the temperature for use in utilities such as <i>rrdtool</i> or <i>conky</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">52</pre>
<p>Reference: <a rel="nofollow"  href="http://www.question-defense.com/2010/03/22/gpu-linux-shell-temp-get-nvidia-gpu-temperatures-via-linux-cli">http://www.question-defense.com/2010/03/22/gpu-linux-shell-temp-get-nvidia-gpu-temperatures-via-linux-cli</a>.
</p>
<h3><span class="mw-headline" id="nvclock">nvclock</span></h3>
<p>Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/nvclock/">nvclock</a></span><sup><small>AUR</small></sup> which is available from the <a href="../../TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>nvclock</i> cannot access thermal sensors on newer NVIDIA cards such as Geforce 200 series cards.</div>
<p>There can be significant differences between the temperatures reported by <i>nvclock</i> and <i>nvidia-settings</i>/<i>nv-control</i>. According to <a rel="nofollow"  href="http://sourceforge.net/projects/nvclock/forums/forum/67426/topic/1906899">this post</a> by the author (thunderbird) of <i>nvclock</i>, the <i>nvclock</i> values should be more accurate.
</p>
<h2><span class="mw-headline" id="Set_fan_speed_at_login">Set fan speed at login</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../../Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Refer to <a href="#Enabling_overclocking">#Enabling overclocking</a> for description of <i>Coolbits</i>. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks#</a>)</div>
</div>
<p>You can adjust the fan speed on your graphics card with <i>nvidia-settings'</i> console interface. First ensure that your Xorg configuration sets the Coolbits option to <code>4</code>, <code>5</code> or <code>12</code> for fermi and above in your <code>Device</code> section to enable fan control.
</p>
<pre>Option "Coolbits" "4"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> GeForce 400/500 series cards cannot currently set fan speeds at login using this method. This method only allows for the setting of fan speeds within the current X session by way of nvidia-settings.</div>
<p>Place the following line in your <a href="../../Xinit.html#xinitrc" class="mw-redirect" title="Xinitrc">xinitrc</a> file to adjust the fan when you launch Xorg. Replace <code><i>n</i></code> with the fan speed percentage you want to set.
</p>
<pre>nvidia-settings -a "[gpu:0]/GPUFanControlState=1" -a "[fan:0]/GPUTargetFanSpeed=<i>n</i>"
</pre>
<p>You can also configure a second GPU by incrementing the GPU and fan number.
</p>
<pre>nvidia-settings -a "[gpu:0]/GPUFanControlState=1" -a "[fan:0]/GPUTargetFanSpeed=<i>n</i>" \
                -a "[gpu:1]/GPUFanControlState=1" -a  [fan:1]/GPUTargetFanSpeed=<i>n</i>" &amp;
</pre>
<p>If you use a login manager such as <a href="../../GDM.html" title="GDM">GDM</a> or <a href="../../SDDM.html" title="SDDM">SDDM</a>, you can create a desktop entry file to process this setting. Create <code>~/.config/autostart/nvidia-fan-speed.desktop</code> and place this text inside it. Again, change <code><i>n</i></code> to the speed percentage you want.
</p>
<pre>[Desktop Entry]
Type=Application
Exec=nvidia-settings -a "[gpu:0]/GPUFanControlState=1" -a "[fan:0]/GPUTargetFanSpeed=<i>n</i>"
X-GNOME-Autostart-enabled=true
Name=nvidia-fan-speed
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Before driver version 349.16, <code>GPUCurrentFanSpeed</code> was used instead of <code>GPUTargetFanSpeed</code>.<a rel="nofollow"  href="https://devtalk.nvidia.com/default/topic/821563/linux/can-t-control-fan-speed-with-beta-driver-349-12/post/4526208/#4526208">[1]</a>
</div>
<p>To make it possible to adjust the fanspeed of more than one graphics card, run:
</p>
<pre>$ nvidia-xconfig --enable-all-gpus
$ nvidia-xconfig --cool-bits=4
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On some laptops (including the ThinkPad <a rel="nofollow"  href="https://devtalk.nvidia.com/default/topic/1052110/linux/can-t-control-gtx-1050-ti-max-q-fan-on-thinkpad-x1-extreme-laptop/post/5340658/#5340658">X1 Extreme</a> and <a rel="nofollow"  href="https://devtalk.nvidia.com/default/topic/1048624/linux/how-to-set-gpu-fan-speed/post/5321818/#5321818">P51/P52</a>), there are two fans, but neither are controlled by nvidia.</div>
<h2><span class="mw-headline" id="Manual_configuration">Manual configuration</span></h2>
<p>Several tweaks (which cannot be enabled <a href="../../NVIDIA.html#Automatic_configuration" title="NVIDIA">automatically</a> or with the <a href="../../NVIDIA.html#NVIDIA_Settings" title="NVIDIA">GUI</a>) can be performed by editing your <a href="../../NVIDIA.html#Minimal_configuration" title="NVIDIA">config</a> file. The Xorg server will need to be restarted before any changes are applied.
</p>
<p>See <a rel="nofollow"  href="https://download.nvidia.com/XFree86/Linux-x86_64/381.09/README/">NVIDIA Accelerated Linux Graphics Driver README and Installation Guide</a> for additional details and options.
</p>
<h3><span class="mw-headline" id="Disabling_the_logo_on_startup">Disabling the logo on startup</span></h3>
<p>Add the <code>"NoLogo"</code> option under section <code>Device</code>:
</p>
<pre>Option "NoLogo" "1"
</pre>
<h3><span class="mw-headline" id="Overriding_monitor_detection">Overriding monitor detection</span></h3>
<p>The <code>"ConnectedMonitor"</code> option under section <code>Device</code> allows to override monitor detection when X server starts, which may save a significant amount of time at start up. The available options are: <code>"CRT"</code> for analog connections, <code>"DFP"</code> for digital monitors and <code>"TV"</code> for televisions.
</p>
<p>The following statement forces the NVIDIA driver to bypass startup checks and recognize the monitor as DFP:
</p>
<pre>Option "ConnectedMonitor" "DFP"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Use "CRT" for all analog 15 pin VGA connections, even if the display is a flat panel. "DFP" is intended for DVI, HDMI, or DisplayPort digital connections only.</div>
<h3><span class="mw-headline" id="Enabling_brightness_control">Enabling brightness control</span></h3>
<p>Add under section <code>Device</code>:
</p>
<pre>Option "RegistryDwords" "EnableBrightnessControl=1"
</pre>
<p>If brightness control still does not work with this option, try installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/nvidia-bl/">nvidia-bl</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/nvidiabl/">nvidiabl</a></span><sup><small>AUR</small></sup>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Installing either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/nvidia-bl/">nvidia-bl</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/nvidiabl/">nvidiabl</a></span><sup><small>AUR</small></sup> will provide a <code>/sys/class/backlight/nvidia_backlight/</code> interface to backlight brightness control, but your system may continue to issue backlight control changes on <code>/sys/class/backlight/acpi_video0/</code>. One solution in this case is to watch for changes on, e.g. <code>acpi_video0/brightness</code> with <i>inotifywait</i> and to translate and write to <code>nvidia_backlight/brightness</code> accordingly. See <a href="../../Backlight.html#sysfs_modified_but_no_brightness_change" title="Backlight">Backlight#sysfs modified but no brightness change</a>.</div>
<h3><span class="mw-headline" id="Enabling_SLI">Enabling SLI</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> As of May 7, 2011, you may experience sluggish video performance in GNOME 3 after enabling SLI.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Since the GTX 10xx Series (1080, 1070, 1060, etc) only 2-way SLI is supported. 3-way and 4-way SLI may work for CUDA/OpenCL applications, but will most likely break all OpenGL applications.</div>
<p>Taken from the NVIDIA driver's <a rel="nofollow"  href="ftp://download.nvidia.com/XFree86/Linux-x86/355.11/README/xconfigoptions.html">README</a> Appendix B: <i>This option controls the configuration of SLI rendering in supported configurations.</i> A "supported configuration" is a computer equipped with an SLI-Certified Motherboard and 2 or 3 SLI-Certified GeForce GPUs. See NVIDIA's <a rel="nofollow"  href="http://www.slizone.com/page/home.html">SLI Zone</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup> for more information.
</p>
<p>Find the first GPU's PCI Bus ID using <code>lspci</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lspci | grep VGA</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">03:00.0 VGA compatible controller: nVidia Corporation G92 [GeForce 8800 GTS 512] (rev a2)
05:00.0 VGA compatible controller: nVidia Corporation G92 [GeForce 8800 GTS 512] (rev a2)
</pre>
<p>Add the BusID (3 in the previous example) under section <code>Device</code>:
</p>
<pre>BusID "PCI:3:0:0"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The format is important. The BusID value must be specified as <code>"PCI:&lt;BusID&gt;:0:0"</code>
</div>
<p>Add the desired SLI rendering mode value under section <code>Screen</code>:
</p>
<pre>Option "SLI" "AA"
</pre>
<p>The following table presents the available rendering modes.
</p>
<table >
<tbody>
<tr>
<th>Value</th>
<th>Behavior
</th>
</tr>
<tr>
<td>0, no, off, false, Single</td>
<td>Use only a single GPU when rendering.
</td>
</tr>
<tr>
<td>1, yes, on, true, Auto</td>
<td>Enable SLI and allow the driver to automatically select the appropriate rendering mode.
</td>
</tr>
<tr>
<td>AFR</td>
<td>Enable SLI and use the alternate frame rendering mode.
</td>
</tr>
<tr>
<td>SFR</td>
<td>Enable SLI and use the split frame rendering mode.
</td>
</tr>
<tr>
<td>AA</td>
<td>Enable SLI and use SLI antialiasing. Use this in conjunction with full scene antialiasing to improve visual quality.
</td>
</tr>
</tbody>
</table>
<p>Alternatively, you can use the <code>nvidia-xconfig</code> utility to insert these changes into <code>xorg.conf</code> with a single command:
</p>
<pre># nvidia-xconfig --busid=PCI:3:0:0 --sli=AA
</pre>
<p>To verify that SLI mode is enabled from a shell:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-settings -q all | grep SLIMode</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  Attribute 'SLIMode' (arch:0.0): AA 
    'SLIMode' is a string attribute.
    'SLIMode' is a read-only attribute.
    'SLIMode' can use the following target types: X Screen.
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  After enabling SLI, your system may become frozen/non-responsive upon starting xorg. It is advisable that you disable your display manager before restarting.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If this configuration does not work, you may need to use the PCI Bus ID provided by <code>nvidia-settings</code>,
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nvidia-settings -q all | grep -i pcibus</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Attribute 'PCIBus' (host:0[gpu:0]): 101.
  'PCIBus' is an integer attribute.
  'PCIBus' is a read-only attribute.
  'PCIBus' can use the following target types: GPU, SDI Input Device.
Attribute 'PCIBus' (host:0[gpu:1]): 23.
  'PCIBus' is an integer attribute.
  'PCIBus' is a read-only attribute.
  'PCIBus' can use the following target types: GPU, SDI Input Device.</pre>
<p>and comment out the PrimaryGPU option in your xorg.d configuration,
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

Section "OutputClass"
...
    # Option "PrimaryGPU" "yes"
...</pre>
<p>Using this configuration may also solve any graphical boot issues.
</p>
</div>
<h3><span class="mw-headline" id="Enabling_overclocking">Enabling overclocking</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Overclocking might permanently damage your hardware. You have been warned.</div>
<p>Overclocking is controlled via <i>Coolbits</i> option in the <code>Device</code> section, which enables various unsupported features:
</p>
<pre>Option "Coolbits" "<i>value</i>"
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <i>Coolbits</i> option can be easily controlled with the <i>nvidia-xconfig</i>, which manipulates the Xorg configuration files: <pre># nvidia-xconfig --cool-bits=<i>value</i></pre>
</div>
<p>The <i>Coolbits</i> value is the sum of its component bits in the binary numeral system. The component bits are:
</p>
<ul>
<li>
<code>1</code> (bit 0) - Enables overclocking of older (pre-Fermi) cores on the <i>Clock Frequencies</i> page in <i>nvidia-settings</i>.</li>
<li>
<code>2</code> (bit 1) - When this bit is set, the driver will "attempt to initialize SLI when using GPUs with different amounts of video memory".</li>
<li>
<code>4</code> (bit 2) - Enables manual configuration of GPU fan speed on the <i>Thermal Monitor</i> page in <i>nvidia-settings</i>.</li>
<li>
<code>8</code> (bit 3) - Enables overclocking on the <i>PowerMizer</i> page in <i>nvidia-settings</i>. Available since version 337.12 for the Fermi architecture and newer.<a rel="nofollow"  href="http://www.phoronix.com/scan.php?px=MTY1OTM&amp;page=news_item">[2]</a>
</li>
<li>
<code>16</code> (bit 4) - Enables overvoltage using <i>nvidia-settings</i> CLI options. Available since version 346.16 for the Fermi architecture and newer.<a rel="nofollow"  href="http://www.phoronix.com/scan.php?page=news_item&amp;px=MTg0MDI">[3]</a>
</li>
</ul>
<p>To enable multiple features, add the <i>Coolbits</i> values together. For example, to enable overclocking and overvoltage of Fermi cores, set <code>Option "Coolbits" "24"</code>.
</p>
<p>The documentation of <i>Coolbits</i> can be found in <code>/usr/share/doc/nvidia/html/xconfigoptions.html</code> and <a rel="nofollow"  href="http://download.nvidia.com/XFree86/Linux-x86_64/430.14/README/xconfigoptions.html#Coolbits">here</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> An alternative is to edit and reflash the GPU BIOS either under DOS (preferred), or within a Win32 environment by way of <a rel="nofollow"  href="http://www.mvktech.net/component/option,com_remository/Itemid,26/func,select/id,127/orderby,2/page,1/">nvflash</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup> and <a rel="nofollow"  href="http://www.mvktech.net/component/option,com_remository/Itemid,26/func,select/id,135/orderby,2/page,1/">NiBiTor 6.0</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup>. The advantage of BIOS flashing is that not only can voltage limits be raised, but stability is generally improved over software overclocking methods such as Coolbits. <a rel="nofollow"  href="http://ivanvojtko.blogspot.sk/2014/03/how-to-overclock-geforce-460gtx-fermi.html">Fermi BIOS modification tutorial</a>
</div>
<h4>
<span id="Setting_static_2D.2F3D_clocks"></span><span class="mw-headline" id="Setting_static_2D/3D_clocks">Setting static 2D/3D clocks</span>
</h4>
<p>Set the following string in the <code>Device</code> section to enable PowerMizer at its maximum performance level (VSync will not work without this line):
</p>
<pre>Option "RegistryDwords" "PerfLevelSrc=0x2222"
</pre>
<h4><span class="mw-headline" id="Allow_change_to_highest_Performance_Mode">Allow change to highest Performance Mode</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-inaccurate.png" ><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../../File:Tango-inaccurate.png" ><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This section refers to the limits for <a rel="nofollow"  href="https://en.wikipedia.org/wiki/Kepler_(microarchitecture)#GPU_Boost">GPU boost</a>, which is unrelated to overclocking discussed above. The <code>nvidia-smi(1)</code> man page says that it is "For Tesla devices from the Kepler+ family and Maxwell-based GeForce Titan." And as far as <a href="../../User:Lahwaacz.html" title="User:Lahwaacz">Lahwaacz</a> is aware, the only GPU which supports this and does not have the default clocks equal to the maximum, is Tesla K40 <a rel="nofollow"  href="https://www.nvidia.com/content/PDF/kepler/nvidia-gpu-boost-tesla-k40-06767-001-v02.pdf">[4]</a>. Since the Pascal architecture, <a rel="nofollow"  href="http://www.anandtech.com/show/10325/the-nvidia-geforce-gtx-1080-and-1070-founders-edition-review/15">Boost 3.0</a> handles automatic clocking even differently. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks#</a>)</div>
</div>
<p>Since changing Performance Mode and Overclocking Memory Rate has little to no effect in nvidia-settings, try this:
</p>
<p>- Setting Coolbits to 24 or 28 and remove Powermizer RegistryDwords -&gt; Restart X
- find out max. Clock and Memory rate. (this can be LOWER than what your gfx card reports after booting!):
</p>
<pre>nvidia-smi -q -d SUPPORTED_CLOCKS
</pre>
<p>- set rates for GPU 0:
</p>
<pre>sudo nvidia-smi -i 0 -ac memratemax,clockratemax
</pre>
<p>After setting the rates the max. Performance Mode works in nvidia-settings and you can overclock graphics-clock and Memory Transfer Rate.
</p>
<h3><span class="mw-headline" id="Custom_TDP_Limit">Custom TDP Limit</span></h3>
<p>Modern Nvidia graphics cards throttle frequency to stay in their TDP and temperature limits. To increase performance it is possible to change the TDP limit, which will result in higher temperatures and higher power consumption. 
</p>
<p>For example, to set the power limit to 160.30W:
</p>
<pre># nvidia-smi -pl 160.30
</pre>
<p>To set the power limit on boot (without driver persistence):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nvidia-tdp.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Set NVIDIA power limit on boot

[Timer]
OnBootSec=5

[Install]
WantedBy=timers.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nvidia-tdp.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Set NVIDIA power limit

[Service]
Type=oneshot
ExecStart=/usr/bin/nvidia-smi -pl 160.30</pre>
<h3><span class="mw-headline" id="Kernel_module_parameters">Kernel module parameters</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../../Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../../File:Tango-edit-clear.png" ><img alt="Tango-edit-clear.png" src="../../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Giving advanced examples without explaining what they do is pointless. (Discuss in <a rel="nofollow"  href="https://wiki.archlinux.org/index.php/Talk:NVIDIA/Tips_and_tricks">Talk:NVIDIA/Tips and tricks#</a>)</div>
</div>
<p>Some options can be set as kernel module parameters, a full list can be obtained by running <code>modinfo nvidia</code> or looking at <code>nv-reg.h</code>. See <a rel="nofollow"  href="https://wiki.gentoo.org/wiki/NVidia/nvidia-drivers#Kernel_module_parameters">the Gentoo wiki</a> as well.
</p>
<p>For example, enabling the following will turn on kernel mode setting (see above) and enable the PAT feature <a rel="nofollow"  href="https://www.kernel.org/doc/html/v5.4-rc8/x86/pat.html">[5]</a>, which affects how memory is allocated. PAT was first introduced in Pentium III <a rel="nofollow"  href="https://www.kernel.org/doc/ols/2008/ols2008v2-pages-135-144.pdf">[6]</a> and is supported by most newer CPUs (see <a href="https://en.wikipedia.org/wiki/Page_attribute_table#Processors"  title="wikipedia:Page attribute table">wikipedia:Page attribute table#Processors</a>). If your system can support this feature, it should improve performance.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia-drm modeset=1 
options nvidia NVreg_UsePageAttributeTable=1</pre>
<p>On some notebooks, to enable any nvidia settings tweaking you must include this option, otherwise it responds with "Setting applications clocks is not supported" etc.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia NVreg_RegistryDwords="OverrideMaxPerf=0x1"</pre>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../Category:Graphics.html" title="Category:Graphics">Graphics</a></li>
<li><a href="../../Category:X_server.html" title="Category:X server">X server</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../../Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../../Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=NVIDIA/Tips_and_tricks&amp;oldid=613745">https://wiki.archlinux.org/index.php?title=NVIDIA/Tips_and_tricks&amp;oldid=613745</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 17 May 2020, at 08:57.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../../TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../../TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../../TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



