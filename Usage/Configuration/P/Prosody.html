<!--
    title: Prosody
    description: Migration of Prosody from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-29T19:25:31.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Prosody</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>From the <a rel="nofollow"  href="https://prosody.im/">official website</a>:
</p>
<dl><dd>Prosody is a modern XMPP communication server. It aims to be easy to set up and configure, and efficient with system resources. Additionally, for developers it aims to be easy to extend and give a flexible system on which to rapidly develop added functionality, or prototype new protocols.</dd></dl>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Installation"><span >1</span> <span >Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Optional_dependencies"><span >1.1</span> <span >Optional dependencies</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3">
<a href="#Configuration"><span >2</span> <span >Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Authentication"><span >2.1</span> <span >Authentication</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Logging"><span >2.2</span> <span >Logging</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#Operation"><span >3</span> <span >Operation</span></a>
<ul>
<li class="toclevel-2 tocsection-7">
<a href="#Security"><span >3.1</span> <span >Security</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#User_registration"><span >3.1.1</span> <span >User registration</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Stream_encryption"><span >3.1.2</span> <span >Stream encryption</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Listing_users"><span >3.2</span> <span >Listing users</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Removal"><span >4</span> <span >Removal</span></a></li>
<li class="toclevel-1 tocsection-12">
<a href="#Tips_and_tricks"><span >5</span> <span >Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-13">
<a href="#Components"><span >5.1</span> <span >Components</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#Multi-User_Chat"><span >5.1.1</span> <span >Multi-User Chat</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#Prosody_modules"><span >5.2</span> <span >Prosody modules</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Console"><span >5.3</span> <span >Console</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Troubleshooting"><span >6</span> <span >Troubleshooting</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Development"><span >7</span> <span >Development</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#Communication"><span >8</span> <span >Communication</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#See_also"><span >9</span> <span >See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="/Usage/Configuration/P/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=prosody">prosody</a></span> package.
</p>
<h3><span class="mw-headline" id="Optional_dependencies">Optional dependencies</span></h3>
<p>Prosody has optional depedencies that although not strictly required for its operation, provide useful features. These dependencies may also have to be built and installed from the AUR. If you are unfamiliar with how to build and install packages from the AUR please see <a href="/Usage/Configuration/P/TOS_User_Repository.html#Installing_packages" class="mw-redirect" title="AUR User Guidelines">AUR User Guidelines#Installing packages</a>. As of prosody version <a rel="nofollow"  href="https://blog.prosody.im/prosody-0-11-2-released/">0.11.2</a>, Lua 5.2 is needed. 
</p>
<dl>
<dt>TLS/SSL Support (Recommended)</dt>
<dd>Allow Prosody to encrypt streams to prevent eavesdropping.<br><i>Requires:</i> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=lua52-sec">lua52-sec</a></span>
</dd>
</dl>
<dl>
<dt>MySQL/Postgresql Backend</dt>
<dd>Allow Prosody to use a MySQL/mariadb/Postgresql backend for better scaling and performance.<br><i>Requires:</i> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=lua52-dbi">lua52-dbi</a></span>
</dd>
</dl>
<dl>
<dt>Better Connection Scaling (Recommended)</dt>
<dd>Allow Prosody to use <a rel="nofollow"  href="http://www.monkey.org/~provos/libevent/">libevent</a> to handle a greater number of simultaneous connections.<br><i>Requires:</i> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/lua52-event/">lua52-event</a></span><sup><small>AUR</small></sup>
</dd>
</dl>
<dl>
<dt>Stream Compression</dt>
<dd>Allow Prosody to compress client-to-server streams for compatible clients to save bandwidth.<br><i>Requires:</i> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/lua52-zlib/">lua52-zlib</a></span><sup><small>AUR</small></sup>
</dd>
</dl>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>posix</code> module and <code>pidfile</code> setting contained in the default configuration file are required for Prosody's proper operation.</div>
<p>The main configuration file is located at <code>/etc/prosody/prosody.cfg.lua</code>. Information on how to configure Prosody can be found in Prosody's <a rel="nofollow"  href="https://prosody.im/doc/configure">documentation</a>. The syntax of the configuration file can be checked after any changes are made by running: 
</p>
<pre># luac5.2 -p /etc/prosody/prosody.cfg.lua
</pre>
<p>No output means the syntax is correct.
</p>
<h3><span class="mw-headline" id="Authentication">Authentication</span></h3>
<p>The default configuration uses <a rel="nofollow"  href="https://prosody.im/doc/modules/mod_auth_internal_hashed">mod_auth_internal_hashed</a>. If you remove the line, it will default to <a rel="nofollow"  href="https://prosody.im/doc/modules/mod_auth_internal_plain">mod_auth_internal_plain</a>.
</p>
<h3><span class="mw-headline" id="Logging">Logging</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=prosody">prosody</a></span> package is pre-configured to log to syslog. Thus, by default, Prosody log messages are available in the <a href="/Usage/Configuration/P/Systemd/Journal.html" class="mw-redirect" title="Systemd journal">systemd journal</a>.
</p>
<h2><span class="mw-headline" id="Operation">Operation</span></h2>
<p><a href="/Usage/Configuration/P/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">Start/enable</a> the <code>prosody.service</code> systemd service.
</p>
<p>Prosody uses the default XMPP ports, 5222 and 5269, for client-to-server and server-to-server communications respectively. Configure your firewall as necessary.
</p>
<p>You can manipulate Prosody users by using the <code>prosodyctl</code> program. To add a user:
</p>
<pre># prosodyctl adduser <i>&lt;JID&gt;</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You will likely want to make at least one user an administrator by adding their Jabber ID to the <code>admins</code> list in the configuration file.</div>
<p>Issue <span class="plainlinks archwiki-template-man" title="$ man 1 prosodyctl"><a rel="nofollow"  href="https://jlk.fjfi.cvut.cz/arch/manpages/man/prosodyctl.1">prosodyctl(1)</a></span> to see the man page for <code>prosodyctl</code>.
</p>
<h3><span class="mw-headline" id="Security">Security</span></h3>
<h4><span class="mw-headline" id="User_registration">User registration</span></h4>
<p>Prosody supports XMPP's in-band registration <a rel="nofollow"  href="http://xmpp.org/extensions/xep-0077.html">standard</a>, which allows users to register with an XMPP client from within their client and change their passwords. While this is convenient for users it does not allow administrators to moderate the registration of new users. As such, the <code>register</code> module is enabled in the default configuration but <code>allow_registration</code> is set to <code>false</code>. This allows existing users to change their passwords from within their client but does not allow new users to register themselves.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you do decide to support new in-band registrations, you will likely find the <code>watchregistrations</code> and <code>welcome</code> modules useful.</div>
<h4><span class="mw-headline" id="Stream_encryption">Stream encryption</span></h4>
<p>Prosody can utilize TLS certificates to encrypt client-to-server communications (if the proper <a href="#Optional_dependencies">dependencies</a> are installed). See the relevant sections of <code>prosody.cfg.lua</code> to configure Prosody to utilize these certificates.
</p>
<p>To require encryption for client-to-server communications add the following to your configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/prosody/prosody.cfg.lua</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host "*"

    c2s_require_encryption = true</pre>
<p>Similarly, for server-to-server communications you may do:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/prosody/prosody.cfg.lua</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host "*"

    s2s_require_encryption = true</pre>
<p>While requiring client-to-server encryption is generally a good idea, please keep in mind that some popular XMPP services such as Google Talk/Gmail do not support server-to-server encryption.
</p>
<h3><span class="mw-headline" id="Listing_users">Listing users</span></h3>
<p>A simple way to see a list of the registered users is
</p>
<pre># ls -l /var/lib/prosody/*/accounts/*
</pre>
<p>alternatively, you can download the module <a rel="nofollow"  href="https://prosody.im/files/mod_listusers.lua">mod_listusers.lua</a>, and use it as
</p>
<pre># prosodyctl mod_listusers
</pre>
<h2><span class="mw-headline" id="Removal">Removal</span></h2>
<p>After normally uninstalling Prosody with pacman, the <code>/etc/prosody</code> and <code>/var/lib/prosody</code> directories may be left on your filesystem, and you may want to remove them if you do not plan on reinstalling Prosody.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Components">Components</span></h3>
<p>Prosody supports XMPP components, which provide extra services to clients. Components are either provided internally by special Prosody modules or externally using the protocol specified in <a rel="nofollow"  href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Components must use a different hostname from the <code>VirtualHost</code> names defined in <code>prosody.cfg.lua</code>. Attempting to host a component on the same hostname as a defined <code>VirtualHost</code> <b>will</b> result in errors.</div>
<p>By default, Prosody will listen for external components. If you do not plan to use any external components with Prosody you can disable this behavior by adding the following your configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/prosody/prosody.cfg.lua</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">component_ports = {}</pre>
<h4><span class="mw-headline" id="Multi-User_Chat">Multi-User Chat</span></h4>
<p>A common component used with XMPP servers is Multi-User Chat (MUC), which allows conferences between multiple users. MUC is provided as an internal component with Prosody. To enable MUC add the following to your configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/prosody/prosody.cfg.lua</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Component "conference.example.com" "muc"
</pre>
<p>This will enable the MUC component on host <code>conference.example.com</code>.
</p>
<h3><span class="mw-headline" id="Prosody_modules">Prosody modules</span></h3>
<p><a rel="nofollow"  href="https://prosody.im/community_modules">Prosody Modules</a> is a collection of extra modules not distributed with Prosody. These modules are in various states of development from highly experimental to relatively stable. You should consult a given module's wiki page for more information. An example of an extra module is <code><a rel="nofollow"  href="http://code.google.com/p/prosody-modules/wiki/mod_pastebin">pastebin</a></code>, which when loaded will intercept long messages (for example, log file output) and replace them with a link to a pastebin hosted using Prosody's internal HTTP server (provided by the core module, <code>httpserver</code>).
</p>
<p>To use an extra module download its raw file(s) from the source browser (when viewing a file, search for the link "View raw file"). Alternatively and likely easier, use Mercurial to clone the entire repository:
</p>
<dl><dt>Prosody 0.9+</dt></dl>
<p><code>$ hg clone https://hg.prosody.im/prosody-modules/ prosody-modules</code>
</p>
<dl><dt>Prosody 0.8</dt></dl>
<p><code>$ hg clone http://0-8.prosody-modules.googlecode.com/hg/ prosody-modules</code>
</p>
<p>Now you can copy the module (and any additional files it needs) to Prosody's module directory at <code>/usr/lib/prosody/modules</code>. To enable the module add it to your <code>modules_enabled</code> list in your <code>prosody.cfg.lua</code> for the host or component you wish to use it for. For example, to use the <code>pastebin</code> module on a MUC component:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/prosody/prosody.cfg.lua</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Component "conference.example.com" "muc"
    modules_enabled = { "pastebin" }</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> An enforced Prosody convention is that modules are named <code>mod_<i>foo</i>.lua</code> but simply enabled by adding <code><i>foo</i></code> to the <code>modules_enabled</code> list.</div>
<h3><span class="mw-headline" id="Console">Console</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The console does not require any authentication so any user on a multi-user system can connect and issue commands on the console. Therefore it is <b>not</b> recommended to enable the <code>console</code> module on a multi-user system.</div>
<p>The <code>console</code> module provides a telnet console from which administrative operations and queries can be performed. You can connect to the console by issuing:
</p>
<p><code>$ telnet localhost 5582</code>
</p>
<p>You of course need the <code>telnet</code> program provided by the <code>inetutils</code> package. Use the <code>help</code> command in the console to get usage help.
</p>
<p>The console even allows you to execute Lua commands directly on the server by preceding a command with <code>&gt;</code>. For example to see if a client connection is compressed:
</p>
<p><code>&gt; full_sessions["romeo@montague.lit/Resource"].compressed</code>
</p>
<p>Will return <code>true</code> if the connection is compressed or <code>nil</code> if it is not.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>One of Prosody's primary design principles is to be simple to use and configure. However, issues can still arise (and likely will as is the case with any complex software). If you encounter a problem there are a variety of steps you can take to narrow down the cause:
</p>
<ul>
<li>
<b>Check for known issues</b><br>Look at the <a rel="nofollow"  href="https://prosody.im/doc/release">release notes</a> for your Prosody version to see if your issue is listed as a known issue. Also check the <a rel="nofollow"  href="https://prosody.im/issues/list">issue tracker</a> to see if your issue has already been reported.</li>
<li>
<b>Check configuration syntax</b><br>Run <code>luac5.1 -p /etc/prosody/prosody.cfg.lua</code> to check for any syntax errors in your configuration file. If there is no output your syntax is fine.</li>
<li>
<b>Check the log</b><br>Errors are only logged if there is a critical problem so always address those issues. If you think you have a very low level issue (like protocol compatibility between clients and servers with Prosody) then you can enable the very verbose debug level logging.</li>
<li>
<b>Check permissions</b><br>The Prosody package should add a new <code>prosody</code> user and group to your system and set appropriate permissions, but it is always good to double check. Ensure that <code>/etc/prosody</code> and <code>/var/lib/prosody</code> are owned by the <code>prosody</code> user and that the user has appropriate permissions to read and write to those paths and all contained files.</li>
<li>
<b>Check listening ports</b><br>When troubleshooting connection issues make sure that Prosody is actually listening for connections. You may do so by running <code>ss -tul</code> and making sure that <code>xmpp-client</code> (port 5222) and <code>xmpp-server</code> (port 5269) are listed.</li>
<li>
<b>Restart</b><br>Like most things, it does not hurt to restart Prosody (<code>systemctl restart prosody</code>) to see if it resolves an issue.</li>
</ul>
<p>If you are unable to resolve your issue yourself there are a variety of resources you can use to seek help. In order of immediacy with which you will likely receive help:
</p>
<ol>
<li>XMPP Conference: <code>prosody@conference.prosody.im</code>
</li>
<li>Mailing List: <code>prosody-users@googlegroups.com</code>, <a rel="nofollow"  href="https://groups.google.com/forum/#!forum/prosody-users">web interface</a>
</li>
<li>
<a rel="nofollow"  href="https://bbs.archlinux.org/viewforum.php?id=4">TOS Forums</a> (for package issues)</li>
</ol>
<h2><span class="mw-headline" id="Development">Development</span></h2>
<p>A development packages is maintained for Prosody in the AUR, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/prosody-hg/">prosody-hg</a></span><sup><small>AUR</small></sup>. <code>prosody-hg</code> tracks the <a rel="nofollow"  href="http://www.selenic.com/mercurial/wiki/">Mercurial</a> repository tip for Prosody and will always contain the latest code as it is checked in. Both packages are built similarly to the stable package.
</p>
<h2><span class="mw-headline" id="Communication">Communication</span></h2>
<ul>
<li>Mailing Lists: <a rel="nofollow"  href="https://groups.google.com/forum/#!forum/prosody-dev">prosody-dev</a>, <a rel="nofollow"  href="https://groups.google.com/forum/#!forum/prosody-users">prosody-users</a>
</li>
<li>Conference: <code>prosody@conference.prosody.im</code>
</li>
<li>Blog: <a rel="nofollow"  href="https://blog.prosody.im/">Prosodical Thoughts</a>
</li>
</ul>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow"  href="https://prosody.im/doc">Official documentation</a></li>
<li>
<a rel="nofollow"  href="https://blog.prosody.im/">Prosodical Thoughts</a> (Blog)</li>
<li><a rel="nofollow"  href="https://prosody.im/issues/">Issue Tracker</a></li>
<li>
<a rel="nofollow"  href="https://hg.prosody.im/prosody-modules/">Prosody Modules</a> (Extra Modules)</li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="/Usage/Configuration/P/Category:XMPP.html" title="Category:XMPP">XMPP</a></li></ul>
</div></div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Prosody&amp;oldid=608260">https://wiki.archlinux.org/index.php?title=Prosody&amp;oldid=608260</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 26 April 2020, at 09:38.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="/Usage/Configuration/P/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="/Usage/Configuration/P/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="/Usage/Configuration/P/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



