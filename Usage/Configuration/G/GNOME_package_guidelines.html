<!--
    title: GNOME_package_guidelines
    description: Migration of GNOME_package_guidelines from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-29T19:40:39.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">GNOME package guidelines</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div  style="display:block; text-align: center; margin-bottom: 1em;">
<b><a href="/Usage/Configuration/T/TOS_package_guidelines.html" title="TOS package guidelines">TOS package guidelines</a></b>
<hr>
<p><a href="../wiki/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit</a> – <a href="/Usage/Configuration/C/CLR_package_guidelines.html" title="CLR package guidelines">CLR</a> – <a href="/Usage/Configuration/C/CMake_package_guidelines.html" title="CMake package guidelines">CMake</a> – <a href="/Usage/Configuration/C/Cross-compiling_tools_package_guidelines.html" title="Cross-compiling tools package guidelines">Cross</a> – <a href="/Usage/Configuration/E/Eclipse_plugin_package_guidelines.html" title="Eclipse plugin package guidelines">Eclipse</a> – <a href="/Usage/Configuration/E/Electron_package_guidelines.html" title="Electron package guidelines">Electron</a> – <a href="/Usage/Configuration/F/Font_package_guidelines.html" class="mw-redirect" title="Font packaging guidelines">Font</a> – <a href="/Usage/Configuration/F/Free_Pascal_package_guidelines.html" title="Free Pascal package guidelines">Free Pascal</a> – <a class="mw-selflink selflink">GNOME</a> – <a href="/Usage/Configuration/G/Go_package_guidelines.html" title="Go package guidelines">Go</a> – <a href="/Usage/Configuration/H/Haskell_package_guidelines.html" title="Haskell package guidelines">Haskell</a> – <a href="/Usage/Configuration/J/Java_package_guidelines.html" title="Java package guidelines">Java</a> – <a href="/Usage/Configuration/K/KDE_package_guidelines.html" title="KDE package guidelines">KDE</a> – <a href="/Usage/Configuration/K/Kernel_module_package_guidelines.html" title="Kernel module package guidelines">Kernel</a> – <a href="/Usage/Configuration/L/Lisp_package_guidelines.html" title="Lisp package guidelines">Lisp</a> – <a href="/Usage/Configuration/M/MinGW_package_guidelines.html" title="MinGW package guidelines">MinGW</a> – <a href="/Usage/Configuration/N/Node.js_package_guidelines.html" title="Node.js package guidelines">Node.js</a> – <a href="/Usage/Configuration/N/Nonfree_applications_package_guidelines.html" title="Nonfree applications package guidelines">Nonfree</a> – <a href="/Usage/Configuration/O/OCaml_package_guidelines.html" title="OCaml package guidelines">OCaml</a> – <a href="/Usage/Configuration/P/Perl_package_guidelines.html" title="Perl package guidelines">Perl</a> – <a href="/Usage/Configuration/P/PHP_package_guidelines.html" title="PHP package guidelines">PHP</a> – <a href="/Usage/Configuration/P/Python_package_guidelines.html" title="Python package guidelines">Python</a> – <a href="/Usage/Configuration/R/R_package_guidelines.html" title="R package guidelines">R</a> – <a href="/Usage/Configuration/R/Ruby_Gem_package_guidelines.html" title="Ruby Gem package guidelines">Ruby</a> – <a href="/Usage/Configuration/R/Rust_package_guidelines.html" title="Rust package guidelines">Rust</a> – <a href="/Usage/Configuration/V/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a> – <a href="/Usage/Configuration/W/Web_application_package_guidelines.html" title="Web application package guidelines">Web</a> – <a href="/Usage/Configuration/W/Wine_package_guidelines.html" title="Wine package guidelines">Wine</a>
</p>
</div>
<p>The <a href="/Usage/Configuration/G/GNOME.html" title="GNOME">GNOME</a> packages on TOS Linux follow a certain schema.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Source_URL"><span >1</span> <span >Source URL</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Using_released_tarball"><span >1.1</span> <span >Using released tarball</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Using_a_commit_from_Git_repository"><span >1.2</span> <span >Using a commit from Git repository</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Building_with_meson"><span >2</span> <span >Building with meson</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#GConf_schemas"><span >3</span> <span >GConf schemas</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#GSettings_schemas"><span >4</span> <span >GSettings schemas</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Scrollkeeper_documentation"><span >5</span> <span >Scrollkeeper documentation</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#GTK_icon_cache"><span >6</span> <span >GTK icon cache</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#.desktop_files"><span >7</span> <span >.desktop files</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#.install_files"><span >8</span> <span >.install files</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Source_URL">Source URL</span></h2>
<p>This topic contains the most commonly used source URL used by GNOME packages in both <a href="/Usage/Configuration/O/Official_repositories.html" title="Official repositories">official repositories</a> and <a href="/Usage/Configuration/T/TOS_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>. For examples, search for GNOME packages in the official repositories<a rel="nofollow"  href="https://www.archlinux.org/packages/?q=gnome">[1]</a> and in the AUR<a rel="nofollow"  href="https://aur.archlinux.org/packages/?K=gnome">[2]</a>
</p>
<h3><span class="mw-headline" id="Using_released_tarball">Using released tarball</span></h3>
<p>When downloading a released tarball, you can get it from <a rel="nofollow"  href="https://download.gnome.org">https://download.gnome.org</a> using the following source array:
</p>
<pre>source=("https://download.gnome.org/sources/$pkgname/${pkgver%.*}/$pkgname-$pkgver.tar.xz")
</pre>
<p>where <i>${pkgver%.*}</i> returns the <i>major</i>.<i>minor</i> package version, by removing the suffix of <code>pkgver</code> (which is the <i>micro</i> package version). E.g., if <i>pkgver=3.28.0</i> then <i>${pkgver%.*}</i> would return <i>3.28</i>.
</p>
<h3><span class="mw-headline" id="Using_a_commit_from_Git_repository">Using a commit from Git repository</span></h3>
<p>Another common practice is to use as source a specific commit from a GNOME software's source code git repository. It doesn't classify as VCS package because Pacman's feature of setting specific commit<a rel="nofollow"  href="https://www.archlinux.org/pacman/PKGBUILD.5.html#_using_vcs_sources_a_id_vcs_a">[3]</a> makes PKGBUILD not follow latest development commits neither update the <code>pkgver</code> field, using the source from the specified commit hash instead.
</p>
<p>See a template below:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">makedepends=(git)
commit=<i>hash_of_a_commit</i> 
source=("git+https://gitlab.gnome.org/GNOME/$pkgname.git#commit=$_commit")
md5sums=('SKIP')

pkgver() {
  cd $pkgname
  git describe --tags | sed 's/-/+/g'
}</pre>
<p>Replace <i>hash_of_a_commit</i> with the Git commit hash desired.
</p>
<p>Please notice that since the source is downloaded with <i>git</i>, then <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=git">git</a></span> must be in makedepends and checksums must be set to 'SKIP', just like it would happen with any other VCS package. Using <code>pkgver()</code> function is highly recommended, so it sets <code>pkgver</code> accordingly for the commit hash provided.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> GNOME previously used <a rel="nofollow"  href="https://git.gnome.org">https://git.gnome.org</a>, but then migrated to <a rel="nofollow"  href="https://gitlab.gnome.org">https://gitlab.gnome.org</a><a rel="nofollow"  href="https://www.gnome.org/news/2018/05/gnome-moves-to-gitlab-2/">[4]</a>. Old links should automatically redirect to the new gitlab.gnome.org domain, but it might be wise to manually update your source URL.</div>
<h2><span class="mw-headline" id="Building_with_meson">Building with meson</span></h2>
<p>Many GNOME software migrated the build system to <a rel="nofollow"  href="https://mesonbuild.com/">Meson</a>, consequently dropping <a href="/Usage/Configuration/G/GNU.html#Build_system" class="mw-redirect" title="GNU Build System">GNU Autotools</a> support. That means you will not be using <i>./configure</i> and <i>make</i> in this case.
</p>
<p>In order to build using Meson, add the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=meson">meson</a></span> package to <a href="/Usage/Configuration/P/PKGBUILD.html#makedepends" class="mw-redirect" title="Makedepends">makedepends</a> and call its command <i>meson</i>, optionally including any desired options supported by the target software. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=ninja">ninja</a></span> package will also be used in this build system but it is a dependency of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=meson">meson</a></span>, so you do not need to include it in the <i>makedepends</i> array.)
</p>
<p>The <a href="/Usage/Configuration/C/Creating_packages.html#build()" title="Creating packages">build()</a>, <a href="/Usage/Configuration/C/Creating_packages.html#check()" title="Creating packages">check()</a>, and <a href="/Usage/Configuration/C/Creating_packages.html#package()" title="Creating packages">package()</a> functions should look something like:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">makedepends=(meson)

build() {
  meson --prefix /usr --buildtype=plain <i>source</i> <i>build</i>
  ninja -C <i>build</i>
}

check() {
  ninja -C <i>build</i> check
}

package() {
  DESTDIR="$pkgdir" ninja -C <i>build</i> install
}</pre>
<p>where
</p>
<ul>
<li>
<i>source</i> is the directory containing the extracted source code, e.g. <i>$pkgname</i> or <i>$pkgname-$pkgver</i>; and</li>
<li>
<i>build</i> is the directory that will hold the binary files to be installed.  Normally the dirname "build" is used so you may want to keep it for standardization, but you may rename it to whatever pleases you.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Some software do not support invoking <i>meson</i> from outside the source code's root directory. If that is your case, adapt the above code block by simply adding <code>cd <i>source</i></code> to the start of the three functions above, and also changing the above <i>meson</i> command-line to <code>meson . <i>build</i></code>.</li>
<li>If the software have no testing rules set (case which the above code block would fail to build the package), remove/comment the whole <i>check()</i> function.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> In order to toggle a build option in <i>meson</i>, append <code>-D <i>option=value</i></code> flags to the <i>meson</i> command-line, where <i>option</i> is a supported option for the target software you are building, and <i>value</i> is a valid value for the <i>option</i> given. So, for instance, if the software has a <i>gtk_doc</i> option as <i>false</i> by default and you want to enable it, append <code>-D gtk_doc=true</code> to the <i>meson</i> command-line. Read <code>meson.build</code> and <code>meson_options.txt</code> files in the source code's root directory to find the available options.</div>
<h2><span class="mw-headline" id="GConf_schemas">GConf schemas</span></h2>
<p>Some GNOME packages install <a href="https://en.wikipedia.org/wiki/GConf#Schemas"  title="wikipedia:GConf">GConf schemas</a>, even though many others already migrated to GSettings. Those packages should depend on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/gconf/">gconf</a></span><sup><small>AUR</small></sup>.
</p>
<p>Gconf schemas get installed in the system GConf database, which has to be avoided.
Some packages provide a <code>--disable-schemas-install</code> switch for <b>./configure</b>, which hardly ever works. However, gconftool-2 has a variable called <code>GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL</code> which you can set to tell gconftool-2 to not update any databases.
</p>
<p>When creating packages that install GConf schema files, use
</p>
<pre>make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR=${pkgdir} install</pre>
<p>for the package installation step in the PKGBUILD.
</p>
<p>Do not call <code>gconfpkg</code> in the .install file, as GConf schemas are automatically installed/removed (while installing/removing the GNOME package) via <a href="/Usage/Configuration/P/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a> since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/gconf/">gconf</a></span><sup><small>AUR</small></sup>=3.2.6-4
</p>
<h2><span class="mw-headline" id="GSettings_schemas">GSettings schemas</span></h2>
<p>The GConf schemas were migrated to GSettings schemas, so many GNOME applications can be found using this new schema file. GSettings uses dconf as backend, so all packages that contain GSettings schemas require <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=dconf">dconf</a></span> as dependency. When a new GSettings schema installed on the system, the GSettings database has to be recompiled, but not when packaging.
</p>
<p>To avoid recompiling GSettings database on packaging, use the <code>--disable-schemas-compile</code> switch for <b>./configure</b>.
</p>
<p>Do not call <code>glib-compile-schemas</code> in the .install file, as GSettings schema databases are automatically recompiled via <a href="/Usage/Configuration/P/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a> since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=glib2">glib2</a></span>=2.48.0-2.
</p>
<h2><span class="mw-headline" id="Scrollkeeper_documentation">Scrollkeeper documentation</span></h2>
<p>Starting from GNOME 2.20 there is no need to handle scrollkeeper anymore, as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/rarian/">rarian</a></span><sup><small>AUR</small></sup> reads its OMF files directly. Scrollkeeper-update is a dummy these days. The only required thing now is to makedepend on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/gnome-doc-utils/">gnome-doc-utils</a></span><sup><small>AUR</small></sup>&gt;=0.11.2.
</p>
<p>It can be disabled using <code>--disable-scrollkeeper</code> switch from <b>./configure</b>.
</p>
<h2><span class="mw-headline" id="GTK_icon_cache">GTK icon cache</span></h2>
<p>Quite some packages install icons in the hicolor icon theme.
</p>
<p>Do not call <code>gtk-update-icon-cache</code> in the .install file, as the icon cache is updated via <a href="/Usage/Configuration/P/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a> since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gtk-update-icon-cache">gtk-update-icon-cache</a></span>=3.20.3-2.  These packages should <i>not</i> depend on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=gtk-update-icon-cache">gtk-update-icon-cache</a></span>, as any application which makes use of gtk icon caches will install the package with the hook and do a full, retroactive cache update.
</p>
<h2><span class="mw-headline" id=".desktop_files">.desktop files</span></h2>
<p>Many packages install Freedesktop.org compatible <code>.desktop</code> files and register MimeType entries in them.
</p>
<p>Do not call <code>update-desktop-database</code> in the .install file, as the database is automatically updated via <a href="/Usage/Configuration/P/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a> since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=desktop-file-utils">desktop-file-utils</a></span>=0.22-2. They should <i>not</i> depend on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=desktop-file-utils">desktop-file-utils</a></span>, as any desktop which makes use of desktop files will install the package with the hook and do a full, retroactive database update.
</p>
<h2><span class="mw-headline" id=".install_files">.install files</span></h2>
<p>Previously, most of the GNOME packages had a .install file calling commands like <code>glib-compile-schemas</code>, <code>gtk-update-icon-cache</code>, and <code>update-desktop-database</code> in order to install/update local cache or databases.  This is deprecated since pacman 5.0 implemented <a href="/Usage/Configuration/P/Pacman.html#Hooks" title="Pacman">hooks</a> which call those commands automatically when installing the package.
</p>
<p>To avoid being called twice, the above mentioned commands should be removed from .install file.
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="/Usage/Configuration/C/Category:TOS_package_guidelines.html" title="Category:TOS package guidelines">TOS package guidelines</a></li></ul>
</div></div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GNOME_package_guidelines&amp;oldid=602193">https://wiki.archlinux.org/index.php?title=GNOME_package_guidelines&amp;oldid=602193</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 21 March 2020, at 13:22.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="/Usage/Configuration/T/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="/Usage/Configuration/T/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="/Usage/Configuration/T/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



