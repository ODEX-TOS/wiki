<!--
    title: Examples
    description: Migration of Examples from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-29T19:25:31.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Font configuration/Examples</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="..//Usage/Configuration/E/Font_configuration.html" title="Font configuration">Font configuration</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>See <a href="..//Usage/Configuration/E/Font_configuration.html" title="Font configuration">Font configuration</a> for the main article. 
</p>
<p>Configurations can vary to a degree.  Please post Fontconfig configurations with an explanation for why they were done.
</p>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Hinted_fonts"><span >1</span> <span >Hinted fonts</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#No_hinting_for_italic_or_bold"><span >2</span> <span >No hinting for italic or bold</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Enable_anti-aliasing_only_for_bigger_fonts"><span >3</span> <span >Enable anti-aliasing only for bigger fonts</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Disable_bold_font"><span >4</span> <span >Disable bold font</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Disable_ligatures_for_monospaced_fonts"><span >5</span> <span >Disable ligatures for monospaced fonts</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#Default_fonts"><span >6</span> <span >Default fonts</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Japanese"><span >6.1</span> <span >Japanese</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Chinese"><span >6.2</span> <span >Chinese</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Chinese_in_Noto_Fonts"><span >6.3</span> <span >Chinese in Noto Fonts</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Alternate_stylistic_sets_for_fonts"><span >7</span> <span >Alternate stylistic sets for fonts</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#See_also"><span >8</span> <span >See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Hinted_fonts">Hinted fonts</span></h2>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/fontconfig/fonts.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version='1.0'?&gt;
&lt;!DOCTYPE fontconfig SYSTEM 'fonts.dtd'&gt;
&lt;fontconfig&gt;
	&lt;match target="font"&gt;
		&lt;edit mode="assign" name="antialias"&gt;
			&lt;bool&gt;true&lt;/bool&gt;
		&lt;/edit&gt;
		&lt;edit mode="assign" name="embeddedbitmap"&gt;
			&lt;bool&gt;false&lt;/bool&gt;
		&lt;/edit&gt;
		&lt;edit mode="assign" name="hinting"&gt;
			&lt;bool&gt;true&lt;/bool&gt;
		&lt;/edit&gt;
		&lt;edit mode="assign" name="hintstyle"&gt;
			&lt;const&gt;hintslight&lt;/const&gt;
		&lt;/edit&gt;
		&lt;edit mode="assign" name="lcdfilter"&gt;
			&lt;const&gt;lcddefault&lt;/const&gt;
		&lt;/edit&gt;
		&lt;edit mode="assign" name="rgba"&gt;
			&lt;const&gt;rgb&lt;/const&gt;
		&lt;/edit&gt;
	&lt;/match&gt;
&lt;/fontconfig&gt;
</pre>
<h2><span class="mw-headline" id="No_hinting_for_italic_or_bold">No hinting for italic or bold</span></h2>
<pre>&lt;?xml version='1.0'?&gt;
&lt;!DOCTYPE fontconfig SYSTEM 'fonts.dtd'&gt;
&lt;fontconfig&gt;
  &lt;match target="font" &gt;
    &lt;edit mode="assign" name="autohint"&gt;  &lt;bool&gt;true&lt;/bool&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="hinting"&gt;	  &lt;bool&gt;false&lt;/bool&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="lcdfilter"&gt; &lt;const&gt;lcddefault&lt;/const&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="hintstyle"&gt; &lt;const&gt;hintslight&lt;/const&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="antialias"&gt; &lt;bool&gt;true&lt;/bool&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="rgba"&gt;      &lt;const&gt;rgb&lt;/const&gt;&lt;/edit&gt;
  &lt;/match&gt;

  &lt;match target="font"&gt;
    &lt;test name="pixelsize" qual="any" compare="more"&gt;&lt;double&gt;15&lt;/double&gt;&lt;/test&gt;
    &lt;edit mode="assign" name="lcdfilter"&gt;&lt;const&gt;lcdlight&lt;/const&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="hintstyle"&gt;&lt;const&gt;hintnone&lt;/const&gt;&lt;/edit&gt;
  &lt;/match&gt;

  &lt;match target="font"&gt;
    &lt;test name="weight" compare="more"&gt;&lt;const&gt;medium&lt;/const&gt;&lt;/test&gt;
    &lt;edit mode="assign" name="hintstyle"&gt;&lt;const&gt;hintnone&lt;/const&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="lcdfilter"&gt;&lt;const&gt;lcdlight&lt;/const&gt;&lt;/edit&gt;
  &lt;/match&gt;

  &lt;match target="font"&gt;
    &lt;test name="slant"  compare="not_eq"&gt;&lt;double&gt;0&lt;/double&gt;&lt;/test&gt;
    &lt;edit mode="assign" name="hintstyle"&gt;&lt;const&gt;hintnone&lt;/const&gt;&lt;/edit&gt;
    &lt;edit mode="assign" name="lcdfilter"&gt;&lt;const&gt;lcdlight&lt;/const&gt;&lt;/edit&gt;
  &lt;/match&gt;

&lt;/fontconfig&gt;
</pre>
<h2><span class="mw-headline" id="Enable_anti-aliasing_only_for_bigger_fonts">Enable anti-aliasing only for bigger fonts</span></h2>
<p>Some users prefer the sharper rendering that anti-aliasing does not offer:
</p>
<pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
&lt;fontconfig&gt;
  &lt;match target="font"&gt;
    &lt;edit name="antialias" mode="assign"&gt;
      &lt;bool&gt;false&lt;/bool&gt;
    &lt;/edit&gt;
  &lt;/match&gt;

  &lt;match target="font" &gt;
    &lt;test name="size" qual="any" compare="more"&gt;
      &lt;double&gt;12&lt;/double&gt;
    &lt;/test&gt;
    &lt;edit name="antialias" mode="assign"&gt;
      &lt;bool&gt;true&lt;/bool&gt;
    &lt;/edit&gt;
  &lt;/match&gt;

  &lt;match target="font" &gt;
    &lt;test name="pixelsize" qual="any" compare="more"&gt;
      &lt;double&gt;16&lt;/double&gt;
    &lt;/test&gt;
    &lt;edit name="antialias" mode="assign"&gt;
      &lt;bool&gt;true&lt;/bool&gt;
    &lt;/edit&gt;
  &lt;/match&gt;
&lt;/fontconfig&gt;
</pre>
<h2><span class="mw-headline" id="Disable_bold_font">Disable bold font</span></h2>
<p>For when a font does not present itself well in bold and you can't disable bold fonts in the application (<a href="..//Usage/Configuration/E/St.html" title="St">st</a> for example).
</p>
<pre>...
&lt;match target="pattern"&gt;
    &lt;test qual="any" name="family"&gt;
        &lt;string&gt;Envy Code R&lt;/string&gt;
    &lt;/test&gt;
    &lt;test name="weight" compare="more"&gt;
        &lt;const&gt;medium&lt;/const&gt;
    &lt;/test&gt;
    &lt;edit name="weight" mode="assign" binding="same"&gt;
        &lt;const&gt;medium&lt;/const&gt;
    &lt;/edit&gt;
&lt;/match&gt;
...
</pre>
<h2><span class="mw-headline" id="Disable_ligatures_for_monospaced_fonts">Disable ligatures for monospaced fonts</span></h2>
<p>This prevents letter combinations like "ffi" from being squashed into a single-width character in some monospaced fonts.  The whole <code>&lt;match&gt;</code> block needs to be duplicated to include extra fonts.
</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
&lt;fontconfig&gt;
  &lt;description&gt;Disable ligatures for monospaced fonts to avoid ff, fi, ffi, etc. becoming only one character wide&lt;/description&gt;

  &lt;match target="font"&gt;
    &lt;test name="family" compare="eq" ignore-blanks="true"&gt;
      &lt;string&gt;Nimbus Mono PS&lt;/string&gt;
    &lt;/test&gt;
    &lt;edit name="fontfeatures" mode="append"&gt;
      &lt;string&gt;liga off&lt;/string&gt;
      &lt;string&gt;dlig off&lt;/string&gt;
    &lt;/edit&gt;
  &lt;/match&gt;
&lt;/fontconfig&gt;
</pre>
<p>You can test the effectiveness of this with the following command:
</p>
<pre>$ echo -e "| worksheet |\n| buffering |\n| difficult |\n| finishing |\n| different |\n| efficient |" | pango-view --font="Nimbus Mono PS" /dev/stdin
</pre>
<p>Some programs (such as Firefox) do not support the <code>fontfeatures</code> tag, so for those replacing the font with another is the only option. See <a href="..//Usage/Configuration/E/Font_configuration.html#Replace_or_set_default_fonts" title="Font configuration">Font configuration#Replace or set default fonts</a> for details.
</p>
<h2><span class="mw-headline" id="Default_fonts">Default fonts</span></h2>
<p>For font consistency, all applications should be set to use the serif, sans-serif, and monospace aliases, which are mapped to particular fonts by fontconfig. See <a href="..//Usage/Configuration/E/Metric-compatible_fonts.html" title="Metric-compatible fonts">Metric-compatible fonts</a> for options and examples. 
</p>
<h3><span class="mw-headline" id="Japanese">Japanese</span></h3>
<p>Example fonts.conf which also specifies a default font for the Japanese locale (ja_JP) and keeps western style fonts for Latin letters.
</p>
<pre>&lt;?xml version='1.0'?&gt;
&lt;!DOCTYPE fontconfig SYSTEM 'fonts.dtd'&gt;
&lt;fontconfig&gt;

&lt;!-- Default font (no fc-match pattern) --&gt;
 &lt;match&gt;
  &lt;edit mode="prepend" name="family"&gt;
   &lt;string&gt;Noto Sans&lt;/string&gt;
  &lt;/edit&gt;
 &lt;/match&gt;

&lt;!-- Default font for the ja_JP locale (no fc-match pattern) --&gt;
 &lt;match&gt;
  &lt;test compare="contains" name="lang"&gt;
   &lt;string&gt;ja&lt;/string&gt;
  &lt;/test&gt;
  &lt;edit mode="prepend" name="family"&gt;
   &lt;string&gt;Noto Sans CJK JP&lt;/string&gt;
  &lt;/edit&gt;
 &lt;/match&gt;

&lt;!-- Default sans-serif font --&gt;
 &lt;match target="pattern"&gt;
   &lt;test qual="any" name="family"&gt;&lt;string&gt;sans-serif&lt;/string&gt;&lt;/test&gt;
   &lt;!--&lt;test qual="any" name="lang"&gt;&lt;string&gt;ja&lt;/string&gt;&lt;/test&gt;--&gt;
   &lt;edit name="family" mode="prepend" binding="same"&gt;&lt;string&gt;Noto Sans&lt;/string&gt;  &lt;/edit&gt;
 &lt;/match&gt;
 
&lt;!-- Default serif fonts --&gt;
 &lt;match target="pattern"&gt;
   &lt;test qual="any" name="family"&gt;&lt;string&gt;serif&lt;/string&gt;&lt;/test&gt;
   &lt;edit name="family" mode="prepend" binding="same"&gt;&lt;string&gt;Noto Serif&lt;/string&gt;  &lt;/edit&gt;
   &lt;edit name="family" mode="append" binding="same"&gt;&lt;string&gt;IPAPMincho&lt;/string&gt;  &lt;/edit&gt;
   &lt;edit name="family" mode="append" binding="same"&gt;&lt;string&gt;HanaMinA&lt;/string&gt;  &lt;/edit&gt;
 &lt;/match&gt;

&lt;!-- Default monospace fonts --&gt;
 &lt;match target="pattern"&gt;
   &lt;test qual="any" name="family"&gt;&lt;string&gt;monospace&lt;/string&gt;&lt;/test&gt;
   &lt;edit name="family" mode="prepend" binding="same"&gt;&lt;string&gt;Noto Sans Mono&lt;/string&gt;&lt;/edit&gt;
   &lt;edit name="family" mode="append" binding="same"&gt;&lt;string&gt;Inconsolatazi4&lt;/string&gt;&lt;/edit&gt;
   &lt;edit name="family" mode="append" binding="same"&gt;&lt;string&gt;IPAGothic&lt;/string&gt;&lt;/edit&gt;
 &lt;/match&gt;

&lt;!-- Fallback fonts preference order --&gt;
 &lt;alias&gt;
  &lt;family&gt;sans-serif&lt;/family&gt;
  &lt;prefer&gt;
   &lt;family&gt;Noto Sans&lt;/family&gt;
   &lt;family&gt;Open Sans&lt;/family&gt;
   &lt;family&gt;Droid Sans&lt;/family&gt;
   &lt;family&gt;Ubuntu&lt;/family&gt;
   &lt;family&gt;Roboto&lt;/family&gt;
   &lt;family&gt;NotoSansCJK&lt;/family&gt;
   &lt;family&gt;Source Han Sans JP&lt;/family&gt;
   &lt;family&gt;IPAPGothic&lt;/family&gt;
   &lt;family&gt;VL PGothic&lt;/family&gt;
   &lt;family&gt;Koruri&lt;/family&gt;
  &lt;/prefer&gt;
 &lt;/alias&gt;
 &lt;alias&gt;
  &lt;family&gt;serif&lt;/family&gt;
  &lt;prefer&gt;
   &lt;family&gt;Noto Serif&lt;/family&gt;
   &lt;family&gt;Droid Serif&lt;/family&gt;
   &lt;family&gt;Roboto Slab&lt;/family&gt;
   &lt;family&gt;IPAPMincho&lt;/family&gt;
  &lt;/prefer&gt;
 &lt;/alias&gt;
 &lt;alias&gt;
  &lt;family&gt;monospace&lt;/family&gt;
  &lt;prefer&gt;
   &lt;family&gt;Noto Sans Mono&lt;/family&gt;
   &lt;family&gt;Inconsolatazi4&lt;/family&gt;
   &lt;family&gt;Ubuntu Mono&lt;/family&gt;
   &lt;family&gt;Droid Sans Mono&lt;/family&gt;
   &lt;family&gt;Roboto Mono&lt;/family&gt;
   &lt;family&gt;IPAGothic&lt;/family&gt;
  &lt;/prefer&gt;
 &lt;/alias&gt;

&lt;/fontconfig&gt;
</pre>
<h3><span class="mw-headline" id="Chinese">Chinese</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/fontconfig/fonts.conf
or
/etc/fonts/local.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
&lt;fontconfig&gt;

    &lt;match target="font"&gt;
        &lt;edit name="embeddedbitmap" mode="assign"&gt;
            &lt;bool&gt;false&lt;/bool&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;match&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend" binding="strong"&gt;
            &lt;string&gt;Noto Serif&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;sans-serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend" binding="strong"&gt;
            &lt;string&gt;Roboto&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;monospace&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend" binding="strong"&gt;
            &lt;string&gt;DejaVu Sans Mono&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;match&gt;
        &lt;test name="lang" compare="contains"&gt;
            &lt;string&gt;zh&lt;/string&gt;
        &lt;/test&gt;
        &lt;test name="family"&gt;
            &lt;string&gt;serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend"&gt;
            &lt;string&gt;Source Han Serif CN&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match&gt;
        &lt;test name="lang" compare="contains"&gt;
            &lt;string&gt;zh&lt;/string&gt;
        &lt;/test&gt;
        &lt;test name="family"&gt;
            &lt;string&gt;sans-serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend"&gt;
            &lt;string&gt;Source Han Sans CN&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match&gt;
        &lt;test name="lang" compare="contains"&gt;
            &lt;string&gt;zh&lt;/string&gt;
        &lt;/test&gt;
        &lt;test name="family"&gt;
            &lt;string&gt;monospace&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend"&gt;
            &lt;string&gt;Noto Sans Mono CJK SC&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

&lt;!--Windows &amp; Linux Chinese fonts. --&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;WenQuanYi Zen Hei&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;Source Han Sans CN&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
                &lt;test qual="any" name="family"&gt;
                        &lt;string&gt;WenQuanYi Micro Hei&lt;/string&gt;
                &lt;/test&gt;
                &lt;edit name="family" mode="assign" binding="same"&gt;
                        &lt;string&gt;Source Han Sans CN&lt;/string&gt;
                &lt;/edit&gt;
    &lt;/match&gt;
        &lt;match target="pattern"&gt;
                &lt;test qual="any" name="family"&gt;
                        &lt;string&gt;WenQuanYi Micro Hei Light&lt;/string&gt;
                &lt;/test&gt;
                &lt;edit name="family" mode="assign" binding="same"&gt;
                        &lt;string&gt;Source Han Sans CN&lt;/string&gt;
                &lt;/edit&gt;
        &lt;/match&gt;
    &lt;match target="pattern"&gt;
                &lt;test qual="any" name="family"&gt;
                        &lt;string&gt;Microsoft YaHei&lt;/string&gt;
                &lt;/test&gt;
                &lt;edit name="family" mode="assign" binding="same"&gt;
                        &lt;string&gt;Source Han Sans CN&lt;/string&gt;
                &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern"&gt;
                &lt;test qual="any" name="family"&gt;
                        &lt;string&gt;SimHei&lt;/string&gt;
                &lt;/test&gt;
                &lt;edit name="family" mode="assign" binding="same"&gt;
                        &lt;string&gt;Source Han Sans CN&lt;/string&gt;
                &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern"&gt;
                &lt;test qual="any" name="family"&gt;
                        &lt;string&gt;SimSun&lt;/string&gt;
                &lt;/test&gt;
                &lt;edit name="family" mode="assign" binding="same"&gt;
                        &lt;string&gt;Source Han Serif CN&lt;/string&gt;
                &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern"&gt;
                &lt;test qual="any" name="family"&gt;
                        &lt;string&gt;SimSun-18030&lt;/string&gt;
                &lt;/test&gt;
                &lt;edit name="family" mode="assign" binding="same"&gt;
                        &lt;string&gt;Source Han Serif CN&lt;/string&gt;
                &lt;/edit&gt;
        &lt;/match&gt;
&lt;/fontconfig&gt;
</pre>
<h3><span class="mw-headline" id="Chinese_in_Noto_Fonts">Chinese in Noto Fonts</span></h3>
<p>Apply Noto Fonts, while replace Microsoft Fonts with WenQuanYi Micro Hei
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/fontconfig/fonts.conf
or
/etc/fonts/local.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
&lt;fontconfig&gt;
    &lt;match target="font"&gt;
        &lt;edit name="embeddedbitmap" mode="assign"&gt;
            &lt;bool&gt;false&lt;/bool&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend" binding="strong"&gt;
            &lt;string&gt;Noto Serif&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;sans-serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend" binding="strong"&gt;
            &lt;string&gt;Noto Sans&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;monospace&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend" binding="strong"&gt;
            &lt;string&gt;Noto Sans Mono&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match&gt;
        &lt;test name="lang" compare="contains"&gt;
            &lt;string&gt;zh&lt;/string&gt;
        &lt;/test&gt;
        &lt;test name="family"&gt;
            &lt;string&gt;serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend"&gt;
            &lt;string&gt;Noto Serif CJK SC&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match&gt;
        &lt;test name="lang" compare="contains"&gt;
            &lt;string&gt;zh&lt;/string&gt;
        &lt;/test&gt;
        &lt;test name="family"&gt;
            &lt;string&gt;sans-serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend"&gt;
            &lt;string&gt;Noto Sans CJK SC&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match&gt;
        &lt;test name="lang" compare="contains"&gt;
            &lt;string&gt;zh&lt;/string&gt;
        &lt;/test&gt;
        &lt;test name="family"&gt;
            &lt;string&gt;monospace&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="prepend"&gt;
            &lt;string&gt;Noto Sans Mono CJK SC&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;!--WenQuanYi Zen Hei -&gt; WenQuanYi Micro Hei --&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;WenQuanYi Zen Hei&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;WenQuanYi Zen Hei Lite&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei Lite&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;WenQuanYi Zen Hei Mono&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei Mono&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;!--Microsoft YaHei, SimHei, SimSun -&gt; WenQuanYi Micro Hei --&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;Microsoft YaHei&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;SimHei&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;SimSun&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
    &lt;match target="pattern"&gt;
        &lt;test qual="any" name="family"&gt;
            &lt;string&gt;SimSun-18030&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name="family" mode="assign" binding="same"&gt;
            &lt;string&gt;WenQuanYi Micro Hei&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
&lt;/fontconfig&gt;
</pre>
<h2><span class="mw-headline" id="Alternate_stylistic_sets_for_fonts">Alternate stylistic sets for fonts</span></h2>
<p>Certain fonts come with alternate stylistic sets for characters through an OpenType feature. 
Generally these stylistic sets are named <code>ss0x</code> and contain small changes to individual characters.
This shows how to change the default dotted zero to a slashed zero for the monospace version of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=ttf-ibm-plex">ttf-ibm-plex</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/fontconfig/fonts.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
&lt;fontconfig&gt;
    &lt;match target='font'&gt;
        &lt;test name='fontformat' compare='not_eq'&gt;
            &lt;string/&gt;
        &lt;/test&gt;
        &lt;test name='family'&gt;
            &lt;string&gt;IBM Plex Mono&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name='fontfeatures' mode='assign_replace'&gt;
            &lt;string&gt;ss03&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
&lt;/fontconfig&gt;
</pre>
<p>See <a rel="nofollow"  href="https://www.typography.com/faq/question.php?faqID=157">What are "Stylistic Sets?"</a> for more information on this.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow"  href="http://forums.gentoo.org/viewtopic-p-7273876.html#7273876">Gentoo forums</a></li>
<li><a rel="nofollow"  href="https://wiki.ubuntu.com/BetterCJKSupportSpecification/FontConfig">Ubuntu Wiki</a></li>
</ul>
</div></div>
		
		<div id="catlinks"  data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="..//Usage/Configuration/E/Category:Fonts.html" title="Category:Fonts">Fonts</a></li></ul>
</div></div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Font_configuration/Examples&amp;oldid=616504">https://wiki.archlinux.org/index.php?title=Font_configuration/Examples&amp;oldid=616504</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 27 May 2020, at 09:09.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="..//Usage/Configuration/E/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="..//Usage/Configuration/E/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="..//Usage/Configuration/E/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Examples
    description: Migration of Examples from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-29T19:25:31.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">PCI passthrough via OVMF/Examples</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html" title="PCI passthrough via OVMF">PCI passthrough via OVMF</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<p>As PCI passthrough is quite tricky to get right (both on the hardware and software configuration sides), this page presents <b>working, complete</b> VFIO setups. Feel free to look up users' scripts, BIOS/UEFI configuration, configuration files and specific hardware. If you have a problem, it might have been stumbled upon by other VFIO users and fixed in the examples below.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have got VFIO working properly, please post your own setup according to the template on the bottom.</div>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Users'_setups"><span >1</span> <span >Users' setups</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#mstrthealias:_Intel_7800X_/_X299,_GTX_1070"><span >1.1</span> <span >mstrthealias: Intel 7800X / X299, GTX 1070</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#DragoonAethis:_6700K,_GA-Z170X-UD3,_GTX_1070"><span >1.2</span> <span >DragoonAethis: 6700K, GA-Z170X-UD3, GTX 1070</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Manbearpig3130's_Virtual_Gaming_Machine"><span >1.3</span> <span >Manbearpig3130's Virtual Gaming Machine</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Bretos'_Virtual_Gaming_Setup"><span >1.4</span> <span >Bretos' Virtual Gaming Setup</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Skeen's_Virtual_Gaming_Rack_Machine"><span >1.5</span> <span >Skeen's Virtual Gaming Rack Machine</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#droserasprout_poor_man's_setup"><span >1.6</span> <span >droserasprout poor man's setup</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#prauat:_2xIntel(R)_Xeon(R)_CPU_E5-2609_v4,_2xGigabyte_GeForce_GTX_1060_6GB_G1_Gaming,_Intel_S2600CWTR"><span >1.7</span> <span >prauat: 2xIntel(R) Xeon(R) CPU E5-2609 v4, 2xGigabyte GeForce GTX 1060 6GB G1 Gaming, Intel S2600CWTR</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Dinkonin's_virtual_gaming/work_setup"><span >1.8</span> <span >Dinkonin's virtual gaming/work setup</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#pauledd's_unexeptional_setup"><span >1.9</span> <span >pauledd's unexeptional setup</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#hkk's_Windows_gaming_machine_(6700K,_1070,_16GB)"><span >1.10</span> <span >hkk's Windows gaming machine (6700K, 1070, 16GB)</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#sitilge's_treachery"><span >1.11</span> <span >sitilge's treachery</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#chestm007's_hackery"><span >1.12</span> <span >chestm007's hackery</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Eduxstad's_Infidelity"><span >1.13</span> <span >Eduxstad's Infidelity</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Pi's_vr-vm"><span >1.14</span> <span >Pi's vr-vm</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#coghex's_gaming_box"><span >1.15</span> <span >coghex's gaming box</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Roobre's_VFIO_setup"><span >1.16</span> <span >Roobre's VFIO setup</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#laenco's_VFIO_setup"><span >1.17</span> <span >laenco's VFIO setup</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Poncho's_VFIO_setup"><span >1.18</span> <span >Poncho's VFIO setup</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#zane's_not_working_box"><span >1.19</span> <span >zane's not working box</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Muata's_VFIO_setup"><span >1.20</span> <span >Muata's VFIO setup</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#peterge's_VFIO_setup"><span >1.21</span> <span >peterge's VFIO setup</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#Adding_your_own_setup"><span >2</span> <span >Adding your own setup</span></a></li>
</ul>
</div>

<h2>
<span id="Users.27_setups"></span><span class="mw-headline" id="Users'_setups">Users' setups</span>
</h2>
<h3>
<span id="mstrthealias:_Intel_7800X_.2F_X299.2C_GTX_1070"></span><span class="mw-headline" id="mstrthealias:_Intel_7800X_/_X299,_GTX_1070">mstrthealias: Intel 7800X / X299, GTX 1070</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel(R) Core(TM) i7-7800X CPU</li>
<li>
<b>Motherboard</b>: ASRock X299 Taichi (Revision: A, BIOS/UEFI Version: 1.60A)</li>
<li>
<b>GPU</b>: Asus STRIX GTX 1070</li>
<li>
<b>RAM</b>: 32GB DDR4</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: Kernel version 4.14.8-1-skx (patched crystal_khz=24000).
<ul>
<li>Custom patches:
<ul><li>skylakex-crystal_khz-24000.patch (see below)</li></ul>
</li>
<li>Patches used from linux-ck:
<ul>
<li>enable_additional_cpu_optimizations_for_gcc_v4.9+_kernel_v4.13+.patch</li>
<li>0001-add-sysctl-to-disallow-unprivileged-CLONE_NEWUSER-by.patch</li>
<li>0001-e1000e-Fix-e1000_check_for_copper_link_ich8lan-retur.patch</li>
<li>0002-dccp-CVE-2017-8824-use-after-free-in-DCCP-code.patch</li>
</ul>
</li>
<li>Config:
<ul><li>PREEMPT, NO_HZ_IDLE, 300HZ, MSKYLAKE</li></ul>
</li>
</ul>
</li>
<li>GitHub: Link TBD</li>
<li>Benchmarks: <a rel="nofollow"  href="https://imgur.com/a/hIfQD">https://imgur.com/a/hIfQD</a>
</li>
<li>Using <b>libvirt/QEMU</b>: libvirt 3.10.0 / QEMU 2.11.0</li>
<li>Issues you have encountered, special steps taken to make something work a bit better, etc.
<ul>
<li>Skylake-X default clock incorrect in 4.14.8 (<a rel="nofollow"  href="https://bugzilla.kernel.org/show_bug.cgi?id=197299">https://bugzilla.kernel.org/show_bug.cgi?id=197299</a>)
<ul>
<li>Was unable to resolve timing issue using adjtimex</li>
<li>Patching kernel source to <b>crystal_khz = 24000</b> resolved timing/performance issues</li>
</ul>
</li>
<li>Enable 'Intel SpeedShift' in BIOS, installed <b>cpupower'</b>, set governor='performance'
<ul><li>Verify: dmesg|grep HWP
<ul><li>intel_pstate: HWP enabled</li></ul>
</li></ul>
</li>
<li>Enable HT in BIOS</li>
<li>Enable 'deadline' IO sceduler:
<ul><li>echo 'ACTION=="add|change", KERNEL=="sd*[!0-9]|sr*", ATTR{queue/scheduler}="deadline"' &gt;&gt; /etc/udev/rules.d/60-schedulers.rules</li></ul>
</li>
<li>Bypass x2apic opt-out:
<ul><li>GRUB_CMDLINE_LINUX="... intremap=no_x2apic_optout ..."</li></ul>
</li>
<li>Isolate cores for Windows VM:
<ul><li>GRUB_CMDLINE_LINUX="... isolcpus=2-5,8-11 nohz_full=2-5,8-11 rcu_nocbs=2-5,8-11 ..."</li></ul>
</li>
<li>Use hugepages (2MB) for all VM memory allocation</li>
<li>memoryBacking: &lt;hugepages/&gt;&lt;nosharepages/&gt;&lt;locked/&gt;&lt;access mode='private'/&gt;&lt;allocation mode='immediate'/&gt;</li>
<li>Extracted rom from GPU; used for &lt;rom file=../&gt; config</li>
<li>Using MSI for GPU and GPU Audio (configured in Windows registry; FPS seems same as using line-based interrupts)</li>
</ul>
</li>
<li>Hardware setup
<ul>
<li>PCIE1: NVIDIA GeForce GT 710B (for host)</li>
<li>Onboard: ASRock XHCI 3.1 USB (for host)</li>
<li>Onboard: Intel I219 NIC (bridged)</li>
<li>PCIE3: Asus Xonar STX (passthrough to Win10)</li>
<li>PCIE5: NVIDIA GeForce GTX 1070 (passthrough to Win10)</li>
<li>M2_1: Samsung 960 EVO 500GB (passthrough to Win10)</li>
<li>Onboard: Intel XHCI USB 3.0 (passthrough to Win10)</li>
<li>Onboard: Intel HDA (passthrough to Win10)</li>
<li>Onboard: Intel I211 NIC (passthrough to Win10)</li>
<li>Onboard: ASRock AHCI SATA A1/A2 (passthrough to Linux)</li>
</ul>
</li>
</ul>
<h3>
<span id="DragoonAethis:_6700K.2C_GA-Z170X-UD3.2C_GTX_1070"></span><span class="mw-headline" id="DragoonAethis:_6700K,_GA-Z170X-UD3,_GTX_1070">DragoonAethis: 6700K, GA-Z170X-UD3, GTX 1070</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i7-6700K (using iGPU as the host GPU)</li>
<li>
<b>Motherboard</b>: Gigabyte GA-Z170X-UD3 (Revision 1.0, BIOS/UEFI Version: F23d)</li>
<li>
<b>GPU</b>: MSI GeForce 1070 Gaming X (10Gbps)</li>
<li>
<b>RAM</b>: 16GB DDR4 2400MHz</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: "Vanilla" Linux (no ACS patch needed).</li>
<li>Using <b>libvirt</b>: XML domain, helper scripts, IOMMU groups, etc available in <a rel="nofollow"  href="https://github.com/DragoonAethis/VFIO">my VFIO repository</a>.</li>
<li>
<b>Guest OS</b>: Windows 8.1 Pro.</li>
<li>The entire HDD is passed to the VM as a raw device (formatted as a single NTFS partition).</li>
<li>USB keyboard and mouse are passed to the guest VM and shared with the host with Synergy.</li>
<li>Virtualized audio: PulseAudio -&gt; local Unix socket. Previously, I've had a bit more complex setup in which PA on the host was configured to accept TCP connections, and the envvars required for QEMU to use PA were pointed at the PA server running on 127.0.0.1. This way it was not required to change the QEMU user (exact details in the repo), but introduced other minor issues I've resolved later.</li>
<li>Bridged networking (with NetworkManager's and <a rel="nofollow"  href="https://www.happyassassin.net/2014/07/23/bridged-networking-for-libvirt-with-networkmanager-2014-fedora-21/">this tutorial's</a> help) is used. <code>bridge0</code> is created, <code>eth0</code> interface is bound to it. STP disabled, VirtIO NIC is configured in the VM and that VM is seen in the network just as any other computer (and is being assigned an IP address from the router itself, can communicate freely with other computers).</li>
<li>For some reason, enabling intel_iommu=on on the kernel cmdline without CSM support enabled in UEFI causes a black screen on boot. Enable it (Windows 8/10 features need to be enabled to show "CSM Support", selecting "Other OS" hides that).</li>
</ul>
<h3>
<span id="Manbearpig3130.27s_Virtual_Gaming_Machine"></span><span class="mw-headline" id="Manbearpig3130's_Virtual_Gaming_Machine">Manbearpig3130's Virtual Gaming Machine</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i7-6850K 3.6GHz</li>
<li>
<b>Motherboard</b>: Gigabyte x99-Ultra Gaming (Revision 1.0, BIOS/UEFI Version: F4)</li>
<li>
<b>Host GPU</b>: AMD Radeon HD6950 1GB</li>
<li>
<b>Guest GPU</b>: AMD R9 390 8GB</li>
<li>
<b>RAM</b>: 32GB G-Skill Ripjaws DDR4 runing at 3200MHz</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Host Kernel</b>: Kernel version Linux 4.7.2-1.</li>
<li>Using <b>libvirt QEMU/KVM with OVMF</b>: link to domain XMLs/scripts/notes: <a rel="nofollow"  href="https://github.com/manbearpig3130/MBP-VT-d-gaming-machine">https://github.com/manbearpig3130/MBP-VT-d-gaming-machine</a>
</li>
<li>
<b>Host OS</b>: TOS Linux</li>
<li>
<b>Guest OS</b>: Windows 10 Pro</li>
<li>2x 480GB SSDs set up in LVM striped mode (with mdadm) formatted to ext4 are mounted in linux-toswhich contains the guest's qcow2 virtual VirtIO disk file.</li>
<li>USB Host controller is passed through, giving most USB ports to the VM, leaving my USB 3.1 controller with attached USB hub for the host.</li>
<li>Motherboard has two NICs, one is passed into VM (Works perfectly after installing Killer NIC Driver).</li>
<li>VM gets dedicated 16GB RAM via static hugepages.</li>
<li>CPU pinning increased performance considerably.</li>
<li>Windows boots straight into Steam big picture mode on primary display (43" Sony Bravia). Overall an awesome gaming machine that meets my gaming needs and lust for GNU/Linux at the same time.</li>
<li>
<b>Quirks</b>:</li>
<li>I sometimes have to reinstall the AMD drivers in Windows to get HDMI audio working properly, or roll back to Windows HDMI driver. I normally use a USB headset which works fine anyway.</li>
</ul>
<h3>
<span id="Bretos.27_Virtual_Gaming_Setup"></span><span class="mw-headline" id="Bretos'_Virtual_Gaming_Setup">Bretos' Virtual Gaming Setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i7-7700k</li>
<li>
<b>Motherboard</b>: Z270 GAMING M3 (MS-7A62)</li>
<li>
<b>GPU</b>: ASUS GeForce GTX960</li>
<li>
<b>RAM</b>: Kingston HyperX 3x8GB DDR4 2.4GHz</li>
<li>
<b>Storage</b>: 2x Corsair MP500 m.2 240G SSDs in mdadm RAID0, 1x WD Black 1TB for storage. 100GB LVM volume as writeback cache for HDD</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: vanilla</li>
<li>
<b>Host OS</b>: TOS Linux</li>
<li>
<b>Guest OS</b>: Windows 10 Pro</li>
<li>Using <b>libvirt/QEMU</b>: GitHub config repository: <a rel="nofollow"  href="https://github.com/Bretos/vfio">[1]</a>
</li>
<li>Issues you have encountered: AUDIO. Had to get USB audio adapter and pass it through.</li>
<li>No issues other than audio. Works like a charm.</li>
</ul>
<h3>
<span id="Skeen.27s_Virtual_Gaming_Rack_Machine"></span><span class="mw-headline" id="Skeen's_Virtual_Gaming_Rack_Machine">Skeen's Virtual Gaming Rack Machine</span>
</h3>
<p>Still work in progress.
</p>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: AMD FX(tm)-8350</li>
<li>
<b>Motherboard</b>: MSI 970A SLI Krait Edition (MS-7693) (Revision 5.0, BIOS/UEFI Version: 25.4)</li>
<li>
<b>Host GPU</b>: ASUS GeForce GTX 480 1536MB</li>
<li>
<b>Guest GPU</b>: ASUS GeForce GTX 480 1536MB</li>
<li>
<b>RAM</b>: 2x8GB Kingston HyperX Fury White DDR3 1866MHz</li>
<li>
<b>Storage</b>: 2x250GB Samsung EVO (MZ-75E250) set up in LVM striped mode (with mdadm), 2x1TB WD Blue (WDC_WD10SPCX) for storage. 250GB LVM volume as writeback cache for HDD.</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Host Kernel</b>: Linux 4.9.0-3 (No ACS)</li>
<li>
<b>Host OS</b>: Debian Stretch</li>
<li>
<b>Guest OS</b>: Windows 10 Home (10_1703_N, International Edition)</li>
<li>Using <b>libvirt QEMU/KVM with OVMF</b>: See <a rel="nofollow"  href="https://github.com/Skeen/libvirt-gpu-passthrough">Github</a>
</li>
</ul>
<p>Issues you have encountered:
</p>
<ul>
<li>Identifical GPUs; solved <a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html#Using_identical_guest_and_host_GPUs" title="PCI passthrough via OVMF">using this section on the wiki</a>, but with the script from the <a href="..//Usage/Configuration/E/Talk:PCI_passthrough_via_OVMF.html#Using_identical_guest_and_host_GPUs_-_did_not_work_for_me." title="Talk:PCI passthrough via OVMF">corresponding discussion page</a>. Several adaptations for Debian were required too, but are not applicable for this forum.</li>
<li>"Error 43: Driver failed to load";
<ul>
<li>Spoofing vendor_id caused Windows to crash during boot-up.</li>
<li>Linux VMs complain unable to find GPU from Grub2, and booted into blind-mode, but would still pick up the graphics card during the boot process, and would remain functional until VM reboot.</li>
<li>Vendor_id spoofing turned out to work after solving the real problem (Missing UEFI compatability in VBIOS).</li>
</ul>
</li>
<li>Missing UEFI (OVMF) compatability in VBIOS;
<ul>
<li>Requested a GOP/UEFI compatible VBIOS upgrade from ASUS, but ASUS could neither understand the request, or provide the upgrade (The only thing supplied was standard support answers).</li>
<li>No compatible VBIOS was found at <a rel="nofollow"  href="https://www.techpowerup.com/vgabios/">TechPowerUp</a>.</li>
<li>Finally solved by manually hacking GOP/UEFI support into the ROM, using <a rel="nofollow"  href="http://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html">GOPupd</a>. Current rom was dumped within a Windows 10 VM using GPU-Z, then modified using GOPupd, pulled to Linux, and provided using the rom file parameter in the VM XML file.</li>
</ul>
</li>
<li>VM only uses one core (even with mode=host-passthrough): solved <a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html#VM_only_uses_one_core" title="PCI passthrough via OVMF">using this section on the wiki</a>.</li>
</ul>
<p>Quirks:
</p>
<ul>
<li>The GPU that is being passed through, <a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html#Passing_through_a_device_that_does_not_support_resetting" title="PCI passthrough via OVMF">does not support resetting</a>, and thus doing a hard-reboot / shutdown of the VM locks the GPU.
<ul>
<li>The VM cannot be started again unless the Host machine is rebooted.
<ul><li>When doing a clean reboot / shutdown, allows the VM to start up as expected without reboot..</li></ul>
</li>
<li>Removing and rescanning the PCI device, does not change anything.</li>
<li>No further attempts at powercycling the GPU from the host has been done (Yet).</li>
</ul>
</li>
<li>
<a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html#Passing_VM_audio_to_host_via_PulseAudio" title="PCI passthrough via OVMF">Passing VM audio to host via PulseAudio</a> results in heavy crackling.
<ul><li>Using <a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html#Slowed_down_audio_pumped_through_HDMI_on_the_video_card" title="PCI passthrough via OVMF">Message-Signaled Interrupts</a> have not been attempted (Yet).</li></ul>
</li>
</ul>
<h3>
<span id="droserasprout_poor_man.27s_setup"></span><span class="mw-headline" id="droserasprout_poor_man's_setup">droserasprout poor man's setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i3-6100</li>
<li>
<b>Motherboard</b>: ASRock H110M2 D3 (BIOS version 0603)</li>
<li>
<b>Host GPU</b>: Intel HD 530</li>
<li>
<b>Guest GPU</b>: Sapphire Radeon R7 360</li>
<li>
<b>RAM</b>: Apacer 8Gb 75.C93DE.G040C, Kingston 4Gb 99U5401-011.A00LF</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: linux-lts 4.9.67-1 (vanilla)</li>
<li>
<b>Host OS</b>: TOS Linux</li>
<li>
<b>Guest OS</b>: Windows 10 Pro 1709 (build 16299.98)</li>
<li>Using <b>libvirt/QEMU</b>: See my configs and IOMMU groups on <a rel="nofollow"  href="https://github.com/droserasprout/win10-vfio-configs">Github</a>
</li>
<li>HDD partition is passed to the VM as a raw virtio device.</li>
<li>HD Audio is passed too. Works fine with both playing and recording, no latency issues or glitches. After VM is powered off host audio works fine too.</li>
<li>Guest's latency is slightly better when CPU cores are isolated for VM.</li>
<li>i2c-dev module added to bypass 'EDID signature' error when switching HDMI. Without it I had to switch video output before starting VM for some reason.</li>
<li>intremap=no_x2apic_optout kernel option added to bypass motherboard firmware falsely reporting x2APIC method is not supported. Seems to have a strong influence on the guest's latency.</li>
<li>Overall performance is pretty close to the native OS setup.</li>
</ul>
<h3>
<span id="prauat:_2xIntel.28R.29_Xeon.28R.29_CPU_E5-2609_v4.2C_2xGigabyte_GeForce_GTX_1060_6GB_G1_Gaming.2C_Intel_S2600CWTR"></span><span class="mw-headline" id="prauat:_2xIntel(R)_Xeon(R)_CPU_E5-2609_v4,_2xGigabyte_GeForce_GTX_1060_6GB_G1_Gaming,_Intel_S2600CWTR">prauat: 2xIntel(R) Xeon(R) CPU E5-2609 v4, 2xGigabyte GeForce GTX 1060 6GB G1 Gaming, Intel S2600CWTR</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>:2xIntel(R) Xeon(R) CPU E5-2609 v4</li>
<li>
<b>Motherboard</b>: Intel S2600CWTR(RevisionÂ ???, BIOS/UEFI Version: SE5C610.86B.01.01.0022.062820171903)</li>
<li>
<b>GPU</b>: 2xGigabyte GeForce GTX 1060 6GB G1 Gaming [GeForce GTX 1060 6GB] (rev a1)</li>
<li>
<b>RAM</b>: Samsung M393A2G40EB1-CPB  2133 MHz 64GB (4x16GB)</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: Linux 4.14.15-1-ARCH #1 SMP PREEMPT</li>
<li>Using <b>libvirt/QEMU</b>: <a rel="nofollow"  href="https://github.com/prauat/passvm/blob/master/generic.xml">https://github.com/prauat/passvm/blob/master/generic.xml</a>
</li>
<li>Most important:</li>
<li>When using nvidia driver hide virtualization to guest &lt;kvm&gt;&lt;hidden state='on'/&gt;&lt;/kvm&gt;</li>
<li>Configuration works with TOS Linux guest os, still work in progress.</li>
</ul>
<h3>
<span id="Dinkonin.27s_virtual_gaming.2Fwork_setup"></span><span class="mw-headline" id="Dinkonin's_virtual_gaming/work_setup">Dinkonin's virtual gaming/work setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>:  Intel(R) Core(TM) i7-7700K CPU @ 4.60GHz</li>
<li>
<b>Motherboard</b>: MSI Z270 GAMING PRO CARBON (MS-7A63) BIOS Version: 1.80</li>
<li>
<b>GPU</b>: 1x Gigabyte GeForce GTX 1050 2GB (host), 1x MSI GeForce 1080 AERO 8GB(guest)</li>
<li>
<b>RAM</b>: 32GB DDR4</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: Kernel version linux-tos4.15.2-2-ARCH.</li>
<li>Using <b>libvirt/QEMU (patched from AUR) with OVMF</b>
</li>
<li>Installed qemu-patched from AUR because of crackling/delayed sound with pulseaduio (still hear ocasional pops/clicks while gaming.</li>
<li>Patched video bios with <a rel="nofollow"  href="https://github.com/Matoking/NVIDIA-vBIOS-VFIO-Patcher">https://github.com/Matoking/NVIDIA-vBIOS-VFIO-Patcher</a>, because of error:</li>
</ul>
<pre>vfio-pci 0000:01:00.0: Invalid PCI ROM header signature: expecting 0xaa55, got 0xffff
</pre>
<ul><li>Single monitor setup, implemented full software KVM(for host and guest) described here: <a rel="nofollow"  href="https://rokups.github.io/#!pages/full-software-kvm-switch.md">https://rokups.github.io/#!pages/full-software-kvm-switch.md</a>
</li></ul>
<h3>
<span id="pauledd.27s_unexeptional_setup"></span><span class="mw-headline" id="pauledd's_unexeptional_setup">pauledd's unexeptional setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i7 6700K</li>
<li>
<b>Motherboard</b>: Gigabyte GA-Z170N-WIFI Retail (Revision 1.0 , BIOS/UEFI Version: F20)</li>
<li>
<b>GPU</b>: 8GB Palit GeForce GTX 1070 Dual Aktiv PCIe 3.0 x16 (Retail)</li>
<li>
<b>RAM</b>: 16GB G.Skill RipJaws V DDR4-3200 DIMM CL16 Dual Kit</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: 4.15.2-gentoo</li>
<li>Using <b>libvirt/QEMU</b>: libvirt-4.0.0, qemu-2.11.1, <a rel="nofollow"  href="https://github.com/pauledd/GPU-Passthrough/blob/master/win10-2.xml">https://github.com/pauledd/GPU-Passthrough/blob/master/win10-2.xml</a> , using vfio kernel module</li>
<li>Had to dump VBIOS in at the host while GPU was normally attached (and drivers loaded) (see <a rel="nofollow"  href="https://stackoverflow.com/a/42441234">https://stackoverflow.com/a/42441234</a>), had to set CPU settings manually according to my cpu (host-passthrough, sockets 1, cores: 4, threads: 2 ) or some games will regularly crash, see my xml how to insert vbios, still have audio clicking/lag with pulseaudio but thats ok for me, no further patching etc.. works out of the box without any issues.</li>
<li>3DMark Results Time Spy Graphic Score: Native Windows 10: 5564 , GPU-Passthrough: 5541</li>
</ul>
<h3>
<span id="hkk.27s_Windows_gaming_machine_.286700K.2C_1070.2C_16GB.29"></span><span class="mw-headline" id="hkk's_Windows_gaming_machine_(6700K,_1070,_16GB)">hkk's Windows gaming machine (6700K, 1070, 16GB)</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i7-6700K 4.5GHz</li>
<li>
<b>Motherboard</b>: AsRock Fatality Gaming K6 Z170 (rev. 1.05)</li>
<li>
<b>Host GPU</b>: Intel GPU HD530 with 1GB shared memory</li>
<li>
<b>Guest GPU</b>: Gigabyte GeForce GTX1070 G1 Gaming 8GB</li>
<li>
<b>RAM</b>: 16GB G.Skill RipjawsV @ 3333 MHz CL14-15-15-31-2T [DDR4]</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Host Kernel</b>: Kernel version Linux 4.15.7-1-vfio (with ACS patch included).</li>
<li>Using <b>libvirt QEMU/KVM with OVMF</b>
</li>
<li>
<b>Host OS</b>: TOS Linux</li>
<li>
<b>Guest OS</b>: Windows 10 Pro</li>
<li>128GB Intel 600p SSD splited into 3 partitions: 512MB for EFI, 30GB for / in Btrfs and other gigs for Windows 10 installed straight on SSD.</li>
<li>Two more HDDs for Windows. 1TB and 650GB</li>
<li>Passed specific devices like X360 and some of single USB ports.</li>
<li>One NIC behind NAT on VM machine.</li>
<li>VM gets dedicated 8GB RAM via static hugepages.</li>
<li>CPU pinning increased performance considerably and machine gets 4/4 cores of my 4/8 CPU</li>
<li>Windows boots on second screen with simple script which shutting down display with xrandr.</li>
<li>Using Synergy to share mouse and keyboard between systems.</li>
<li>
<b>Quirks</b>:</li>
<li>Synergy is not perfect and will not entirely work in some games.</li>
<li>No boot screen. Display is turning on only when Windows is up and ready to go.</li>
</ul>
<h3>
<span id="sitilge.27s_treachery"></span><span class="mw-headline" id="sitilge's_treachery">sitilge's treachery</span>
</h3>
<p>Full info: <a rel="nofollow"  href="https://git.sitilge.id.lv/sitilge/dotfiles">https://git.sitilge.id.lv/sitilge/dotfiles</a>
</p>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel Core i5 6600K</li>
<li>
<b>Motherboard</b>: Asus Z170i</li>
<li>
<b>GPU</b>: Gigabyte Radeon RX460 OC 2GB</li>
<li>
<b>Storage</b>: Samsung 850 EVO 500GB</li>
<li>
<b>RAM</b>: Corsair 16GB DDR4</li>
<li>
<b>Mouse, Keyboard</b>: Logitech M90, Vortex Pok3r</li>
</ul>
<p>Host Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: linux-vfio</li>
<li>
<b>Packages</b>: qemu-git, virtio-win, ovmf</li>
</ul>
<p>Guest Configuration:
</p>
<ul>
<li>
<b>OS</b>: Windows 10 Pro</li>
<li>
<b>CPU</b>: host</li>
<li>
<b>Motherboard</b>: host</li>
<li>
<b>GPU</b>:  passthrough</li>
<li>
<b>Storage</b>: 64GB</li>
<li>
<b>RAM</b>: 8GB</li>
<li>
<b>Mouse, Keyboard</b>: passthrough</li>
</ul>
<p>Notes:
</p>
<ul>
<li>You can easy simlink the config files using <code>stow -t / boot mkinitcpio</code> and then <code>mkinitcpio -p linux-vfio</code>.</li>
<li>
<code>-smp cores=4</code> - guest might utilize only one core otherwise.</li>
<li>
<code>-soundhw ac97</code> - I'm passing mobo audio thus ac97. Download, unzip and install the Realtek AC97 drivers within a guest.</li>
<li>Use virtio drivers for both block devices and network. For example, the ping went down from 250 to 50.</li>
<li>Mouse and keyboard passthrough solved the terrible lag problem which was present in emulation mode.</li>
<li>Make sure virtualization is supported and enabled in your firmware (UEFI). The option was hidden in a submenu in my case.</li>
<li>As trivial as it sounds, check your cables.</li>
<li>Be patient - it took more than 10 minutes for the guest to recognize the GPU.</li>
</ul>
<h3>
<span id="chestm007.27s_hackery"></span><span class="mw-headline" id="chestm007's_hackery">chestm007's hackery</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Ryzen 7 1800x</li>
<li>
<b>Motherboard</b>: Asus ROG Crosshair VI (Revision 1, BIOS/UEFI Version: 3502)</li>
<li>
<b>GPU</b>: Asus ROG RX480oc 8GB</li>
<li>
<b>RAM</b>: 32gb Ripjaws 2400mhz</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: 4.16.12-1-ARCH.</li>
<li>Using <b>libvirt/QEMU</b>: libvirtd (libvirt) 4.3.0, QEMU emulator version 2.12.0,</li>
</ul>
<p>Notes: 
</p>
<ul>
<li>using ic6 audio - works fine for me.</li>
<li>have a working looking-glass setup, however cant get spice to pass through keyboard and mouse, currently using a mixture of synergy and a dedicated screen as a workaround</li>
</ul>
<h3>
<span id="Eduxstad.27s_Infidelity"></span><span class="mw-headline" id="Eduxstad's_Infidelity">Eduxstad's Infidelity</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Ryzen 2600X @ 3.7 GHZ</li>
<li>
<b>Motherboard</b>: ASUS PRIME B350-PLUS(BIOS/UEFI Version: 4011)</li>
<li>
<b>GPU1 (Guest)</b>: MSI 390 8GB @ Stock</li>
<li>
<b>GPU2 (Host)</b>: XFX 550 4GB @ Stock</li>
<li>
<b>RAM</b>: 2 x 8GB (16GB) @ 3000 HZ</li>
<li>
<b>Guest OS</b>: Windows 8.1 Embedded Pro</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: 4.17.3-1-ARCH (vanilla).</li>
<li>Using <b>libvirt/QEMU</b>: libvirt/virt-manager (<a rel="nofollow"  href="https://github.com/eduxstad/vfio-config">https://github.com/eduxstad/vfio-config</a>).</li>
<li>Look in the repository for complete documentation of extra steps taken</li>
<li>Overview: VM managed using virt-manager, using looking glass for primary io and built in spice display server as backup. Passing vm audio back to pulseaudio. Using hugepages for RAM. SCSI Drivers installed for hardware drive support.</li>
</ul>
<h3>
<span id="Pi.27s_vr-vm"></span><span class="mw-headline" id="Pi's_vr-vm">Pi's vr-vm</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: i7-8700k @ 4.8 GHz</li>
<li>
<b>Motherboard</b>: MSI Gaming Pro Carbon (BIOS/UEFI Version: A.40/5.12)</li>
<li>
<b>GPU</b>: Palit RTX 2080 Ti</li>
<li>
<b>RAM</b>: 4x8GB G.Skill DDR4 @ 3000 MHz</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>Kernel: latest mainline (rc if available)
<ul>
<li>custom built with ZFS, WireGuard</li>
<li>
<i>CONFIG_PREEMPT_VOLUNTARY=y</i> to work around QEMU bug with long guest boot times</li>
</ul>
</li>
<li>Startup scripts/additional info: <a rel="nofollow"  href="https://github.com/PiMaker/Win10-VFIO">https://github.com/PiMaker/Win10-VFIO</a>
</li>
<li>Issues encountered:
<ul>
<li>PUBG would not launch at all
<ul><li>Solution: Enable the HyperV clock with &lt;timer name='hypervclock' present='yes'/&gt; and disable hpet with &lt;timer name='hpet' present='no'/&gt;</li></ul>
</li>
<li>VR would start to stutter badly after about 20-30 minutes of playtime (this one took me about 2 weeks to finally figure outÂ :-)
<ul><li>Solution:
<ul>
<li>Enable invariant tsc passthrough with &lt;feature policy='require' name='invtsc'/&gt; (required even if using host-passthrough!)</li>
<li>Enable MSI for the GPU (using tool from <a rel="nofollow"  href="https://forums.guru3d.com/threads/windows-line-based-vs-message-signaled-based-interrupts-msi-tool.378044/">here</a>)</li>
<li>Enable vAPIC and synic in the HyperV configuration</li>
<li>Manually move all IRQs to host cores using qemu_fifo.sh script from my GitHub repo above</li>
</ul>
</li></ul>
</li>
</ul>
</li>
<li>Overview: SteamVR-capable gaming and workstation rig, passing through NVIDIA GPU and onboard USB-controller (leaving an additional ASMedia USB port to the host). 22 GB hugepages memory, 10 of 12 cores (with SMT) passed through. Audio working via Scream (<a rel="nofollow"  href="https://github.com/duncanthrax/scream">https://github.com/duncanthrax/scream</a>) - with IVSHMEM, surprisingly low latency and no stutters.</li>
</ul>
<h3>
<span id="coghex.27s_gaming_box"></span><span class="mw-headline" id="coghex's_gaming_box">coghex's gaming box</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: i7-8086k @ 5.0 GHZ (8086k is just a binned 8700k)</li>
<li>
<b>Motherboard</b>: GIGABYTE Z370 AORUS Gaming 7 rev1.0 (BIOS/UEFI Version: F15a)</li>
<li>
<b>GPU</b>: GIGABYTE GV-N108TAORUSX WB-11GD AORUS GeForce GTX 1080 Ti Waterforce WB Xtreme Edition 11G @ ~2Ghz</li>
<li>
<b>RAM</b>: 4 x 8GB (32GB) Corsair Dominator Platinum @ 3600 HZ (XMP)</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: linux-zen-5.5.8.zen1-1</li>
<li>
<b>Modules</b>: raid0 raid1 md_mod ext4 vfat ahci vfio_pci vfio vfio_iommu_type1 vfio_virqfd usbhid it87 (aur version is unmaintained and the support for the ITE8686E chip on this board is limited, replace it87 source with that which is found <a rel="nofollow"  href="https://github.com/andreychernyshev/it87-8613E">here</a> for more comprehensive support)</li>
<li>
<b>Virsh</b>: virsh-5.10.0</li>
<li>
<b>Qemu</b>: qemu-system-x86_64-4.2.0 machine='pc-i440fx-4.2'</li>
<li>
<b>Performance Services</b>: <a href="..//Usage/Configuration/E/Improving_performance.html#irqbalance" title="Improving performance">irqbalance-1.6.0</a>, <a href="..//Usage/Configuration/E/Improving_performance.html#Ananicy" title="Improving performance">ananicy-git-2.1.0.r22</a>, <a href="..//Usage/Configuration/E/CPU_frequency_scaling.html#cpupower" title="CPU frequency scaling">cpupower5.5-1</a>
</li>
<li>EDIT(2020): much has changed since this setup was posted years ago and a custom kernel is no longer needed on this hardware, everything works perfectly...</li>
<li>scripts, libvirt XML, and personal configs can be found here: <a rel="nofollow"  href="https://github.com/coghex/hoest">https://github.com/coghex/hoest</a>
</li>
<li>host boot options: intel_iommu=on iommu=pt rd.driver.pre=vfio-pci acpi_enforce_resources=lax</li>
<li>systemd modprobe.d options: kvm ignore_msrs=1 (avoids critical bugs), kvm report_ignored_msrs=N (cleans up journal logs)</li>
<li>libvirt features: acpi, apic, kvm hidden state='on', vmport state='off'</li>
<li>guest hyper-v options: hv-relaxed, hv-vapic, hv-spinlocks (retries='8191'), hv-vpindex, hv-runtime, hv-synic, hv-stimer, hv-stimer-direct, hv-reset, hv-vendor_id (value='1234567890ab'), hv-frequencies, hv-reenlightenment, hv-tlbflush, hv-ipi, (hv-evmcs and hv-no-nonarch-coresharing seemingly do not work yet in virsh)</li>
<li>make sure to use the multifunction field for the GPU's hdmi audio controller and set them to the same slot, otherwise the audio interrupts will hang.  Someone should probably add that to the guide...</li>
<li>im running the clock at 100Hz, the people running it at 1000 with the zen or ck kernel should know that the MuQSS scheduler works the same regardless of this speed and 1000 will just add more useless interrupts.</li>
<li>cpu pinning works best for single VM performance, default host-passthrough works best for multiple running VMs.</li>
<li>on windows, the <a rel="nofollow"  href="https://github.com/CHEF-KOCH/MSI-utility">MSI_util_v2</a> gets used every update to reset MSI interrupts on the GPU.</li>
</ul>
<p>Hardware Specific:
</p>
<ul>
<li>
<b>Fully-Functional Passthrough Devices</b>: this motherboard has many PCI slots, all of these devices have been working flawlessly with little setup for years now:
<ul>
<li>Inatek USB Card: KT5001 <a rel="nofollow"  href="https://www.amazon.com/Inateck-Express-15-Pin-Connector-KT5001/dp/B00FPIMJEW">[2]</a>
</li>
<li>Creative Sound Card: 70SB155000001 <a rel="nofollow"  href="https://www.amazon.com/Creative-Labs-70SB155000001-Blaster-PCI-Express/dp/B01LYT7U99">[3]</a>
</li>
<li>EDUP WiFi Card: AC9636GS (must use virtio usb passthrough for bluetooth functionality) <a rel="nofollow"  href="https://www.amazon.com/EDUP-3000Mbps-802-11AX-Bluetooth-EP-AC9636GS/dp/B082F5D4SM">[4]</a>
</li>
<li>Intel Optane SSD: SSDPED1D480GASX <a rel="nofollow"  href="https://www.amazon.com/Intel-Optane-900P-480GB-XPoint/dp/B0772T4BVZ">[5]</a>
</li>
<li>Zotac GeForce GT 710: ZT-71304-20L (this one does not seem to be available on amazon anymore, a shame since its one of the few high performance PCIEx1 cards...) <a rel="nofollow"  href="https://www.amazon.com/ZOTAC-GeForce-Profile-Graphic-ZT-71304-20L/dp/B01E9Z2D60">[6]</a>
</li>
</ul>
</li>
<li>none of the proprietary gigabyte software works, in fact, it blue screens windows and installs itself as a startup program, forever locking you out.</li>
<li>if anyone else uses this exact motherboard, there are two internal USB IOMMU groups, even with the ACS patch.  one will include the usb labeled "USB 3.1", and the other will include all the other USBs.  this means if you want more than just a keyboard and mouse, you will need either a usb hub to plug into the 3.1 slot and passthrough, or a PCIE USB bus.</li>
<li>the two ethernet ports are in different IOMMU groups, making this a perfect motherboard for vfio.</li>
<li>the ACS patch is needed on this motherboard if you want to use two graphics cards at once in seperate IOMMU groups.  this sets the main GPU to PCIEx8 instead of x16.</li>
</ul>
<h3>
<span id="Roobre.27s_VFIO_setup"></span><span class="mw-headline" id="Roobre's_VFIO_setup">Roobre's VFIO setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Intel(R) Core(TM) i5-6600K CPU @ 3.50GHz (OC'ed to 4.50)</li>
<li>
<b>Motherboard</b>: ASUS ROG MAXIMUS VIII GENE, v3801</li>
<li>
<b>GPU</b>: EVGA GTX 1080Ti</li>
<li>
<b>RAM</b>: 32GB DDR4 2400 (2x Ballistix)</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: Latest -ARCH or -zen (4.17.10-1-zen at the time of writing)</li>
<li>Using <b>libvirt/QEMU</b>: libvirt 4.5.0-1, qemu 2.12.0-2. Config: <a rel="nofollow"  href="https://gist.github.com/roobre/d2d20cc638c5030f360b500000da0f88">https://gist.github.com/roobre/d2d20cc638c5030f360b500000da0f88</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot"  title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01Â â]</sup>
</li>
<li>
<b>ZFS</b> volumes passed as raw devices for hard drives.</li>
<li>
<b>VirtIO all the things!</b> Download drivers from <a rel="nofollow"  href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/</a>
</li>
</ul>
<p>Issues: 
</p>
<ul><li>Pulseaudio never worked good (too much crackling), so I ended up passing-through an USB 3.1 PCI controller and connecting an USB audio card to it. That card is then connected to one of my MoBo's inputs, and echoed using pulseaudio's `loopback` module.</li></ul>
<ul><li>Synergy works really great. On some games (ones who take control of the mouse pointer, e.g. first-person), you need to lock the mouse cursor to the VM window to avoid issues (camera moving too fast).</li></ul>
<ul><li>Do not forget to add the needed snippet for the nvidia driver to run (<a href="..//Usage/Configuration/E/PCI_passthrough_via_OVMF.html#%22Error_43:_Driver_failed_to_load%22_on_Nvidia_GPUs_passed_to_Windows_VMs" title="PCI passthrough via OVMF">PCI passthrough via OVMF#"Error 43: Driver failed to load" on Nvidia GPUs passed to Windows VMs</a>)</li></ul>
<h3>
<span id="laenco.27s_VFIO_setup"></span><span class="mw-headline" id="laenco's_VFIO_setup">laenco's VFIO setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: Ryzen 9 3950X @ 4.15Ghz all-cores via PBO</li>
<li>
<b>Motherboard</b>: Asus ROG STRIX X470-F GAMING (BIOS/UEFI Version: 5406)</li>
<li>
<b>GPU1 (Guest)</b>: Palit GeForce GTX 1080 8GB @ Stock</li>
<li>
<b>GPU2 (Host)</b>: MSI RX 570 8GB @ Stock</li>
<li>
<b>RAM</b>: 4 x 16GB (64GB) @ 3333 MHz</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Guest OS</b>: Windows 10 Pro</li>
<li>
<b>Kernel</b>: 5.4.13-arch1-1-gc (-ck is also good). No ACS patch.</li>
<li>Using vanilla <b>QEMU 4.2.0</b>
</li>
<li>AMD Ryzen currently (2020.01.20) got bugged with smp threads option - VM stuck on start.</li>
<li>Got classic Nvidia error 43 - classically fixed. But also added some cpu flags which are set automatically with kvm=on found here <a rel="nofollow"  href="https://github.com/qemu/qemu/blob/master/target/i386/cpu.c#L4008">https://github.com/qemu/qemu/blob/master/target/i386/cpu.c#L4008</a>
</li>
<li>As pure qemu have no option to pin cpu cores and self threads - using python script "cpu_affinity" - credits to <a rel="nofollow"  href="https://github.com/zegelin/qemu-affinity/">https://github.com/zegelin/qemu-affinity/</a> and also a copy in my repo. Requires debug-threads=on</li>
<li>Using dynamically allocated hugepages 2Mb</li>
<li>Hardly using VirtIO</li>
<li>Using hardware usb switch like Aten US224-AT and hdmi switch "many-to-one", which allow me to have one monitor, mouse, keyboard and some usb devices, and switch them by button between host and guest.</li>
<li>Repo with current major system config and script for VM could be found here <a rel="nofollow"  href="https://github.com/laenco/vfio-config">https://github.com/laenco/vfio-config</a>
</li>
</ul>
<h3>
<span id="Poncho.27s_VFIO_setup"></span><span class="mw-headline" id="Poncho's_VFIO_setup">Poncho's VFIO setup</span>
</h3>
<p><b>Hardware:</b>
</p>
<ul>
<li>
<b>CPU</b>: Ryzen 7 2700x @ stock (PBO)</li>
<li>
<b>Motherboard</b>: MSI B450-A PRO MAX (BIOS/UEFI version: 7B86vM5)</li>
<li>
<b>GPU1 (Guest)</b>: MSI GeForce GTX 1660 Ti Gaming X 6GB @ Stock</li>
<li>
<b>GPU2 (Host)</b>: AsRock RX 570 8GB @ Stock</li>
<li>
<b>RAM</b>: 2 x 16GB @ 3200MHz</li>
</ul>
<p><b>Configuration:</b>
</p>
<ul>
<li>
<b>Guest OS</b>: Windows 10 Home</li>
<li>
<b>Kernel</b>: 5.4.17-1-MANJARO vanilla, no ACS patch</li>
<li>
<b>libvirt 5.10.0/QEMU 4.2.0</b>: <a rel="nofollow"  href="https://gist.github.com/jp1995/7427b00eae14aba91a6ee2ab0d17df0a/">win10.xml gist</a>
</li>
</ul>
<p><b>Issues I have encountered:</b>
</p>
<p>The main issue that plagued me for a while was crashes. The crashes were occurring more often in more demanding games, and less often when the host was as idle as possible. Mostly just the game crashed, but sometimes it would take the VM with it. I finally solved this by changing my RAM speed from 3466MHz to 2666MHz. I'll try slowly bumping the RAM speed back up step by step to find the point of instability and I'll edit this once I've found it. <i>Edit:</i> It's 3200MHz.
</p>
<p><b>Describing setup loosely:</b> 
</p>
<ul>
<li>On the hardware side, my 620 Watt PSU is perfectly adequate, despite some early concerns.</li>
<li>16 PCI lanes for the Guest card, 4 for the Host card. 8+8 is also a solution but I haven't had the need to try this.</li>
<li>Regarding the VM setup, I pinned and isolated 12 logical processors, leaving 4 to the host. The isolation was achieved using <a rel="nofollow"  href="https://rokups.github.io/#!pages/gaming-vm-performance.md/">these scripts.</a> I needed the git version of cpuset for it to work. The pinning alone didn't change performance at all.</li>
<li>Audio passthrough is done through the usual pulseaudio solution, I have no demonic interference, works almost perfectly. I have to plug my headset directly into the VM when I want my mic to not sound garbage. ICH9.</li>
<li>I did try enabling MSI on the GPU in an attempt to fix the crashes described above, but all I got was a small but significant reduction in performance.</li>
<li>Regarding input, I got a bit lucky. My motherboard has two USB 3 ports all alone in a single IOMMU group. I got a 4 port USB switch and the only complaint I have with it is that while switching from Host to Guest is near instantaneous, the other way around takes about 3 seconds.</li>
<li>No trouble at all getting the NVIDIA gpu to run in a VM, used the general solution in the wiki, including &lt;kvm&gt;&lt;hidden state='on'/&gt;&lt;/kvm&gt;</li>
<li>As for storage, I just gave the VM a whole raw SATA SSD. Benchmarking shows about a 50% performance drop, but I haven't really noticed significantly longer loading times in games. In the future I might try reinstalling windows on a virtual image for cloning purposes and use the SSD as a game drive.</li>
<li>All in all, <s>there is about a 10% performance loss in CPU intensive games, compared to bare metal.</s> after four months of use, I've found that some games do not run as well as others. EFT can drop over 25 fps compared to native. GTA V can drop more. Insurgency Sandstorm starts stuttering, something frame time related I think, when there's anything graphical going on in the host machine. Less demanding games run great. Hoping Zen 3 saves me with more CPU resources, L3 cache, bandwidth etc. Ideally, I imagine separate NUMA nodes would be great for this, but way above my price range.</li>
</ul>
<h3>
<span id="zane.27s_not_working_box"></span><span class="mw-headline" id="zane's_not_working_box">zane's not working box</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>MacBook Pro 11,x</b> (2014 Model)</li>
<li>
<b>CPU</b>: Intel Core i7-4770HQ</li>
<li>
<b>Motherboard</b>: Apple</li>
<li>
<b>GPU</b>: Iris Pro 5200 for host, GTX 1660 eGPU over Thunderbolt 2 for guest</li>
<li>
<b>RAM</b>: 16GB</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: linux-vfio from aur 5.5.8</li>
<li>
<b>qemu</b>: 4.2.0</li>
<li>
<b>libvirt</b>: 5.10.0</li>
<li>
<b>ovmf</b>: 1:r26976.bd85bf54c2</li>
<li>
<b>libvirt/QEMU</b>: <a rel="nofollow"  href="https://gist.github.com/xzn/ef338049c91d21e9c1900982b21d9d32">libvirt setup</a>; <a rel="nofollow"  href="https://gist.github.com/xzn/06760e0e7df6ca325d0f05979aeff3bd">qemu setup</a>
</li>
</ul>
<p>Description:
</p>
<ul><li>The qemu script include lines for setting up device mapped file for raw disk access. 3D Performace is about 40% to 80% native depending on the application, with periodic lag spike/stutter.</li></ul>
<p>Issues:
</p>
<ul>
<li>Use <a rel="nofollow"  href="https://github.com/0xbb/apple_set_os.efi">apple_set_os.efi</a> or <code>spoof_osx_version</code> with <a rel="nofollow"  href="https://www.rodsbooks.com/refind/configfile.html">refind</a> to avoid black screen on start. This prevents Apple firmware from shutting down host iGPU when booting Linux/Windows.</li>
<li>CPU pinning for guest is mandatory as it removes majority of stutters. After that isolate host CPU cores and pin emulator/IO threads as well. <a rel="nofollow"  href="https://github.com/PiMaker/Win10-VFIO/blob/master/qemu_fifo.sh">Pi's script</a> for pinning IRQ handlers also helps. Hugepages for memory helps.</li>
<li>Kernel parameters: <code>intel_iommu=on iommu=pt pcie_acs_override=downstream pci=realloc vfio-pci.ids=10de:2184,10de:1aeb,10de:1aec,10de:1aed,8086:0d01,8086:156d,8086:156c isolcpus=0-5 nohz_full=0-5 rcu_nocbs=0-5 default_hugepagesz=1G hugepagesz=1G hugepages=12 mitigations=off pcie_aspm=off module_blacklist=nvidia audit=0 loglevel=3 quiet</code>. Everything starting with <code>mitigations=off</code> are optional. <code>pci=realloc</code> is mandatory or you will get <code>NVRM: This PCI I/O region assigned to your NVIDIA device is invalid: NVRM: BAR1 is 0M @ 0x0 (PCI:0000:0a:00.0)</code> error in dmesg and Error 43 for the Nvidia driver in guest.</li>
<li>Add <code>vfio_pci vfio vfio_iommu_type1 vfio_virqfd</code> to your <code>mkinitcpio.conf</code> as normal. Add <code>options kvm ignore_msrs=1</code> and <code>options kvm report_ignored_msrs=N</code> to your <code>/etc/modprobe.d/kvm.conf</code> as well.</li>
<li>For me ACSO patch is mandatory, available from linux-vfio aur.</li>
<li>Enabling MSI for guest GPU seemingly helps. Using <code>ioh3420</code> device and passthrough GPU on top of that DOES NOT seem to help, while making PulseAudio output cracks badly. Setting <code>mixing-engine=off</code> for PulseAudio also makes it cracks badly so consider USB soundcard if needed. (I personally use the sound out on my monitor from guest). While I'm not sure what this option does, setting <code>in.buffer-length</code> on PulseAudio audiodev reduces cracks.</li>
</ul>
<h3>
<span id="Muata.27s_VFIO_setup"></span><span class="mw-headline" id="Muata's_VFIO_setup">Muata's VFIO setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: i7 4790</li>
<li>
<b>Motherboard</b>: MSI B85M-G43 BIOS/UEFI Version: V3.9 (03/30/2015)</li>
<li>
<b>GPU</b>: NVIDIA GeForce GTX 1060 6GB (MSI Gaming+)</li>
<li>
<b>RAM</b>: 16GB</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: linux-zen 5.5.11-1</li>
<li>Using <b>libvirt/QEMU</b>: <a rel="nofollow"  href="https://github.com/Muata/VFIO">VFIO setup</a>;</li>
<li>
<b>qemu</b>: 4.2.0</li>
<li>
<b>libvirt</b>: 5.10.0</li>
<li>No issues at moment of writing this.</li>
</ul>
<p>&gt; I had some issues with the network, for example, I couldn't connect to Activision games servers (CoD: MW, Overwatch) but I've changed firewall settings from public to private and everything is good for now.
</p>
<p>&gt; For the first time, I had windows on .raw image and disk was throttling a lot, I've set up raid0 on my 2 HDD's, then I created 3 partitions with LVM - 120GB for windows, 700GB for data(games), 700gb for Linux data and passthrough two of partition as Virtio-BLK. <a href="..//Usage/Configuration/E/LVM_on_software_RAID.html" class="mw-redirect" title="Software RAID and LVM">RAID&amp;LVM</a>
</p>
<p>&gt; Audio passthrough is done through the usual PulseAudio solution, works nicely.
</p>
<p>&gt; For some people who, maybe looking how to passthrough GPU - because it's not obvious when you doing it for the first time and it's not on the wiki though, so when you pass a correct group of vfio-pci.ids then you need to add in (easiest way) a Virtual Machine Manager - Add hardware - PCI Host Device - You graphic card (for me it was 0000:01:00:0 NVIDIA Corporation GP106 [GeForce GTX 1060 6GB]).
</p>
<h3>
<span id="peterge.27s_VFIO_setup"></span><span class="mw-headline" id="peterge's_VFIO_setup">peterge's VFIO setup</span>
</h3>
<p>Hardware:
</p>
<ul>
<li>
<b>CPU</b>: AMD Ryzen 5 1600X</li>
<li>
<b>Motherboard</b>: MSI x370 Gaming Pro Carbon</li>
<li>
<b>GPU</b>: SAPPHIRE PULSE Radeon RX 5700 XT (Host), Asus ROG Strix GeForce GTX 1080 (VM)</li>
<li>
<b>RAM</b>: 16GB</li>
</ul>
<p>Configuration:
</p>
<ul>
<li>
<b>Kernel</b>: 5.4.24-1-MANJARO</li>
<li>Using <b>libvirt/QEMU</b>: <a rel="nofollow"  href="https://github.com/peterge1998/vfio-setup-libvirt-xml">Xml File</a>
</li>
<li>No issues right now.</li>
</ul>
<p>&gt; Mouse and keyboard passthrough with evdev.
</p>
<p>&gt; Monitor connected to both GPUs to display native 144hz.
</p>
<p>&gt; Needed this option in <code>/etc/modprobe.d/kvm.conf</code>, related to my Ryzen CPU: 
<code>options kvm ignore_msrs</code>
</p>
<p>&gt; Had problems passing sound to host with a ICH6 device, sound was crackeling and a bit delayed. Then switched to 
scream-ivshmem and sound is working perfectly now. Its great in combination with looking-glass.
</p>
<p>&gt; Tried to build a solution where i can use my main GPU (GTX 1080) on Host and VM, by rebinding drivers. Rebinding drivers worked on the GTX 1080, but it was not able to use it to offload games from my host gpu back then <a rel="nofollow"  href="https://www.reddit.com/r/VFIO/comments/eaknqx/enabling_dri_prime1_to_use_passthrough_card_on/">Reddit Post</a> (Got it working with an R9 380 for the host, but needed to restart xorg every time). Then bought the RX 5700 XT, where GPU offloading worked like a charm, but due to the early stage of driver support driver rebinding is not supported <a rel="nofollow"  href="https://www.reddit.com/r/VFIO/comments/f2ypgz/5700xt_use_amd_gpu_on_host_and_vm_rebind_drivers/">Reddit Post</a>. So i currently have 2 GPUs in my rig.
</p>
<h2><span class="mw-headline" id="Adding_your_own_setup">Adding your own setup</span></h2>
<p>Add a new section with your nickname, CPU, motherboard and GPU models, then copy and paste this template to your section:
</p>
<pre>Hardware:

* '''CPU''': 
* '''Motherboard''': (Revision , BIOS/UEFI Version: )
* '''GPU''': 
* '''RAM''': 

Configuration:

* '''Kernel''': Kernel version (vanilla/CK/Zen/ACS-patched or not).
* Using '''libvirt/QEMU''': link to domain XMLs/scripts/notes (Git repo preferred).
* Issues you have encountered, special steps taken to make something work a bit better, etc.
* Describe your setup loosely here, so that when other wiki users are looking for something, they can easily skim through available setups.
</pre>
<p>Replace proper sections with your own data. Make sure to provide the exact motherboard model, revision (if possible - should be on both the motherboard itself and the box it came in) and BIOS/UEFI version you are using. Describe your exact software setup and add a link to your configuration files. (GitHub, GitLab, BitBucket, etc can host a public repository which you may update once in a while, but uploading them to pastebins is fine, too. <b>Do not</b> post the entire config file contents here.)
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="..//Usage/Configuration/E/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="..//Usage/Configuration/E/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li></ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF/Examples&amp;oldid=616506">https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF/Examples&amp;oldid=616506</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 27 May 2020, at 09:28.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="..//Usage/Configuration/E/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="..//Usage/Configuration/E/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="..//Usage/Configuration/E/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



<!--
    title: Examples
    description: Migration of Examples from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-29T19:25:31.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">PulseAudio/Examples</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"><span >&lt; <a href="..//Usage/Configuration/E/PulseAudio.html" title="PulseAudio">PulseAudio</a></span></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="..//Usage/Configuration/E/PulseAudio.html" title="PulseAudio">PulseAudio</a></li>
<li><a href="..//Usage/Configuration/E/PulseAudio/Troubleshooting.html" title="PulseAudio/Troubleshooting">PulseAudio/Troubleshooting</a></li>
</ul>
</div>
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Set_default_input_source"><span >1</span> <span >Set default input source</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Set_the_default_output_sink"><span >2</span> <span >Set the default output sink</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Set_the_default_output_sink_profile"><span >3</span> <span >Set the default output sink profile</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Independent_analog_and_digital_outputs_on_the_same_card"><span >4</span> <span >Independent analog and digital outputs on the same card</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Simultaneous_HDMI_and_analog_output"><span >5</span> <span >Simultaneous HDMI and analog output</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#HDMI_output_configuration"><span >6</span> <span >HDMI output configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Finding_HDMI_output"><span >6.1</span> <span >Finding HDMI output</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Testing_for_the_correct_card"><span >6.2</span> <span >Testing for the correct card</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Manually_configuring_PulseAudio_to_detect_the_Nvidia_HDMI"><span >6.3</span> <span >Manually configuring PulseAudio to detect the Nvidia HDMI</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Automatically_switch_audio_to_HDMI"><span >6.4</span> <span >Automatically switch audio to HDMI</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Surround_sound_systems"><span >7</span> <span >Surround sound systems</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Splitting_front/rear"><span >7.1</span> <span >Splitting front/rear</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Splitting_7.1_into_5.1+2.0"><span >7.2</span> <span >Splitting 7.1 into 5.1+2.0</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Disabling_LFE_remixing"><span >7.3</span> <span >Disabling LFE remixing</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Binaural_Headphones"><span >7.4</span> <span >Binaural Headphones</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16">
<a href="#PulseAudio_over_network"><span >8</span> <span >PulseAudio over network</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#TCP_support_(networked_sound)"><span >8.1</span> <span >TCP support (networked sound)</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#TCP_support_with_anonymous_clients"><span >8.2</span> <span >TCP support with anonymous clients</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Zeroconf_(Avahi)_publishing"><span >8.3</span> <span >Zeroconf (Avahi) publishing</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Selecting_the_Server"><span >8.4</span> <span >Selecting the Server</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Switching_the_PulseAudio_server_used_by_local_X_clients"><span >8.5</span> <span >Switching the PulseAudio server used by local X clients</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#When_everything_else_seems_to_fail"><span >8.6</span> <span >When everything else seems to fail</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#ALSA_monitor_source"><span >9</span> <span >ALSA monitor source</span></a></li>
<li class="toclevel-1 tocsection-24"><a href="#Monitor_specific_output"><span >10</span> <span >Monitor specific output</span></a></li>
<li class="toclevel-1 tocsection-25">
<a href="#PulseAudio_through_JACK"><span >11</span> <span >PulseAudio through JACK</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#The_KXStudio_method"><span >11.1</span> <span >The KXStudio method</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#The_manual_sink_configuration_method"><span >11.2</span> <span >The manual sink configuration method</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#The_shell_script_method"><span >11.3</span> <span >The shell script method</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#The_PulseAudio_kill_method"><span >11.4</span> <span >The PulseAudio kill method</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30">
<a href="#PulseAudio_through_JACK_issues"><span >12</span> <span >PulseAudio through JACK issues</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#When_JACK_is_started_Firefox,_Chrome_and_other_apps_stop_playing_video_and_audio"><span >12.1</span> <span >When JACK is started Firefox, Chrome and other apps stop playing video and audio</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#After_I_start_JACK_the_sound_from_PulseAudio_becomes_distorted"><span >12.2</span> <span >After I start JACK the sound from PulseAudio becomes distorted</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#PulseAudio_through_OSS"><span >13</span> <span >PulseAudio through OSS</span></a></li>
<li class="toclevel-1 tocsection-34"><a href="#PulseAudio_from_within_a_chroot"><span >14</span> <span >PulseAudio from within a chroot</span></a></li>
<li class="toclevel-1 tocsection-35"><a href="#Disabling_automatic_spawning_of_PulseAudio_server"><span >15</span> <span >Disabling automatic spawning of PulseAudio server</span></a></li>
<li class="toclevel-1 tocsection-36"><a href="#Disabling_pulseaudio_daemon_altogether"><span >16</span> <span >Disabling pulseaudio daemon altogether</span></a></li>
<li class="toclevel-1 tocsection-37"><a href="#Remap_stereo_to_mono"><span >17</span> <span >Remap stereo to mono</span></a></li>
<li class="toclevel-1 tocsection-38"><a href="#Remap_left_or_right_to_mono"><span >18</span> <span >Remap left or right to mono</span></a></li>
<li class="toclevel-1 tocsection-39"><a href="#Remap_for_broadcasting_software"><span >19</span> <span >Remap for broadcasting software</span></a></li>
<li class="toclevel-1 tocsection-40">
<a href="#Swap_left/right_channels"><span >20</span> <span >Swap left/right channels</span></a>
<ul>
<li class="toclevel-2 tocsection-41"><a href="#Using_default.pa"><span >20.1</span> <span >Using default.pa</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-42"><a href="#PulseAudio_as_a_minimal_unintrusive_dumb_pipe_to_ALSA"><span >21</span> <span >PulseAudio as a minimal unintrusive dumb pipe to ALSA</span></a></li>
<li class="toclevel-1 tocsection-43"><a href="#Having_both_speakers_and_headphones_plugged_in_and_switching_in_software_on-the-fly"><span >22</span> <span >Having both speakers and headphones plugged in and switching in software on-the-fly</span></a></li>
<li class="toclevel-1 tocsection-44"><a href="#Allowing_multiple_users_to_use_PulseAudio_at_the_same_time"><span >23</span> <span >Allowing multiple users to use PulseAudio at the same time</span></a></li>
<li class="toclevel-1 tocsection-45">
<a href="#Mixing_additional_audio_into_the_microphone's_audio"><span >24</span> <span >Mixing additional audio into the microphone's audio</span></a>
<ul>
<li class="toclevel-2 tocsection-46"><a href="#Overview_of_the_targeted_PulseAudio_configuration"><span >24.1</span> <span >Overview of the targeted PulseAudio configuration</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="#Applications_configuration"><span >24.2</span> <span >Applications configuration</span></a></li>
<li class="toclevel-2 tocsection-48"><a href="#Setup_steps"><span >24.3</span> <span >Setup steps</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="#Teardown"><span >24.4</span> <span >Teardown</span></a></li>
<li class="toclevel-2 tocsection-50"><a href="#Template_script"><span >24.5</span> <span >Template script</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Set_default_input_source">Set default input source</span></h2>
<p>List available input sources
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacmd list-sources | grep -e 'index:' -e device.string -e 'name:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"><i>  </i>index: 0
    name: &lt;input&gt;
      device.string = "hw:2"
* index: 1
    name: &lt;oss_input.dsp&gt;
      device.string = "/dev/dsp"
  index: 2
    name: &lt;alsa_output.pci-0000_04_01.0.analog-stereo.monitor&gt;</pre>
<p>The <code>*</code> in front of the index indicates the current default input.
</p>
<p>To set a system wide default, add the source name in the <code>default.pa</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
set-default-source <i>alsa_output.pci-0000_04_01.0.analog-stereo.monitor</i>
...</pre>
<p>For temporary use
</p>
<pre>$ pacmd "set-default-source alsa_output.pci-0000_04_01.0.analog-stereo.monitor"
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The default source can be referred as <code>@DEFAULT_SOURCE@</code> in commands, for example: <code>$ pactl set-source-mute @DEFAULT_SOURCE@ toggle</code>.</div>
<h2><span class="mw-headline" id="Set_the_default_output_sink">Set the default output sink</span></h2>
<p>To list the output sinks available, type the following command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacmd list-sinks | grep -e 'name:' -e 'index:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  * index: 0
	name: &lt;alsa_output.pci-0000_04_01.0.analog-stereo&gt;
    index: 1
	name: &lt;combined&gt;</pre>
<p>The <code>*</code> in front of the index indicates the current default output.
</p>
<p>To set a system wide default, add the source name in the <code>default.pa</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
set-default-sink <i>alsa_output.pci-0000_04_01.0.analog-stereo</i>
...</pre>
<p>When done then you can logout/login or restart PulseAudio manually for these changes to take effect.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The numbering of sinks is not guaranteed to be persistent, so all sinks in the <code>default.pa</code> file should be identified by the name.</li>
<li>For quick identification at runtime (e.g. to manage sound volume), you can use the sink index instead of the sink name: <pre>$ pactl set-sink-volume 0 +3%
$ pactl set-sink-volume 0 -3%
$ pactl set-sink-mute 0 toggle
</pre>
</li>
<li>To avoid unnecessary overriding of 100% normal volume it is better to use alternative utilities for managing of sound. See the <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=124513">forum thread</a> for more information.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The default sink can be referred as <code>@DEFAULT_SINK@</code> in commands, for example: <code>$ pactl set-sink-volume @DEFAULT_SINK@ +5%</code>.</div>
<h2><span class="mw-headline" id="Set_the_default_output_sink_profile">Set the default output sink profile</span></h2>
<p>Sometimes PulseAudio neglects to load the desired profile on start (e.g. a profile for having <a href="#Independent_analog_and_digital_outputs_on_the_same_card">#Independent analog and digital outputs on the same card</a>). To change the default profile, append the following to <code>default.pa</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
set-card-profile &lt;symbolic-name&gt; &lt;profilename&gt;</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>You could also use <code>&lt;cardindex&gt;</code> instead of <code>&lt;symbolic-name&gt;</code>, but using <code>&lt;symbolic-name&gt;</code> ensures referencing the correct device. <code>&lt;cardindex&gt;</code> is dynamic, and changes when a new device is plugged in.
</p>
</div>
<p>Find <code>&lt;symbolic-name&gt;</code> by running <code>pacmd list-cards</code>:
</p>
<pre>$ pacmd list-cards
3 card(s) available.
    index: 0
	name: &lt;alsa_card.pci-0000_01_00.1&gt;
	driver: &lt;module-alsa-card.c&gt;
	owner module: 6
        (...)

    index: 1
	name: &lt;alsa_card.usb-Sony_Interactive_Entertainment_Wireless_Controller-00&gt;
	driver: &lt;module-alsa-card.c&gt;
	owner module: 7
        (...)
				
    index: 2
	name: &lt;alsa_card.pci-0000_00_14.2&gt;
	driver: &lt;module-alsa-card.c&gt;
	owner module: 8
	(...)</pre>
<p>In this case, I want to use the device with index number 2, so <code>&lt;symbolic-name&gt;</code> should be <code>alsa_card.pci-0000_00_14.2</code>.
</p>
<p>To find <code>&lt;profilename&gt;</code>, set the desired profile manually, then run <code>pacmd list-cards </code>:
</p>
<pre>$ pacmd list-cards | grep 'active profile'
        active profile: &lt;off&gt;
	active profile: &lt;off&gt;
	active profile: &lt;output:analog-stereo+output:iec958-stereo+input:analog-stereo&gt;</pre>
<p>In this case, <code>default.pa</code> should now be changed to this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
set-card-profile alsa_card.pci-0000_00_14.2 output:analog-stereo+output:iec958-stereo+input:analog-stereo</pre>
<p>You can test your configuration by running <code>pactl set-card-profile &lt;symbolic-name&gt; &lt;profilename&gt;</code>.
</p>
<h2><span class="mw-headline" id="Independent_analog_and_digital_outputs_on_the_same_card">Independent analog and digital outputs on the same card</span></h2>
<p>Sound cards may have both analog and digital (iec958) outputs.  Pulseaudio does not generate combined profiles by default, you can choose either digital or analog profiles.
</p>
<p>The easiest way to make both outputs available is to add a combined profile to the end of default profile configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/pulseaudio/alsa-mixer/profile-sets/default.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

# Profile must be a '+' separated list of relevant mappings configured above
[Profile output:analog-stereo+output:iec958-stereo+input:analog-stereo]
# Human readable description
description = Analog and digital stereo output and analog stereo intput
output-mappings = analog-stereo iec958-stereo
input-mappings = analog-stereo
</pre>
<p>This way a defined profile is added to the end of the list of available profiles.
</p>
<p>Although this works, pulseaudio has a nasty habit of falling back to auto-generated profiles, so you may eventually need to set your card back to the combined profile.  The best way to overcome this is by writing a custom config with disabled <code>auto-profiles</code>. Copy <code>default.conf</code> to <code>custom-profile.conf</code>, and edit it to suit your needs (this example is for stereo output/input):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/pulseaudio/alsa-mixer/profile-sets/custom-profile.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

[General]
auto-profiles = no # disable  profile auto-generation
# Leave only relevant mappings:
[Mapping analog-stereo]
device-strings = front:%f
channel-map = left,right
paths-output = analog-output analog-output-lineout analog-output-speaker analog-output-headphones analog-output-headphones-2
paths-input = analog-input-front-mic analog-input-rear-mic analog-input-internal-mic analog-input-dock-mic analog-input analog-input-mic analog-input-linein analog-input-aux analog-input-video analog-input-tvtuner analog-input-fm analog-input-mic-line analog-input-headphone-mic analog-input-headset-mic
priority = 15

[Mapping iec958-stereo]
device-strings = iec958:%f
channel-map = left,right
paths-input = iec958-stereo-input
paths-output = iec958-stereo-output
priority = 5

[Profile output:analog-stereo+output:iec958-stereo+input:analog-stereo]
description = Analog and digital stereo output and analog stereo intput
output-mappings = analog-stereo iec958-stereo
input-mappings = analog-stereo
skip-probe=yes # since you know what your sound card has, there is no need for checking which sinks are available
</pre>
<p>Now that you have your custom profile you need to tell pulseaudio to use it.  This can be done by defining an <a href="..//Usage/Configuration/E/Udev.html#About_udev_rules" title="Udev">udev rule</a>:
</p>
<p>First get relevant information about your sound card:
</p>
<pre>$ pactl list cards

Card #0
        Name: alsa_card.pci-0000_00_1b.0
--- snip ----
        Properties:
--- snip ---
                device.vendor.id = "8086" # This is a 'vendor' attribute for udev rule
                device.product.id = "1c20" # This is a 'device' attribute for udev rule</pre>
<p>Now create a config file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/udev/rules.d/91-pulseaudio-custom.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

SUBSYSTEM!="sound", GOTO="pulseaudio_end"
ACTION!="change", GOTO="pulseaudio_end"
KERNEL!="card*", GOTO="pulseaudio_end"

SUBSYSTEMS=="pci", ATTRS{vendor}=="0x8086", ATTRS{device}=="0x1c20", ENV{PULSE_PROFILE_SET}="custom-profile.conf"

LABEL="pulseaudio_end"
</pre>
<p>Now tell udev to reload sound subsystem <code>udevadm trigger -ssound</code> (as the root user) and restart pulseaudio.  Your sound card should now use only the defined profile and have both analog and digital outputs available.
</p>
<h2><span class="mw-headline" id="Simultaneous_HDMI_and_analog_output">Simultaneous HDMI and analog output</span></h2>
<p>PulseAudio allows for simultaneous output to multiple sources.  In this example, some applications are configured to use HDMI while others are configured to use analog.  Multiple applications are able to receive audio at the same time.
</p>
<pre>$ aplay -l
**** List of PLAYBACK Hardware Devices ****
card 0: Intel [HDA Intel], device 0: ALC889A Analog [ALC889A Analog]
  Subdevices: 0/1
  Subdevice #0: subdevice #0
card 0: Intel [HDA Intel], device 1: ALC889A Digital [ALC889A Digital]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: Intel [HDA Intel], device 3: HDMI 0 [HDMI 0]
  Subdevices: 0/1
  Subdevice #0: subdevice #0</pre>
<p>Or by using the the <code>pacmd</code> command: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacmd list-sinks  | grep -e 'name:'  -e 'alsa.device ' -e 'alsa.subdevice '</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">	name: &lt;alsa_output.pci-0000_00_1b.0.analog-stereo&gt;
		alsa.subdevice = "0"
		alsa.device = "0"</pre>
<p>The key to a configuration like this is to understand that whatever is selected in pavucontrol under <i>Configuration &gt; Internal Audio</i> is the default device. Load <i>pavucontrol &gt; Configuration</i> and select HDMI as the profile. 
</p>
<p>To setup the analog device as a secondary source, add the following to the <code>/etc/pulse/default.pa</code> configuration at the beginning, before any other modules are loaded: 
</p>
<pre>### Load analog device
load-module module-alsa-sink device=hw:0,0
load-module module-combine-sink sink_name=combined
set-default-sink combined
</pre>
<p>Restart PulseAudio, run <i>pavucontrol</i> and select the "Output Devices" tab.  Three settings should be displayed:
</p>
<ol>
<li>Internal Audio Digital Stereo (HDMI)</li>
<li>Internal Audio</li>
<li>Simultaneous output to Internal Audio Digital Stereo (HDMI), Internal Audio</li>
</ol>
<p>Now start a program that will use PulseAudio such as MPlayer, VLC, mpd, etc. and switch to the "Playback" tab. A drop-down list should be available for the running program to select one of the three sources.
</p>
<p>Also see <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=118026">this thread</a> for a variation on this theme and <a rel="nofollow"  href="http://www.freedesktop.org/wiki/Software/PulseAudio/FAQ#Can_I_use_PulseAudio_to_playback_music_on_two_sound_cards_simultaneously.3F">PulseAudio FAQ</a>.
</p>
<h2><span class="mw-headline" id="HDMI_output_configuration">HDMI output configuration</span></h2>
<p>As outlined in <a rel="nofollow"  href="https://download.nvidia.com/XFree86/gpu-hdmi-audio-document/index.html#_issues_in_pulseaudio">https://download.nvidia.com/XFree86/gpu-hdmi-audio-document/index.html#_issues_in_pulseaudio</a> unless the HDMI port is the first
output, PulseAudio will not be able to have any audio when using certain graphics cards with HDMI audio support. This is because of a bug in PulseAudio where it will only select the first HDMI output on a device. A work around posted further down is to first find which HDMI output is working by using the aplay utility from ALSA.
</p>
<p>The original title for this section indicated the problem is specific to nVidia cards. As seen in <a rel="nofollow"  href="https://bbs.archlinux.org/viewtopic.php?id=133222">this forum thread</a> other cards are affected as well. The rest of the section will use an nVidia card as a case-study but the solution should carry over for people using other affected cards.
</p>
<h3><span class="mw-headline" id="Finding_HDMI_output">Finding HDMI output</span></h3>
<p>Then find the working output by listing the available cards
</p>
<pre># aplay -l
</pre>
<pre>sample output:
 **** List of PLAYBACK Hardware Devices ****
 card 0: NVidia [HDA NVidia], device 0: ALC1200 Analog [ALC1200 Analog]
   Subdevices: 1/1
   Subdevice #0: subdevice #0
 card 0: NVidia [HDA NVidia], device 3: ALC1200 Digital [ALC1200 Digital]
   Subdevices: 1/1
   Subdevice #0: subdevice #0
 card 1: NVidia_1 [HDA NVidia], device 3: HDMI 0 [HDMI 0]
   Subdevices: 1/1
   Subdevice #0: subdevice #0
 card 1: NVidia_1 [HDA NVidia], device 7: HDMI 0 [HDMI 0]
   Subdevices: 0/1
   Subdevice #0: subdevice #0
 card 1: NVidia_1 [HDA NVidia], device 8: HDMI 0 [HDMI 0]
   Subdevices: 1/1
   Subdevice #0: subdevice #0
 card 1: NVidia_1 [HDA NVidia], device 9: HDMI 0 [HDMI 0]
   Subdevices: 1/1
   Subdevice #0: subdevice #0
</pre>
<p>In case your HDMI port is wired to the NVIDIA card, but aplay does not detect an NVIDIA audio card, follow <a href="..//Usage/Configuration/E/NVIDIA/Troubleshooting.html#No_audio_over_HDMI" title="NVIDIA/Troubleshooting">NVIDIA/Troubleshooting#No audio over HDMI</a>.
</p>
<h3><span class="mw-headline" id="Testing_for_the_correct_card">Testing for the correct card</span></h3>
<p>Now a list of the detected cards is known, users will need to test for which one is outputting to the TV/monitor
</p>
<pre># aplay -D plughw:1,3 /usr/share/sounds/alsa/Front_Right.wav
</pre>
<p>where 1 is the card and 3 is the device substitute in the values listed from the previous section. If there is no audio, then try substituting a different device (on my card I had to use card 1 device 7)
</p>
<h3><span class="mw-headline" id="Manually_configuring_PulseAudio_to_detect_the_Nvidia_HDMI">Manually configuring PulseAudio to detect the Nvidia HDMI</span></h3>
<p>Having identified which HDMI device is working, PulseAudio can be forced to use it via an edit to <code>/etc/pulse/default.pa</code>:
</p>
<pre># load-module module-alsa-sink device=hw:1,7
</pre>
<p>where the 1 is the card and the 7 is the device found to work in the previous section
</p>
<p>restart pulse audio
</p>
<pre> $ pulseaudio -k
 $ pulseaudio --start
</pre>
<p>open the sound settings manager, make sure that under the hardware tab the graphics cards HDMI audio is set to "Digital Stereo (HDMI) Output" (My graphics card audio is called "GF100 High Definition Audio Controller").
</p>
<p>Then, open the output tab. There should now be two HDMI outputs for the graphics card. Test which one works by selecting one of them, and then using a program to play audio. For example, use VLC to play a movie, and if it does not work, then select the other.
</p>
<h3><span class="mw-headline" id="Automatically_switch_audio_to_HDMI">Automatically switch audio to HDMI</span></h3>
<p>Create a script to switch to the desired audio profile if an HDMI cable is plugged in:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/hdmi_sound_toggle.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

export PATH=/usr/bin

USER_NAME=$(who | awk -v vt=tty$(fgconsole) '$0 ~ vt {print $1}')
USER_ID=$(id -u "$USER_NAME")
CARD_PATH="/sys/class/drm/card0/"
AUDIO_OUTPUT="analog-surround-40"
PULSE_SERVER="unix:/run/user/"$USER_ID"/pulse/native"

for OUTPUT in $(cd "$CARD_PATH" &amp;&amp; echo card*); do
  OUT_STATUS=$(&lt;"$CARD_PATH"/"$OUTPUT"/status)
  if [[ $OUT_STATUS == connected ]]
  then
    echo $OUTPUT connected
    case "$OUTPUT" in
      "card0-HDMI-A-1")
        AUDIO_OUTPUT="hdmi-stereo" # Digital Stereo (HDMI 1)
     ;;
      "card0-HDMI-A-2")
        AUDIO_OUTPUT="hdmi-stereo-extra1" # Digital Stereo (HDMI 2)
     ;;
    esac
  fi
done
echo selecting output $AUDIO_OUTPUT
sudo -u "$USER_NAME" pactl --server "$PULSE_SERVER" set-card-profile 0 output:$AUDIO_OUTPUT+input:analog-stereo
</pre>
<p>Make the script executable:
</p>
<pre>chmod +x /usr/local/bin/hdmi_sound_toggle.sh
</pre>
<p>Create a <a href="..//Usage/Configuration/E/Udev.html" title="Udev">udev</a> rule to run this script when the status of the HDMI change:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/99-hdmi_sound.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">KERNEL=="card0", SUBSYSTEM=="drm", ACTION=="change", RUN+="/usr/local/bin/hdmi_sound_toggle.sh"</pre>
<p>To make the change effective don't forget to reload the udev rules:
</p>
<pre>udevadm control --reload-rules
</pre>
<p>A reboot might be required.
</p>
<h2><span class="mw-headline" id="Surround_sound_systems">Surround sound systems</span></h2>
<p>Many people have a surround sound card, but have speakers for just two channels, so PulseAudio cannot really default to a surround sound setup. To enable all of the channels, edit <code>/etc/pulse/daemon.conf</code>: uncomment the default-sample-channels line (i.e. remove the semicolon from the beginning of the line) and set the value to <b>6</b>. For a <i>5.1</i> setup, or <b>8</b> for a <i>7.1</i> setup etc.
</p>
<pre># Default
default-sample-channels=2
# For 5.1
default-sample-channels=6
# For 7.1
default-sample-channels=8
</pre>
<p>If your channels are not correclty mapped or the volume controls for the individual channels do not work as expected in pavucontrol, and you have a HDMI and an analog soundcard, then try to add the following line to <code>/etc/pulse/default.pa</code>
</p>
<pre>load-module module-combine channels=6 channel_map=front-left,front-right,rear-left,rear-right,front-center,lfe
</pre>
<p>Note that this example is for a 5.1 setup.
</p>
<p>After doing the edit, restart PulseAudio.
</p>
<h3>
<span id="Splitting_front.2Frear"></span><span class="mw-headline" id="Splitting_front/rear">Splitting front/rear</span>
</h3>
<p>Connect speakers to front analog output and headphones to rear output. It would be useful to split front/rear to separate sinks. Add to <code>/etc/pulse/default.pa</code>:
</p>
<pre> load-module module-remap-sink sink_name=speakers sink_properties="device.description='Speakers'" remix=no master=alsa_output.pci-0000_05_00.0.analog-surround-40 channels=2 master_channel_map=front-left,front-right channel_map=front-left,front-right
 load-module module-remap-sink sink_name=headphones sink_properties="device.description='Headphones'" remix=no master=alsa_output.pci-0000_05_00.0.analog-surround-40 channels=2 master_channel_map=rear-left,rear-right channel_map=front-left,front-right
</pre>
<p>Make sure to replace alsa_output.pci-0000_05_00.0.analog-surround-40 with the sound card name shown in 'pacmd list-sinks'.
Now you have 2 additional sinks which can be used separately. You can choose 'sink_name' freely, as long as there is no sink with that name already. The 'remix' parameter controls whether the audio should be down-/upmixed to match the channels in the sink.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If pulseaudio fails with <code>master sink not found</code>, comment out the remapping lines, start PulseAudio and verify your card output is set to the one you specified (e.g. analog surround 4.0). Alternatively, try using a <a href="#Set_the_default_output_source">sink index</a><sup>[<a href="..//Usage/Configuration/E/TOS Wiki:Requests.html#Broken_section_links" class="mw-redirect" title="TOS Wiki:Requests">broken link</a>: invalid section]</sup> instead of a sink name.</div>
<h3>
<span id="Splitting_7.1_into_5.1.2B2.0"></span><span class="mw-headline" id="Splitting_7.1_into_5.1+2.0">Splitting 7.1 into 5.1+2.0</span>
</h3>
<p>Similar to the example above, you can also split a 7.1 configuration into 5.1 surround and stereo output devices.
Set your card to 7.1 mode, then add the following lines to <code>/etc/pulse/default.pa</code>:
</p>
<pre> load-module module-remap-sink sink_name=Surround sink_properties="device.description='Surround'" remix=no master=alsa_output.pci-0000_00_14.2.analog-surround-71 channels=6 master_channel_map=front-left,front-right,rear-left,rear-right,front-center,lfe channel_map=front-left,front-right,rear-left,rear-right,front-center,lfe
 load-module module-remap-sink sink_name=Stereo sink_properties="device.description='Stereo'" remix=no master=alsa_output.pci-0000_00_14.2.analog-surround-71 channels=2 master_channel_map=side-left,side-right channel_map=front-left,front-right
</pre>
<p>Make sure to replace alsa_output.pci-0000_00_14.2 with your sound card name, get it by running 'pacmd list-sinks'.
This configuration will use the front/rear/center+lfe (green/black/orange) jacks for the 5.1 sink and the side (grey) jack for the stereo sink.
It will also downmix any audio to stereo for the stereo sink, but will not touch the 5.1 output.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If pulseaudio fails with <code>master sink not found</code>, comment out the remapping lines, start PulseAudio and verify your card output is set to analog surround 7.1. Alternatively, try using a <a href="#Set_the_default_output_source">sink index</a><sup>[<a href="..//Usage/Configuration/E/TOS Wiki:Requests.html#Broken_section_links" class="mw-redirect" title="TOS Wiki:Requests">broken link</a>: invalid section]</sup> instead of a sink name.</div>
<h3><span class="mw-headline" id="Disabling_LFE_remixing">Disabling LFE remixing</span></h3>
<p>By default, PulseAudio remixes the number of channels to the default-sample-channels and since version 7 it also remixes the LFE channel. If you wish to disable LFE remixing, uncomment the line:
</p>
<pre>; enable-lfe-remixing = yes
</pre>
<p>and replace yes with no:
</p>
<pre>enable-lfe-remixing = no
</pre>
<p>then restart Pulseaudio.
</p>
<h3><span class="mw-headline" id="Binaural_Headphones">Binaural Headphones</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/ladspa-bs2b/">ladspa-bs2b</a></span><sup><small>AUR</small></sup> provides a plugin to simulate surround sound on stereo headphones. To use it, find your headphones with:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacmd list-sinks | grep -e 'name:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">	name: &lt;alsa_output.pci-0000_00_1b.0.iec958-ac3-surround-51&gt;
	name: &lt;alsa_output.pci-0000_00_1b.0.iec958-ac3-surround-51.equalizer&gt;
	name: &lt;bluez_sink.00_1F_82_28_93_51&gt;
</pre>
<p>Load the plugin (<i>new</i> sink_name is up to you, master=<i>headphone's sink name</i>):
</p>
<pre>pacmd load-module module-ladspa-sink sink_name=binaural master=bluez_sink.00_1F_82_28_93_51 plugin=bs2b label=bs2b control=700,4.5
</pre>
<p>Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pavucontrol">pavucontrol</a></span> to transfer streams to the new sink, or:
</p>
<pre>pactl move-sink-input $INPUTID $BINAURALSINKNAME
</pre>
<h2><span class="mw-headline" id="PulseAudio_over_network">PulseAudio over network</span></h2>
<p>One of PulseAudio's unique features is its ability to stream audio from clients over TCP to a server running the PulseAudio daemon reliably within a LAN. Ensure that client and server systems agree on the time (i.e., use NTP), or audio streams may be choppy or may not work at all.
</p>
<h3>
<span id="TCP_support_.28networked_sound.29"></span><span class="mw-headline" id="TCP_support_(networked_sound)">TCP support (networked sound)</span>
</h3>
<p>You need to enable the TCP module, on the server edit <code>/etc/pulse/default.pa</code> to add or uncomment:
</p>
<pre>load-module module-native-protocol-tcp
</pre>
<p>For this to work, it is a requirement that both the client and server share the same cookie. Ensure that the clients and server share the same cookie file found under <code>~/.config/pulse/cookie</code>. It does not matter whose cookie file you use (the server or a client's), just that the server and client(s) share the same one.
</p>
<p>Note: If experiencing trouble connecting, use (on server)
</p>
<pre>pacmd list-modules
</pre>
<h3><span class="mw-headline" id="TCP_support_with_anonymous_clients">TCP support with anonymous clients</span></h3>
<p>If it is undesirable to copy the cookie file from clients, anonymous clients can access the server by giving these parameters to module-native-protocol-tcp on the server (again in <code>/etc/pulse/default.pa</code>):
</p>
<pre> load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1;192.168.0.0/24 auth-anonymous=1
</pre>
<p>Change the LAN IP subnet to match that of those clients you wish to have access to the server.
</p>
<h3>
<span id="Zeroconf_.28Avahi.29_publishing"></span><span class="mw-headline" id="Zeroconf_(Avahi)_publishing">Zeroconf (Avahi) publishing</span>
</h3>
<p>For the remote PulseAudio server to appear in the PulseAudio Device Chooser (<code>pasystray</code>), load the appropriate zeroconf modules, and enable the <a href="..//Usage/Configuration/E/Avahi.html" title="Avahi">Avahi</a> <a href="..//Usage/Configuration/E/Daemons.html" class="mw-redirect" title="Daemon">daemon</a>. On both machines, the client and server, <a href="..//Usage/Configuration/E/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pulseaudio-zeroconf">pulseaudio-zeroconf</a></span> then <a href="..//Usage/Configuration/E/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> and <a href="..//Usage/Configuration/E/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>avahi-daemon.service</code>.
</p>
<p>On the server, add <code>load-module module-zeroconf-publish</code> to <code>/etc/pulse/default.pa</code>. 
On the client, add <code>load-module module-zeroconf-discover</code> to <code>/etc/pulse/default.pa</code>. Now redirect any stream or complete audio output to the remote PulseAudio server by selecting the appropriate sink.
</p>
<p>If you have issues with the remote syncs appearing on the client, try restarting the Avahi daemon on the server to rebroadcast the available interfaces.
</p>
<h3><span class="mw-headline" id="Selecting_the_Server">Selecting the Server</span></h3>
<p>Run the graphical PulseAudio Volume Control <code>pavucontrol</code>.  Under the <b>Output Devices</b> tab, you should see the local and remote output devices.  Under the <b>Playback</b> tab, to the left of the "X" Mute Audio button, you should see a box containing the name of an output device.  That box is <i>actually a button</i>, which will display a drop-down radio-button list of the available output devices, with one output device selected.  Selecting an output device from the list will allow the audio stream to be switched to the PulseAudio server associated with that output device.  This control is not at all obvious until you have used it, and is especially useful with a remote Headless sound server.
</p>
<p>Similarly, under the <b>Input Devices</b> tab, local and remote input devices will be seen.  And under the <b>Recording</b> tab, there will be a box, to the left of the "X" Mute Audio button, with the name of an input device which is actually a button which will display a drop-down radio-button list of available input devices.
</p>
<p>Run <code>pavucontrol</code> on the local or remote host associated with the audio stream to be directed.  For instance, run <code>pavucontrol</code> on the remote host to direct the remote audio output to the local host.  Run <code>pavucontrol</code> on the local host to direct the local audio output to some remote host.
</p>
<p>Setting up simultaneous inputs or outputs is a different thing.  Search about "monitor" and "module-combine-sink" for that.
</p>
<h3><span class="mw-headline" id="Switching_the_PulseAudio_server_used_by_local_X_clients">Switching the PulseAudio server used by local X clients</span></h3>
<p>To switch between servers on the client from within X, the <code>pax11publish</code> command can be used.  For example, to switch from the default server to the server at hostname foo:
</p>
<pre>$ pax11publish -e -S foo
</pre>
<p>Or to switch back to the default:
</p>
<pre>$ pax11publish -e -r
</pre>
<p>Instead of telling the PulseAudio server to stream audio (as described above), this will edit PulseAudio variables on the X11 root window, which will instruct the PulseAudio client libraries to connect to a PulseAudio server other than <code>localhost</code>. As such, the programs will no longer interact with the local <code>pulseaudio</code> process, which can then be <a href="..//Usage/Configuration/E/Systemd.html#Using_units" class="mw-redirect" title="Stop">stopped</a>. Programs such as <code>pactl</code>, <code>pacmd</code> or <code>pavucontrol</code> will need to also run with the appropriate <code>PULSE_SERVER</code> environment/X variable to control the remote PulseAudio server.
</p>
<p>Note that for the switch to become apparent, the programs using Pulse must be restarted, or their PulseAudio client library otherwise reinitialized (completely stopping and restarting playback may be enough). To make this setting permanent, edit <code>default-server</code> in <code>~/.config/pulse/client.conf</code> or <code>/etc/pulse/client.conf</code>.
</p>
<h3><span class="mw-headline" id="When_everything_else_seems_to_fail">When everything else seems to fail</span></h3>
<p>The following is a quick fix and NOT a permanent solution
</p>
<p>On the server:
</p>
<pre> $ paprefs 
</pre>
<p>Go to Network Access -&gt; Enable access to local sound devices (Also check both 'Allow discover' and 'Don't require authentication').
</p>
<p>On the client:
</p>
<pre> $ export PULSE_SERVER=server.ip &amp;&amp; mplayer test.mp3
</pre>
<h2><span class="mw-headline" id="ALSA_monitor_source">ALSA monitor source</span></h2>
<p>To be able to record from a monitor source (a.k.a. "What-U-Hear", "Stereo Mix"), use <code>pactl list</code> to find out the name of the source in PulseAudio (e.g. <code>alsa_output.pci-0000_00_1b.0.analog-stereo.monitor</code>). Then add lines like the following to <code>/etc/asound.conf</code> or <code>~/.asoundrc</code>:
</p>
<pre>pcm.pulse_monitor {
  type pulse
  device alsa_output.pci-0000_00_1b.0.analog-stereo.monitor
}

ctl.pulse_monitor {
  type pulse
  device alsa_output.pci-0000_00_1b.0.analog-stereo.monitor
}
</pre>
<p>Now you can select <code>pulse_monitor</code> as a recording source.
</p>
<p>Alternatively, you can use pavucontrol to do this: make sure you have set up the display to "All input devices", then select "Monitor of [your sound card]" as the recording source.
</p>
<h2><span class="mw-headline" id="Monitor_specific_output">Monitor specific output</span></h2>
<p>It is possible to monitor a specific output, for example to stream audio from a music player into a VOIP application.
Simply create a null output device:
</p>
<pre>pactl load-module module-null-sink sink_name=&lt;name&gt;
</pre>
<p>In Pulseaudio Volume Control (pavucontrol), under the "Playback" tab, change the output of an application to &lt;name&gt;, and in the recording tab change the input of an application to "Monitor of &lt;name&gt;". Audio will now be outputted from one application into the other.
</p>
<h2><span class="mw-headline" id="PulseAudio_through_JACK">PulseAudio through JACK</span></h2>
<p>The <a href="..//Usage/Configuration/E/JACK_Audio_Connection_Kit.html" title="JACK Audio Connection Kit">JACK Audio Connection Kit</a> is popular for audio work, and is widely supported by Linux audio applications. It fills a similar niche as PulseAudio, but with more of an emphasis on professional audio work. It can offer lower latency audio monitoring along with greater control of input and output of multi-i/o sound devices.
</p>
<h3><span class="mw-headline" id="The_KXStudio_method">The KXStudio method</span></h3>
<p>This is the recommended method as it is <a rel="nofollow"  href="https://github.com/jackaudio/jackaudio.github.com/wiki/WalkThrough_User_PulseOnJack">officially endorsed by the JACK developers</a>.
</p>
<p>This configuration requires the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=jack2">jack2</a></span> package.
</p>
<p>JACK now has native features for bridging between ALSA, PulseAudio, and JACK.  This will allow you to simultaneously have JACK and PulseAudio running with both outputting at the same time, with no config editing or terminal commands requried.
</p>
<p>If you are using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=qjackctl">qjackctl</a></span>, it is recommended to uninstall it before beginning this.
</p>
<p>Begin by installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=cadence">cadence</a></span>, as well as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pulseaudio-jack">pulseaudio-jack</a></span>.  Once installed and started, JACK bridge configuration is found in the bottom right of the window.  The ALSA audio bridge should be set to ALSA -&gt; PulseAudio -&gt; JACK, and the PulseAudio bridge should be enabled.  Make sure in <code>pavucontrol</code> that all output devices besides Jack sink are muted, and all input devices besides Jack input are muted.  Start JACK using the Force Restart button, and if it starts successfully PulseAudio programs should begin outputting to JACK.
</p>
<h3><span class="mw-headline" id="The_manual_sink_configuration_method">The manual sink configuration method</span></h3>
<p>This configuration provides a method of allowing JACK and PulseAudio to run at the same time and output to each other.  It uses manual configuration of the systems that bridge between JACK and PulseAudio.  This configuration has no reliance on scripts or commands and is entirely based in configuration.
</p>
<p>This configuration only works with jack2. To use this configuration, just install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pulseaudio-jack">pulseaudio-jack</a></span> package. <code>/etc/pulse/default.pa</code> is already configured to load the modules in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pulseaudio-jack">pulseaudio-jack</a></span> if they are present. If you want to be sure, open the file and look for the line:
</p>
<pre>load-module module-jackdbus-detect <i>options</i>
</pre>
<p>Where <code><i>options</i></code> can be any options supported by this module, usually <code>channels=2</code>.
</p>
<p>As described on the <a rel="nofollow"  href="https://github.com/jackaudio/jackaudio.github.com/wiki/JackDbusPackaging">Jack-DBUS Packaging</a> page:
</p>
<p><i>Server auto-launching is implemented as D-Bus call that auto-activates JACK D-Bus service, in case it is not already started, and starts the JACK server. Correct interaction with PulseAudio is done using a D-Bus based audio card "acquire/release" mechanism. When JACK server starts, it asks this D-Bus service to acquire the audio card and PulseAudio will unconditionally release it. When JACK server stops, it releases the audio card that can be grabbed again by PulseAudio.</i>
</p>
<p><code>module-jackdbus-detect.so</code> dynamically loads and unloads module-jack-sink and module-jack-source when jackdbus is started and stopped.
</p>
<p>If PulseAudio sound does not work, check with <code>pavucontrol</code> to see if the relevant programs appear in the playback tab. If not, add the following to <code>~/.asoundrc</code> or <code>/etc/asound.conf</code> to redirect ALSA to PulseAudio:
</p>
<pre>pcm.pulse {
    type pulse
}

ctl.pulse {
    type pulse
}

pcm.!default {
    type pulse
}
ctl.!default {
    type pulse
}
</pre>
<p>If it still does not work, check with <code>pavucontrol</code> in the playback tab and make sure the relevant programs are outputting to PulseAudio JACK Sink instead of your audio card (which JACK has control of, so it will not work). Also ensure that in the JACK graph the PulseAudio JACK Source is connected to the system audio output.
</p>
<h3><span class="mw-headline" id="The_shell_script_method">The shell script method</span></h3>
<p>This method allows JACK and PulseAudio to output at the same time.  It mostly relies on shell scripts that are automatically run by QJackCTL to manage aspects of how the JACK sinks and PulseAudio behave.
</p>
<p>The basic idea is that killing PulseAudio is a bad idea because it may crash any apps using PulseAudio and disrupt any audio playing.
</p>
<p>The flow of how this setup works:
</p>
<ol>
<li>PulseAudio releases the sound card</li>
<li>JACK grabs sound card and starts up</li>
<li>script redirects PulseAudio to JACK</li>
<li>manually send PulseAudio apps to JACK output (pavucontrol may come in helpful for this)</li>
<li>use JACK programs etc</li>
<li>via script, stop redirecting PulseAudio to JACK</li>
<li>stop JACK and release sound card</li>
<li>PulseAudio grabs sound card and reroutes audio to it directly</li>
</ol>
<p>With QJackCTL, set up these scripts:
</p>
<p><code>pulse-jack-pre-start.sh</code> set it up as the execute script on startup script
</p>
<pre>#!/bin/bash
pacmd suspend true
</pre>
<p><code>pulse-jack-post-start.sh</code> set this one up as execute script after startup
</p>
<pre>#!/bin/bash
pactl load-module module-jack-sink channels=2
pactl load-module module-jack-source channels=2
pacmd set-default-sink jack_out
pacmd set-default-source jack_in
</pre>
<p><code>pulse-jack-pre-stop.sh</code> "execute script on shutdown"
</p>
<pre>#!/bin/bash
SINKID=$(LANG=C pactl list | grep -B 1 "Name: module-jack-sink" | grep Module | sed 's/[^0-9]//g')
SOURCEID=$(LANG=C pactl list | grep -B 1 "Name: module-jack-source" | grep Module | sed 's/[^0-9]//g')
pactl unload-module $SINKID
pactl unload-module $SOURCEID
sleep 5
</pre>
<p><code>pulse-jack-post-stop.sh</code> "execute script after shutdown"
</p>
<pre>#!/bin/bash
pacmd suspend false
</pre>
<h3><span class="mw-headline" id="The_PulseAudio_kill_method">The PulseAudio kill method</span></h3>
<p>This method relies on shell scripts to automatically kill PulseAudio when JACK is started, and automatically restart it when JACK is stopped.  This will result in lower CPU usage than having both running, but can cause errors in already running PulseAudio application and does not allow simultaneous output of both.
</p>
<p>Using the settings listed above, use QjackCtl to execute a script upon startup and shutdown to load/unload PulseAudio. Part of the reason users may wish to do this is that the above changes disable PulseAudio's automatic hardware detection modules. This particular setup is for using PulseAudio in an exclusive fashion with JACK, though the scripts could be modified to unload and load an alternate non-JACK setup, but killing and starting PulseAudio while programs might be using it would become problematic.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> padevchooser in the following example is deprecated. It is replaced by pasystray</div>
<p>The following example could be used and modified as necessary as a startup script that daemonizes PulseAudio and loads the <i>padevchooser</i> program (optional, needs to be built from AUR) called <code>jack_startup</code>:	
</p>
<pre>#!/bin/bash	
#Load PulseAudio and PulseAudio Device Chooser
pulseaudio -D
padevchooser&amp;

</pre>
<p>as well as a shutdown script to kill PulseAudio and the Pulse Audio Device Chooser, as another example called <code>jack_shutdown</code> also in the home directory:	
</p>
<pre>#!/bin/bash	
#Kill PulseAudio and PulseAudio Device Chooser		
pulseaudio --kill	
killall padevchooser	
</pre>
<p>Both scripts need to be made executable:	
</p>
<pre>chmod +x jack_startup jack_shutdown
</pre>
<p>then with QjackCtl loaded, click on the <i>Setup</i> button and then the <i>Options</i> tab and tick both "Execute Script after Startup:" And "Execute Script on Shutdown:" and put either use the ... button or type the path to the scripts (assuming the scripts are in the home directory) <code>~/jack_startup</code> and <code>~/jack_shutdown</code> making sure to save the changes.
</p>
<h2><span class="mw-headline" id="PulseAudio_through_JACK_issues">PulseAudio through JACK issues</span></h2>
<h3>
<span id="When_JACK_is_started_Firefox.2C_Chrome_and_other_apps_stop_playing_video_and_audio"></span><span class="mw-headline" id="When_JACK_is_started_Firefox,_Chrome_and_other_apps_stop_playing_video_and_audio">When JACK is started Firefox, Chrome and other apps stop playing video and audio</span>
</h3>
<p>Firefox/Chrome/etc. is using PulseAudio soundcard sink instead of the JACK sink. Open <code>pavucontrol</code> and on the <i>Playback</i> tab switch all audiostreams from something like "Built-in Audio Analog Stereo" to something like "Jack sink (PulseAudio JACK Sink)".
</p>
<h3><span class="mw-headline" id="After_I_start_JACK_the_sound_from_PulseAudio_becomes_distorted">After I start JACK the sound from PulseAudio becomes distorted</span></h3>
<p>In QjackCtl click <i>Setup</i> and on the <i>Settings</i> tab, <i>Parameters</i> subtab untick "Realtime". In addition, tweaking Sample Rate, Frames/Period and Period/Buffer may help. Look for latency in the bottom right corner, as you still want minimal latency for audio production. Also, I think Sample Rate should match one of the rates supported by your audio interface (<code>cat /proc/asound/cardN/codec\#M</code> and look for <code>rates</code>, there could be multiple occurrences).
</p>
<h2><span class="mw-headline" id="PulseAudio_through_OSS">PulseAudio through OSS</span></h2>
<p>Add the following to <code>/etc/pulse/default.pa</code>:
</p>
<pre>load-module module-oss
</pre>
<p>Then start PulseAudio as usual, making sure that sinks and sources are defined for OSS devices.
</p>
<h2><span class="mw-headline" id="PulseAudio_from_within_a_chroot">PulseAudio from within a chroot</span></h2>
<p>Since a chroot sets up an alternative root for the running/jailing of applications, PulseAudio must be installed within the chroot itself (<code>pacman -S pulseaudio</code> within the chroot environment).
</p>
<p>PulseAudio, if not set up to connect to any specific server (this can be done in <code>/etc/pulse/client.conf</code>, through the PULSE_SERVER environment variable, or through publishing to the local X11 properties using module-x11-publish), will attempt to connect to the local pulse server, failing which it will spawn a new pulse server. Each pulse server has a unique ID based on the machine-id value in <code>/var/lib/dbus</code>. To allow for chrooted apps to access the pulse server, the following directories must be mounted within the chroot:-
</p>
<pre>/run
/var/lib/dbus
/tmp
~/config/.pulse
</pre>
<p><code>/dev/shm</code> should also be mounted for efficiency and good performance. Note that mounting /home would normally also allow sharing of the <code>~/.pulse</code> folder.
</p>
<p>PulseAudio selects the path to the socket via XDG_RUNTIME_DIR, so be sure to drag it along when you chroot as a normal user using <a href="..//Usage/Configuration/E/Sudo.html" title="Sudo">sudo</a> (see <a href="..//Usage/Configuration/E/Sudo.html#Environment_variables" title="Sudo">Sudo#Environment variables</a>).
</p>
<h2><span class="mw-headline" id="Disabling_automatic_spawning_of_PulseAudio_server">Disabling automatic spawning of PulseAudio server</span></h2>
<p>Some users may prefer to manually start the PulseAudio server before running certain programs and then stop the PulseAudio server when they are finished. A simple way to accomplish this is to edit <code>~/.config/pulse/client.conf</code> or <code>/etc/pulse/client.conf</code> and change <code>autospawn = yes</code> to <code>autospawn=no</code>. Make sure the line is uncommented as well.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/pulse/client.conf #or /etc/pulse/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">autospawn=no
</pre>
<p>Now you can manually start the pulseaudio server with
</p>
<pre>$ pulseaudio --start
</pre>
<p>and stop it with
</p>
<pre>$ pulseaudio --kill
</pre>
<p>This setting is also respected by the default pulseaudio dektop session startup script <code>start-pulseaudio-x11</code> which is executed from <code>/etc/xdg/autostart/pulseaudio.desktop</code>.
</p>
<h2><span class="mw-headline" id="Disabling_pulseaudio_daemon_altogether">Disabling pulseaudio daemon altogether</span></h2>
<p>To disable the pulseaudio daemon completely, and thereby preventing it from starting, one can add <code>daemon-binary=/bin/true</code> to the configuration file.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/pulse/client.conf #or /etc/pulse/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">daemon-binary=/bin/true</pre>
<h2><span class="mw-headline" id="Remap_stereo_to_mono">Remap stereo to mono</span></h2>
<p>Remap a stereo input-sink to a mono sink by creating a virtual sink. It would be useful if you only have one speaker. Add to <code>/etc/pulse/default.pa</code>:
</p>
<pre>load-module module-remap-sink master=alsa_output.pci-0000_00_1f.5.analog-stereo sink_name=mono sink_properties="device.description='Mono'" channels=2 channel_map=mono,mono
# Optional: Select new remap as default
set-default-sink mono
</pre>
<p>(replace alsa_output.pci-0000_00_1f.5.analog-stereo in the sound card name shown from <code>pacmd list-sinks</code>)
</p>
<p>Switch player between virtual mono sink and real stereo sink.
</p>
<h2><span class="mw-headline" id="Remap_left_or_right_to_mono">Remap left or right to mono</span></h2>
<p>Particularly useful in the case an audio stream has different content in the left and right channels, such as Japanese television broadcasts with bilingual audio.
</p>
<pre># For Japanese bilingual TV
load-module module-remap-sink sink_name=Left-to-Mono sink_properties="device.description='Left to Mono (5.1 AC3 on ALC892 Digital)'" master=alsa_output.pci-0000_00_1b.0.iec958-ac3-surround-51 channels=2 master_channel_map=mono,mono channel_map=front-left,rear-left
load-module module-remap-sink sink_name=Right-to-Mono sink_properties="device.description='Right to Mono (5.1 AC3 on ALC892 Digital)'" master=alsa_output.pci-0000_00_1b.0.iec958-ac3-surround-51 channels=2 master_channel_map=mono,mono channel_map=front-right,rear-right
</pre>
<p>Replace <code>alsa_output.pci-0000_00_1b.0.iec958-ac3-surround-51</code> (5.1 AC3 on ALC892 Digital) with your own card (<code>pacmd list-sinks</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>
<i>master_channel_map</i> is a list of outputs to be remapped to.</li>
<li>
<i>channel_map</i> is a list of inputs to be remapped from.</li>
<li>A stereo card will not have to specify as many channels, eg. <code>channels=1 master_channel_map=mono channel_map=right</code>
</li>
</ul>
</div>
<h2><span class="mw-headline" id="Remap_for_broadcasting_software">Remap for broadcasting software</span></h2>
<p>If you do not want to capture sound from the application you need to create Remap sink:
</p>
<pre>### Create Remap sink
load-module module-remap-sink sink_name=Remap_sink master=SINK_NAME channels=2 remix=no
set-default-sink Remap_sink 
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Replace <code>SINK_NAME</code> with the real name of the master sink <code>pacmd list-sinks</code>.</div>
<p>Then restart PulseAudio daemon:
</p>
<pre>$ pulseaudio -k
$ pulseaudio --start
</pre>
<p>Now you need set the <code>Remap_sink</code> as the default sound source in broadcast software
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Use environment variable <code>PULSE_SINK=SINK_NAME</code> for applications, sound that does not need to be captured.</div>
<h2>
<span id="Swap_left.2Fright_channels"></span><span class="mw-headline" id="Swap_left/right_channels">Swap left/right channels</span>
</h2>
<p>This is the same as "reverse stereo", where the left and right channels are to be swapped.
</p>
<p>First, identify the card you want its channels swapped:
</p>
<pre>$ cat /proc/asound/cards
</pre>
<p>and use the name string for the device you wish to use (the one in square brackets, e.g. [Intel]).
</p>
<p>Edit <code>/etc/pulse/default.pa</code> and comment out module-hal-detect and module-detect lines.
</p>
<p>Search for the commented-out line that starts "#load-module module-alsa-sink", uncomment it and change it to
</p>
<pre>load-module module-alsa-sink device=hw:"device_name" channel_map=right,left
</pre>
<p>Restart the pulseaudio deamon by running
</p>
<pre>pulseaudio -k; pulseaudio -D
</pre>
<p><a rel="nofollow"  href="https://www.freedesktop.org/wiki/Software/PulseAudio/FAQ/#index34h3">Pulseaudio FAQ: How can I reverse my left and right speaker channels?</a>
</p>
<h3><span class="mw-headline" id="Using_default.pa">Using default.pa</span></h3>
<p>Another approach to swapping channels is suggested in <a rel="nofollow"  href="https://superuser.com/a/144252/161008">[1]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/pulseaudio -nF

.include /etc/pulse/default.pa

load-module module-remap-sink sink_name=reverse-stereo master=0 channels=2 master_channel_map=front-right,front-left channel_map=front-left,front-right
set-default-sink reverse-stereo</pre>
<h2><span class="mw-headline" id="PulseAudio_as_a_minimal_unintrusive_dumb_pipe_to_ALSA">PulseAudio as a minimal unintrusive dumb pipe to ALSA</span></h2>
<p>Some people do not want to run PulseAudio all the time for various reasons. This example will turn the full fledged audio server into an unobstrusive dumb pipe to ALSA devices that automatically starts <b>and</b> stops itself when done, allowing applications that requires PulseAudio to fully function while not touching any ALSA setting nor setting itself as the default ALSA device.
</p>
<p>This configuration tells native PA clients to autospawn the daemon when they need it, then the daemon is configured to autoexit as soon as all clients have disconnected. The daemon itself uses a plain simple static configuration that uses your configured <code>pcm.!default</code> ALSA devices and nothing more. No replacement of ALSA's default, no playing with mixer levels, nothing but record/playback. Also make sure <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pulseaudio-alsa">pulseaudio-alsa</a></span> is <b>not</b> installed so standard ALSA clients don't default to pulse. Since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=pulseaudio-alsa">pulseaudio-alsa</a></span> contains only a configuration file <code>/etc/asound.conf</code>, if it's installed as dependency, one could simply comment all contents in <code>/etc/asound.conf</code>. <code>alsamixer</code> functions properly as well as any other ALSA clients. Also make sure common frameworks like Xine, Gstreamer and Phonon are configured to use ALSA: by default if they detect PulseAudio is installed they will try to use it before ALSA.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/daemon.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Replace these with the proper values
exit-idle-time = 0 # Exit as soon as unneeded
flat-volumes = yes # Prevent messing with the master volume
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Replace these with the proper values

# Applications that uses PulseAudio *directly* will spawn it,
# use it, and pulse will exit itself when done because of the
# exit-idle-time setting in daemon.conf
autospawn = yes
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Replace the *entire* content of this file with these few lines and
# read the comments

.fail
    # Set tsched=0 here if you experience glitchy playback. This will
    # revert back to interrupt-based scheduling and should fix it.
    #
    # Replace the device= part if you want pulse to use a specific device
    # such as "dmix" and "dsnoop" so it doesn't lock an hw: device.
    
    # INPUT/RECORD
    load-module module-alsa-source device="default" tsched=1
    
    # OUTPUT/PLAYBACK
    load-module module-alsa-sink device="default" tsched=1 
    
    # Accept clients -- very important
    load-module module-native-protocol-unix

.nofail
.ifexists module-x11-publish.so
    # Publish to X11 so the clients know how to connect to Pulse. Will
    # clear itself on unload.
    load-module module-x11-publish
.endif
</pre>
<h2><span class="mw-headline" id="Having_both_speakers_and_headphones_plugged_in_and_switching_in_software_on-the-fly">Having both speakers and headphones plugged in and switching in software on-the-fly</span></h2>
<p>By design, Pulseaudio automatically turns off Line Out when headphones are plugged in and uses Headphone slider instead. You can observe this behavior in <code>alsamixer</code>. What we want is to have Headphone and Line Out sliders working separately and at the same time. This is extremely useful if you want to remap Realtek's jacks to have, say, Rear Green for headphones and Blue for speakers (with the help of <code>hdajackretask</code> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=alsa-tools">alsa-tools</a></span>).
</p>
<p>To achieve this, you should directly edit Pulseaudio mixer's configuration.
</p>
<p>1. We tell pulseaudio that headphones are always plugged in. Edit:
</p>
<p><code>/usr/share/pulseaudio/alsa-mixer/paths/analog-output-lineout.conf</code>
</p>
<p>Find:
</p>
<pre>[Jack Headphone]
state.plugged = no
state.unplugged = unknown
</pre>
<p>Change <code>no</code> to <code>yes</code>
</p>
<p>2. By default, Line Out's volume controlled only by Master, and not by Line Out slider itself. We want to merge Line Out with Master.
</p>
<p>Add this snippet to the end of the file:
</p>
<pre>[Element Line Out]
switch = mute
volume = merge
</pre>
<p>3. We need to completely cut off Line Out when we use headphones. Edit:
</p>
<p><code>/usr/share/pulseaudio/alsa-mixer/paths/analog-output-headphones.conf</code>
</p>
<p>Add this snippet to the end of the file:
</p>
<pre>[Element Line Out]
switch = off
volume = off
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On some systems you might need to use <code>[Element Front]</code> instead of <code>[Element Line Out]</code>.</div>
<p>4. Like Pulseaudio, Alsa itself cuts off speakers when headphones are plugged in. Open <code>alsamixer</code> (in case of Realtek HDA <code>alsamixer -c0</code>) and change <code>Auto-Mute mode</code> to <code>disabled</code>. 
</p>
<p>5. Restart Pulseaudio
</p>
<pre>$ pulseaudio -k
$ pulseaudio --start
</pre>
<p>Now you have two separate ports on the same sink in pulseaudio. They mute each other, so you can switch to headphones and this will mute Line Out, and vice versa.
To switch between ports you can use Gnome or Plasma sound mixer, or install appropriate desktop extension.
</p>
<h2><span class="mw-headline" id="Allowing_multiple_users_to_use_PulseAudio_at_the_same_time">Allowing multiple users to use PulseAudio at the same time</span></h2>
<p>It is sometimes desirable to run some programs as another user on the same desktop of the primary user in order to isolate the software. However, PulseAudio will not accept by default connections by the secondary users, since a PulseAudio daemon is already running for the primary user. However, a PulseAudio UNIX socket can be created in order to accept connections from other users to the main PulseAudio daemon run by the primary user.
</p>
<p>First, edit <code>/etc/pulse/default.pa</code> or <code>~/.config/pulse/default.pa</code> and add a directive for the unix socket to be created:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">load-module module-native-protocol-unix auth-anonymous=1 socket=/tmp/pulse-socket</pre>
<p>Afterwards, set PulseAudio as a client to the UNIX socket just created in the secondary user:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/home/<i>secondaryuser</i>/.config/pulse/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default-server = unix:/tmp/pulse-socket</pre>
<p>Now, after restarting the PulseAudio daemon, applications running as the secondary user should be able to play sound through the main PulseAudio daemon running as the primary user without problems.
</p>
<h2>
<span id="Mixing_additional_audio_into_the_microphone.27s_audio"></span><span class="mw-headline" id="Mixing_additional_audio_into_the_microphone's_audio">Mixing additional audio into the microphone's audio</span>
</h2>
<p>Using a setup of null sinks and loopbacks you can mix arbitrary applications' audio output into your microphone's audio, for example to play sound effects or music on voice chat applications.
</p>
<p>The setup suggested here will also play your sound effects back to you and use <a rel="nofollow"  href="https://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/Modules/#module-echo-cancel">PulseAudio echo cancellation</a> to prevent the effects from feeding back into your microphone.
Despite this, using headphones instead of loudspeakers is probably a good idea.
</p>
<h3><span class="mw-headline" id="Overview_of_the_targeted_PulseAudio_configuration">Overview of the targeted PulseAudio configuration</span></h3>
<p>Symbology: <code>(Application)</code>, <code>{Audio source}</code>, <code>[Audio sink]</code>, <code>{m} = Monitor of audio sink</code>
</p>
<pre>{Microphone}
   ||                                             Input
{mic_ec} -------------&gt; [vsink_fx_mic]{m} ------------&gt; (Voice chat)
            Loopback               ^                         |
                           Loopback|                   Output|
                                   |                         |
             Output                |      Loopback           v
(Soundboard) ---------&gt; [vsink_fx]{m} ----------------&gt; [spk_ec]
                                                           ||
                                                        [Speakers]
</pre>
<dl>
<dt>{mic_ec}, [spk_ec]</dt>
<dd>Echo cancellation "clones" of the microphone and speakers</dd>
<dt>[vsink_fx]</dt>
<dd>Virtual sink into which the sound effects are played</dd>
<dt>[vsink_fx_mic]</dt>
<dd>Virtual sink where the microphone and the sound effects are mixed together</dd>
</dl>
<h3><span class="mw-headline" id="Applications_configuration">Applications configuration</span></h3>
<p>The applications providing the sound effects must
</p>
<ul><li>Output to "vsink_fx"</li></ul>
<p>All other applications, including the voice chat, must
</p>
<ul>
<li>Record audio from "Monitor of vsink_fx_mic"</li>
<li>Output to "spk_ec"</li>
</ul>
<p>Accordingly, these devices will be set as default source and default sink; ultimately, controlling which application uses which audio source/sink can be done in the <code>pavucontrol</code> graphical PulseAudio volume control panel.
</p>
<p><b>No application whatsoever</b> must record from, or output to, the "real" microphone or speakers, as this would bypass the echo cancellation.
</p>
<p>Any echo cancellation or other audio processing provided by the voice chat application should be disabled â PulseAudio is doing this already, and as the application is not aware of the sound effects being played on the speakers, it will likely be ineffective in filtering them from the microphone anyway.
</p>
<h3><span class="mw-headline" id="Setup_steps">Setup steps</span></h3>
<ol>
<li>Connect your microphone and headphones and make sure PulseAudio is configured correctly for their use, for example in the "Configuration" tab in <code>pavucontrol</code>
</li>
<li>
<i>First time only:</i>
<ol>
<li>Save the template script below to an executable file of your choice</li>
<li>Find the <code>name:</code>s of your microphone and headphones with <code>pacmd list-sources</code> and <code>pacmd list-sinks</code>, respectively</li>
<li>In the script, replace the values of "microphone" and "speakers" with the names of your microphone/headphones</li>
</ol>
</li>
<li>Run the script</li>
<li>Run your voice chat application and, in <code>pavucontrol</code>, make it record audio from "Monitor of vsink_fx_mic" and output audio to "spk_ec"</li>
<li>Run your sound effects application(s) and, in <code>pavucontrol</code>, make them play to "vsink_fx"</li>
</ol>
<p>As for applications that can play sound effects, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/castersoundboard-git/">castersoundboard-git</a></span><sup><small>AUR</small></sup> has been found to work quite well.
It however needs to be closed and re-opened when PulseAudio is restarted.
</p>
<h3><span class="mw-headline" id="Teardown">Teardown</span></h3>
<p>The changes that the script makes to the running PulseAudio server are not permanent and will be lost when PulseAudio terminates.
</p>
<p>To ditch the custom configuration, just restart PulseAudio, e.g. with <code>systemctl --user stop pulseaudio.service</code>. (PulseAudio is socket-activated and will automatically start on demand.)
</p>
<h3><span class="mw-headline" id="Template_script">Template script</span></h3>
<pre>#!/bin/bash

microphone="alsa_input.pci-0000_00_1b.0.analog-stereo"
speakers="alsa_output.pci-0000_00_1b.0.analog-stereo"

echo "Setting up echo cancellation"
pactl load-module module-echo-cancel use_master_format=1 aec_method=webrtc \
      aec_args="analog_gain_control=0\\ digital_gain_control=1\\ experimental_agc=1\\ noise_suppression=1\\ voice_detection=1\\ extended_filter=1" \
      source_master="$microphone" source_name=mic_ec source_properties=device.description=mic_ec \
        sink_master="$speakers"     sink_name=spk_ec   sink_properties=device.description=spk_ec

echo "Creating virtual output devices"
pactl load-module module-null-sink sink_name=vsink_fx     sink_properties=device.description=vsink_fx
pactl load-module module-null-sink sink_name=vsink_fx_mic sink_properties=device.description=vsink_fx_mic

echo "Creating loopbacks"
pactl load-module module-loopback latency_msec=30 adjust_time=3 source=mic_ec           sink=vsink_fx_mic
pactl load-module module-loopback latency_msec=30 adjust_time=3 source=vsink_fx.monitor sink=vsink_fx_mic
pactl load-module module-loopback latency_msec=30 adjust_time=3 source=vsink_fx.monitor sink=spk_ec

echo "Setting default devices"
pactl set-default-source vsink_fx_mic.monitor
pactl set-default-sink   spk_ec
</pre>
<p>This script has been inspired by <a rel="nofollow"  href="https://askubuntu.com/a/915064">https://askubuntu.com/a/915064</a> , for more in-depth information also see that post's author's <a rel="nofollow"  href="https://github.com/toadjaune/pulseaudio-config">pulseaudio-config GitHub repository</a>.
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="..//Usage/Configuration/E/Category:Sound.html" title="Category:Sound">Sound</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="..//Usage/Configuration/E/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li></ul>
</div>
</div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PulseAudio/Examples&amp;oldid=615998">https://wiki.archlinux.org/index.php?title=PulseAudio/Examples&amp;oldid=615998</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 26 May 2020, at 14:51.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="..//Usage/Configuration/E/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="..//Usage/Configuration/E/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="..//Usage/Configuration/E/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



