<!--
    title: Lenovo_Yoga_c940
    description: Migration of Lenovo_Yoga_c940 from the arch Wiki to the TOS Wiki
    published: true
    date: 2020-05-28T17:58:55.000Z
    tags: 
    -->>

<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading"  lang="en">Lenovo Yoga c940</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" >From TOS Wiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<div id="toc" >
<input type="checkbox" role="button" id="toctogglecheckbox"  style="display:none"><div  lang="en" dir="ltr">
<h2>Contents</h2>
<span ><label  for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span >1</span> <span >Overview</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Installation"><span >2</span> <span >Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Booting_the_install_USB"><span >2.1</span> <span >Booting the install USB</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#Configuration"><span >3</span> <span >Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#TrackPad"><span >3.1</span> <span >TrackPad</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#TouchScreen_and_Stylus"><span >3.2</span> <span >TouchScreen and Stylus</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Video"><span >3.3</span> <span >Video</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#Audio"><span >3.4</span> <span >Audio</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Pre_linux_5.5"><span >3.4.1</span> <span >Pre linux-tos5.5</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Linux_5.5_and_later"><span >3.4.2</span> <span >Linux 5.5 and later</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Microphone"><span >3.4.3</span> <span >Microphone</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Speakers"><span >3.4.4</span> <span >Speakers</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#Bluetooth"><span >3.5</span> <span >Bluetooth</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Screen_Rotation"><span >3.6</span> <span >Screen Rotation</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#ACPI"><span >4</span> <span >ACPI</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#Hardware_information"><span >5</span> <span >Hardware information</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Troubleshooting"><span >6</span> <span >Troubleshooting</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>Most functionality works out of the box, a kernel of version 5.4 is recommended due to Ice Lake's new Thunderbolt.
</p>
<table >
<tbody>
<tr>
<td><b>Device</b></td>
<td><b>Status</b></td>
<td>
<b>Modules</b>
</td>
</tr>
<tr>
<td>Graphics</td>
<td style="color:green"><b>Working</b></td>
<td>i915
</td>
</tr>
<tr>
<td>Wireless</td>
<td style="color:green"><b>Working</b></td>
<td>iwlwifi
</td>
</tr>
<tr>
<td>Audio</td>
<td style="color:green"><b>Working</b></td>
<td>snd_sof
</td>
</tr>
<tr>
<td>Touchscreen</td>
<td style="color:green"><b>Working</b></td>
<td>wacom
</td>
</tr>
<tr>
<td>Stylus</td>
<td style="color:green">
<b>Working</b> ยน</td>
<td>wacom,usbhid
</td>
</tr>
<tr>
<td>Accelerometer</td>
<td style="color:green"><b>Working</b></td>
<td>hid_sensor_accel_3d
</td>
</tr>
<tr>
<td>Touchpad</td>
<td style="color:green"><b>Working</b></td>
<td>libinput
</td>
</tr>
<tr>
<td>Camera</td>
<td style="color:green"><b>Working</b></td>
<td>uvcvideo
</td>
</tr>
<tr>
<td>Bluetooth</td>
<td style="color:green"><b>Working</b></td>
<td>btintel
</td>
</tr>
<tr>
<td>Fingerprint Reader</td>
<td style="color:red"><b>Not Working</b></td>
<td>
</td>
</tr>
</tbody>
</table>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>Newer kernels boot without problems and the wifi should be available. If you get a blank screen after booting, the power modes are not supported by your kernel; refer to Troubleshooting.
</p>
<h3><span class="mw-headline" id="Booting_the_install_USB">Booting the install USB</span></h3>
<p>To access the boot menu and BIOS, use "F1". Disable secure boot from the BIOS.  UEFI boot mode works fine.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="TrackPad">TrackPad</span></h3>
<p>TrackPad works fine with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xf86-input-libinput">xf86-input-libinput</a></span>.
</p>
<h3><span class="mw-headline" id="TouchScreen_and_Stylus">TouchScreen and Stylus</span></h3>
<p>Touchscreen works with the Wacom driver (package: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xf86-input-wacom">xf86-input-wacom</a></span>).
Also using the Stylus, the bottom button of the pen is defined as the eraser and the top button works as a middle mouse button
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="../wiki/Tablet_PC.html" title="Tablet PC">Tablet PC</a> for more info on optimizing the touchscreen experience.</div>
<h3><span class="mw-headline" id="Video">Video</span></h3>
<p>The kernel supports Iris Plus Gen11 from version 5.3. With default configuration, tearing is apparent when playing videos. To fix tearing, create the file <code>/etc/X11/xorg.conf.d/20-intel.conf</code> with the following content:
</p>
<pre>Section "Device"
   Identifier  "Intel Graphics"
   Driver      "intel"
   Option      "TearFree"    "true"
EndSection
</pre>
<p><br>
That said there seems to be issues with Chromium based GPU acceleration, so either disabling that via Chromium flags, removing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span>, or adding the following options to <code>/etc/X11/xorg.conf.d/20-intel.conf</code>:
</p>
<pre>   Option      "NoAccel"     "true"
   Option      "DRI"         "false"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On Kubuntu 20.04 LTS, Mainline kernel version 5.7-rc seems to fix screen flickering and tearing issues that are present in Kubuntu 19.10, 20.04 and Fedora 31 with kernels 5.3 and 5.4.</div>
<h3><span class="mw-headline" id="Audio">Audio</span></h3>
<h4><span class="mw-headline" id="Pre_linux_5.5">Pre linux-tos5.5</span></h4>
<p>Audio works when using the snd_hda_intel driver, so make a file in <code>/etc/modprobe.d/alsa-base.conf</code> with
</p>
<pre>options snd_hda_intel enable=1 index=1
</pre>
<p>However Audio is partially working as there are some limitations.
</p>
<h4><span class="mw-headline" id="Linux_5.5_and_later">Linux 5.5 and later</span></h4>
<p>Audio (not including bottom facing speakers) and microphone works with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=sof-firmware">sof-firmware</a></span> and Linux 5.5 just add the following to <code>/etc/modprobe.d/blacklist.conf</code>
</p>
<pre>blacklist snd_hda_intel
blacklist snd_soc_skl
</pre>
<p>Configure PulseAudio's to load Alsa modules with the correct <code>device</code> and <code>channnel</code> settings, by adding these two lines to <code>/etc/pulse/default.pa</code>:
</p>
<pre>load-module module-alsa-sink device=hw:0,0 channels=4
load-module module-alsa-source device=hw:0,6 channels=4
</pre>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Linux kernel 5.5.6 causes a hang on udev, also reported in Fedora <a rel="nofollow"  href="https://bugzilla.redhat.com/show_bug.cgi?id=1772498#c205">here</a>. 5.5.7 fixes this.</div>
<h4><span class="mw-headline" id="Microphone">Microphone</span></h4>
<p>Microphone requires <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=sof-firmware">sof-firmware</a></span> and linux-toskernel 5.5. blacklist the above and it will work.
</p>
<p><br>
</p>
<p>Bug reports for Microphone 
</p>
<ul>
<li><a rel="nofollow"  href="https://bugzilla.kernel.org/show_bug.cgi?id=201251">https://bugzilla.kernel.org/show_bug.cgi?id=201251</a></li>
<li><a rel="nofollow"  href="https://github.com/thesofproject/sof/issues/2134">https://github.com/thesofproject/sof/issues/2134</a></li>
</ul>
<h4><span class="mw-headline" id="Speakers">Speakers</span></h4>
<p>Audio is OK, there are 5.1 speakers, 2.1 in the soundbar, and 2 under the palmrest on either side of the laptop. Only the 2 speakers in the soundbar work, and not the subwoofer. This isn't optimal, but Alsa/Pulseaudio report that its a 2 channel audio device. I have read in other articles from other Lenovo devices, like the X1 Yoga that they solve this by making the alsa/pulseaudio use 4 channels instead of 2. I haven't tried this so I cannot report on it.
</p>
<p>Thread on Alsa-devel about 5.1 speakers <a rel="nofollow"  href="https://mailman.alsa-project.org/pipermail/alsa-devel/2018-November/142369.html">https://mailman.alsa-project.org/pipermail/alsa-devel/2018-November/142369.html</a>
</p>
<p>The problem appears to be that the amplifiers for the extra speakers are turned off by default and there is no available documentation on how to turn them on; more details on <a rel="nofollow"  href="https://bugzilla.kernel.org/show_bug.cgi?id=205755#c4">bugzilla.kernel.org#205755</a>.
</p>
<p>If the speakers are detected, unmuted, and the volume is turned up yet the audio does not seem to play through the speakers, try adding <code>options snd-hda-intel dmic_detect=0</code> to <code>/etc/modprobe.d/alsa-base.conf</code> . Then, reboot.
</p>
<h3><span class="mw-headline" id="Bluetooth">Bluetooth</span></h3>
<p>The Bluetooth adapter works out of the box. 
</p>
<h3><span class="mw-headline" id="Screen_Rotation">Screen Rotation</span></h3>
<p>I personally use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=bspwm">bspwm</a></span> and for that I use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=iio-sensor-proxy">iio-sensor-proxy</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/screenrotator-git/">screenrotator-git</a></span><sup><small>AUR</small></sup>. But theres a whole article on this in <a href="../wiki/Tablet_PC.html" title="Tablet PC">Tablet PC</a>.
</p>
<h2><span class="mw-headline" id="ACPI">ACPI</span></h2>
<p>Suspend on lid works.
</p>
<p>Manual fan control does not work at all.
</p>
<p>Tablet/Laptop usage mode detection works with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://aur.archlinux.org/packages/yoga-usage-mode-dkms-git/">yoga-usage-mode-dkms-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>Battery Conservation Mode (charge to max 50%) can be set with a 0/1 in "/sys/bus/platform/drivers/ideapad_acpi/VPC2004\:00/conservation_mode" where VPC2004\:00 could vary depending on the computer.
</p>
<h2><span class="mw-headline" id="Hardware_information">Hardware information</span></h2>
<p>The output of <i>lspci</i> is
</p>
<pre>00:00.0 Host bridge: Intel Corporation Device 8a12 (rev 03)
00:02.0 VGA compatible controller: Intel Corporation Iris Plus Graphics G7 (rev 07)
00:04.0 Signal processing controller: Intel Corporation Device 8a03 (rev 03)
00:07.0 PCI bridge: Intel Corporation Ice Lake Thunderbolt 3 PCI Express Root Port #0 (rev 03)
00:07.1 PCI bridge: Intel Corporation Ice Lake Thunderbolt 3 PCI Express Root Port #1 (rev 03)
00:0d.0 USB controller: Intel Corporation Ice Lake Thunderbolt 3 USB Controller (rev 03)
00:0d.2 System peripheral: Intel Corporation Ice Lake Thunderbolt 3 NHI #0 (rev 03)
00:12.0 Serial controller: Intel Corporation Device 34fc (rev 30)
00:14.0 USB controller: Intel Corporation Ice Lake-LP USB 3.1 xHCI Host Controller (rev 30)
00:14.2 RAM memory: Intel Corporation Device 34ef (rev 30)
00:14.3 Network controller: Intel Corporation Killer Wi-Fi 6 AX1650i 160MHz Wireless Network Adapter (201NGW) (rev 30)
00:15.0 Serial bus controller [0c80]: Intel Corporation Ice Lake-LP Serial IO I2C Controller #0 (rev 30)
00:15.1 Serial bus controller [0c80]: Intel Corporation Ice Lake-LP Serial IO I2C Controller #1 (rev 30)
00:15.2 Serial bus controller [0c80]: Intel Corporation Ice Lake-LP Serial IO I2C Controller #2 (rev 30)
00:16.0 Communication controller: Intel Corporation Management Engine Interface (rev 30)
00:1d.0 PCI bridge: Intel Corporation Ice Lake-LP PCI Express Root Port #9 (rev 30)
00:1f.0 ISA bridge: Intel Corporation Ice Lake-LP LPC Controller (rev 30)
00:1f.3 Multimedia audio controller: Intel Corporation Smart Sound Technology Audio Controller (rev 30)
00:1f.4 SMBus: Intel Corporation Ice Lake-LP SMBus Controller (rev 30)
00:1f.5 Serial bus controller [0c80]: Intel Corporation Ice Lake-LP SPI Controller (rev 30)
55:00.0 Non-Volatile memory controller: Samsung Electronics Co Ltd NVMe SSD Controller SM981/PM981/PM983
</pre>
<p><br>
The output of <i>lsusb</i> is
</p>
<pre>Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 003: ID 06cb:00be Synaptics, Inc. 
Bus 003 Device 004: ID 8087:0026 Intel Corp. 
Bus 003 Device 002: ID 13d3:56b2 IMC Networks Integrated Camera
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</pre>
<p><br>
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>Most of the difficulty is getting screen rotation, sound, and the microphone to work. Other issues like Chromium/Electron apps being slow, or graphics weirdness can be solved by uninstalling the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow"  href="https://www.archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span> package
</p>
<p>If shutdown is not working and the system hangs on "reboot: Shutting down" on post 5.5 installations, try adding <code>intel_iommu=off</code> to <code>GRUB_CMDLINE_LINUX_DEFAULT</code> in <code>/etc/default/grub</code>. Then update via <code>update-grub</code>.
</p>
</div></div>
		
		<div id="catlinks"  data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../wiki/Category:Lenovo.html" title="Category:Lenovo">Lenovo</a></li></ul>
</div></div>
		<div ></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Lenovo_Yoga_c940&amp;oldid=615725">https://wiki.archlinux.org/index.php?title=Lenovo_Yoga_c940&amp;oldid=615725</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 25 May 2020, at 10:03.</li>
								<li id="footer-info-copyright">Content is available under <a  rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../wiki/TOS Wiki:Privacy_policy.html" title="TOS Wiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../wiki/TOS Wiki:About.html" title="TOS Wiki:About">About TOS Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="../wiki/TOS Wiki:General_disclaimer.html" title="TOS Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" >
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		



